{
  "version": 3,
  "sources": ["../../pdfjs-dist/build/webpack:/pdf.js/src/shared/scripting_utils.js", "../../pdfjs-dist/build/webpack:/pdf.js/src/display/annotation_layer.js", "../../pdfjs-dist/build/webpack:/pdf.js/src/display/annotation_storage.js", "../../pdfjs-dist/build/webpack:/pdf.js/src/display/api.js", "../../pdfjs-dist/build/webpack:/pdf.js/src/display/base_factory.js", "../../pdfjs-dist/build/webpack:/pdf.js/src/display/pattern_helper.js", "../../pdfjs-dist/build/webpack:/pdf.js/src/shared/image_utils.js", "../../pdfjs-dist/build/webpack:/pdf.js/src/display/canvas.js", "../../pdfjs-dist/build/webpack:/pdf.js/src/display/display_utils.js", "../../pdfjs-dist/build/webpack:/pdf.js/src/display/draw_layer.js", "../../pdfjs-dist/build/webpack:/pdf.js/src/display/editor/freetext.js", "../../pdfjs-dist/build/webpack:/pdf.js/src/display/editor/highlight.js", "../../pdfjs-dist/build/webpack:/pdf.js/src/display/editor/ink.js", "../../pdfjs-dist/build/webpack:/pdf.js/src/display/editor/stamp.js", "../../pdfjs-dist/build/webpack:/pdf.js/src/display/editor/annotation_editor_layer.js", "../../pdfjs-dist/build/webpack:/pdf.js/src/display/editor/color_picker.js", "../../pdfjs-dist/build/webpack:/pdf.js/src/display/editor/alt_text.js", "../../pdfjs-dist/build/webpack:/pdf.js/src/display/editor/toolbar.js", "../../pdfjs-dist/build/webpack:/pdf.js/src/display/editor/editor.js", "../../pdfjs-dist/build/webpack:/pdf.js/src/display/editor/outliner.js", "../../pdfjs-dist/build/webpack:/pdf.js/src/display/editor/tools.js", "../../pdfjs-dist/build/webpack:/pdf.js/src/display/fetch_stream.js", "../../pdfjs-dist/build/webpack:/pdf.js/src/display/font_loader.js", "../../pdfjs-dist/build/webpack:/pdf.js/src/display/metadata.js", "../../pdfjs-dist/build/webpack:/pdf.js/src/display/network.js", "../../pdfjs-dist/build/webpack:/pdf.js/src/display/content_disposition.js", "../../pdfjs-dist/build/webpack:/pdf.js/src/display/network_utils.js", "../../pdfjs-dist/build/webpack:/pdf.js/src/display/node_stream.js", "../../pdfjs-dist/build/webpack:/pdf.js/src/display/node_utils.js", "../../pdfjs-dist/build/webpack:/pdf.js/src/display/optional_content_config.js", "../../pdfjs-dist/build/webpack:/pdf.js/src/display/text_layer.js", "../../pdfjs-dist/build/webpack:/pdf.js/src/display/transport_stream.js", "../../pdfjs-dist/build/webpack:/pdf.js/src/display/worker_options.js", "../../pdfjs-dist/build/webpack:/pdf.js/src/display/xfa_layer.js", "../../pdfjs-dist/build/webpack:/pdf.js/src/display/xfa_text.js", "../../pdfjs-dist/build/webpack:/pdf.js/src/pdf.js", "../../pdfjs-dist/build/webpack:/pdf.js/src/shared/message_handler.js", "../../pdfjs-dist/build/webpack:/pdf.js/src/shared/murmurhash3.js", "../../pdfjs-dist/build/webpack:/pdf.js/src/shared/util.js", "../../pdfjs-dist/build/webpack:/pdf.js/webpack/bootstrap", "../../pdfjs-dist/build/webpack:/pdf.js/webpack/runtime/async module", "../../pdfjs-dist/build/webpack:/pdf.js/webpack/runtime/define property getters", "../../pdfjs-dist/build/webpack:/pdf.js/webpack/runtime/hasOwnProperty shorthand", "../../pdfjs-dist/build/webpack:/pdf.js/webpack/before-startup", "../../pdfjs-dist/build/webpack:/pdf.js/webpack/startup", "../../pdfjs-dist/build/webpack:/pdf.js/webpack/after-startup"],
  "sourcesContent": ["/* Copyright 2020 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * PLEASE NOTE: This file is currently imported in both the `../display/` and\n *              `../scripting_api/` folders, hence be EXTREMELY careful about\n *              introducing any dependencies here since that can lead to an\n *              unexpected/unnecessary size increase of the *built* files.\n */\n\nfunction makeColorComp(n) {\n  return Math.floor(Math.max(0, Math.min(1, n)) * 255)\n    .toString(16)\n    .padStart(2, \"0\");\n}\n\nfunction scaleAndClamp(x) {\n  return Math.max(0, Math.min(255, 255 * x));\n}\n\n// PDF specifications section 10.3\nclass ColorConverters {\n  static CMYK_G([c, y, m, k]) {\n    return [\"G\", 1 - Math.min(1, 0.3 * c + 0.59 * m + 0.11 * y + k)];\n  }\n\n  static G_CMYK([g]) {\n    return [\"CMYK\", 0, 0, 0, 1 - g];\n  }\n\n  static G_RGB([g]) {\n    return [\"RGB\", g, g, g];\n  }\n\n  static G_rgb([g]) {\n    g = scaleAndClamp(g);\n    return [g, g, g];\n  }\n\n  static G_HTML([g]) {\n    const G = makeColorComp(g);\n    return `#${G}${G}${G}`;\n  }\n\n  static RGB_G([r, g, b]) {\n    return [\"G\", 0.3 * r + 0.59 * g + 0.11 * b];\n  }\n\n  static RGB_rgb(color) {\n    return color.map(scaleAndClamp);\n  }\n\n  static RGB_HTML(color) {\n    return `#${color.map(makeColorComp).join(\"\")}`;\n  }\n\n  static T_HTML() {\n    return \"#00000000\";\n  }\n\n  static T_rgb() {\n    return [null];\n  }\n\n  static CMYK_RGB([c, y, m, k]) {\n    return [\n      \"RGB\",\n      1 - Math.min(1, c + k),\n      1 - Math.min(1, m + k),\n      1 - Math.min(1, y + k),\n    ];\n  }\n\n  static CMYK_rgb([c, y, m, k]) {\n    return [\n      scaleAndClamp(1 - Math.min(1, c + k)),\n      scaleAndClamp(1 - Math.min(1, m + k)),\n      scaleAndClamp(1 - Math.min(1, y + k)),\n    ];\n  }\n\n  static CMYK_HTML(components) {\n    const rgb = this.CMYK_RGB(components).slice(1);\n    return this.RGB_HTML(rgb);\n  }\n\n  static RGB_CMYK([r, g, b]) {\n    const c = 1 - r;\n    const m = 1 - g;\n    const y = 1 - b;\n    const k = Math.min(c, m, y);\n    return [\"CMYK\", c, m, y, k];\n  }\n}\n\nexport { ColorConverters };\n", "/* Copyright 2014 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"./api\").PDFPageProxy} PDFPageProxy */\n/** @typedef {import(\"./display_utils\").PageViewport} PageViewport */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../../web/text_accessibility.js\").TextAccessibilityManager} TextAccessibilityManager */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../../web/interfaces\").IDownloadManager} IDownloadManager */\n/** @typedef {import(\"../../web/interfaces\").IPDFLinkService} IPDFLinkService */\n\nimport {\n  AnnotationBorderStyleType,\n  AnnotationEditorType,\n  AnnotationPrefix,\n  AnnotationType,\n  FeatureTest,\n  LINE_FACTOR,\n  shadow,\n  unreachable,\n  Util,\n  warn,\n} from \"../shared/util.js\";\nimport {\n  DOMSVGFactory,\n  getFilenameFromUrl,\n  PDFDateString,\n  setLayerDimensions,\n} from \"./display_utils.js\";\nimport { AnnotationStorage } from \"./annotation_storage.js\";\nimport { ColorConverters } from \"../shared/scripting_utils.js\";\nimport { XfaLayer } from \"./xfa_layer.js\";\n\nconst DEFAULT_TAB_INDEX = 1000;\nconst DEFAULT_FONT_SIZE = 9;\nconst GetElementsByNameSet = new WeakSet();\n\nfunction getRectDims(rect) {\n  return {\n    width: rect[2] - rect[0],\n    height: rect[3] - rect[1],\n  };\n}\n\n/**\n * @typedef {Object} AnnotationElementParameters\n * @property {Object} data\n * @property {HTMLDivElement} layer\n * @property {IPDFLinkService} linkService\n * @property {IDownloadManager} [downloadManager]\n * @property {AnnotationStorage} [annotationStorage]\n * @property {string} [imageResourcesPath] - Path for image resources, mainly\n *   for annotation icons. Include trailing slash.\n * @property {boolean} renderForms\n * @property {Object} svgFactory\n * @property {boolean} [enableScripting]\n * @property {boolean} [hasJSActions]\n * @property {Object} [fieldObjects]\n */\n\nclass AnnotationElementFactory {\n  /**\n   * @param {AnnotationElementParameters} parameters\n   * @returns {AnnotationElement}\n   */\n  static create(parameters) {\n    const subtype = parameters.data.annotationType;\n\n    switch (subtype) {\n      case AnnotationType.LINK:\n        return new LinkAnnotationElement(parameters);\n\n      case AnnotationType.TEXT:\n        return new TextAnnotationElement(parameters);\n\n      case AnnotationType.WIDGET:\n        const fieldType = parameters.data.fieldType;\n\n        switch (fieldType) {\n          case \"Tx\":\n            return new TextWidgetAnnotationElement(parameters);\n          case \"Btn\":\n            if (parameters.data.radioButton) {\n              return new RadioButtonWidgetAnnotationElement(parameters);\n            } else if (parameters.data.checkBox) {\n              return new CheckboxWidgetAnnotationElement(parameters);\n            }\n            return new PushButtonWidgetAnnotationElement(parameters);\n          case \"Ch\":\n            return new ChoiceWidgetAnnotationElement(parameters);\n          case \"Sig\":\n            return new SignatureWidgetAnnotationElement(parameters);\n        }\n        return new WidgetAnnotationElement(parameters);\n\n      case AnnotationType.POPUP:\n        return new PopupAnnotationElement(parameters);\n\n      case AnnotationType.FREETEXT:\n        return new FreeTextAnnotationElement(parameters);\n\n      case AnnotationType.LINE:\n        return new LineAnnotationElement(parameters);\n\n      case AnnotationType.SQUARE:\n        return new SquareAnnotationElement(parameters);\n\n      case AnnotationType.CIRCLE:\n        return new CircleAnnotationElement(parameters);\n\n      case AnnotationType.POLYLINE:\n        return new PolylineAnnotationElement(parameters);\n\n      case AnnotationType.CARET:\n        return new CaretAnnotationElement(parameters);\n\n      case AnnotationType.INK:\n        return new InkAnnotationElement(parameters);\n\n      case AnnotationType.POLYGON:\n        return new PolygonAnnotationElement(parameters);\n\n      case AnnotationType.HIGHLIGHT:\n        return new HighlightAnnotationElement(parameters);\n\n      case AnnotationType.UNDERLINE:\n        return new UnderlineAnnotationElement(parameters);\n\n      case AnnotationType.SQUIGGLY:\n        return new SquigglyAnnotationElement(parameters);\n\n      case AnnotationType.STRIKEOUT:\n        return new StrikeOutAnnotationElement(parameters);\n\n      case AnnotationType.STAMP:\n        return new StampAnnotationElement(parameters);\n\n      case AnnotationType.FILEATTACHMENT:\n        return new FileAttachmentAnnotationElement(parameters);\n\n      default:\n        return new AnnotationElement(parameters);\n    }\n  }\n}\n\nclass AnnotationElement {\n  #hasBorder = false;\n\n  constructor(\n    parameters,\n    {\n      isRenderable = false,\n      ignoreBorder = false,\n      createQuadrilaterals = false,\n    } = {}\n  ) {\n    this.isRenderable = isRenderable;\n    this.data = parameters.data;\n    this.layer = parameters.layer;\n    this.linkService = parameters.linkService;\n    this.downloadManager = parameters.downloadManager;\n    this.imageResourcesPath = parameters.imageResourcesPath;\n    this.renderForms = parameters.renderForms;\n    this.svgFactory = parameters.svgFactory;\n    this.annotationStorage = parameters.annotationStorage;\n    this.enableScripting = parameters.enableScripting;\n    this.hasJSActions = parameters.hasJSActions;\n    this._fieldObjects = parameters.fieldObjects;\n    this.parent = parameters.parent;\n\n    if (isRenderable) {\n      this.container = this._createContainer(ignoreBorder);\n    }\n    if (createQuadrilaterals) {\n      this._createQuadrilaterals();\n    }\n  }\n\n  static _hasPopupData({ titleObj, contentsObj, richText }) {\n    return !!(titleObj?.str || contentsObj?.str || richText?.str);\n  }\n\n  get hasPopupData() {\n    return AnnotationElement._hasPopupData(this.data);\n  }\n\n  /**\n   * Create an empty container for the annotation's HTML element.\n   *\n   * @private\n   * @param {boolean} ignoreBorder\n   * @memberof AnnotationElement\n   * @returns {HTMLElement} A section element.\n   */\n  _createContainer(ignoreBorder) {\n    const {\n      data,\n      parent: { page, viewport },\n    } = this;\n\n    const container = document.createElement(\"section\");\n    container.setAttribute(\"data-annotation-id\", data.id);\n    if (!(this instanceof WidgetAnnotationElement)) {\n      container.tabIndex = DEFAULT_TAB_INDEX;\n    }\n\n    // The accessibility manager will move the annotation in the DOM in\n    // order to match the visual ordering.\n    // But if an annotation is above an other one, then we must draw it\n    // after the other one whatever the order is in the DOM, hence the\n    // use of the z-index.\n    container.style.zIndex = this.parent.zIndex++;\n\n    if (this.data.popupRef) {\n      container.setAttribute(\"aria-haspopup\", \"dialog\");\n    }\n\n    if (data.noRotate) {\n      container.classList.add(\"norotate\");\n    }\n\n    const { pageWidth, pageHeight, pageX, pageY } = viewport.rawDims;\n\n    if (!data.rect || this instanceof PopupAnnotationElement) {\n      const { rotation } = data;\n      if (!data.hasOwnCanvas && rotation !== 0) {\n        this.setRotation(rotation, container);\n      }\n      return container;\n    }\n\n    const { width, height } = getRectDims(data.rect);\n\n    // Do *not* modify `data.rect`, since that will corrupt the annotation\n    // position on subsequent calls to `_createContainer` (see issue 6804).\n    const rect = Util.normalizeRect([\n      data.rect[0],\n      page.view[3] - data.rect[1] + page.view[1],\n      data.rect[2],\n      page.view[3] - data.rect[3] + page.view[1],\n    ]);\n\n    if (!ignoreBorder && data.borderStyle.width > 0) {\n      container.style.borderWidth = `${data.borderStyle.width}px`;\n\n      const horizontalRadius = data.borderStyle.horizontalCornerRadius;\n      const verticalRadius = data.borderStyle.verticalCornerRadius;\n      if (horizontalRadius > 0 || verticalRadius > 0) {\n        const radius = `calc(${horizontalRadius}px * var(--scale-factor)) / calc(${verticalRadius}px * var(--scale-factor))`;\n        container.style.borderRadius = radius;\n      } else if (this instanceof RadioButtonWidgetAnnotationElement) {\n        const radius = `calc(${width}px * var(--scale-factor)) / calc(${height}px * var(--scale-factor))`;\n        container.style.borderRadius = radius;\n      }\n\n      switch (data.borderStyle.style) {\n        case AnnotationBorderStyleType.SOLID:\n          container.style.borderStyle = \"solid\";\n          break;\n\n        case AnnotationBorderStyleType.DASHED:\n          container.style.borderStyle = \"dashed\";\n          break;\n\n        case AnnotationBorderStyleType.BEVELED:\n          warn(\"Unimplemented border style: beveled\");\n          break;\n\n        case AnnotationBorderStyleType.INSET:\n          warn(\"Unimplemented border style: inset\");\n          break;\n\n        case AnnotationBorderStyleType.UNDERLINE:\n          container.style.borderBottomStyle = \"solid\";\n          break;\n\n        default:\n          break;\n      }\n\n      const borderColor = data.borderColor || null;\n      if (borderColor) {\n        this.#hasBorder = true;\n        container.style.borderColor = Util.makeHexColor(\n          borderColor[0] | 0,\n          borderColor[1] | 0,\n          borderColor[2] | 0\n        );\n      } else {\n        // Transparent (invisible) border, so do not draw it at all.\n        container.style.borderWidth = 0;\n      }\n    }\n\n    container.style.left = `${(100 * (rect[0] - pageX)) / pageWidth}%`;\n    container.style.top = `${(100 * (rect[1] - pageY)) / pageHeight}%`;\n\n    const { rotation } = data;\n    if (data.hasOwnCanvas || rotation === 0) {\n      container.style.width = `${(100 * width) / pageWidth}%`;\n      container.style.height = `${(100 * height) / pageHeight}%`;\n    } else {\n      this.setRotation(rotation, container);\n    }\n\n    return container;\n  }\n\n  setRotation(angle, container = this.container) {\n    if (!this.data.rect) {\n      return;\n    }\n    const { pageWidth, pageHeight } = this.parent.viewport.rawDims;\n    const { width, height } = getRectDims(this.data.rect);\n\n    let elementWidth, elementHeight;\n    if (angle % 180 === 0) {\n      elementWidth = (100 * width) / pageWidth;\n      elementHeight = (100 * height) / pageHeight;\n    } else {\n      elementWidth = (100 * height) / pageWidth;\n      elementHeight = (100 * width) / pageHeight;\n    }\n\n    container.style.width = `${elementWidth}%`;\n    container.style.height = `${elementHeight}%`;\n\n    container.setAttribute(\"data-main-rotation\", (360 - angle) % 360);\n  }\n\n  get _commonActions() {\n    const setColor = (jsName, styleName, event) => {\n      const color = event.detail[jsName];\n      const colorType = color[0];\n      const colorArray = color.slice(1);\n      event.target.style[styleName] =\n        ColorConverters[`${colorType}_HTML`](colorArray);\n      this.annotationStorage.setValue(this.data.id, {\n        [styleName]: ColorConverters[`${colorType}_rgb`](colorArray),\n      });\n    };\n\n    return shadow(this, \"_commonActions\", {\n      display: event => {\n        const { display } = event.detail;\n        // See scripting/constants.js for the values of `Display`.\n        // 0 = visible, 1 = hidden, 2 = noPrint and 3 = noView.\n        const hidden = display % 2 === 1;\n        this.container.style.visibility = hidden ? \"hidden\" : \"visible\";\n        this.annotationStorage.setValue(this.data.id, {\n          noView: hidden,\n          noPrint: display === 1 || display === 2,\n        });\n      },\n      print: event => {\n        this.annotationStorage.setValue(this.data.id, {\n          noPrint: !event.detail.print,\n        });\n      },\n      hidden: event => {\n        const { hidden } = event.detail;\n        this.container.style.visibility = hidden ? \"hidden\" : \"visible\";\n        this.annotationStorage.setValue(this.data.id, {\n          noPrint: hidden,\n          noView: hidden,\n        });\n      },\n      focus: event => {\n        setTimeout(() => event.target.focus({ preventScroll: false }), 0);\n      },\n      userName: event => {\n        // tooltip\n        event.target.title = event.detail.userName;\n      },\n      readonly: event => {\n        event.target.disabled = event.detail.readonly;\n      },\n      required: event => {\n        this._setRequired(event.target, event.detail.required);\n      },\n      bgColor: event => {\n        setColor(\"bgColor\", \"backgroundColor\", event);\n      },\n      fillColor: event => {\n        setColor(\"fillColor\", \"backgroundColor\", event);\n      },\n      fgColor: event => {\n        setColor(\"fgColor\", \"color\", event);\n      },\n      textColor: event => {\n        setColor(\"textColor\", \"color\", event);\n      },\n      borderColor: event => {\n        setColor(\"borderColor\", \"borderColor\", event);\n      },\n      strokeColor: event => {\n        setColor(\"strokeColor\", \"borderColor\", event);\n      },\n      rotation: event => {\n        const angle = event.detail.rotation;\n        this.setRotation(angle);\n        this.annotationStorage.setValue(this.data.id, {\n          rotation: angle,\n        });\n      },\n    });\n  }\n\n  _dispatchEventFromSandbox(actions, jsEvent) {\n    const commonActions = this._commonActions;\n    for (const name of Object.keys(jsEvent.detail)) {\n      const action = actions[name] || commonActions[name];\n      action?.(jsEvent);\n    }\n  }\n\n  _setDefaultPropertiesFromJS(element) {\n    if (!this.enableScripting) {\n      return;\n    }\n\n    // Some properties may have been updated thanks to JS.\n    const storedData = this.annotationStorage.getRawValue(this.data.id);\n    if (!storedData) {\n      return;\n    }\n\n    const commonActions = this._commonActions;\n    for (const [actionName, detail] of Object.entries(storedData)) {\n      const action = commonActions[actionName];\n      if (action) {\n        const eventProxy = {\n          detail: {\n            [actionName]: detail,\n          },\n          target: element,\n        };\n        action(eventProxy);\n        // The action has been consumed: no need to keep it.\n        delete storedData[actionName];\n      }\n    }\n  }\n\n  /**\n   * Create quadrilaterals from the annotation's quadpoints.\n   *\n   * @private\n   * @memberof AnnotationElement\n   */\n  _createQuadrilaterals() {\n    if (!this.container) {\n      return;\n    }\n    const { quadPoints } = this.data;\n    if (!quadPoints) {\n      return;\n    }\n\n    const [rectBlX, rectBlY, rectTrX, rectTrY] = this.data.rect;\n\n    if (quadPoints.length === 1) {\n      const [, { x: trX, y: trY }, { x: blX, y: blY }] = quadPoints[0];\n      if (\n        rectTrX === trX &&\n        rectTrY === trY &&\n        rectBlX === blX &&\n        rectBlY === blY\n      ) {\n        // The quadpoints cover the whole annotation rectangle, so no need to\n        // create a quadrilateral.\n        return;\n      }\n    }\n\n    const { style } = this.container;\n    let svgBuffer;\n    if (this.#hasBorder) {\n      const { borderColor, borderWidth } = style;\n      style.borderWidth = 0;\n      svgBuffer = [\n        \"url('data:image/svg+xml;utf8,\",\n        `<svg xmlns=\"http://www.w3.org/2000/svg\"`,\n        ` preserveAspectRatio=\"none\" viewBox=\"0 0 1 1\">`,\n        `<g fill=\"transparent\" stroke=\"${borderColor}\" stroke-width=\"${borderWidth}\">`,\n      ];\n      this.container.classList.add(\"hasBorder\");\n    }\n\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")) {\n      this.container.classList.add(\"hasClipPath\");\n    }\n\n    const width = rectTrX - rectBlX;\n    const height = rectTrY - rectBlY;\n\n    const { svgFactory } = this;\n    const svg = svgFactory.createElement(\"svg\");\n    svg.classList.add(\"quadrilateralsContainer\");\n    svg.setAttribute(\"width\", 0);\n    svg.setAttribute(\"height\", 0);\n    const defs = svgFactory.createElement(\"defs\");\n    svg.append(defs);\n    const clipPath = svgFactory.createElement(\"clipPath\");\n    const id = `clippath_${this.data.id}`;\n    clipPath.setAttribute(\"id\", id);\n    clipPath.setAttribute(\"clipPathUnits\", \"objectBoundingBox\");\n    defs.append(clipPath);\n\n    for (const [, { x: trX, y: trY }, { x: blX, y: blY }] of quadPoints) {\n      const rect = svgFactory.createElement(\"rect\");\n      const x = (blX - rectBlX) / width;\n      const y = (rectTrY - trY) / height;\n      const rectWidth = (trX - blX) / width;\n      const rectHeight = (trY - blY) / height;\n      rect.setAttribute(\"x\", x);\n      rect.setAttribute(\"y\", y);\n      rect.setAttribute(\"width\", rectWidth);\n      rect.setAttribute(\"height\", rectHeight);\n      clipPath.append(rect);\n      svgBuffer?.push(\n        `<rect vector-effect=\"non-scaling-stroke\" x=\"${x}\" y=\"${y}\" width=\"${rectWidth}\" height=\"${rectHeight}\"/>`\n      );\n    }\n\n    if (this.#hasBorder) {\n      svgBuffer.push(`</g></svg>')`);\n      style.backgroundImage = svgBuffer.join(\"\");\n    }\n\n    this.container.append(svg);\n    this.container.style.clipPath = `url(#${id})`;\n  }\n\n  /**\n   * Create a popup for the annotation's HTML element. This is used for\n   * annotations that do not have a Popup entry in the dictionary, but\n   * are of a type that works with popups (such as Highlight annotations).\n   *\n   * @private\n   * @memberof AnnotationElement\n   */\n  _createPopup() {\n    const { container, data } = this;\n    container.setAttribute(\"aria-haspopup\", \"dialog\");\n\n    const popup = new PopupAnnotationElement({\n      data: {\n        color: data.color,\n        titleObj: data.titleObj,\n        modificationDate: data.modificationDate,\n        contentsObj: data.contentsObj,\n        richText: data.richText,\n        parentRect: data.rect,\n        borderStyle: 0,\n        id: `popup_${data.id}`,\n        rotation: data.rotation,\n      },\n      parent: this.parent,\n      elements: [this],\n    });\n    this.parent.div.append(popup.render());\n  }\n\n  /**\n   * Render the annotation's HTML element(s).\n   *\n   * @public\n   * @memberof AnnotationElement\n   */\n  render() {\n    unreachable(\"Abstract method `AnnotationElement.render` called\");\n  }\n\n  /**\n   * @private\n   * @returns {Array}\n   */\n  _getElementsByName(name, skipId = null) {\n    const fields = [];\n\n    if (this._fieldObjects) {\n      const fieldObj = this._fieldObjects[name];\n      if (fieldObj) {\n        for (const { page, id, exportValues } of fieldObj) {\n          if (page === -1) {\n            continue;\n          }\n          if (id === skipId) {\n            continue;\n          }\n          const exportValue =\n            typeof exportValues === \"string\" ? exportValues : null;\n\n          const domElement = document.querySelector(\n            `[data-element-id=\"${id}\"]`\n          );\n          if (domElement && !GetElementsByNameSet.has(domElement)) {\n            warn(`_getElementsByName - element not allowed: ${id}`);\n            continue;\n          }\n          fields.push({ id, exportValue, domElement });\n        }\n      }\n      return fields;\n    }\n    // Fallback to a regular DOM lookup, to ensure that the standalone\n    // viewer components won't break.\n    for (const domElement of document.getElementsByName(name)) {\n      const { exportValue } = domElement;\n      const id = domElement.getAttribute(\"data-element-id\");\n      if (id === skipId) {\n        continue;\n      }\n      if (!GetElementsByNameSet.has(domElement)) {\n        continue;\n      }\n      fields.push({ id, exportValue, domElement });\n    }\n    return fields;\n  }\n\n  show() {\n    if (this.container) {\n      this.container.hidden = false;\n    }\n    this.popup?.maybeShow();\n  }\n\n  hide() {\n    if (this.container) {\n      this.container.hidden = true;\n    }\n    this.popup?.forceHide();\n  }\n\n  /**\n   * Get the HTML element(s) which can trigger a popup when clicked or hovered.\n   *\n   * @public\n   * @memberof AnnotationElement\n   * @returns {Array<HTMLElement>|HTMLElement} An array of elements or an\n   *          element.\n   */\n  getElementsToTriggerPopup() {\n    return this.container;\n  }\n\n  addHighlightArea() {\n    const triggers = this.getElementsToTriggerPopup();\n    if (Array.isArray(triggers)) {\n      for (const element of triggers) {\n        element.classList.add(\"highlightArea\");\n      }\n    } else {\n      triggers.classList.add(\"highlightArea\");\n    }\n  }\n\n  get _isEditable() {\n    return false;\n  }\n\n  _editOnDoubleClick() {\n    if (!this._isEditable) {\n      return;\n    }\n    const {\n      annotationEditorType: mode,\n      data: { id: editId },\n    } = this;\n    this.container.addEventListener(\"dblclick\", () => {\n      this.linkService.eventBus?.dispatch(\"switchannotationeditormode\", {\n        source: this,\n        mode,\n        editId,\n      });\n    });\n  }\n}\n\nclass LinkAnnotationElement extends AnnotationElement {\n  constructor(parameters, options = null) {\n    super(parameters, {\n      isRenderable: true,\n      ignoreBorder: !!options?.ignoreBorder,\n      createQuadrilaterals: true,\n    });\n    this.isTooltipOnly = parameters.data.isTooltipOnly;\n  }\n\n  render() {\n    const { data, linkService } = this;\n    const link = document.createElement(\"a\");\n    link.setAttribute(\"data-element-id\", data.id);\n    let isBound = false;\n\n    if (data.url) {\n      linkService.addLinkAttributes(link, data.url, data.newWindow);\n      isBound = true;\n    } else if (data.action) {\n      this._bindNamedAction(link, data.action);\n      isBound = true;\n    } else if (data.attachment) {\n      this.#bindAttachment(link, data.attachment, data.attachmentDest);\n      isBound = true;\n    } else if (data.setOCGState) {\n      this.#bindSetOCGState(link, data.setOCGState);\n      isBound = true;\n    } else if (data.dest) {\n      this._bindLink(link, data.dest);\n      isBound = true;\n    } else {\n      if (\n        data.actions &&\n        (data.actions.Action ||\n          data.actions[\"Mouse Up\"] ||\n          data.actions[\"Mouse Down\"]) &&\n        this.enableScripting &&\n        this.hasJSActions\n      ) {\n        this._bindJSAction(link, data);\n        isBound = true;\n      }\n\n      if (data.resetForm) {\n        this._bindResetFormAction(link, data.resetForm);\n        isBound = true;\n      } else if (this.isTooltipOnly && !isBound) {\n        this._bindLink(link, \"\");\n        isBound = true;\n      }\n    }\n\n    this.container.classList.add(\"linkAnnotation\");\n    if (isBound) {\n      this.container.append(link);\n    }\n\n    return this.container;\n  }\n\n  #setInternalLink() {\n    this.container.setAttribute(\"data-internal-link\", \"\");\n  }\n\n  /**\n   * Bind internal links to the link element.\n   *\n   * @private\n   * @param {Object} link\n   * @param {Object} destination\n   * @memberof LinkAnnotationElement\n   */\n  _bindLink(link, destination) {\n    link.href = this.linkService.getDestinationHash(destination);\n    link.onclick = () => {\n      if (destination) {\n        this.linkService.goToDestination(destination);\n      }\n      return false;\n    };\n    if (destination || destination === /* isTooltipOnly = */ \"\") {\n      this.#setInternalLink();\n    }\n  }\n\n  /**\n   * Bind named actions to the link element.\n   *\n   * @private\n   * @param {Object} link\n   * @param {Object} action\n   * @memberof LinkAnnotationElement\n   */\n  _bindNamedAction(link, action) {\n    link.href = this.linkService.getAnchorUrl(\"\");\n    link.onclick = () => {\n      this.linkService.executeNamedAction(action);\n      return false;\n    };\n    this.#setInternalLink();\n  }\n\n  /**\n   * Bind attachments to the link element.\n   * @param {Object} link\n   * @param {Object} attachment\n   * @param {str} [dest]\n   */\n  #bindAttachment(link, attachment, dest = null) {\n    link.href = this.linkService.getAnchorUrl(\"\");\n    link.onclick = () => {\n      this.downloadManager?.openOrDownloadData(\n        attachment.content,\n        attachment.filename,\n        dest\n      );\n      return false;\n    };\n    this.#setInternalLink();\n  }\n\n  /**\n   * Bind SetOCGState actions to the link element.\n   * @param {Object} link\n   * @param {Object} action\n   */\n  #bindSetOCGState(link, action) {\n    link.href = this.linkService.getAnchorUrl(\"\");\n    link.onclick = () => {\n      this.linkService.executeSetOCGState(action);\n      return false;\n    };\n    this.#setInternalLink();\n  }\n\n  /**\n   * Bind JS actions to the link element.\n   *\n   * @private\n   * @param {Object} link\n   * @param {Object} data\n   * @memberof LinkAnnotationElement\n   */\n  _bindJSAction(link, data) {\n    link.href = this.linkService.getAnchorUrl(\"\");\n    const map = new Map([\n      [\"Action\", \"onclick\"],\n      [\"Mouse Up\", \"onmouseup\"],\n      [\"Mouse Down\", \"onmousedown\"],\n    ]);\n    for (const name of Object.keys(data.actions)) {\n      const jsName = map.get(name);\n      if (!jsName) {\n        continue;\n      }\n      link[jsName] = () => {\n        this.linkService.eventBus?.dispatch(\"dispatcheventinsandbox\", {\n          source: this,\n          detail: {\n            id: data.id,\n            name,\n          },\n        });\n        return false;\n      };\n    }\n\n    if (!link.onclick) {\n      link.onclick = () => false;\n    }\n    this.#setInternalLink();\n  }\n\n  _bindResetFormAction(link, resetForm) {\n    const otherClickAction = link.onclick;\n    if (!otherClickAction) {\n      link.href = this.linkService.getAnchorUrl(\"\");\n    }\n    this.#setInternalLink();\n\n    if (!this._fieldObjects) {\n      warn(\n        `_bindResetFormAction - \"resetForm\" action not supported, ` +\n          \"ensure that the `fieldObjects` parameter is provided.\"\n      );\n      if (!otherClickAction) {\n        link.onclick = () => false;\n      }\n      return;\n    }\n\n    link.onclick = () => {\n      otherClickAction?.();\n\n      const {\n        fields: resetFormFields,\n        refs: resetFormRefs,\n        include,\n      } = resetForm;\n\n      const allFields = [];\n      if (resetFormFields.length !== 0 || resetFormRefs.length !== 0) {\n        const fieldIds = new Set(resetFormRefs);\n        for (const fieldName of resetFormFields) {\n          const fields = this._fieldObjects[fieldName] || [];\n          for (const { id } of fields) {\n            fieldIds.add(id);\n          }\n        }\n        for (const fields of Object.values(this._fieldObjects)) {\n          for (const field of fields) {\n            if (fieldIds.has(field.id) === include) {\n              allFields.push(field);\n            }\n          }\n        }\n      } else {\n        for (const fields of Object.values(this._fieldObjects)) {\n          allFields.push(...fields);\n        }\n      }\n\n      const storage = this.annotationStorage;\n      const allIds = [];\n      for (const field of allFields) {\n        const { id } = field;\n        allIds.push(id);\n        switch (field.type) {\n          case \"text\": {\n            const value = field.defaultValue || \"\";\n            storage.setValue(id, { value });\n            break;\n          }\n          case \"checkbox\":\n          case \"radiobutton\": {\n            const value = field.defaultValue === field.exportValues;\n            storage.setValue(id, { value });\n            break;\n          }\n          case \"combobox\":\n          case \"listbox\": {\n            const value = field.defaultValue || \"\";\n            storage.setValue(id, { value });\n            break;\n          }\n          default:\n            continue;\n        }\n\n        const domElement = document.querySelector(`[data-element-id=\"${id}\"]`);\n        if (!domElement) {\n          continue;\n        } else if (!GetElementsByNameSet.has(domElement)) {\n          warn(`_bindResetFormAction - element not allowed: ${id}`);\n          continue;\n        }\n        domElement.dispatchEvent(new Event(\"resetform\"));\n      }\n\n      if (this.enableScripting) {\n        // Update the values in the sandbox.\n        this.linkService.eventBus?.dispatch(\"dispatcheventinsandbox\", {\n          source: this,\n          detail: {\n            id: \"app\",\n            ids: allIds,\n            name: \"ResetForm\",\n          },\n        });\n      }\n\n      return false;\n    };\n  }\n}\n\nclass TextAnnotationElement extends AnnotationElement {\n  constructor(parameters) {\n    super(parameters, { isRenderable: true });\n  }\n\n  render() {\n    this.container.classList.add(\"textAnnotation\");\n\n    const image = document.createElement(\"img\");\n    image.src =\n      this.imageResourcesPath +\n      \"annotation-\" +\n      this.data.name.toLowerCase() +\n      \".svg\";\n    image.setAttribute(\"data-l10n-id\", \"pdfjs-text-annotation-type\");\n    image.setAttribute(\n      \"data-l10n-args\",\n      JSON.stringify({ type: this.data.name })\n    );\n\n    if (!this.data.popupRef && this.hasPopupData) {\n      this._createPopup();\n    }\n\n    this.container.append(image);\n    return this.container;\n  }\n}\n\nclass WidgetAnnotationElement extends AnnotationElement {\n  render() {\n    // Show only the container for unsupported field types.\n    if (this.data.alternativeText) {\n      this.container.title = this.data.alternativeText;\n    }\n\n    return this.container;\n  }\n\n  showElementAndHideCanvas(element) {\n    if (this.data.hasOwnCanvas) {\n      if (element.previousSibling?.nodeName === \"CANVAS\") {\n        element.previousSibling.hidden = true;\n      }\n      element.hidden = false;\n    }\n  }\n\n  _getKeyModifier(event) {\n    return FeatureTest.platform.isMac ? event.metaKey : event.ctrlKey;\n  }\n\n  _setEventListener(element, elementData, baseName, eventName, valueGetter) {\n    if (baseName.includes(\"mouse\")) {\n      // Mouse events\n      element.addEventListener(baseName, event => {\n        this.linkService.eventBus?.dispatch(\"dispatcheventinsandbox\", {\n          source: this,\n          detail: {\n            id: this.data.id,\n            name: eventName,\n            value: valueGetter(event),\n            shift: event.shiftKey,\n            modifier: this._getKeyModifier(event),\n          },\n        });\n      });\n    } else {\n      // Non-mouse events\n      element.addEventListener(baseName, event => {\n        if (baseName === \"blur\") {\n          if (!elementData.focused || !event.relatedTarget) {\n            return;\n          }\n          elementData.focused = false;\n        } else if (baseName === \"focus\") {\n          if (elementData.focused) {\n            return;\n          }\n          elementData.focused = true;\n        }\n\n        if (!valueGetter) {\n          return;\n        }\n\n        this.linkService.eventBus?.dispatch(\"dispatcheventinsandbox\", {\n          source: this,\n          detail: {\n            id: this.data.id,\n            name: eventName,\n            value: valueGetter(event),\n          },\n        });\n      });\n    }\n  }\n\n  _setEventListeners(element, elementData, names, getter) {\n    for (const [baseName, eventName] of names) {\n      if (eventName === \"Action\" || this.data.actions?.[eventName]) {\n        if (eventName === \"Focus\" || eventName === \"Blur\") {\n          elementData ||= { focused: false };\n        }\n        this._setEventListener(\n          element,\n          elementData,\n          baseName,\n          eventName,\n          getter\n        );\n        if (eventName === \"Focus\" && !this.data.actions?.Blur) {\n          // Ensure that elementData will have the correct value.\n          this._setEventListener(element, elementData, \"blur\", \"Blur\", null);\n        } else if (eventName === \"Blur\" && !this.data.actions?.Focus) {\n          this._setEventListener(element, elementData, \"focus\", \"Focus\", null);\n        }\n      }\n    }\n  }\n\n  _setBackgroundColor(element) {\n    const color = this.data.backgroundColor || null;\n    element.style.backgroundColor =\n      color === null\n        ? \"transparent\"\n        : Util.makeHexColor(color[0], color[1], color[2]);\n  }\n\n  /**\n   * Apply text styles to the text in the element.\n   *\n   * @private\n   * @param {HTMLDivElement} element\n   * @memberof TextWidgetAnnotationElement\n   */\n  _setTextStyle(element) {\n    const TEXT_ALIGNMENT = [\"left\", \"center\", \"right\"];\n    const { fontColor } = this.data.defaultAppearanceData;\n    const fontSize =\n      this.data.defaultAppearanceData.fontSize || DEFAULT_FONT_SIZE;\n\n    const style = element.style;\n\n    // TODO: If the font-size is zero, calculate it based on the height and\n    //       width of the element.\n    // Not setting `style.fontSize` will use the default font-size for now.\n\n    // We don't use the font, as specified in the PDF document, for the <input>\n    // element. Hence using the original `fontSize` could look bad, which is why\n    // it's instead based on the field height.\n    // If the height is \"big\" then it could lead to a too big font size\n    // so in this case use the one we've in the pdf (hence the min).\n    let computedFontSize;\n    const BORDER_SIZE = 2;\n    const roundToOneDecimal = x => Math.round(10 * x) / 10;\n    if (this.data.multiLine) {\n      const height = Math.abs(\n        this.data.rect[3] - this.data.rect[1] - BORDER_SIZE\n      );\n      const numberOfLines = Math.round(height / (LINE_FACTOR * fontSize)) || 1;\n      const lineHeight = height / numberOfLines;\n      computedFontSize = Math.min(\n        fontSize,\n        roundToOneDecimal(lineHeight / LINE_FACTOR)\n      );\n    } else {\n      const height = Math.abs(\n        this.data.rect[3] - this.data.rect[1] - BORDER_SIZE\n      );\n      computedFontSize = Math.min(\n        fontSize,\n        roundToOneDecimal(height / LINE_FACTOR)\n      );\n    }\n    style.fontSize = `calc(${computedFontSize}px * var(--scale-factor))`;\n\n    style.color = Util.makeHexColor(fontColor[0], fontColor[1], fontColor[2]);\n\n    if (this.data.textAlignment !== null) {\n      style.textAlign = TEXT_ALIGNMENT[this.data.textAlignment];\n    }\n  }\n\n  _setRequired(element, isRequired) {\n    if (isRequired) {\n      element.setAttribute(\"required\", true);\n    } else {\n      element.removeAttribute(\"required\");\n    }\n    element.setAttribute(\"aria-required\", isRequired);\n  }\n}\n\nclass TextWidgetAnnotationElement extends WidgetAnnotationElement {\n  constructor(parameters) {\n    const isRenderable =\n      parameters.renderForms ||\n      parameters.data.hasOwnCanvas ||\n      (!parameters.data.hasAppearance && !!parameters.data.fieldValue);\n    super(parameters, { isRenderable });\n  }\n\n  setPropertyOnSiblings(base, key, value, keyInStorage) {\n    const storage = this.annotationStorage;\n    for (const element of this._getElementsByName(\n      base.name,\n      /* skipId = */ base.id\n    )) {\n      if (element.domElement) {\n        element.domElement[key] = value;\n      }\n      storage.setValue(element.id, { [keyInStorage]: value });\n    }\n  }\n\n  render() {\n    const storage = this.annotationStorage;\n    const id = this.data.id;\n\n    this.container.classList.add(\"textWidgetAnnotation\");\n\n    let element = null;\n    if (this.renderForms) {\n      // NOTE: We cannot set the values using `element.value` below, since it\n      //       prevents the AnnotationLayer rasterizer in `test/driver.js`\n      //       from parsing the elements correctly for the reference tests.\n      const storedData = storage.getValue(id, {\n        value: this.data.fieldValue,\n      });\n      let textContent = storedData.value || \"\";\n      const maxLen = storage.getValue(id, {\n        charLimit: this.data.maxLen,\n      }).charLimit;\n      if (maxLen && textContent.length > maxLen) {\n        textContent = textContent.slice(0, maxLen);\n      }\n\n      let fieldFormattedValues =\n        storedData.formattedValue || this.data.textContent?.join(\"\\n\") || null;\n      if (fieldFormattedValues && this.data.comb) {\n        fieldFormattedValues = fieldFormattedValues.replaceAll(/\\s+/g, \"\");\n      }\n\n      const elementData = {\n        userValue: textContent,\n        formattedValue: fieldFormattedValues,\n        lastCommittedValue: null,\n        commitKey: 1,\n        focused: false,\n      };\n\n      if (this.data.multiLine) {\n        element = document.createElement(\"textarea\");\n        element.textContent = fieldFormattedValues ?? textContent;\n        if (this.data.doNotScroll) {\n          element.style.overflowY = \"hidden\";\n        }\n      } else {\n        element = document.createElement(\"input\");\n        element.type = \"text\";\n        element.setAttribute(\"value\", fieldFormattedValues ?? textContent);\n        if (this.data.doNotScroll) {\n          element.style.overflowX = \"hidden\";\n        }\n      }\n      if (this.data.hasOwnCanvas) {\n        element.hidden = true;\n      }\n      GetElementsByNameSet.add(element);\n      element.setAttribute(\"data-element-id\", id);\n\n      element.disabled = this.data.readOnly;\n      element.name = this.data.fieldName;\n      element.tabIndex = DEFAULT_TAB_INDEX;\n\n      this._setRequired(element, this.data.required);\n\n      if (maxLen) {\n        element.maxLength = maxLen;\n      }\n\n      element.addEventListener(\"input\", event => {\n        storage.setValue(id, { value: event.target.value });\n        this.setPropertyOnSiblings(\n          element,\n          \"value\",\n          event.target.value,\n          \"value\"\n        );\n        elementData.formattedValue = null;\n      });\n\n      element.addEventListener(\"resetform\", event => {\n        const defaultValue = this.data.defaultFieldValue ?? \"\";\n        element.value = elementData.userValue = defaultValue;\n        elementData.formattedValue = null;\n      });\n\n      let blurListener = event => {\n        const { formattedValue } = elementData;\n        if (formattedValue !== null && formattedValue !== undefined) {\n          event.target.value = formattedValue;\n        }\n        // Reset the cursor position to the start of the field (issue 12359).\n        event.target.scrollLeft = 0;\n      };\n\n      if (this.enableScripting && this.hasJSActions) {\n        element.addEventListener(\"focus\", event => {\n          if (elementData.focused) {\n            return;\n          }\n          const { target } = event;\n          if (elementData.userValue) {\n            target.value = elementData.userValue;\n          }\n          elementData.lastCommittedValue = target.value;\n          elementData.commitKey = 1;\n          if (!this.data.actions?.Focus) {\n            elementData.focused = true;\n          }\n        });\n\n        element.addEventListener(\"updatefromsandbox\", jsEvent => {\n          this.showElementAndHideCanvas(jsEvent.target);\n          const actions = {\n            value(event) {\n              elementData.userValue = event.detail.value ?? \"\";\n              storage.setValue(id, { value: elementData.userValue.toString() });\n              event.target.value = elementData.userValue;\n            },\n            formattedValue(event) {\n              const { formattedValue } = event.detail;\n              elementData.formattedValue = formattedValue;\n              if (\n                formattedValue !== null &&\n                formattedValue !== undefined &&\n                event.target !== document.activeElement\n              ) {\n                // Input hasn't the focus so display formatted string\n                event.target.value = formattedValue;\n              }\n              storage.setValue(id, {\n                formattedValue,\n              });\n            },\n            selRange(event) {\n              event.target.setSelectionRange(...event.detail.selRange);\n            },\n            charLimit: event => {\n              const { charLimit } = event.detail;\n              const { target } = event;\n              if (charLimit === 0) {\n                target.removeAttribute(\"maxLength\");\n                return;\n              }\n\n              target.setAttribute(\"maxLength\", charLimit);\n              let value = elementData.userValue;\n              if (!value || value.length <= charLimit) {\n                return;\n              }\n              value = value.slice(0, charLimit);\n              target.value = elementData.userValue = value;\n              storage.setValue(id, { value });\n\n              this.linkService.eventBus?.dispatch(\"dispatcheventinsandbox\", {\n                source: this,\n                detail: {\n                  id,\n                  name: \"Keystroke\",\n                  value,\n                  willCommit: true,\n                  commitKey: 1,\n                  selStart: target.selectionStart,\n                  selEnd: target.selectionEnd,\n                },\n              });\n            },\n          };\n          this._dispatchEventFromSandbox(actions, jsEvent);\n        });\n\n        // Even if the field hasn't any actions\n        // leaving it can still trigger some actions with Calculate\n        element.addEventListener(\"keydown\", event => {\n          elementData.commitKey = 1;\n          // If the key is one of Escape, Enter then the data are committed.\n          // If we've a Tab then data will be committed on blur.\n          let commitKey = -1;\n          if (event.key === \"Escape\") {\n            commitKey = 0;\n          } else if (event.key === \"Enter\" && !this.data.multiLine) {\n            // When we've a multiline field, \"Enter\" key is a key as the other\n            // hence we don't commit the data (Acrobat behaves the same way)\n            // (see issue #15627).\n            commitKey = 2;\n          } else if (event.key === \"Tab\") {\n            elementData.commitKey = 3;\n          }\n          if (commitKey === -1) {\n            return;\n          }\n          const { value } = event.target;\n          if (elementData.lastCommittedValue === value) {\n            return;\n          }\n          elementData.lastCommittedValue = value;\n          // Save the entered value\n          elementData.userValue = value;\n          this.linkService.eventBus?.dispatch(\"dispatcheventinsandbox\", {\n            source: this,\n            detail: {\n              id,\n              name: \"Keystroke\",\n              value,\n              willCommit: true,\n              commitKey,\n              selStart: event.target.selectionStart,\n              selEnd: event.target.selectionEnd,\n            },\n          });\n        });\n        const _blurListener = blurListener;\n        blurListener = null;\n        element.addEventListener(\"blur\", event => {\n          if (!elementData.focused || !event.relatedTarget) {\n            return;\n          }\n          if (!this.data.actions?.Blur) {\n            elementData.focused = false;\n          }\n          const { value } = event.target;\n          elementData.userValue = value;\n          if (elementData.lastCommittedValue !== value) {\n            this.linkService.eventBus?.dispatch(\"dispatcheventinsandbox\", {\n              source: this,\n              detail: {\n                id,\n                name: \"Keystroke\",\n                value,\n                willCommit: true,\n                commitKey: elementData.commitKey,\n                selStart: event.target.selectionStart,\n                selEnd: event.target.selectionEnd,\n              },\n            });\n          }\n          _blurListener(event);\n        });\n\n        if (this.data.actions?.Keystroke) {\n          element.addEventListener(\"beforeinput\", event => {\n            elementData.lastCommittedValue = null;\n            const { data, target } = event;\n            const { value, selectionStart, selectionEnd } = target;\n\n            let selStart = selectionStart,\n              selEnd = selectionEnd;\n\n            switch (event.inputType) {\n              // https://rawgit.com/w3c/input-events/v1/index.html#interface-InputEvent-Attributes\n              case \"deleteWordBackward\": {\n                const match = value\n                  .substring(0, selectionStart)\n                  .match(/\\w*[^\\w]*$/);\n                if (match) {\n                  selStart -= match[0].length;\n                }\n                break;\n              }\n              case \"deleteWordForward\": {\n                const match = value\n                  .substring(selectionStart)\n                  .match(/^[^\\w]*\\w*/);\n                if (match) {\n                  selEnd += match[0].length;\n                }\n                break;\n              }\n              case \"deleteContentBackward\":\n                if (selectionStart === selectionEnd) {\n                  selStart -= 1;\n                }\n                break;\n              case \"deleteContentForward\":\n                if (selectionStart === selectionEnd) {\n                  selEnd += 1;\n                }\n                break;\n            }\n\n            // We handle the event ourselves.\n            event.preventDefault();\n            this.linkService.eventBus?.dispatch(\"dispatcheventinsandbox\", {\n              source: this,\n              detail: {\n                id,\n                name: \"Keystroke\",\n                value,\n                change: data || \"\",\n                willCommit: false,\n                selStart,\n                selEnd,\n              },\n            });\n          });\n        }\n\n        this._setEventListeners(\n          element,\n          elementData,\n          [\n            [\"focus\", \"Focus\"],\n            [\"blur\", \"Blur\"],\n            [\"mousedown\", \"Mouse Down\"],\n            [\"mouseenter\", \"Mouse Enter\"],\n            [\"mouseleave\", \"Mouse Exit\"],\n            [\"mouseup\", \"Mouse Up\"],\n          ],\n          event => event.target.value\n        );\n      }\n\n      if (blurListener) {\n        element.addEventListener(\"blur\", blurListener);\n      }\n\n      if (this.data.comb) {\n        const fieldWidth = this.data.rect[2] - this.data.rect[0];\n        const combWidth = fieldWidth / maxLen;\n\n        element.classList.add(\"comb\");\n        element.style.letterSpacing = `calc(${combWidth}px * var(--scale-factor) - 1ch)`;\n      }\n    } else {\n      element = document.createElement(\"div\");\n      element.textContent = this.data.fieldValue;\n      element.style.verticalAlign = \"middle\";\n      element.style.display = \"table-cell\";\n\n      if (this.data.hasOwnCanvas) {\n        element.hidden = true;\n      }\n    }\n\n    this._setTextStyle(element);\n    this._setBackgroundColor(element);\n    this._setDefaultPropertiesFromJS(element);\n\n    this.container.append(element);\n    return this.container;\n  }\n}\n\nclass SignatureWidgetAnnotationElement extends WidgetAnnotationElement {\n  constructor(parameters) {\n    super(parameters, { isRenderable: !!parameters.data.hasOwnCanvas });\n  }\n}\n\nclass CheckboxWidgetAnnotationElement extends WidgetAnnotationElement {\n  constructor(parameters) {\n    super(parameters, { isRenderable: parameters.renderForms });\n  }\n\n  render() {\n    const storage = this.annotationStorage;\n    const data = this.data;\n    const id = data.id;\n    let value = storage.getValue(id, {\n      value: data.exportValue === data.fieldValue,\n    }).value;\n    if (typeof value === \"string\") {\n      // The value has been changed through js and set in annotationStorage.\n      value = value !== \"Off\";\n      storage.setValue(id, { value });\n    }\n\n    this.container.classList.add(\"buttonWidgetAnnotation\", \"checkBox\");\n\n    const element = document.createElement(\"input\");\n    GetElementsByNameSet.add(element);\n    element.setAttribute(\"data-element-id\", id);\n\n    element.disabled = data.readOnly;\n    this._setRequired(element, this.data.required);\n    element.type = \"checkbox\";\n    element.name = data.fieldName;\n    if (value) {\n      element.setAttribute(\"checked\", true);\n    }\n    element.setAttribute(\"exportValue\", data.exportValue);\n    element.tabIndex = DEFAULT_TAB_INDEX;\n\n    element.addEventListener(\"change\", event => {\n      const { name, checked } = event.target;\n      for (const checkbox of this._getElementsByName(name, /* skipId = */ id)) {\n        const curChecked = checked && checkbox.exportValue === data.exportValue;\n        if (checkbox.domElement) {\n          checkbox.domElement.checked = curChecked;\n        }\n        storage.setValue(checkbox.id, { value: curChecked });\n      }\n      storage.setValue(id, { value: checked });\n    });\n\n    element.addEventListener(\"resetform\", event => {\n      const defaultValue = data.defaultFieldValue || \"Off\";\n      event.target.checked = defaultValue === data.exportValue;\n    });\n\n    if (this.enableScripting && this.hasJSActions) {\n      element.addEventListener(\"updatefromsandbox\", jsEvent => {\n        const actions = {\n          value(event) {\n            event.target.checked = event.detail.value !== \"Off\";\n            storage.setValue(id, { value: event.target.checked });\n          },\n        };\n        this._dispatchEventFromSandbox(actions, jsEvent);\n      });\n\n      this._setEventListeners(\n        element,\n        null,\n        [\n          [\"change\", \"Validate\"],\n          [\"change\", \"Action\"],\n          [\"focus\", \"Focus\"],\n          [\"blur\", \"Blur\"],\n          [\"mousedown\", \"Mouse Down\"],\n          [\"mouseenter\", \"Mouse Enter\"],\n          [\"mouseleave\", \"Mouse Exit\"],\n          [\"mouseup\", \"Mouse Up\"],\n        ],\n        event => event.target.checked\n      );\n    }\n\n    this._setBackgroundColor(element);\n    this._setDefaultPropertiesFromJS(element);\n\n    this.container.append(element);\n    return this.container;\n  }\n}\n\nclass RadioButtonWidgetAnnotationElement extends WidgetAnnotationElement {\n  constructor(parameters) {\n    super(parameters, { isRenderable: parameters.renderForms });\n  }\n\n  render() {\n    this.container.classList.add(\"buttonWidgetAnnotation\", \"radioButton\");\n    const storage = this.annotationStorage;\n    const data = this.data;\n    const id = data.id;\n    let value = storage.getValue(id, {\n      value: data.fieldValue === data.buttonValue,\n    }).value;\n    if (typeof value === \"string\") {\n      // The value has been changed through js and set in annotationStorage.\n      value = value !== data.buttonValue;\n      storage.setValue(id, { value });\n    }\n\n    if (value) {\n      // It's possible that multiple radio buttons are checked.\n      // So if this one is checked we just reset the other ones.\n      // (see bug 1864136). Then when the other ones will be rendered they will\n      // unchecked (because of their value in the storage).\n      // Consequently, the first checked radio button will be the only checked\n      // one.\n      for (const radio of this._getElementsByName(\n        data.fieldName,\n        /* skipId = */ id\n      )) {\n        storage.setValue(radio.id, { value: false });\n      }\n    }\n\n    const element = document.createElement(\"input\");\n    GetElementsByNameSet.add(element);\n    element.setAttribute(\"data-element-id\", id);\n\n    element.disabled = data.readOnly;\n    this._setRequired(element, this.data.required);\n    element.type = \"radio\";\n    element.name = data.fieldName;\n    if (value) {\n      element.setAttribute(\"checked\", true);\n    }\n    element.tabIndex = DEFAULT_TAB_INDEX;\n\n    element.addEventListener(\"change\", event => {\n      const { name, checked } = event.target;\n      for (const radio of this._getElementsByName(name, /* skipId = */ id)) {\n        storage.setValue(radio.id, { value: false });\n      }\n      storage.setValue(id, { value: checked });\n    });\n\n    element.addEventListener(\"resetform\", event => {\n      const defaultValue = data.defaultFieldValue;\n      event.target.checked =\n        defaultValue !== null &&\n        defaultValue !== undefined &&\n        defaultValue === data.buttonValue;\n    });\n\n    if (this.enableScripting && this.hasJSActions) {\n      const pdfButtonValue = data.buttonValue;\n      element.addEventListener(\"updatefromsandbox\", jsEvent => {\n        const actions = {\n          value: event => {\n            const checked = pdfButtonValue === event.detail.value;\n            for (const radio of this._getElementsByName(event.target.name)) {\n              const curChecked = checked && radio.id === id;\n              if (radio.domElement) {\n                radio.domElement.checked = curChecked;\n              }\n              storage.setValue(radio.id, { value: curChecked });\n            }\n          },\n        };\n        this._dispatchEventFromSandbox(actions, jsEvent);\n      });\n\n      this._setEventListeners(\n        element,\n        null,\n        [\n          [\"change\", \"Validate\"],\n          [\"change\", \"Action\"],\n          [\"focus\", \"Focus\"],\n          [\"blur\", \"Blur\"],\n          [\"mousedown\", \"Mouse Down\"],\n          [\"mouseenter\", \"Mouse Enter\"],\n          [\"mouseleave\", \"Mouse Exit\"],\n          [\"mouseup\", \"Mouse Up\"],\n        ],\n        event => event.target.checked\n      );\n    }\n\n    this._setBackgroundColor(element);\n    this._setDefaultPropertiesFromJS(element);\n\n    this.container.append(element);\n    return this.container;\n  }\n}\n\nclass PushButtonWidgetAnnotationElement extends LinkAnnotationElement {\n  constructor(parameters) {\n    super(parameters, { ignoreBorder: parameters.data.hasAppearance });\n  }\n\n  render() {\n    // The rendering and functionality of a push button widget annotation is\n    // equal to that of a link annotation, but may have more functionality, such\n    // as performing actions on form fields (resetting, submitting, et cetera).\n    const container = super.render();\n    container.classList.add(\"buttonWidgetAnnotation\", \"pushButton\");\n\n    if (this.data.alternativeText) {\n      container.title = this.data.alternativeText;\n    }\n\n    const linkElement = container.lastChild;\n    if (this.enableScripting && this.hasJSActions && linkElement) {\n      this._setDefaultPropertiesFromJS(linkElement);\n\n      linkElement.addEventListener(\"updatefromsandbox\", jsEvent => {\n        this._dispatchEventFromSandbox({}, jsEvent);\n      });\n    }\n\n    return container;\n  }\n}\n\nclass ChoiceWidgetAnnotationElement extends WidgetAnnotationElement {\n  constructor(parameters) {\n    super(parameters, { isRenderable: parameters.renderForms });\n  }\n\n  render() {\n    this.container.classList.add(\"choiceWidgetAnnotation\");\n    const storage = this.annotationStorage;\n    const id = this.data.id;\n\n    const storedData = storage.getValue(id, {\n      value: this.data.fieldValue,\n    });\n\n    const selectElement = document.createElement(\"select\");\n    GetElementsByNameSet.add(selectElement);\n    selectElement.setAttribute(\"data-element-id\", id);\n\n    selectElement.disabled = this.data.readOnly;\n    this._setRequired(selectElement, this.data.required);\n    selectElement.name = this.data.fieldName;\n    selectElement.tabIndex = DEFAULT_TAB_INDEX;\n\n    let addAnEmptyEntry = this.data.combo && this.data.options.length > 0;\n\n    if (!this.data.combo) {\n      // List boxes have a size and (optionally) multiple selection.\n      selectElement.size = this.data.options.length;\n      if (this.data.multiSelect) {\n        selectElement.multiple = true;\n      }\n    }\n\n    selectElement.addEventListener(\"resetform\", event => {\n      const defaultValue = this.data.defaultFieldValue;\n      for (const option of selectElement.options) {\n        option.selected = option.value === defaultValue;\n      }\n    });\n\n    // Insert the options into the choice field.\n    for (const option of this.data.options) {\n      const optionElement = document.createElement(\"option\");\n      optionElement.textContent = option.displayValue;\n      optionElement.value = option.exportValue;\n      if (storedData.value.includes(option.exportValue)) {\n        optionElement.setAttribute(\"selected\", true);\n        addAnEmptyEntry = false;\n      }\n      selectElement.append(optionElement);\n    }\n\n    let removeEmptyEntry = null;\n    if (addAnEmptyEntry) {\n      const noneOptionElement = document.createElement(\"option\");\n      noneOptionElement.value = \" \";\n      noneOptionElement.setAttribute(\"hidden\", true);\n      noneOptionElement.setAttribute(\"selected\", true);\n      selectElement.prepend(noneOptionElement);\n\n      removeEmptyEntry = () => {\n        noneOptionElement.remove();\n        selectElement.removeEventListener(\"input\", removeEmptyEntry);\n        removeEmptyEntry = null;\n      };\n      selectElement.addEventListener(\"input\", removeEmptyEntry);\n    }\n\n    const getValue = isExport => {\n      const name = isExport ? \"value\" : \"textContent\";\n      const { options, multiple } = selectElement;\n      if (!multiple) {\n        return options.selectedIndex === -1\n          ? null\n          : options[options.selectedIndex][name];\n      }\n      return Array.prototype.filter\n        .call(options, option => option.selected)\n        .map(option => option[name]);\n    };\n\n    let selectedValues = getValue(/* isExport */ false);\n\n    const getItems = event => {\n      const options = event.target.options;\n      return Array.prototype.map.call(options, option => {\n        return { displayValue: option.textContent, exportValue: option.value };\n      });\n    };\n\n    if (this.enableScripting && this.hasJSActions) {\n      selectElement.addEventListener(\"updatefromsandbox\", jsEvent => {\n        const actions = {\n          value(event) {\n            removeEmptyEntry?.();\n            const value = event.detail.value;\n            const values = new Set(Array.isArray(value) ? value : [value]);\n            for (const option of selectElement.options) {\n              option.selected = values.has(option.value);\n            }\n            storage.setValue(id, {\n              value: getValue(/* isExport */ true),\n            });\n            selectedValues = getValue(/* isExport */ false);\n          },\n          multipleSelection(event) {\n            selectElement.multiple = true;\n          },\n          remove(event) {\n            const options = selectElement.options;\n            const index = event.detail.remove;\n            options[index].selected = false;\n            selectElement.remove(index);\n            if (options.length > 0) {\n              const i = Array.prototype.findIndex.call(\n                options,\n                option => option.selected\n              );\n              if (i === -1) {\n                options[0].selected = true;\n              }\n            }\n            storage.setValue(id, {\n              value: getValue(/* isExport */ true),\n              items: getItems(event),\n            });\n            selectedValues = getValue(/* isExport */ false);\n          },\n          clear(event) {\n            while (selectElement.length !== 0) {\n              selectElement.remove(0);\n            }\n            storage.setValue(id, { value: null, items: [] });\n            selectedValues = getValue(/* isExport */ false);\n          },\n          insert(event) {\n            const { index, displayValue, exportValue } = event.detail.insert;\n            const selectChild = selectElement.children[index];\n            const optionElement = document.createElement(\"option\");\n            optionElement.textContent = displayValue;\n            optionElement.value = exportValue;\n\n            if (selectChild) {\n              selectChild.before(optionElement);\n            } else {\n              selectElement.append(optionElement);\n            }\n            storage.setValue(id, {\n              value: getValue(/* isExport */ true),\n              items: getItems(event),\n            });\n            selectedValues = getValue(/* isExport */ false);\n          },\n          items(event) {\n            const { items } = event.detail;\n            while (selectElement.length !== 0) {\n              selectElement.remove(0);\n            }\n            for (const item of items) {\n              const { displayValue, exportValue } = item;\n              const optionElement = document.createElement(\"option\");\n              optionElement.textContent = displayValue;\n              optionElement.value = exportValue;\n              selectElement.append(optionElement);\n            }\n            if (selectElement.options.length > 0) {\n              selectElement.options[0].selected = true;\n            }\n            storage.setValue(id, {\n              value: getValue(/* isExport */ true),\n              items: getItems(event),\n            });\n            selectedValues = getValue(/* isExport */ false);\n          },\n          indices(event) {\n            const indices = new Set(event.detail.indices);\n            for (const option of event.target.options) {\n              option.selected = indices.has(option.index);\n            }\n            storage.setValue(id, {\n              value: getValue(/* isExport */ true),\n            });\n            selectedValues = getValue(/* isExport */ false);\n          },\n          editable(event) {\n            event.target.disabled = !event.detail.editable;\n          },\n        };\n        this._dispatchEventFromSandbox(actions, jsEvent);\n      });\n\n      selectElement.addEventListener(\"input\", event => {\n        const exportValue = getValue(/* isExport */ true);\n        storage.setValue(id, { value: exportValue });\n\n        event.preventDefault();\n\n        this.linkService.eventBus?.dispatch(\"dispatcheventinsandbox\", {\n          source: this,\n          detail: {\n            id,\n            name: \"Keystroke\",\n            value: selectedValues,\n            changeEx: exportValue,\n            willCommit: false,\n            commitKey: 1,\n            keyDown: false,\n          },\n        });\n      });\n\n      this._setEventListeners(\n        selectElement,\n        null,\n        [\n          [\"focus\", \"Focus\"],\n          [\"blur\", \"Blur\"],\n          [\"mousedown\", \"Mouse Down\"],\n          [\"mouseenter\", \"Mouse Enter\"],\n          [\"mouseleave\", \"Mouse Exit\"],\n          [\"mouseup\", \"Mouse Up\"],\n          [\"input\", \"Action\"],\n          [\"input\", \"Validate\"],\n        ],\n        event => event.target.value\n      );\n    } else {\n      selectElement.addEventListener(\"input\", function (event) {\n        storage.setValue(id, { value: getValue(/* isExport */ true) });\n      });\n    }\n\n    if (this.data.combo) {\n      this._setTextStyle(selectElement);\n    } else {\n      // Just use the default font size...\n      // it's a bit hard to guess what is a good size.\n    }\n    this._setBackgroundColor(selectElement);\n    this._setDefaultPropertiesFromJS(selectElement);\n\n    this.container.append(selectElement);\n    return this.container;\n  }\n}\n\nclass PopupAnnotationElement extends AnnotationElement {\n  constructor(parameters) {\n    const { data, elements } = parameters;\n    super(parameters, { isRenderable: AnnotationElement._hasPopupData(data) });\n    this.elements = elements;\n  }\n\n  render() {\n    this.container.classList.add(\"popupAnnotation\");\n\n    const popup = new PopupElement({\n      container: this.container,\n      color: this.data.color,\n      titleObj: this.data.titleObj,\n      modificationDate: this.data.modificationDate,\n      contentsObj: this.data.contentsObj,\n      richText: this.data.richText,\n      rect: this.data.rect,\n      parentRect: this.data.parentRect || null,\n      parent: this.parent,\n      elements: this.elements,\n      open: this.data.open,\n    });\n\n    const elementIds = [];\n    for (const element of this.elements) {\n      element.popup = popup;\n      elementIds.push(element.data.id);\n      element.addHighlightArea();\n    }\n\n    this.container.setAttribute(\n      \"aria-controls\",\n      elementIds.map(id => `${AnnotationPrefix}${id}`).join(\",\")\n    );\n\n    return this.container;\n  }\n}\n\nclass PopupElement {\n  #boundKeyDown = this.#keyDown.bind(this);\n\n  #boundHide = this.#hide.bind(this);\n\n  #boundShow = this.#show.bind(this);\n\n  #boundToggle = this.#toggle.bind(this);\n\n  #color = null;\n\n  #container = null;\n\n  #contentsObj = null;\n\n  #dateObj = null;\n\n  #elements = null;\n\n  #parent = null;\n\n  #parentRect = null;\n\n  #pinned = false;\n\n  #popup = null;\n\n  #rect = null;\n\n  #richText = null;\n\n  #titleObj = null;\n\n  #wasVisible = false;\n\n  constructor({\n    container,\n    color,\n    elements,\n    titleObj,\n    modificationDate,\n    contentsObj,\n    richText,\n    parent,\n    rect,\n    parentRect,\n    open,\n  }) {\n    this.#container = container;\n    this.#titleObj = titleObj;\n    this.#contentsObj = contentsObj;\n    this.#richText = richText;\n    this.#parent = parent;\n    this.#color = color;\n    this.#rect = rect;\n    this.#parentRect = parentRect;\n    this.#elements = elements;\n\n    // The modification date is shown in the popup instead of the creation\n    // date if it is available and can be parsed correctly, which is\n    // consistent with other viewers such as Adobe Acrobat.\n    this.#dateObj = PDFDateString.toDateObject(modificationDate);\n\n    this.trigger = elements.flatMap(e => e.getElementsToTriggerPopup());\n    // Attach the event listeners to the trigger element.\n    for (const element of this.trigger) {\n      element.addEventListener(\"click\", this.#boundToggle);\n      element.addEventListener(\"mouseenter\", this.#boundShow);\n      element.addEventListener(\"mouseleave\", this.#boundHide);\n      element.classList.add(\"popupTriggerArea\");\n    }\n\n    // Attach the event listener to toggle the popup with the keyboard.\n    for (const element of elements) {\n      element.container?.addEventListener(\"keydown\", this.#boundKeyDown);\n    }\n\n    this.#container.hidden = true;\n    if (open) {\n      this.#toggle();\n    }\n\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")) {\n      // Since the popup is lazily created, we need to ensure that it'll be\n      // created and displayed during reference tests.\n      this.#parent.popupShow.push(async () => {\n        if (this.#container.hidden) {\n          this.#show();\n        }\n      });\n    }\n  }\n\n  render() {\n    if (this.#popup) {\n      return;\n    }\n\n    const {\n      page: { view },\n      viewport: {\n        rawDims: { pageWidth, pageHeight, pageX, pageY },\n      },\n    } = this.#parent;\n    const popup = (this.#popup = document.createElement(\"div\"));\n    popup.className = \"popup\";\n\n    if (this.#color) {\n      const baseColor = (popup.style.outlineColor = Util.makeHexColor(\n        ...this.#color\n      ));\n      if (\n        (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) ||\n        CSS.supports(\"background-color\", \"color-mix(in srgb, red 30%, white)\")\n      ) {\n        popup.style.backgroundColor = `color-mix(in srgb, ${baseColor} 30%, white)`;\n      } else {\n        // color-mix isn't supported in some browsers hence this version.\n        // See https://developer.mozilla.org/en-US/docs/Web/CSS/color_value/color-mix#browser_compatibility\n        // TODO: Use color-mix when it's supported everywhere.\n        // Enlighten the color.\n        const BACKGROUND_ENLIGHT = 0.7;\n        popup.style.backgroundColor = Util.makeHexColor(\n          ...this.#color.map(c =>\n            Math.floor(BACKGROUND_ENLIGHT * (255 - c) + c)\n          )\n        );\n      }\n    }\n\n    const header = document.createElement(\"span\");\n    header.className = \"header\";\n    const title = document.createElement(\"h1\");\n    header.append(title);\n    ({ dir: title.dir, str: title.textContent } = this.#titleObj);\n    popup.append(header);\n\n    if (this.#dateObj) {\n      const modificationDate = document.createElement(\"span\");\n      modificationDate.classList.add(\"popupDate\");\n      modificationDate.setAttribute(\n        \"data-l10n-id\",\n        \"pdfjs-annotation-date-string\"\n      );\n      modificationDate.setAttribute(\n        \"data-l10n-args\",\n        JSON.stringify({\n          date: this.#dateObj.toLocaleDateString(),\n          time: this.#dateObj.toLocaleTimeString(),\n        })\n      );\n      header.append(modificationDate);\n    }\n\n    const contentsObj = this.#contentsObj;\n    const richText = this.#richText;\n    if (\n      richText?.str &&\n      (!contentsObj?.str || contentsObj.str === richText.str)\n    ) {\n      XfaLayer.render({\n        xfaHtml: richText.html,\n        intent: \"richText\",\n        div: popup,\n      });\n      popup.lastChild.classList.add(\"richText\", \"popupContent\");\n    } else {\n      const contents = this._formatContents(contentsObj);\n      popup.append(contents);\n    }\n\n    let useParentRect = !!this.#parentRect;\n    let rect = useParentRect ? this.#parentRect : this.#rect;\n    for (const element of this.#elements) {\n      if (!rect || Util.intersect(element.data.rect, rect) !== null) {\n        rect = element.data.rect;\n        useParentRect = true;\n        break;\n      }\n    }\n\n    const normalizedRect = Util.normalizeRect([\n      rect[0],\n      view[3] - rect[1] + view[1],\n      rect[2],\n      view[3] - rect[3] + view[1],\n    ]);\n\n    const HORIZONTAL_SPACE_AFTER_ANNOTATION = 5;\n    const parentWidth = useParentRect\n      ? rect[2] - rect[0] + HORIZONTAL_SPACE_AFTER_ANNOTATION\n      : 0;\n    const popupLeft = normalizedRect[0] + parentWidth;\n    const popupTop = normalizedRect[1];\n\n    const { style } = this.#container;\n    style.left = `${(100 * (popupLeft - pageX)) / pageWidth}%`;\n    style.top = `${(100 * (popupTop - pageY)) / pageHeight}%`;\n\n    this.#container.append(popup);\n  }\n\n  /**\n   * Format the contents of the popup by adding newlines where necessary.\n   *\n   * @private\n   * @param {Object<string, string>} contentsObj\n   * @memberof PopupElement\n   * @returns {HTMLParagraphElement}\n   */\n  _formatContents({ str, dir }) {\n    const p = document.createElement(\"p\");\n    p.classList.add(\"popupContent\");\n    p.dir = dir;\n    const lines = str.split(/(?:\\r\\n?|\\n)/);\n    for (let i = 0, ii = lines.length; i < ii; ++i) {\n      const line = lines[i];\n      p.append(document.createTextNode(line));\n      if (i < ii - 1) {\n        p.append(document.createElement(\"br\"));\n      }\n    }\n    return p;\n  }\n\n  #keyDown(event) {\n    if (event.altKey || event.shiftKey || event.ctrlKey || event.metaKey) {\n      return;\n    }\n\n    if (event.key === \"Enter\" || (event.key === \"Escape\" && this.#pinned)) {\n      this.#toggle();\n    }\n  }\n\n  /**\n   * Toggle the visibility of the popup.\n   */\n  #toggle() {\n    this.#pinned = !this.#pinned;\n    if (this.#pinned) {\n      this.#show();\n      this.#container.addEventListener(\"click\", this.#boundToggle);\n      this.#container.addEventListener(\"keydown\", this.#boundKeyDown);\n    } else {\n      this.#hide();\n      this.#container.removeEventListener(\"click\", this.#boundToggle);\n      this.#container.removeEventListener(\"keydown\", this.#boundKeyDown);\n    }\n  }\n\n  /**\n   * Show the popup.\n   */\n  #show() {\n    if (!this.#popup) {\n      this.render();\n    }\n    if (!this.isVisible) {\n      this.#container.hidden = false;\n      this.#container.style.zIndex =\n        parseInt(this.#container.style.zIndex) + 1000;\n    } else if (this.#pinned) {\n      this.#container.classList.add(\"focused\");\n    }\n  }\n\n  /**\n   * Hide the popup.\n   */\n  #hide() {\n    this.#container.classList.remove(\"focused\");\n    if (this.#pinned || !this.isVisible) {\n      return;\n    }\n    this.#container.hidden = true;\n    this.#container.style.zIndex =\n      parseInt(this.#container.style.zIndex) - 1000;\n  }\n\n  forceHide() {\n    this.#wasVisible = this.isVisible;\n    if (!this.#wasVisible) {\n      return;\n    }\n    this.#container.hidden = true;\n  }\n\n  maybeShow() {\n    if (!this.#wasVisible) {\n      return;\n    }\n    this.#wasVisible = false;\n    this.#container.hidden = false;\n  }\n\n  get isVisible() {\n    return this.#container.hidden === false;\n  }\n}\n\nclass FreeTextAnnotationElement extends AnnotationElement {\n  constructor(parameters) {\n    super(parameters, { isRenderable: true, ignoreBorder: true });\n    this.textContent = parameters.data.textContent;\n    this.textPosition = parameters.data.textPosition;\n    this.annotationEditorType = AnnotationEditorType.FREETEXT;\n  }\n\n  render() {\n    this.container.classList.add(\"freeTextAnnotation\");\n\n    if (this.textContent) {\n      const content = document.createElement(\"div\");\n      content.classList.add(\"annotationTextContent\");\n      content.setAttribute(\"role\", \"comment\");\n      for (const line of this.textContent) {\n        const lineSpan = document.createElement(\"span\");\n        lineSpan.textContent = line;\n        content.append(lineSpan);\n      }\n      this.container.append(content);\n    }\n\n    if (!this.data.popupRef && this.hasPopupData) {\n      this._createPopup();\n    }\n\n    this._editOnDoubleClick();\n\n    return this.container;\n  }\n\n  get _isEditable() {\n    return this.data.hasOwnCanvas;\n  }\n}\n\nclass LineAnnotationElement extends AnnotationElement {\n  #line = null;\n\n  constructor(parameters) {\n    super(parameters, { isRenderable: true, ignoreBorder: true });\n  }\n\n  render() {\n    this.container.classList.add(\"lineAnnotation\");\n\n    // Create an invisible line with the same starting and ending coordinates\n    // that acts as the trigger for the popup. Only the line itself should\n    // trigger the popup, not the entire container.\n    const data = this.data;\n    const { width, height } = getRectDims(data.rect);\n    const svg = this.svgFactory.create(\n      width,\n      height,\n      /* skipDimensions = */ true\n    );\n\n    // PDF coordinates are calculated from a bottom left origin, so transform\n    // the line coordinates to a top left origin for the SVG element.\n    const line = (this.#line = this.svgFactory.createElement(\"svg:line\"));\n    line.setAttribute(\"x1\", data.rect[2] - data.lineCoordinates[0]);\n    line.setAttribute(\"y1\", data.rect[3] - data.lineCoordinates[1]);\n    line.setAttribute(\"x2\", data.rect[2] - data.lineCoordinates[2]);\n    line.setAttribute(\"y2\", data.rect[3] - data.lineCoordinates[3]);\n    // Ensure that the 'stroke-width' is always non-zero, since otherwise it\n    // won't be possible to open/close the popup (note e.g. issue 11122).\n    line.setAttribute(\"stroke-width\", data.borderStyle.width || 1);\n    line.setAttribute(\"stroke\", \"transparent\");\n    line.setAttribute(\"fill\", \"transparent\");\n\n    svg.append(line);\n    this.container.append(svg);\n\n    // Create the popup ourselves so that we can bind it to the line instead\n    // of to the entire container (which is the default).\n    if (!data.popupRef && this.hasPopupData) {\n      this._createPopup();\n    }\n\n    return this.container;\n  }\n\n  getElementsToTriggerPopup() {\n    return this.#line;\n  }\n\n  addHighlightArea() {\n    this.container.classList.add(\"highlightArea\");\n  }\n}\n\nclass SquareAnnotationElement extends AnnotationElement {\n  #square = null;\n\n  constructor(parameters) {\n    super(parameters, { isRenderable: true, ignoreBorder: true });\n  }\n\n  render() {\n    this.container.classList.add(\"squareAnnotation\");\n\n    // Create an invisible square with the same rectangle that acts as the\n    // trigger for the popup. Only the square itself should trigger the\n    // popup, not the entire container.\n    const data = this.data;\n    const { width, height } = getRectDims(data.rect);\n    const svg = this.svgFactory.create(\n      width,\n      height,\n      /* skipDimensions = */ true\n    );\n\n    // The browser draws half of the borders inside the square and half of\n    // the borders outside the square by default. This behavior cannot be\n    // changed programmatically, so correct for that here.\n    const borderWidth = data.borderStyle.width;\n    const square = (this.#square = this.svgFactory.createElement(\"svg:rect\"));\n    square.setAttribute(\"x\", borderWidth / 2);\n    square.setAttribute(\"y\", borderWidth / 2);\n    square.setAttribute(\"width\", width - borderWidth);\n    square.setAttribute(\"height\", height - borderWidth);\n    // Ensure that the 'stroke-width' is always non-zero, since otherwise it\n    // won't be possible to open/close the popup (note e.g. issue 11122).\n    square.setAttribute(\"stroke-width\", borderWidth || 1);\n    square.setAttribute(\"stroke\", \"transparent\");\n    square.setAttribute(\"fill\", \"transparent\");\n\n    svg.append(square);\n    this.container.append(svg);\n\n    // Create the popup ourselves so that we can bind it to the square instead\n    // of to the entire container (which is the default).\n    if (!data.popupRef && this.hasPopupData) {\n      this._createPopup();\n    }\n\n    return this.container;\n  }\n\n  getElementsToTriggerPopup() {\n    return this.#square;\n  }\n\n  addHighlightArea() {\n    this.container.classList.add(\"highlightArea\");\n  }\n}\n\nclass CircleAnnotationElement extends AnnotationElement {\n  #circle = null;\n\n  constructor(parameters) {\n    super(parameters, { isRenderable: true, ignoreBorder: true });\n  }\n\n  render() {\n    this.container.classList.add(\"circleAnnotation\");\n\n    // Create an invisible circle with the same ellipse that acts as the\n    // trigger for the popup. Only the circle itself should trigger the\n    // popup, not the entire container.\n    const data = this.data;\n    const { width, height } = getRectDims(data.rect);\n    const svg = this.svgFactory.create(\n      width,\n      height,\n      /* skipDimensions = */ true\n    );\n\n    // The browser draws half of the borders inside the circle and half of\n    // the borders outside the circle by default. This behavior cannot be\n    // changed programmatically, so correct for that here.\n    const borderWidth = data.borderStyle.width;\n    const circle = (this.#circle =\n      this.svgFactory.createElement(\"svg:ellipse\"));\n    circle.setAttribute(\"cx\", width / 2);\n    circle.setAttribute(\"cy\", height / 2);\n    circle.setAttribute(\"rx\", width / 2 - borderWidth / 2);\n    circle.setAttribute(\"ry\", height / 2 - borderWidth / 2);\n    // Ensure that the 'stroke-width' is always non-zero, since otherwise it\n    // won't be possible to open/close the popup (note e.g. issue 11122).\n    circle.setAttribute(\"stroke-width\", borderWidth || 1);\n    circle.setAttribute(\"stroke\", \"transparent\");\n    circle.setAttribute(\"fill\", \"transparent\");\n\n    svg.append(circle);\n    this.container.append(svg);\n\n    // Create the popup ourselves so that we can bind it to the circle instead\n    // of to the entire container (which is the default).\n    if (!data.popupRef && this.hasPopupData) {\n      this._createPopup();\n    }\n\n    return this.container;\n  }\n\n  getElementsToTriggerPopup() {\n    return this.#circle;\n  }\n\n  addHighlightArea() {\n    this.container.classList.add(\"highlightArea\");\n  }\n}\n\nclass PolylineAnnotationElement extends AnnotationElement {\n  #polyline = null;\n\n  constructor(parameters) {\n    super(parameters, { isRenderable: true, ignoreBorder: true });\n\n    this.containerClassName = \"polylineAnnotation\";\n    this.svgElementName = \"svg:polyline\";\n  }\n\n  render() {\n    this.container.classList.add(this.containerClassName);\n\n    // Create an invisible polyline with the same points that acts as the\n    // trigger for the popup. Only the polyline itself should trigger the\n    // popup, not the entire container.\n    const data = this.data;\n    const { width, height } = getRectDims(data.rect);\n    const svg = this.svgFactory.create(\n      width,\n      height,\n      /* skipDimensions = */ true\n    );\n\n    // Convert the vertices array to a single points string that the SVG\n    // polyline element expects (\"x1,y1 x2,y2 ...\"). PDF coordinates are\n    // calculated from a bottom left origin, so transform the polyline\n    // coordinates to a top left origin for the SVG element.\n    let points = [];\n    for (const coordinate of data.vertices) {\n      const x = coordinate.x - data.rect[0];\n      const y = data.rect[3] - coordinate.y;\n      points.push(x + \",\" + y);\n    }\n    points = points.join(\" \");\n\n    const polyline = (this.#polyline = this.svgFactory.createElement(\n      this.svgElementName\n    ));\n    polyline.setAttribute(\"points\", points);\n    // Ensure that the 'stroke-width' is always non-zero, since otherwise it\n    // won't be possible to open/close the popup (note e.g. issue 11122).\n    polyline.setAttribute(\"stroke-width\", data.borderStyle.width || 1);\n    polyline.setAttribute(\"stroke\", \"transparent\");\n    polyline.setAttribute(\"fill\", \"transparent\");\n\n    svg.append(polyline);\n    this.container.append(svg);\n\n    // Create the popup ourselves so that we can bind it to the polyline\n    // instead of to the entire container (which is the default).\n    if (!data.popupRef && this.hasPopupData) {\n      this._createPopup();\n    }\n\n    return this.container;\n  }\n\n  getElementsToTriggerPopup() {\n    return this.#polyline;\n  }\n\n  addHighlightArea() {\n    this.container.classList.add(\"highlightArea\");\n  }\n}\n\nclass PolygonAnnotationElement extends PolylineAnnotationElement {\n  constructor(parameters) {\n    // Polygons are specific forms of polylines, so reuse their logic.\n    super(parameters);\n\n    this.containerClassName = \"polygonAnnotation\";\n    this.svgElementName = \"svg:polygon\";\n  }\n}\n\nclass CaretAnnotationElement extends AnnotationElement {\n  constructor(parameters) {\n    super(parameters, { isRenderable: true, ignoreBorder: true });\n  }\n\n  render() {\n    this.container.classList.add(\"caretAnnotation\");\n\n    if (!this.data.popupRef && this.hasPopupData) {\n      this._createPopup();\n    }\n    return this.container;\n  }\n}\n\nclass InkAnnotationElement extends AnnotationElement {\n  #polylines = [];\n\n  constructor(parameters) {\n    super(parameters, { isRenderable: true, ignoreBorder: true });\n\n    this.containerClassName = \"inkAnnotation\";\n\n    // Use the polyline SVG element since it allows us to use coordinates\n    // directly and to draw both straight lines and curves.\n    this.svgElementName = \"svg:polyline\";\n    this.annotationEditorType = AnnotationEditorType.INK;\n  }\n\n  render() {\n    this.container.classList.add(this.containerClassName);\n\n    // Create an invisible polyline with the same points that acts as the\n    // trigger for the popup.\n    const data = this.data;\n    const { width, height } = getRectDims(data.rect);\n    const svg = this.svgFactory.create(\n      width,\n      height,\n      /* skipDimensions = */ true\n    );\n\n    for (const inkList of data.inkLists) {\n      // Convert the ink list to a single points string that the SVG\n      // polyline element expects (\"x1,y1 x2,y2 ...\"). PDF coordinates are\n      // calculated from a bottom left origin, so transform the polyline\n      // coordinates to a top left origin for the SVG element.\n      let points = [];\n      for (const coordinate of inkList) {\n        const x = coordinate.x - data.rect[0];\n        const y = data.rect[3] - coordinate.y;\n        points.push(`${x},${y}`);\n      }\n      points = points.join(\" \");\n\n      const polyline = this.svgFactory.createElement(this.svgElementName);\n      this.#polylines.push(polyline);\n      polyline.setAttribute(\"points\", points);\n      // Ensure that the 'stroke-width' is always non-zero, since otherwise it\n      // won't be possible to open/close the popup (note e.g. issue 11122).\n      polyline.setAttribute(\"stroke-width\", data.borderStyle.width || 1);\n      polyline.setAttribute(\"stroke\", \"transparent\");\n      polyline.setAttribute(\"fill\", \"transparent\");\n\n      // Create the popup ourselves so that we can bind it to the polyline\n      // instead of to the entire container (which is the default).\n      if (!data.popupRef && this.hasPopupData) {\n        this._createPopup();\n      }\n\n      svg.append(polyline);\n    }\n\n    this.container.append(svg);\n    return this.container;\n  }\n\n  getElementsToTriggerPopup() {\n    return this.#polylines;\n  }\n\n  addHighlightArea() {\n    this.container.classList.add(\"highlightArea\");\n  }\n}\n\nclass HighlightAnnotationElement extends AnnotationElement {\n  constructor(parameters) {\n    super(parameters, {\n      isRenderable: true,\n      ignoreBorder: true,\n      createQuadrilaterals: true,\n    });\n  }\n\n  render() {\n    if (!this.data.popupRef && this.hasPopupData) {\n      this._createPopup();\n    }\n\n    this.container.classList.add(\"highlightAnnotation\");\n    return this.container;\n  }\n}\n\nclass UnderlineAnnotationElement extends AnnotationElement {\n  constructor(parameters) {\n    super(parameters, {\n      isRenderable: true,\n      ignoreBorder: true,\n      createQuadrilaterals: true,\n    });\n  }\n\n  render() {\n    if (!this.data.popupRef && this.hasPopupData) {\n      this._createPopup();\n    }\n\n    this.container.classList.add(\"underlineAnnotation\");\n    return this.container;\n  }\n}\n\nclass SquigglyAnnotationElement extends AnnotationElement {\n  constructor(parameters) {\n    super(parameters, {\n      isRenderable: true,\n      ignoreBorder: true,\n      createQuadrilaterals: true,\n    });\n  }\n\n  render() {\n    if (!this.data.popupRef && this.hasPopupData) {\n      this._createPopup();\n    }\n\n    this.container.classList.add(\"squigglyAnnotation\");\n    return this.container;\n  }\n}\n\nclass StrikeOutAnnotationElement extends AnnotationElement {\n  constructor(parameters) {\n    super(parameters, {\n      isRenderable: true,\n      ignoreBorder: true,\n      createQuadrilaterals: true,\n    });\n  }\n\n  render() {\n    if (!this.data.popupRef && this.hasPopupData) {\n      this._createPopup();\n    }\n\n    this.container.classList.add(\"strikeoutAnnotation\");\n    return this.container;\n  }\n}\n\nclass StampAnnotationElement extends AnnotationElement {\n  constructor(parameters) {\n    super(parameters, { isRenderable: true, ignoreBorder: true });\n  }\n\n  render() {\n    this.container.classList.add(\"stampAnnotation\");\n\n    if (!this.data.popupRef && this.hasPopupData) {\n      this._createPopup();\n    }\n    return this.container;\n  }\n}\n\nclass FileAttachmentAnnotationElement extends AnnotationElement {\n  #trigger = null;\n\n  constructor(parameters) {\n    super(parameters, { isRenderable: true });\n\n    const { filename, content } = this.data.file;\n    this.filename = getFilenameFromUrl(filename, /* onlyStripPath = */ true);\n    this.content = content;\n\n    this.linkService.eventBus?.dispatch(\"fileattachmentannotation\", {\n      source: this,\n      filename,\n      content,\n    });\n  }\n\n  render() {\n    this.container.classList.add(\"fileAttachmentAnnotation\");\n\n    const { container, data } = this;\n    let trigger;\n    if (data.hasAppearance || data.fillAlpha === 0) {\n      trigger = document.createElement(\"div\");\n    } else {\n      // Unfortunately it seems that it's not clearly specified exactly what\n      // names are actually valid, since Table 184 contains:\n      //   Conforming readers shall provide predefined icon appearances for at\n      //   least the following standard names: GraphPushPin, PaperclipTag.\n      //   Additional names may be supported as well. Default value: PushPin.\n      trigger = document.createElement(\"img\");\n      trigger.src = `${this.imageResourcesPath}annotation-${\n        /paperclip/i.test(data.name) ? \"paperclip\" : \"pushpin\"\n      }.svg`;\n\n      if (data.fillAlpha && data.fillAlpha < 1) {\n        trigger.style = `filter: opacity(${Math.round(\n          data.fillAlpha * 100\n        )}%);`;\n\n        if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")) {\n          this.container.classList.add(\"hasFillAlpha\");\n        }\n      }\n    }\n    trigger.addEventListener(\"dblclick\", this.#download.bind(this));\n    this.#trigger = trigger;\n\n    const { isMac } = FeatureTest.platform;\n    container.addEventListener(\"keydown\", evt => {\n      if (evt.key === \"Enter\" && (isMac ? evt.metaKey : evt.ctrlKey)) {\n        this.#download();\n      }\n    });\n\n    if (!data.popupRef && this.hasPopupData) {\n      this._createPopup();\n    } else {\n      trigger.classList.add(\"popupTriggerArea\");\n    }\n\n    container.append(trigger);\n    return container;\n  }\n\n  getElementsToTriggerPopup() {\n    return this.#trigger;\n  }\n\n  addHighlightArea() {\n    this.container.classList.add(\"highlightArea\");\n  }\n\n  /**\n   * Download the file attachment associated with this annotation.\n   */\n  #download() {\n    this.downloadManager?.openOrDownloadData(this.content, this.filename);\n  }\n}\n\n/**\n * @typedef {Object} AnnotationLayerParameters\n * @property {PageViewport} viewport\n * @property {HTMLDivElement} div\n * @property {Array} annotations\n * @property {PDFPageProxy} page\n * @property {IPDFLinkService} linkService\n * @property {IDownloadManager} downloadManager\n * @property {AnnotationStorage} [annotationStorage]\n * @property {string} [imageResourcesPath] - Path for image resources, mainly\n *   for annotation icons. Include trailing slash.\n * @property {boolean} renderForms\n * @property {boolean} [enableScripting] - Enable embedded script execution.\n * @property {boolean} [hasJSActions] - Some fields have JS actions.\n *   The default value is `false`.\n * @property {Object<string, Array<Object>> | null} [fieldObjects]\n * @property {Map<string, HTMLCanvasElement>} [annotationCanvasMap]\n * @property {TextAccessibilityManager} [accessibilityManager]\n */\n\n/**\n * Manage the layer containing all the annotations.\n */\nclass AnnotationLayer {\n  #accessibilityManager = null;\n\n  #annotationCanvasMap = null;\n\n  #editableAnnotations = new Map();\n\n  constructor({\n    div,\n    accessibilityManager,\n    annotationCanvasMap,\n    page,\n    viewport,\n  }) {\n    this.div = div;\n    this.#accessibilityManager = accessibilityManager;\n    this.#annotationCanvasMap = annotationCanvasMap;\n    this.page = page;\n    this.viewport = viewport;\n    this.zIndex = 0;\n\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")) {\n      // For testing purposes.\n      Object.defineProperty(this, \"showPopups\", {\n        value: async () => {\n          for (const show of this.popupShow) {\n            await show();\n          }\n        },\n      });\n      this.popupShow = [];\n    }\n  }\n\n  #appendElement(element, id) {\n    const contentElement = element.firstChild || element;\n    contentElement.id = `${AnnotationPrefix}${id}`;\n\n    this.div.append(element);\n    this.#accessibilityManager?.moveElementInDOM(\n      this.div,\n      element,\n      contentElement,\n      /* isRemovable = */ false\n    );\n  }\n\n  /**\n   * Render a new annotation layer with all annotation elements.\n   *\n   * @param {AnnotationLayerParameters} params\n   * @memberof AnnotationLayer\n   */\n  async render(params) {\n    const { annotations } = params;\n    const layer = this.div;\n    setLayerDimensions(layer, this.viewport);\n\n    const popupToElements = new Map();\n    const elementParams = {\n      data: null,\n      layer,\n      linkService: params.linkService,\n      downloadManager: params.downloadManager,\n      imageResourcesPath: params.imageResourcesPath || \"\",\n      renderForms: params.renderForms !== false,\n      svgFactory: new DOMSVGFactory(),\n      annotationStorage: params.annotationStorage || new AnnotationStorage(),\n      enableScripting: params.enableScripting === true,\n      hasJSActions: params.hasJSActions,\n      fieldObjects: params.fieldObjects,\n      parent: this,\n      elements: null,\n    };\n\n    for (const data of annotations) {\n      if (data.noHTML) {\n        continue;\n      }\n      const isPopupAnnotation = data.annotationType === AnnotationType.POPUP;\n      if (!isPopupAnnotation) {\n        const { width, height } = getRectDims(data.rect);\n        if (width <= 0 || height <= 0) {\n          continue; // Ignore empty annotations.\n        }\n      } else {\n        const elements = popupToElements.get(data.id);\n        if (!elements) {\n          // Ignore popup annotations without a corresponding annotation.\n          continue;\n        }\n        elementParams.elements = elements;\n      }\n      elementParams.data = data;\n      const element = AnnotationElementFactory.create(elementParams);\n\n      if (!element.isRenderable) {\n        continue;\n      }\n\n      if (!isPopupAnnotation && data.popupRef) {\n        const elements = popupToElements.get(data.popupRef);\n        if (!elements) {\n          popupToElements.set(data.popupRef, [element]);\n        } else {\n          elements.push(element);\n        }\n      }\n\n      if (element.annotationEditorType > 0) {\n        this.#editableAnnotations.set(element.data.id, element);\n      }\n\n      const rendered = element.render();\n      if (data.hidden) {\n        rendered.style.visibility = \"hidden\";\n      }\n      this.#appendElement(rendered, data.id);\n    }\n\n    this.#setAnnotationCanvasMap();\n  }\n\n  /**\n   * Update the annotation elements on existing annotation layer.\n   *\n   * @param {AnnotationLayerParameters} viewport\n   * @memberof AnnotationLayer\n   */\n  update({ viewport }) {\n    const layer = this.div;\n    this.viewport = viewport;\n    setLayerDimensions(layer, { rotation: viewport.rotation });\n\n    this.#setAnnotationCanvasMap();\n    layer.hidden = false;\n  }\n\n  #setAnnotationCanvasMap() {\n    if (!this.#annotationCanvasMap) {\n      return;\n    }\n    const layer = this.div;\n    for (const [id, canvas] of this.#annotationCanvasMap) {\n      const element = layer.querySelector(`[data-annotation-id=\"${id}\"]`);\n      if (!element) {\n        continue;\n      }\n\n      const { firstChild } = element;\n      if (!firstChild) {\n        element.append(canvas);\n      } else if (firstChild.nodeName === \"CANVAS\") {\n        firstChild.replaceWith(canvas);\n      } else {\n        firstChild.before(canvas);\n      }\n    }\n    this.#annotationCanvasMap.clear();\n  }\n\n  getEditableAnnotations() {\n    return Array.from(this.#editableAnnotations.values());\n  }\n\n  getEditableAnnotation(id) {\n    return this.#editableAnnotations.get(id);\n  }\n}\n\nexport {\n  AnnotationLayer,\n  FreeTextAnnotationElement,\n  InkAnnotationElement,\n  StampAnnotationElement,\n};\n", "/* Copyright 2020 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { objectFromMap, unreachable } from \"../shared/util.js\";\nimport { AnnotationEditor } from \"./editor/editor.js\";\nimport { MurmurHash3_64 } from \"../shared/murmurhash3.js\";\n\nconst SerializableEmpty = Object.freeze({\n  map: null,\n  hash: \"\",\n  transfer: undefined,\n});\n\n/**\n * Key/value storage for annotation data in forms.\n */\nclass AnnotationStorage {\n  #modified = false;\n\n  #storage = new Map();\n\n  constructor() {\n    // Callbacks to signal when the modification state is set or reset.\n    // This is used by the viewer to only bind on `beforeunload` if forms\n    // are actually edited to prevent doing so unconditionally since that\n    // can have undesirable effects.\n    this.onSetModified = null;\n    this.onResetModified = null;\n    this.onAnnotationEditor = null;\n  }\n\n  /**\n   * Get the value for a given key if it exists, or return the default value.\n   * @param {string} key\n   * @param {Object} defaultValue\n   * @returns {Object}\n   */\n  getValue(key, defaultValue) {\n    const value = this.#storage.get(key);\n    if (value === undefined) {\n      return defaultValue;\n    }\n\n    return Object.assign(defaultValue, value);\n  }\n\n  /**\n   * Get the value for a given key.\n   * @param {string} key\n   * @returns {Object}\n   */\n  getRawValue(key) {\n    return this.#storage.get(key);\n  }\n\n  /**\n   * Remove a value from the storage.\n   * @param {string} key\n   */\n  remove(key) {\n    this.#storage.delete(key);\n\n    if (this.#storage.size === 0) {\n      this.resetModified();\n    }\n\n    if (typeof this.onAnnotationEditor === \"function\") {\n      for (const value of this.#storage.values()) {\n        if (value instanceof AnnotationEditor) {\n          return;\n        }\n      }\n      this.onAnnotationEditor(null);\n    }\n  }\n\n  /**\n   * Set the value for a given key\n   * @param {string} key\n   * @param {Object} value\n   */\n  setValue(key, value) {\n    const obj = this.#storage.get(key);\n    let modified = false;\n    if (obj !== undefined) {\n      for (const [entry, val] of Object.entries(value)) {\n        if (obj[entry] !== val) {\n          modified = true;\n          obj[entry] = val;\n        }\n      }\n    } else {\n      modified = true;\n      this.#storage.set(key, value);\n    }\n    if (modified) {\n      this.#setModified();\n    }\n\n    if (\n      value instanceof AnnotationEditor &&\n      typeof this.onAnnotationEditor === \"function\"\n    ) {\n      this.onAnnotationEditor(value.constructor._type);\n    }\n  }\n\n  /**\n   * Check if the storage contains the given key.\n   * @param {string} key\n   * @returns {boolean}\n   */\n  has(key) {\n    return this.#storage.has(key);\n  }\n\n  /**\n   * @returns {Object | null}\n   */\n  getAll() {\n    return this.#storage.size > 0 ? objectFromMap(this.#storage) : null;\n  }\n\n  /**\n   * @param {Object} obj\n   */\n  setAll(obj) {\n    for (const [key, val] of Object.entries(obj)) {\n      this.setValue(key, val);\n    }\n  }\n\n  get size() {\n    return this.#storage.size;\n  }\n\n  #setModified() {\n    if (!this.#modified) {\n      this.#modified = true;\n      if (typeof this.onSetModified === \"function\") {\n        this.onSetModified();\n      }\n    }\n  }\n\n  resetModified() {\n    if (this.#modified) {\n      this.#modified = false;\n      if (typeof this.onResetModified === \"function\") {\n        this.onResetModified();\n      }\n    }\n  }\n\n  /**\n   * @returns {PrintAnnotationStorage}\n   */\n  get print() {\n    return new PrintAnnotationStorage(this);\n  }\n\n  /**\n   * PLEASE NOTE: Only intended for usage within the API itself.\n   * @ignore\n   */\n  get serializable() {\n    if (this.#storage.size === 0) {\n      return SerializableEmpty;\n    }\n    const map = new Map(),\n      hash = new MurmurHash3_64(),\n      transfer = [];\n    const context = Object.create(null);\n    let hasBitmap = false;\n\n    for (const [key, val] of this.#storage) {\n      const serialized =\n        val instanceof AnnotationEditor\n          ? val.serialize(/* isForCopying = */ false, context)\n          : val;\n      if (serialized) {\n        map.set(key, serialized);\n\n        hash.update(`${key}:${JSON.stringify(serialized)}`);\n        hasBitmap ||= !!serialized.bitmap;\n      }\n    }\n\n    if (hasBitmap) {\n      // We must transfer the bitmap data separately, since it can be changed\n      // during serialization with SVG images.\n      for (const value of map.values()) {\n        if (value.bitmap) {\n          transfer.push(value.bitmap);\n        }\n      }\n    }\n\n    return map.size > 0\n      ? { map, hash: hash.hexdigest(), transfer }\n      : SerializableEmpty;\n  }\n}\n\n/**\n * A special `AnnotationStorage` for use during printing, where the serializable\n * data is *frozen* upon initialization, to prevent scripting from modifying its\n * contents. (Necessary since printing is triggered synchronously in browsers.)\n */\nclass PrintAnnotationStorage extends AnnotationStorage {\n  #serializable;\n\n  constructor(parent) {\n    super();\n    const { map, hash, transfer } = parent.serializable;\n    // Create a *copy* of the data, since Objects are passed by reference in JS.\n    const clone = structuredClone(map, transfer ? { transfer } : null);\n\n    this.#serializable = { map: clone, hash, transfer };\n  }\n\n  /**\n   * @returns {PrintAnnotationStorage}\n   */\n  // eslint-disable-next-line getter-return\n  get print() {\n    unreachable(\"Should not call PrintAnnotationStorage.print\");\n  }\n\n  /**\n   * PLEASE NOTE: Only intended for usage within the API itself.\n   * @ignore\n   */\n  get serializable() {\n    return this.#serializable;\n  }\n}\n\nexport { AnnotationStorage, PrintAnnotationStorage, SerializableEmpty };\n", "/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @module pdfjsLib\n */\n\nimport {\n  AbortException,\n  AnnotationMode,\n  assert,\n  getVerbosityLevel,\n  info,\n  InvalidPDFException,\n  isArrayBuffer,\n  isNodeJS,\n  MAX_IMAGE_SIZE_TO_CACHE,\n  MissingPDFException,\n  PasswordException,\n  PromiseCapability,\n  RenderingIntentFlag,\n  setVerbosityLevel,\n  shadow,\n  stringToBytes,\n  UnexpectedResponseException,\n  UnknownErrorException,\n  unreachable,\n  warn,\n} from \"../shared/util.js\";\nimport {\n  AnnotationStorage,\n  PrintAnnotationStorage,\n  SerializableEmpty,\n} from \"./annotation_storage.js\";\nimport {\n  DOMCanvasFactory,\n  DOMCMapReaderFactory,\n  DOMFilterFactory,\n  DOMStandardFontDataFactory,\n  isDataScheme,\n  isValidFetchUrl,\n  PageViewport,\n  RenderingCancelledException,\n  StatTimer,\n} from \"./display_utils.js\";\nimport { FontFaceObject, FontLoader } from \"./font_loader.js\";\nimport {\n  NodeCanvasFactory,\n  NodeCMapReaderFactory,\n  NodeFilterFactory,\n  NodeStandardFontDataFactory,\n} from \"display-node_utils\";\nimport { CanvasGraphics } from \"./canvas.js\";\nimport { GlobalWorkerOptions } from \"./worker_options.js\";\nimport { MessageHandler } from \"../shared/message_handler.js\";\nimport { Metadata } from \"./metadata.js\";\nimport { OptionalContentConfig } from \"./optional_content_config.js\";\nimport { PDFDataTransportStream } from \"./transport_stream.js\";\nimport { PDFFetchStream } from \"display-fetch_stream\";\nimport { PDFNetworkStream } from \"display-network\";\nimport { PDFNodeStream } from \"display-node_stream\";\nimport { XfaText } from \"./xfa_text.js\";\n\nconst DEFAULT_RANGE_CHUNK_SIZE = 65536; // 2^16 = 65536\nconst RENDERING_CANCELLED_TIMEOUT = 100; // ms\nconst DELAYED_CLEANUP_TIMEOUT = 5000; // ms\n\nconst DefaultCanvasFactory =\n  typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"GENERIC\") && isNodeJS\n    ? NodeCanvasFactory\n    : DOMCanvasFactory;\nconst DefaultCMapReaderFactory =\n  typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"GENERIC\") && isNodeJS\n    ? NodeCMapReaderFactory\n    : DOMCMapReaderFactory;\nconst DefaultFilterFactory =\n  typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"GENERIC\") && isNodeJS\n    ? NodeFilterFactory\n    : DOMFilterFactory;\nconst DefaultStandardFontDataFactory =\n  typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"GENERIC\") && isNodeJS\n    ? NodeStandardFontDataFactory\n    : DOMStandardFontDataFactory;\n\n/**\n * @typedef { Int8Array | Uint8Array | Uint8ClampedArray |\n *            Int16Array | Uint16Array |\n *            Int32Array | Uint32Array | Float32Array |\n *            Float64Array\n * } TypedArray\n */\n\n/**\n * @typedef { TypedArray | ArrayBuffer | Array<number> | string } BinaryData\n */\n\n/**\n * @typedef {Object} RefProxy\n * @property {number} num\n * @property {number} gen\n */\n\n/**\n * Document initialization / loading parameters object.\n *\n * @typedef {Object} DocumentInitParameters\n * @property {string | URL} [url] - The URL of the PDF.\n * @property {BinaryData} [data] - Binary PDF data.\n *   Use TypedArrays (Uint8Array) to improve the memory usage. If PDF data is\n *   BASE64-encoded, use `atob()` to convert it to a binary string first.\n *\n *   NOTE: If TypedArrays are used they will generally be transferred to the\n *   worker-thread. This will help reduce main-thread memory usage, however\n *   it will take ownership of the TypedArrays.\n * @property {Object} [httpHeaders] - Basic authentication headers.\n * @property {boolean} [withCredentials] - Indicates whether or not\n *   cross-site Access-Control requests should be made using credentials such\n *   as cookies or authorization headers. The default is `false`.\n * @property {string} [password] - For decrypting password-protected PDFs.\n * @property {number} [length] - The PDF file length. It's used for progress\n *   reports and range requests operations.\n * @property {PDFDataRangeTransport} [range] - Allows for using a custom range\n *   transport implementation.\n * @property {number} [rangeChunkSize] - Specify maximum number of bytes fetched\n *   per range request. The default value is {@link DEFAULT_RANGE_CHUNK_SIZE}.\n * @property {PDFWorker} [worker] - The worker that will be used for loading and\n *   parsing the PDF data.\n * @property {number} [verbosity] - Controls the logging level; the constants\n *   from {@link VerbosityLevel} should be used.\n * @property {string} [docBaseUrl] - The base URL of the document, used when\n *   attempting to recover valid absolute URLs for annotations, and outline\n *   items, that (incorrectly) only specify relative URLs.\n * @property {string} [cMapUrl] - The URL where the predefined Adobe CMaps are\n *   located. Include the trailing slash.\n * @property {boolean} [cMapPacked] - Specifies if the Adobe CMaps are binary\n *   packed or not. The default value is `true`.\n * @property {Object} [CMapReaderFactory] - The factory that will be used when\n *   reading built-in CMap files. Providing a custom factory is useful for\n *   environments without Fetch API or `XMLHttpRequest` support, such as\n *   Node.js. The default value is {DOMCMapReaderFactory}.\n * @property {boolean} [useSystemFonts] - When `true`, fonts that aren't\n *   embedded in the PDF document will fallback to a system font.\n *   The default value is `true` in web environments and `false` in Node.js;\n *   unless `disableFontFace === true` in which case this defaults to `false`\n *   regardless of the environment (to prevent completely broken fonts).\n * @property {string} [standardFontDataUrl] - The URL where the standard font\n *   files are located. Include the trailing slash.\n * @property {Object} [StandardFontDataFactory] - The factory that will be used\n *   when reading the standard font files. Providing a custom factory is useful\n *   for environments without Fetch API or `XMLHttpRequest` support, such as\n *   Node.js. The default value is {DOMStandardFontDataFactory}.\n * @property {boolean} [useWorkerFetch] - Enable using the Fetch API in the\n *   worker-thread when reading CMap and standard font files. When `true`,\n *   the `CMapReaderFactory` and `StandardFontDataFactory` options are ignored.\n *   The default value is `true` in web environments and `false` in Node.js.\n * @property {boolean} [stopAtErrors] - Reject certain promises, e.g.\n *   `getOperatorList`, `getTextContent`, and `RenderTask`, when the associated\n *   PDF data cannot be successfully parsed, instead of attempting to recover\n *   whatever possible of the data. The default value is `false`.\n * @property {number} [maxImageSize] - The maximum allowed image size in total\n *   pixels, i.e. width * height. Images above this value will not be rendered.\n *   Use -1 for no limit, which is also the default value.\n * @property {boolean} [isEvalSupported] - Determines if we can evaluate strings\n *   as JavaScript. Primarily used to improve performance of font rendering, and\n *   when parsing PDF functions. The default value is `true`.\n * @property {boolean} [isOffscreenCanvasSupported] - Determines if we can use\n *   `OffscreenCanvas` in the worker. Primarily used to improve performance of\n *   image conversion/rendering.\n *   The default value is `true` in web environments and `false` in Node.js.\n * @property {number} [canvasMaxAreaInBytes] - The integer value is used to\n *   know when an image must be resized (uses `OffscreenCanvas` in the worker).\n *   If it's -1 then a possibly slow algorithm is used to guess the max value.\n * @property {boolean} [disableFontFace] - By default fonts are converted to\n *   OpenType fonts and loaded via the Font Loading API or `@font-face` rules.\n *   If disabled, fonts will be rendered using a built-in font renderer that\n *   constructs the glyphs with primitive path commands.\n *   The default value is `false` in web environments and `true` in Node.js.\n * @property {boolean} [fontExtraProperties] - Include additional properties,\n *   which are unused during rendering of PDF documents, when exporting the\n *   parsed font data from the worker-thread. This may be useful for debugging\n *   purposes (and backwards compatibility), but note that it will lead to\n *   increased memory usage. The default value is `false`.\n * @property {boolean} [enableXfa] - Render Xfa forms if any.\n *   The default value is `false`.\n * @property {HTMLDocument} [ownerDocument] - Specify an explicit document\n *   context to create elements with and to load resources, such as fonts,\n *   into. Defaults to the current document.\n * @property {boolean} [disableRange] - Disable range request loading of PDF\n *   files. When enabled, and if the server supports partial content requests,\n *   then the PDF will be fetched in chunks. The default value is `false`.\n * @property {boolean} [disableStream] - Disable streaming of PDF file data.\n *   By default PDF.js attempts to load PDF files in chunks. The default value\n *   is `false`.\n * @property {boolean} [disableAutoFetch] - Disable pre-fetching of PDF file\n *   data. When range requests are enabled PDF.js will automatically keep\n *   fetching more data even if it isn't needed to display the current page.\n *   The default value is `false`.\n *\n *   NOTE: It is also necessary to disable streaming, see above, in order for\n *   disabling of pre-fetching to work correctly.\n * @property {boolean} [pdfBug] - Enables special hooks for debugging PDF.js\n *   (see `web/debugger.js`). The default value is `false`.\n * @property {Object} [canvasFactory] - The factory instance that will be used\n *   when creating canvases. The default value is {new DOMCanvasFactory()}.\n * @property {Object} [filterFactory] - A factory instance that will be used\n *   to create SVG filters when rendering some images on the main canvas.\n */\n\n/**\n * This is the main entry point for loading a PDF and interacting with it.\n *\n * NOTE: If a URL is used to fetch the PDF data a standard Fetch API call (or\n * XHR as fallback) is used, which means it must follow same origin rules,\n * e.g. no cross-domain requests without CORS.\n *\n * @param {string | URL | TypedArray | ArrayBuffer | DocumentInitParameters}\n *   src - Can be a URL where a PDF file is located, a typed array (Uint8Array)\n *         already populated with data, or a parameter object.\n * @returns {PDFDocumentLoadingTask}\n */\nfunction getDocument(src) {\n  if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) {\n    if (typeof src === \"string\" || src instanceof URL) {\n      src = { url: src };\n    } else if (isArrayBuffer(src)) {\n      src = { data: src };\n    }\n  }\n  if (typeof src !== \"object\") {\n    throw new Error(\"Invalid parameter in getDocument, need parameter object.\");\n  }\n  if (!src.url && !src.data && !src.range) {\n    throw new Error(\n      \"Invalid parameter object: need either .data, .range or .url\"\n    );\n  }\n  const task = new PDFDocumentLoadingTask();\n  const { docId } = task;\n\n  const url = src.url ? getUrlProp(src.url) : null;\n  const data = src.data ? getDataProp(src.data) : null;\n  const httpHeaders = src.httpHeaders || null;\n  const withCredentials = src.withCredentials === true;\n  const password = src.password ?? null;\n  const rangeTransport =\n    src.range instanceof PDFDataRangeTransport ? src.range : null;\n  const rangeChunkSize =\n    Number.isInteger(src.rangeChunkSize) && src.rangeChunkSize > 0\n      ? src.rangeChunkSize\n      : DEFAULT_RANGE_CHUNK_SIZE;\n  let worker = src.worker instanceof PDFWorker ? src.worker : null;\n  const verbosity = src.verbosity;\n  // Ignore \"data:\"-URLs, since they can't be used to recover valid absolute\n  // URLs anyway. We want to avoid sending them to the worker-thread, since\n  // they contain the *entire* PDF document and can thus be arbitrarily long.\n  const docBaseUrl =\n    typeof src.docBaseUrl === \"string\" && !isDataScheme(src.docBaseUrl)\n      ? src.docBaseUrl\n      : null;\n  const cMapUrl = typeof src.cMapUrl === \"string\" ? src.cMapUrl : null;\n  const cMapPacked = src.cMapPacked !== false;\n  const CMapReaderFactory = src.CMapReaderFactory || DefaultCMapReaderFactory;\n  const standardFontDataUrl =\n    typeof src.standardFontDataUrl === \"string\"\n      ? src.standardFontDataUrl\n      : null;\n  const StandardFontDataFactory =\n    src.StandardFontDataFactory || DefaultStandardFontDataFactory;\n  const ignoreErrors = src.stopAtErrors !== true;\n  const maxImageSize =\n    Number.isInteger(src.maxImageSize) && src.maxImageSize > -1\n      ? src.maxImageSize\n      : -1;\n  const isEvalSupported = src.isEvalSupported !== false;\n  const isOffscreenCanvasSupported =\n    typeof src.isOffscreenCanvasSupported === \"boolean\"\n      ? src.isOffscreenCanvasSupported\n      : !isNodeJS;\n  const canvasMaxAreaInBytes = Number.isInteger(src.canvasMaxAreaInBytes)\n    ? src.canvasMaxAreaInBytes\n    : -1;\n  const disableFontFace =\n    typeof src.disableFontFace === \"boolean\" ? src.disableFontFace : isNodeJS;\n  const fontExtraProperties = src.fontExtraProperties === true;\n  const enableXfa = src.enableXfa === true;\n  const ownerDocument = src.ownerDocument || globalThis.document;\n  const disableRange = src.disableRange === true;\n  const disableStream = src.disableStream === true;\n  const disableAutoFetch = src.disableAutoFetch === true;\n  const pdfBug = src.pdfBug === true;\n\n  // Parameters whose default values depend on other parameters.\n  const length = rangeTransport ? rangeTransport.length : src.length ?? NaN;\n  const useSystemFonts =\n    typeof src.useSystemFonts === \"boolean\"\n      ? src.useSystemFonts\n      : !isNodeJS && !disableFontFace;\n  const useWorkerFetch =\n    typeof src.useWorkerFetch === \"boolean\"\n      ? src.useWorkerFetch\n      : (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) ||\n        (CMapReaderFactory === DOMCMapReaderFactory &&\n          StandardFontDataFactory === DOMStandardFontDataFactory &&\n          cMapUrl &&\n          standardFontDataUrl &&\n          isValidFetchUrl(cMapUrl, document.baseURI) &&\n          isValidFetchUrl(standardFontDataUrl, document.baseURI));\n  const canvasFactory =\n    src.canvasFactory || new DefaultCanvasFactory({ ownerDocument });\n  const filterFactory =\n    src.filterFactory || new DefaultFilterFactory({ docId, ownerDocument });\n\n  // Parameters only intended for development/testing purposes.\n  const styleElement =\n    typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")\n      ? src.styleElement\n      : null;\n\n  // Set the main-thread verbosity level.\n  setVerbosityLevel(verbosity);\n\n  // Ensure that the various factories can be initialized, when necessary,\n  // since the user may provide *custom* ones.\n  const transportFactory = {\n    canvasFactory,\n    filterFactory,\n  };\n  if (!useWorkerFetch) {\n    transportFactory.cMapReaderFactory = new CMapReaderFactory({\n      baseUrl: cMapUrl,\n      isCompressed: cMapPacked,\n    });\n    transportFactory.standardFontDataFactory = new StandardFontDataFactory({\n      baseUrl: standardFontDataUrl,\n    });\n  }\n\n  if (!worker) {\n    const workerParams = {\n      verbosity,\n      port: GlobalWorkerOptions.workerPort,\n    };\n    // Worker was not provided -- creating and owning our own. If message port\n    // is specified in global worker options, using it.\n    worker = workerParams.port\n      ? PDFWorker.fromPort(workerParams)\n      : new PDFWorker(workerParams);\n    task._worker = worker;\n  }\n\n  const fetchDocParams = {\n    docId,\n    apiVersion:\n      typeof PDFJSDev !== \"undefined\" && !PDFJSDev.test(\"TESTING\")\n        ? PDFJSDev.eval(\"BUNDLE_VERSION\")\n        : null,\n    data,\n    password,\n    disableAutoFetch,\n    rangeChunkSize,\n    length,\n    docBaseUrl,\n    enableXfa,\n    evaluatorOptions: {\n      maxImageSize,\n      disableFontFace,\n      ignoreErrors,\n      isEvalSupported,\n      isOffscreenCanvasSupported,\n      canvasMaxAreaInBytes,\n      fontExtraProperties,\n      useSystemFonts,\n      cMapUrl: useWorkerFetch ? cMapUrl : null,\n      standardFontDataUrl: useWorkerFetch ? standardFontDataUrl : null,\n    },\n  };\n  const transportParams = {\n    ignoreErrors,\n    isEvalSupported,\n    disableFontFace,\n    fontExtraProperties,\n    enableXfa,\n    ownerDocument,\n    disableAutoFetch,\n    pdfBug,\n    styleElement,\n  };\n\n  worker.promise\n    .then(function () {\n      if (task.destroyed) {\n        throw new Error(\"Loading aborted\");\n      }\n\n      const workerIdPromise = _fetchDocument(worker, fetchDocParams);\n      const networkStreamPromise = new Promise(function (resolve) {\n        let networkStream;\n        if (rangeTransport) {\n          networkStream = new PDFDataTransportStream(\n            {\n              length,\n              initialData: rangeTransport.initialData,\n              progressiveDone: rangeTransport.progressiveDone,\n              contentDispositionFilename:\n                rangeTransport.contentDispositionFilename,\n              disableRange,\n              disableStream,\n            },\n            rangeTransport\n          );\n        } else if (!data) {\n          if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n            throw new Error(\"Not implemented: createPDFNetworkStream\");\n          }\n          const createPDFNetworkStream = params => {\n            if (\n              typeof PDFJSDev !== \"undefined\" &&\n              PDFJSDev.test(\"GENERIC\") &&\n              isNodeJS\n            ) {\n              return new PDFNodeStream(params);\n            }\n            return isValidFetchUrl(params.url)\n              ? new PDFFetchStream(params)\n              : new PDFNetworkStream(params);\n          };\n\n          networkStream = createPDFNetworkStream({\n            url,\n            length,\n            httpHeaders,\n            withCredentials,\n            rangeChunkSize,\n            disableRange,\n            disableStream,\n          });\n        }\n        resolve(networkStream);\n      });\n\n      return Promise.all([workerIdPromise, networkStreamPromise]).then(\n        function ([workerId, networkStream]) {\n          if (task.destroyed) {\n            throw new Error(\"Loading aborted\");\n          }\n\n          const messageHandler = new MessageHandler(\n            docId,\n            workerId,\n            worker.port\n          );\n          const transport = new WorkerTransport(\n            messageHandler,\n            task,\n            networkStream,\n            transportParams,\n            transportFactory\n          );\n          task._transport = transport;\n          messageHandler.send(\"Ready\", null);\n        }\n      );\n    })\n    .catch(task._capability.reject);\n\n  return task;\n}\n\n/**\n * Starts fetching of specified PDF document/data.\n *\n * @param {PDFWorker} worker\n * @param {Object} source\n * @returns {Promise<string>} A promise that is resolved when the worker ID of\n *   the `MessageHandler` is known.\n * @private\n */\nasync function _fetchDocument(worker, source) {\n  if (worker.destroyed) {\n    throw new Error(\"Worker was destroyed\");\n  }\n  const workerId = await worker.messageHandler.sendWithPromise(\n    \"GetDocRequest\",\n    source,\n    source.data ? [source.data.buffer] : null\n  );\n\n  if (worker.destroyed) {\n    throw new Error(\"Worker was destroyed\");\n  }\n  return workerId;\n}\n\nfunction getUrlProp(val) {\n  if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n    return null; // The 'url' is unused with `PDFDataRangeTransport`.\n  }\n  if (val instanceof URL) {\n    return val.href;\n  }\n  try {\n    // The full path is required in the 'url' field.\n    return new URL(val, window.location).href;\n  } catch {\n    if (\n      typeof PDFJSDev !== \"undefined\" &&\n      PDFJSDev.test(\"GENERIC\") &&\n      isNodeJS &&\n      typeof val === \"string\"\n    ) {\n      return val; // Use the url as-is in Node.js environments.\n    }\n  }\n  throw new Error(\n    \"Invalid PDF url data: \" +\n      \"either string or URL-object is expected in the url property.\"\n  );\n}\n\nfunction getDataProp(val) {\n  // Converting string or array-like data to Uint8Array.\n  if (\n    typeof PDFJSDev !== \"undefined\" &&\n    PDFJSDev.test(\"GENERIC\") &&\n    isNodeJS &&\n    typeof Buffer !== \"undefined\" && // eslint-disable-line no-undef\n    val instanceof Buffer // eslint-disable-line no-undef\n  ) {\n    throw new Error(\n      \"Please provide binary data as `Uint8Array`, rather than `Buffer`.\"\n    );\n  }\n  if (val instanceof Uint8Array && val.byteLength === val.buffer.byteLength) {\n    // Use the data as-is when it's already a Uint8Array that completely\n    // \"utilizes\" its underlying ArrayBuffer, to prevent any possible\n    // issues when transferring it to the worker-thread.\n    return val;\n  }\n  if (typeof val === \"string\") {\n    return stringToBytes(val);\n  }\n  if ((typeof val === \"object\" && !isNaN(val?.length)) || isArrayBuffer(val)) {\n    return new Uint8Array(val);\n  }\n  throw new Error(\n    \"Invalid PDF binary data: either TypedArray, \" +\n      \"string, or array-like object is expected in the data property.\"\n  );\n}\n\n/**\n * @typedef {Object} OnProgressParameters\n * @property {number} loaded - Currently loaded number of bytes.\n * @property {number} total - Total number of bytes in the PDF file.\n */\n\n/**\n * The loading task controls the operations required to load a PDF document\n * (such as network requests) and provides a way to listen for completion,\n * after which individual pages can be rendered.\n */\nclass PDFDocumentLoadingTask {\n  static #docId = 0;\n\n  constructor() {\n    this._capability = new PromiseCapability();\n    this._transport = null;\n    this._worker = null;\n\n    /**\n     * Unique identifier for the document loading task.\n     * @type {string}\n     */\n    this.docId = `d${PDFDocumentLoadingTask.#docId++}`;\n\n    /**\n     * Whether the loading task is destroyed or not.\n     * @type {boolean}\n     */\n    this.destroyed = false;\n\n    /**\n     * Callback to request a password if a wrong or no password was provided.\n     * The callback receives two parameters: a function that should be called\n     * with the new password, and a reason (see {@link PasswordResponses}).\n     * @type {function}\n     */\n    this.onPassword = null;\n\n    /**\n     * Callback to be able to monitor the loading progress of the PDF file\n     * (necessary to implement e.g. a loading bar).\n     * The callback receives an {@link OnProgressParameters} argument.\n     * @type {function}\n     */\n    this.onProgress = null;\n  }\n\n  /**\n   * Promise for document loading task completion.\n   * @type {Promise<PDFDocumentProxy>}\n   */\n  get promise() {\n    return this._capability.promise;\n  }\n\n  /**\n   * Abort all network requests and destroy the worker.\n   * @returns {Promise<void>} A promise that is resolved when destruction is\n   *   completed.\n   */\n  async destroy() {\n    this.destroyed = true;\n    try {\n      if (this._worker?.port) {\n        this._worker._pendingDestroy = true;\n      }\n      await this._transport?.destroy();\n    } catch (ex) {\n      if (this._worker?.port) {\n        delete this._worker._pendingDestroy;\n      }\n      throw ex;\n    }\n\n    this._transport = null;\n    if (this._worker) {\n      this._worker.destroy();\n      this._worker = null;\n    }\n  }\n}\n\n/**\n * Abstract class to support range requests file loading.\n *\n * NOTE: The TypedArrays passed to the constructor and relevant methods below\n * will generally be transferred to the worker-thread. This will help reduce\n * main-thread memory usage, however it will take ownership of the TypedArrays.\n */\nclass PDFDataRangeTransport {\n  /**\n   * @param {number} length\n   * @param {Uint8Array|null} initialData\n   * @param {boolean} [progressiveDone]\n   * @param {string} [contentDispositionFilename]\n   */\n  constructor(\n    length,\n    initialData,\n    progressiveDone = false,\n    contentDispositionFilename = null\n  ) {\n    this.length = length;\n    this.initialData = initialData;\n    this.progressiveDone = progressiveDone;\n    this.contentDispositionFilename = contentDispositionFilename;\n\n    this._rangeListeners = [];\n    this._progressListeners = [];\n    this._progressiveReadListeners = [];\n    this._progressiveDoneListeners = [];\n    this._readyCapability = new PromiseCapability();\n  }\n\n  /**\n   * @param {function} listener\n   */\n  addRangeListener(listener) {\n    this._rangeListeners.push(listener);\n  }\n\n  /**\n   * @param {function} listener\n   */\n  addProgressListener(listener) {\n    this._progressListeners.push(listener);\n  }\n\n  /**\n   * @param {function} listener\n   */\n  addProgressiveReadListener(listener) {\n    this._progressiveReadListeners.push(listener);\n  }\n\n  /**\n   * @param {function} listener\n   */\n  addProgressiveDoneListener(listener) {\n    this._progressiveDoneListeners.push(listener);\n  }\n\n  /**\n   * @param {number} begin\n   * @param {Uint8Array|null} chunk\n   */\n  onDataRange(begin, chunk) {\n    for (const listener of this._rangeListeners) {\n      listener(begin, chunk);\n    }\n  }\n\n  /**\n   * @param {number} loaded\n   * @param {number|undefined} total\n   */\n  onDataProgress(loaded, total) {\n    this._readyCapability.promise.then(() => {\n      for (const listener of this._progressListeners) {\n        listener(loaded, total);\n      }\n    });\n  }\n\n  /**\n   * @param {Uint8Array|null} chunk\n   */\n  onDataProgressiveRead(chunk) {\n    this._readyCapability.promise.then(() => {\n      for (const listener of this._progressiveReadListeners) {\n        listener(chunk);\n      }\n    });\n  }\n\n  onDataProgressiveDone() {\n    this._readyCapability.promise.then(() => {\n      for (const listener of this._progressiveDoneListeners) {\n        listener();\n      }\n    });\n  }\n\n  transportReady() {\n    this._readyCapability.resolve();\n  }\n\n  /**\n   * @param {number} begin\n   * @param {number} end\n   */\n  requestDataRange(begin, end) {\n    unreachable(\"Abstract method PDFDataRangeTransport.requestDataRange\");\n  }\n\n  abort() {}\n}\n\n/**\n * Proxy to a `PDFDocument` in the worker thread.\n */\nclass PDFDocumentProxy {\n  constructor(pdfInfo, transport) {\n    this._pdfInfo = pdfInfo;\n    this._transport = transport;\n\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      // For testing purposes.\n      Object.defineProperty(this, \"getXFADatasets\", {\n        value: () => {\n          return this._transport.getXFADatasets();\n        },\n      });\n      Object.defineProperty(this, \"getXRefPrevValue\", {\n        value: () => {\n          return this._transport.getXRefPrevValue();\n        },\n      });\n      Object.defineProperty(this, \"getAnnotArray\", {\n        value: pageIndex => {\n          return this._transport.getAnnotArray(pageIndex);\n        },\n      });\n    }\n  }\n\n  /**\n   * @type {AnnotationStorage} Storage for annotation data in forms.\n   */\n  get annotationStorage() {\n    return this._transport.annotationStorage;\n  }\n\n  /**\n   * @type {Object} The filter factory instance.\n   */\n  get filterFactory() {\n    return this._transport.filterFactory;\n  }\n\n  /**\n   * @type {number} Total number of pages in the PDF file.\n   */\n  get numPages() {\n    return this._pdfInfo.numPages;\n  }\n\n  /**\n   * @type {Array<string, string|null>} A (not guaranteed to be) unique ID to\n   *   identify the PDF document.\n   *   NOTE: The first element will always be defined for all PDF documents,\n   *   whereas the second element is only defined for *modified* PDF documents.\n   */\n  get fingerprints() {\n    return this._pdfInfo.fingerprints;\n  }\n\n  /**\n   * @type {boolean} True if only XFA form.\n   */\n  get isPureXfa() {\n    return shadow(this, \"isPureXfa\", !!this._transport._htmlForXfa);\n  }\n\n  /**\n   * NOTE: This is (mostly) intended to support printing of XFA forms.\n   *\n   * @type {Object | null} An object representing a HTML tree structure\n   *   to render the XFA, or `null` when no XFA form exists.\n   */\n  get allXfaHtml() {\n    return this._transport._htmlForXfa;\n  }\n\n  /**\n   * @param {number} pageNumber - The page number to get. The first page is 1.\n   * @returns {Promise<PDFPageProxy>} A promise that is resolved with\n   *   a {@link PDFPageProxy} object.\n   */\n  getPage(pageNumber) {\n    return this._transport.getPage(pageNumber);\n  }\n\n  /**\n   * @param {RefProxy} ref - The page reference.\n   * @returns {Promise<number>} A promise that is resolved with the page index,\n   *   starting from zero, that is associated with the reference.\n   */\n  getPageIndex(ref) {\n    return this._transport.getPageIndex(ref);\n  }\n\n  /**\n   * @returns {Promise<Object<string, Array<any>>>} A promise that is resolved\n   *   with a mapping from named destinations to references.\n   *\n   * This can be slow for large documents. Use `getDestination` instead.\n   */\n  getDestinations() {\n    return this._transport.getDestinations();\n  }\n\n  /**\n   * @param {string} id - The named destination to get.\n   * @returns {Promise<Array<any> | null>} A promise that is resolved with all\n   *   information of the given named destination, or `null` when the named\n   *   destination is not present in the PDF file.\n   */\n  getDestination(id) {\n    return this._transport.getDestination(id);\n  }\n\n  /**\n   * @returns {Promise<Array<string> | null>} A promise that is resolved with\n   *   an {Array} containing the page labels that correspond to the page\n   *   indexes, or `null` when no page labels are present in the PDF file.\n   */\n  getPageLabels() {\n    return this._transport.getPageLabels();\n  }\n\n  /**\n   * @returns {Promise<string>} A promise that is resolved with a {string}\n   *   containing the page layout name.\n   */\n  getPageLayout() {\n    return this._transport.getPageLayout();\n  }\n\n  /**\n   * @returns {Promise<string>} A promise that is resolved with a {string}\n   *   containing the page mode name.\n   */\n  getPageMode() {\n    return this._transport.getPageMode();\n  }\n\n  /**\n   * @returns {Promise<Object | null>} A promise that is resolved with an\n   *   {Object} containing the viewer preferences, or `null` when no viewer\n   *   preferences are present in the PDF file.\n   */\n  getViewerPreferences() {\n    return this._transport.getViewerPreferences();\n  }\n\n  /**\n   * @returns {Promise<any | null>} A promise that is resolved with an {Array}\n   *   containing the destination, or `null` when no open action is present\n   *   in the PDF.\n   */\n  getOpenAction() {\n    return this._transport.getOpenAction();\n  }\n\n  /**\n   * @returns {Promise<any>} A promise that is resolved with a lookup table\n   *   for mapping named attachments to their content.\n   */\n  getAttachments() {\n    return this._transport.getAttachments();\n  }\n\n  /**\n   * @returns {Promise<Object | null>} A promise that is resolved with\n   *   an {Object} with the JavaScript actions:\n   *     - from the name tree.\n   *     - from A or AA entries in the catalog dictionary.\n   *   , or `null` if no JavaScript exists.\n   */\n  getJSActions() {\n    return this._transport.getDocJSActions();\n  }\n\n  /**\n   * @typedef {Object} OutlineNode\n   * @property {string} title\n   * @property {boolean} bold\n   * @property {boolean} italic\n   * @property {Uint8ClampedArray} color - The color in RGB format to use for\n   *   display purposes.\n   * @property {string | Array<any> | null} dest\n   * @property {string | null} url\n   * @property {string | undefined} unsafeUrl\n   * @property {boolean | undefined} newWindow\n   * @property {number | undefined} count\n   * @property {Array<OutlineNode>} items\n   */\n\n  /**\n   * @returns {Promise<Array<OutlineNode>>} A promise that is resolved with an\n   *   {Array} that is a tree outline (if it has one) of the PDF file.\n   */\n  getOutline() {\n    return this._transport.getOutline();\n  }\n\n  /**\n   * @returns {Promise<OptionalContentConfig>} A promise that is resolved with\n   *   an {@link OptionalContentConfig} that contains all the optional content\n   *   groups (assuming that the document has any).\n   */\n  getOptionalContentConfig() {\n    return this._transport.getOptionalContentConfig();\n  }\n\n  /**\n   * @returns {Promise<Array<number> | null>} A promise that is resolved with\n   *   an {Array} that contains the permission flags for the PDF document, or\n   *   `null` when no permissions are present in the PDF file.\n   */\n  getPermissions() {\n    return this._transport.getPermissions();\n  }\n\n  /**\n   * @returns {Promise<{ info: Object, metadata: Metadata }>} A promise that is\n   *   resolved with an {Object} that has `info` and `metadata` properties.\n   *   `info` is an {Object} filled with anything available in the information\n   *   dictionary and similarly `metadata` is a {Metadata} object with\n   *   information from the metadata section of the PDF.\n   */\n  getMetadata() {\n    return this._transport.getMetadata();\n  }\n\n  /**\n   * @typedef {Object} MarkInfo\n   * Properties correspond to Table 321 of the PDF 32000-1:2008 spec.\n   * @property {boolean} Marked\n   * @property {boolean} UserProperties\n   * @property {boolean} Suspects\n   */\n\n  /**\n   * @returns {Promise<MarkInfo | null>} A promise that is resolved with\n   *   a {MarkInfo} object that contains the MarkInfo flags for the PDF\n   *   document, or `null` when no MarkInfo values are present in the PDF file.\n   */\n  getMarkInfo() {\n    return this._transport.getMarkInfo();\n  }\n\n  /**\n   * @returns {Promise<Uint8Array>} A promise that is resolved with a\n   *   {Uint8Array} containing the raw data of the PDF document.\n   */\n  getData() {\n    return this._transport.getData();\n  }\n\n  /**\n   * @returns {Promise<Uint8Array>} A promise that is resolved with a\n   *   {Uint8Array} containing the full data of the saved document.\n   */\n  saveDocument() {\n    return this._transport.saveDocument();\n  }\n\n  /**\n   * @returns {Promise<{ length: number }>} A promise that is resolved when the\n   *   document's data is loaded. It is resolved with an {Object} that contains\n   *   the `length` property that indicates size of the PDF data in bytes.\n   */\n  getDownloadInfo() {\n    return this._transport.downloadInfoCapability.promise;\n  }\n\n  /**\n   * Cleans up resources allocated by the document on both the main and worker\n   * threads.\n   *\n   * NOTE: Do not, under any circumstances, call this method when rendering is\n   * currently ongoing since that may lead to rendering errors.\n   *\n   * @param {boolean} [keepLoadedFonts] - Let fonts remain attached to the DOM.\n   *   NOTE: This will increase persistent memory usage, hence don't use this\n   *   option unless absolutely necessary. The default value is `false`.\n   * @returns {Promise} A promise that is resolved when clean-up has finished.\n   */\n  cleanup(keepLoadedFonts = false) {\n    return this._transport.startCleanup(keepLoadedFonts || this.isPureXfa);\n  }\n\n  /**\n   * Destroys the current document instance and terminates the worker.\n   */\n  destroy() {\n    return this.loadingTask.destroy();\n  }\n\n  /**\n   * @type {DocumentInitParameters} A subset of the current\n   *   {DocumentInitParameters}, which are needed in the viewer.\n   */\n  get loadingParams() {\n    return this._transport.loadingParams;\n  }\n\n  /**\n   * @type {PDFDocumentLoadingTask} The loadingTask for the current document.\n   */\n  get loadingTask() {\n    return this._transport.loadingTask;\n  }\n\n  /**\n   * @returns {Promise<Object<string, Array<Object>> | null>} A promise that is\n   *   resolved with an {Object} containing /AcroForm field data for the JS\n   *   sandbox, or `null` when no field data is present in the PDF file.\n   */\n  getFieldObjects() {\n    return this._transport.getFieldObjects();\n  }\n\n  /**\n   * @returns {Promise<boolean>} A promise that is resolved with `true`\n   *   if some /AcroForm fields have JavaScript actions.\n   */\n  hasJSActions() {\n    return this._transport.hasJSActions();\n  }\n\n  /**\n   * @returns {Promise<Array<string> | null>} A promise that is resolved with an\n   *   {Array<string>} containing IDs of annotations that have a calculation\n   *   action, or `null` when no such annotations are present in the PDF file.\n   */\n  getCalculationOrderIds() {\n    return this._transport.getCalculationOrderIds();\n  }\n}\n\n/**\n * Page getViewport parameters.\n *\n * @typedef {Object} GetViewportParameters\n * @property {number} scale - The desired scale of the viewport.\n * @property {number} [rotation] - The desired rotation, in degrees, of\n *   the viewport. If omitted it defaults to the page rotation.\n * @property {number} [offsetX] - The horizontal, i.e. x-axis, offset.\n *   The default value is `0`.\n * @property {number} [offsetY] - The vertical, i.e. y-axis, offset.\n *   The default value is `0`.\n * @property {boolean} [dontFlip] - If true, the y-axis will not be\n *   flipped. The default value is `false`.\n */\n\n/**\n * Page getTextContent parameters.\n *\n * @typedef {Object} getTextContentParameters\n * @property {boolean} [includeMarkedContent] - When true include marked\n *   content items in the items array of TextContent. The default is `false`.\n * @property {boolean} [disableNormalization] - When true the text is *not*\n *   normalized in the worker-thread. The default is `false`.\n */\n\n/**\n * Page text content.\n *\n * @typedef {Object} TextContent\n * @property {Array<TextItem | TextMarkedContent>} items - Array of\n *   {@link TextItem} and {@link TextMarkedContent} objects. TextMarkedContent\n *   items are included when includeMarkedContent is true.\n * @property {Object<string, TextStyle>} styles - {@link TextStyle} objects,\n *   indexed by font name.\n */\n\n/**\n * Page text content part.\n *\n * @typedef {Object} TextItem\n * @property {string} str - Text content.\n * @property {string} dir - Text direction: 'ttb', 'ltr' or 'rtl'.\n * @property {Array<any>} transform - Transformation matrix.\n * @property {number} width - Width in device space.\n * @property {number} height - Height in device space.\n * @property {string} fontName - Font name used by PDF.js for converted font.\n * @property {boolean} hasEOL - Indicating if the text content is followed by a\n *   line-break.\n */\n\n/**\n * Page text marked content part.\n *\n * @typedef {Object} TextMarkedContent\n * @property {string} type - Either 'beginMarkedContent',\n *   'beginMarkedContentProps', or 'endMarkedContent'.\n * @property {string} id - The marked content identifier. Only used for type\n *   'beginMarkedContentProps'.\n */\n\n/**\n * Text style.\n *\n * @typedef {Object} TextStyle\n * @property {number} ascent - Font ascent.\n * @property {number} descent - Font descent.\n * @property {boolean} vertical - Whether or not the text is in vertical mode.\n * @property {string} fontFamily - The possible font family.\n */\n\n/**\n * Page annotation parameters.\n *\n * @typedef {Object} GetAnnotationsParameters\n * @property {string} [intent] - Determines the annotations that are fetched,\n *   can be 'display' (viewable annotations), 'print' (printable annotations),\n *   or 'any' (all annotations). The default value is 'display'.\n */\n\n/**\n * Page render parameters.\n *\n * @typedef {Object} RenderParameters\n * @property {CanvasRenderingContext2D} canvasContext - A 2D context of a DOM\n *   Canvas object.\n * @property {PageViewport} viewport - Rendering viewport obtained by calling\n *   the `PDFPageProxy.getViewport` method.\n * @property {string} [intent] - Rendering intent, can be 'display', 'print',\n *   or 'any'. The default value is 'display'.\n * @property {number} [annotationMode] Controls which annotations are rendered\n *   onto the canvas, for annotations with appearance-data; the values from\n *   {@link AnnotationMode} should be used. The following values are supported:\n *    - `AnnotationMode.DISABLE`, which disables all annotations.\n *    - `AnnotationMode.ENABLE`, which includes all possible annotations (thus\n *      it also depends on the `intent`-option, see above).\n *    - `AnnotationMode.ENABLE_FORMS`, which excludes annotations that contain\n *      interactive form elements (those will be rendered in the display layer).\n *    - `AnnotationMode.ENABLE_STORAGE`, which includes all possible annotations\n *      (as above) but where interactive form elements are updated with data\n *      from the {@link AnnotationStorage}-instance; useful e.g. for printing.\n *   The default value is `AnnotationMode.ENABLE`.\n * @property {Array<any>} [transform] - Additional transform, applied just\n *   before viewport transform.\n * @property {CanvasGradient | CanvasPattern | string} [background] - Background\n *   to use for the canvas.\n *   Any valid `canvas.fillStyle` can be used: a `DOMString` parsed as CSS\n *   <color> value, a `CanvasGradient` object (a linear or radial gradient) or\n *   a `CanvasPattern` object (a repetitive image). The default value is\n *   'rgb(255,255,255)'.\n *\n *   NOTE: This option may be partially, or completely, ignored when the\n *   `pageColors`-option is used.\n * @property {Object} [pageColors] - Overwrites background and foreground colors\n *   with user defined ones in order to improve readability in high contrast\n *   mode.\n * @property {Promise<OptionalContentConfig>} [optionalContentConfigPromise] -\n *   A promise that should resolve with an {@link OptionalContentConfig}\n *   created from `PDFDocumentProxy.getOptionalContentConfig`. If `null`,\n *   the configuration will be fetched automatically with the default visibility\n *   states set.\n * @property {Map<string, HTMLCanvasElement>} [annotationCanvasMap] - Map some\n *   annotation ids with canvases used to render them.\n * @property {PrintAnnotationStorage} [printAnnotationStorage]\n */\n\n/**\n * Page getOperatorList parameters.\n *\n * @typedef {Object} GetOperatorListParameters\n * @property {string} [intent] - Rendering intent, can be 'display', 'print',\n *   or 'any'. The default value is 'display'.\n * @property {number} [annotationMode] Controls which annotations are included\n *   in the operatorList, for annotations with appearance-data; the values from\n *   {@link AnnotationMode} should be used. The following values are supported:\n *    - `AnnotationMode.DISABLE`, which disables all annotations.\n *    - `AnnotationMode.ENABLE`, which includes all possible annotations (thus\n *      it also depends on the `intent`-option, see above).\n *    - `AnnotationMode.ENABLE_FORMS`, which excludes annotations that contain\n *      interactive form elements (those will be rendered in the display layer).\n *    - `AnnotationMode.ENABLE_STORAGE`, which includes all possible annotations\n *      (as above) but where interactive form elements are updated with data\n *      from the {@link AnnotationStorage}-instance; useful e.g. for printing.\n *   The default value is `AnnotationMode.ENABLE`.\n * @property {PrintAnnotationStorage} [printAnnotationStorage]\n */\n\n/**\n * Structure tree node. The root node will have a role \"Root\".\n *\n * @typedef {Object} StructTreeNode\n * @property {Array<StructTreeNode | StructTreeContent>} children - Array of\n *   {@link StructTreeNode} and {@link StructTreeContent} objects.\n * @property {string} role - element's role, already mapped if a role map exists\n * in the PDF.\n */\n\n/**\n * Structure tree content.\n *\n * @typedef {Object} StructTreeContent\n * @property {string} type - either \"content\" for page and stream structure\n *   elements or \"object\" for object references.\n * @property {string} id - unique id that will map to the text layer.\n */\n\n/**\n * PDF page operator list.\n *\n * @typedef {Object} PDFOperatorList\n * @property {Array<number>} fnArray - Array containing the operator functions.\n * @property {Array<any>} argsArray - Array containing the arguments of the\n *   functions.\n */\n\n/**\n * Proxy to a `PDFPage` in the worker thread.\n */\nclass PDFPageProxy {\n  #delayedCleanupTimeout = null;\n\n  #pendingCleanup = false;\n\n  constructor(pageIndex, pageInfo, transport, pdfBug = false) {\n    this._pageIndex = pageIndex;\n    this._pageInfo = pageInfo;\n    this._transport = transport;\n    this._stats = pdfBug ? new StatTimer() : null;\n    this._pdfBug = pdfBug;\n    /** @type {PDFObjects} */\n    this.commonObjs = transport.commonObjs;\n    this.objs = new PDFObjects();\n\n    this._maybeCleanupAfterRender = false;\n    this._intentStates = new Map();\n    this.destroyed = false;\n  }\n\n  /**\n   * @type {number} Page number of the page. First page is 1.\n   */\n  get pageNumber() {\n    return this._pageIndex + 1;\n  }\n\n  /**\n   * @type {number} The number of degrees the page is rotated clockwise.\n   */\n  get rotate() {\n    return this._pageInfo.rotate;\n  }\n\n  /**\n   * @type {RefProxy | null} The reference that points to this page.\n   */\n  get ref() {\n    return this._pageInfo.ref;\n  }\n\n  /**\n   * @type {number} The default size of units in 1/72nds of an inch.\n   */\n  get userUnit() {\n    return this._pageInfo.userUnit;\n  }\n\n  /**\n   * @type {Array<number>} An array of the visible portion of the PDF page in\n   *   user space units [x1, y1, x2, y2].\n   */\n  get view() {\n    return this._pageInfo.view;\n  }\n\n  /**\n   * @param {GetViewportParameters} params - Viewport parameters.\n   * @returns {PageViewport} Contains 'width' and 'height' properties\n   *   along with transforms required for rendering.\n   */\n  getViewport({\n    scale,\n    rotation = this.rotate,\n    offsetX = 0,\n    offsetY = 0,\n    dontFlip = false,\n  } = {}) {\n    return new PageViewport({\n      viewBox: this.view,\n      scale,\n      rotation,\n      offsetX,\n      offsetY,\n      dontFlip,\n    });\n  }\n\n  /**\n   * @param {GetAnnotationsParameters} params - Annotation parameters.\n   * @returns {Promise<Array<any>>} A promise that is resolved with an\n   *   {Array} of the annotation objects.\n   */\n  getAnnotations({ intent = \"display\" } = {}) {\n    const intentArgs = this._transport.getRenderingIntent(intent);\n\n    return this._transport.getAnnotations(\n      this._pageIndex,\n      intentArgs.renderingIntent\n    );\n  }\n\n  /**\n   * @returns {Promise<Object>} A promise that is resolved with an\n   *   {Object} with JS actions.\n   */\n  getJSActions() {\n    return this._transport.getPageJSActions(this._pageIndex);\n  }\n\n  /**\n   * @type {Object} The filter factory instance.\n   */\n  get filterFactory() {\n    return this._transport.filterFactory;\n  }\n\n  /**\n   * @type {boolean} True if only XFA form.\n   */\n  get isPureXfa() {\n    return shadow(this, \"isPureXfa\", !!this._transport._htmlForXfa);\n  }\n\n  /**\n   * @returns {Promise<Object | null>} A promise that is resolved with\n   *   an {Object} with a fake DOM object (a tree structure where elements\n   *   are {Object} with a name, attributes (class, style, ...), value and\n   *   children, very similar to a HTML DOM tree), or `null` if no XFA exists.\n   */\n  async getXfa() {\n    return this._transport._htmlForXfa?.children[this._pageIndex] || null;\n  }\n\n  /**\n   * Begins the process of rendering a page to the desired context.\n   *\n   * @param {RenderParameters} params - Page render parameters.\n   * @returns {RenderTask} An object that contains a promise that is\n   *   resolved when the page finishes rendering.\n   */\n  render({\n    canvasContext,\n    viewport,\n    intent = \"display\",\n    annotationMode = AnnotationMode.ENABLE,\n    transform = null,\n    background = null,\n    optionalContentConfigPromise = null,\n    annotationCanvasMap = null,\n    pageColors = null,\n    printAnnotationStorage = null,\n  }) {\n    this._stats?.time(\"Overall\");\n\n    const intentArgs = this._transport.getRenderingIntent(\n      intent,\n      annotationMode,\n      printAnnotationStorage\n    );\n    // If there was a pending destroy, cancel it so no cleanup happens during\n    // this call to render...\n    this.#pendingCleanup = false;\n    // ... and ensure that a delayed cleanup is always aborted.\n    this.#abortDelayedCleanup();\n\n    if (!optionalContentConfigPromise) {\n      optionalContentConfigPromise = this._transport.getOptionalContentConfig();\n    }\n\n    let intentState = this._intentStates.get(intentArgs.cacheKey);\n    if (!intentState) {\n      intentState = Object.create(null);\n      this._intentStates.set(intentArgs.cacheKey, intentState);\n    }\n\n    // Ensure that a pending `streamReader` cancel timeout is always aborted.\n    if (intentState.streamReaderCancelTimeout) {\n      clearTimeout(intentState.streamReaderCancelTimeout);\n      intentState.streamReaderCancelTimeout = null;\n    }\n\n    const intentPrint = !!(\n      intentArgs.renderingIntent & RenderingIntentFlag.PRINT\n    );\n\n    // If there's no displayReadyCapability yet, then the operatorList\n    // was never requested before. Make the request and create the promise.\n    if (!intentState.displayReadyCapability) {\n      intentState.displayReadyCapability = new PromiseCapability();\n      intentState.operatorList = {\n        fnArray: [],\n        argsArray: [],\n        lastChunk: false,\n        separateAnnots: null,\n      };\n\n      this._stats?.time(\"Page Request\");\n      this._pumpOperatorList(intentArgs);\n    }\n\n    const complete = error => {\n      intentState.renderTasks.delete(internalRenderTask);\n\n      // Attempt to reduce memory usage during *printing*, by always running\n      // cleanup immediately once rendering has finished.\n      if (this._maybeCleanupAfterRender || intentPrint) {\n        this.#pendingCleanup = true;\n      }\n      this.#tryCleanup(/* delayed = */ !intentPrint);\n\n      if (error) {\n        internalRenderTask.capability.reject(error);\n\n        this._abortOperatorList({\n          intentState,\n          reason: error instanceof Error ? error : new Error(error),\n        });\n      } else {\n        internalRenderTask.capability.resolve();\n      }\n\n      this._stats?.timeEnd(\"Rendering\");\n      this._stats?.timeEnd(\"Overall\");\n    };\n\n    const internalRenderTask = new InternalRenderTask({\n      callback: complete,\n      // Only include the required properties, and *not* the entire object.\n      params: {\n        canvasContext,\n        viewport,\n        transform,\n        background,\n      },\n      objs: this.objs,\n      commonObjs: this.commonObjs,\n      annotationCanvasMap,\n      operatorList: intentState.operatorList,\n      pageIndex: this._pageIndex,\n      canvasFactory: this._transport.canvasFactory,\n      filterFactory: this._transport.filterFactory,\n      useRequestAnimationFrame: !intentPrint,\n      pdfBug: this._pdfBug,\n      pageColors,\n    });\n\n    (intentState.renderTasks ||= new Set()).add(internalRenderTask);\n    const renderTask = internalRenderTask.task;\n\n    Promise.all([\n      intentState.displayReadyCapability.promise,\n      optionalContentConfigPromise,\n    ])\n      .then(([transparency, optionalContentConfig]) => {\n        if (this.destroyed) {\n          complete();\n          return;\n        }\n        this._stats?.time(\"Rendering\");\n\n        internalRenderTask.initializeGraphics({\n          transparency,\n          optionalContentConfig,\n        });\n        internalRenderTask.operatorListChanged();\n      })\n      .catch(complete);\n\n    return renderTask;\n  }\n\n  /**\n   * @param {GetOperatorListParameters} params - Page getOperatorList\n   *   parameters.\n   * @returns {Promise<PDFOperatorList>} A promise resolved with an\n   *   {@link PDFOperatorList} object that represents the page's operator list.\n   */\n  getOperatorList({\n    intent = \"display\",\n    annotationMode = AnnotationMode.ENABLE,\n    printAnnotationStorage = null,\n  } = {}) {\n    if (typeof PDFJSDev !== \"undefined\" && !PDFJSDev.test(\"GENERIC\")) {\n      throw new Error(\"Not implemented: getOperatorList\");\n    }\n    function operatorListChanged() {\n      if (intentState.operatorList.lastChunk) {\n        intentState.opListReadCapability.resolve(intentState.operatorList);\n\n        intentState.renderTasks.delete(opListTask);\n      }\n    }\n\n    const intentArgs = this._transport.getRenderingIntent(\n      intent,\n      annotationMode,\n      printAnnotationStorage,\n      /* isOpList = */ true\n    );\n    let intentState = this._intentStates.get(intentArgs.cacheKey);\n    if (!intentState) {\n      intentState = Object.create(null);\n      this._intentStates.set(intentArgs.cacheKey, intentState);\n    }\n    let opListTask;\n\n    if (!intentState.opListReadCapability) {\n      opListTask = Object.create(null);\n      opListTask.operatorListChanged = operatorListChanged;\n      intentState.opListReadCapability = new PromiseCapability();\n      (intentState.renderTasks ||= new Set()).add(opListTask);\n      intentState.operatorList = {\n        fnArray: [],\n        argsArray: [],\n        lastChunk: false,\n        separateAnnots: null,\n      };\n\n      this._stats?.time(\"Page Request\");\n      this._pumpOperatorList(intentArgs);\n    }\n    return intentState.opListReadCapability.promise;\n  }\n\n  /**\n   * NOTE: All occurrences of whitespace will be replaced by\n   * standard spaces (0x20).\n   *\n   * @param {getTextContentParameters} params - getTextContent parameters.\n   * @returns {ReadableStream} Stream for reading text content chunks.\n   */\n  streamTextContent({\n    includeMarkedContent = false,\n    disableNormalization = false,\n  } = {}) {\n    const TEXT_CONTENT_CHUNK_SIZE = 100;\n\n    return this._transport.messageHandler.sendWithStream(\n      \"GetTextContent\",\n      {\n        pageIndex: this._pageIndex,\n        includeMarkedContent: includeMarkedContent === true,\n        disableNormalization: disableNormalization === true,\n      },\n      {\n        highWaterMark: TEXT_CONTENT_CHUNK_SIZE,\n        size(textContent) {\n          return textContent.items.length;\n        },\n      }\n    );\n  }\n\n  /**\n   * NOTE: All occurrences of whitespace will be replaced by\n   * standard spaces (0x20).\n   *\n   * @param {getTextContentParameters} params - getTextContent parameters.\n   * @returns {Promise<TextContent>} A promise that is resolved with a\n   *   {@link TextContent} object that represents the page's text content.\n   */\n  getTextContent(params = {}) {\n    if (this._transport._htmlForXfa) {\n      // TODO: We need to revisit this once the XFA foreground patch lands and\n      // only do this for non-foreground XFA.\n      return this.getXfa().then(xfa => {\n        return XfaText.textContent(xfa);\n      });\n    }\n    const readableStream = this.streamTextContent(params);\n\n    return new Promise(function (resolve, reject) {\n      function pump() {\n        reader.read().then(function ({ value, done }) {\n          if (done) {\n            resolve(textContent);\n            return;\n          }\n          Object.assign(textContent.styles, value.styles);\n          textContent.items.push(...value.items);\n          pump();\n        }, reject);\n      }\n\n      const reader = readableStream.getReader();\n      const textContent = {\n        items: [],\n        styles: Object.create(null),\n      };\n      pump();\n    });\n  }\n\n  /**\n   * @returns {Promise<StructTreeNode>} A promise that is resolved with a\n   *   {@link StructTreeNode} object that represents the page's structure tree,\n   *   or `null` when no structure tree is present for the current page.\n   */\n  getStructTree() {\n    return this._transport.getStructTree(this._pageIndex);\n  }\n\n  /**\n   * Destroys the page object.\n   * @private\n   */\n  _destroy() {\n    this.destroyed = true;\n\n    const waitOn = [];\n    for (const intentState of this._intentStates.values()) {\n      this._abortOperatorList({\n        intentState,\n        reason: new Error(\"Page was destroyed.\"),\n        force: true,\n      });\n\n      if (intentState.opListReadCapability) {\n        // Avoid errors below, since the renderTasks are just stubs.\n        continue;\n      }\n      for (const internalRenderTask of intentState.renderTasks) {\n        waitOn.push(internalRenderTask.completed);\n        internalRenderTask.cancel();\n      }\n    }\n    this.objs.clear();\n    this.#pendingCleanup = false;\n    this.#abortDelayedCleanup();\n\n    return Promise.all(waitOn);\n  }\n\n  /**\n   * Cleans up resources allocated by the page.\n   *\n   * @param {boolean} [resetStats] - Reset page stats, if enabled.\n   *   The default value is `false`.\n   * @returns {boolean} Indicates if clean-up was successfully run.\n   */\n  cleanup(resetStats = false) {\n    this.#pendingCleanup = true;\n    const success = this.#tryCleanup(/* delayed = */ false);\n\n    if (resetStats && success) {\n      this._stats &&= new StatTimer();\n    }\n    return success;\n  }\n\n  /**\n   * Attempts to clean up if rendering is in a state where that's possible.\n   * @param {boolean} [delayed] - Delay the cleanup, to e.g. improve zooming\n   *   performance in documents with large images.\n   *   The default value is `false`.\n   * @returns {boolean} Indicates if clean-up was successfully run.\n   */\n  #tryCleanup(delayed = false) {\n    this.#abortDelayedCleanup();\n\n    if (!this.#pendingCleanup || this.destroyed) {\n      return false;\n    }\n    if (delayed) {\n      this.#delayedCleanupTimeout = setTimeout(() => {\n        this.#delayedCleanupTimeout = null;\n        this.#tryCleanup(/* delayed = */ false);\n      }, DELAYED_CLEANUP_TIMEOUT);\n\n      return false;\n    }\n    for (const { renderTasks, operatorList } of this._intentStates.values()) {\n      if (renderTasks.size > 0 || !operatorList.lastChunk) {\n        return false;\n      }\n    }\n    this._intentStates.clear();\n    this.objs.clear();\n    this.#pendingCleanup = false;\n    return true;\n  }\n\n  #abortDelayedCleanup() {\n    if (this.#delayedCleanupTimeout) {\n      clearTimeout(this.#delayedCleanupTimeout);\n      this.#delayedCleanupTimeout = null;\n    }\n  }\n\n  /**\n   * @private\n   */\n  _startRenderPage(transparency, cacheKey) {\n    const intentState = this._intentStates.get(cacheKey);\n    if (!intentState) {\n      return; // Rendering was cancelled.\n    }\n    this._stats?.timeEnd(\"Page Request\");\n\n    // TODO Refactor RenderPageRequest to separate rendering\n    // and operator list logic\n    intentState.displayReadyCapability?.resolve(transparency);\n  }\n\n  /**\n   * @private\n   */\n  _renderPageChunk(operatorListChunk, intentState) {\n    // Add the new chunk to the current operator list.\n    for (let i = 0, ii = operatorListChunk.length; i < ii; i++) {\n      intentState.operatorList.fnArray.push(operatorListChunk.fnArray[i]);\n      intentState.operatorList.argsArray.push(operatorListChunk.argsArray[i]);\n    }\n    intentState.operatorList.lastChunk = operatorListChunk.lastChunk;\n    intentState.operatorList.separateAnnots = operatorListChunk.separateAnnots;\n\n    // Notify all the rendering tasks there are more operators to be consumed.\n    for (const internalRenderTask of intentState.renderTasks) {\n      internalRenderTask.operatorListChanged();\n    }\n\n    if (operatorListChunk.lastChunk) {\n      this.#tryCleanup(/* delayed = */ true);\n    }\n  }\n\n  /**\n   * @private\n   */\n  _pumpOperatorList({\n    renderingIntent,\n    cacheKey,\n    annotationStorageSerializable,\n  }) {\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      assert(\n        Number.isInteger(renderingIntent) && renderingIntent > 0,\n        '_pumpOperatorList: Expected valid \"renderingIntent\" argument.'\n      );\n    }\n    const { map, transfer } = annotationStorageSerializable;\n\n    const readableStream = this._transport.messageHandler.sendWithStream(\n      \"GetOperatorList\",\n      {\n        pageIndex: this._pageIndex,\n        intent: renderingIntent,\n        cacheKey,\n        annotationStorage: map,\n      },\n      transfer\n    );\n    const reader = readableStream.getReader();\n\n    const intentState = this._intentStates.get(cacheKey);\n    intentState.streamReader = reader;\n\n    const pump = () => {\n      reader.read().then(\n        ({ value, done }) => {\n          if (done) {\n            intentState.streamReader = null;\n            return;\n          }\n          if (this._transport.destroyed) {\n            return; // Ignore any pending requests if the worker was terminated.\n          }\n          this._renderPageChunk(value, intentState);\n          pump();\n        },\n        reason => {\n          intentState.streamReader = null;\n\n          if (this._transport.destroyed) {\n            return; // Ignore any pending requests if the worker was terminated.\n          }\n          if (intentState.operatorList) {\n            // Mark operator list as complete.\n            intentState.operatorList.lastChunk = true;\n\n            for (const internalRenderTask of intentState.renderTasks) {\n              internalRenderTask.operatorListChanged();\n            }\n            this.#tryCleanup(/* delayed = */ true);\n          }\n\n          if (intentState.displayReadyCapability) {\n            intentState.displayReadyCapability.reject(reason);\n          } else if (intentState.opListReadCapability) {\n            intentState.opListReadCapability.reject(reason);\n          } else {\n            throw reason;\n          }\n        }\n      );\n    };\n    pump();\n  }\n\n  /**\n   * @private\n   */\n  _abortOperatorList({ intentState, reason, force = false }) {\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      assert(\n        reason instanceof Error,\n        '_abortOperatorList: Expected valid \"reason\" argument.'\n      );\n    }\n\n    if (!intentState.streamReader) {\n      return;\n    }\n    // Ensure that a pending `streamReader` cancel timeout is always aborted.\n    if (intentState.streamReaderCancelTimeout) {\n      clearTimeout(intentState.streamReaderCancelTimeout);\n      intentState.streamReaderCancelTimeout = null;\n    }\n\n    if (!force) {\n      // Ensure that an Error occurring in *only* one `InternalRenderTask`, e.g.\n      // multiple render() calls on the same canvas, won't break all rendering.\n      if (intentState.renderTasks.size > 0) {\n        return;\n      }\n      // Don't immediately abort parsing on the worker-thread when rendering is\n      // cancelled, since that will unnecessarily delay re-rendering when (for\n      // partially parsed pages) e.g. zooming/rotation occurs in the viewer.\n      if (reason instanceof RenderingCancelledException) {\n        let delay = RENDERING_CANCELLED_TIMEOUT;\n        if (reason.extraDelay > 0 && reason.extraDelay < /* ms = */ 1000) {\n          // Above, we prevent the total delay from becoming arbitrarily large.\n          delay += reason.extraDelay;\n        }\n\n        intentState.streamReaderCancelTimeout = setTimeout(() => {\n          intentState.streamReaderCancelTimeout = null;\n          this._abortOperatorList({ intentState, reason, force: true });\n        }, delay);\n        return;\n      }\n    }\n    intentState.streamReader\n      .cancel(new AbortException(reason.message))\n      .catch(() => {\n        // Avoid \"Uncaught promise\" messages in the console.\n      });\n    intentState.streamReader = null;\n\n    if (this._transport.destroyed) {\n      return; // Ignore any pending requests if the worker was terminated.\n    }\n    // Remove the current `intentState`, since a cancelled `getOperatorList`\n    // call on the worker-thread cannot be re-started...\n    for (const [curCacheKey, curIntentState] of this._intentStates) {\n      if (curIntentState === intentState) {\n        this._intentStates.delete(curCacheKey);\n        break;\n      }\n    }\n    // ... and force clean-up to ensure that any old state is always removed.\n    this.cleanup();\n  }\n\n  /**\n   * @type {StatTimer | null} Returns page stats, if enabled; returns `null`\n   *   otherwise.\n   */\n  get stats() {\n    return this._stats;\n  }\n}\n\nclass LoopbackPort {\n  #listeners = new Set();\n\n  #deferred = Promise.resolve();\n\n  postMessage(obj, transfer) {\n    const event = {\n      data: structuredClone(obj, transfer ? { transfer } : null),\n    };\n\n    this.#deferred.then(() => {\n      for (const listener of this.#listeners) {\n        listener.call(this, event);\n      }\n    });\n  }\n\n  addEventListener(name, listener) {\n    this.#listeners.add(listener);\n  }\n\n  removeEventListener(name, listener) {\n    this.#listeners.delete(listener);\n  }\n\n  terminate() {\n    this.#listeners.clear();\n  }\n}\n\n/**\n * @typedef {Object} PDFWorkerParameters\n * @property {string} [name] - The name of the worker.\n * @property {Worker} [port] - The `workerPort` object.\n * @property {number} [verbosity] - Controls the logging level;\n *   the constants from {@link VerbosityLevel} should be used.\n */\n\nconst PDFWorkerUtil = {\n  isWorkerDisabled: false,\n  fakeWorkerId: 0,\n};\nif (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) {\n  if (isNodeJS) {\n    // Workers aren't supported in Node.js, force-disabling them there.\n    PDFWorkerUtil.isWorkerDisabled = true;\n\n    GlobalWorkerOptions.workerSrc ||= PDFJSDev.test(\"LIB\")\n      ? \"../pdf.worker.js\"\n      : \"./pdf.worker.mjs\";\n  }\n\n  // Check if URLs have the same origin. For non-HTTP based URLs, returns false.\n  PDFWorkerUtil.isSameOrigin = function (baseUrl, otherUrl) {\n    let base;\n    try {\n      base = new URL(baseUrl);\n      if (!base.origin || base.origin === \"null\") {\n        return false; // non-HTTP url\n      }\n    } catch {\n      return false;\n    }\n\n    const other = new URL(otherUrl, base);\n    return base.origin === other.origin;\n  };\n\n  PDFWorkerUtil.createCDNWrapper = function (url) {\n    // We will rely on blob URL's property to specify origin.\n    // We want this function to fail in case if createObjectURL or Blob do not\n    // exist or fail for some reason -- our Worker creation will fail anyway.\n    const wrapper = `await import(\"${url}\");`;\n    return URL.createObjectURL(\n      new Blob([wrapper], { type: \"text/javascript\" })\n    );\n  };\n}\n\n/**\n * PDF.js web worker abstraction that controls the instantiation of PDF\n * documents. Message handlers are used to pass information from the main\n * thread to the worker thread and vice versa. If the creation of a web\n * worker is not possible, a \"fake\" worker will be used instead.\n *\n * @param {PDFWorkerParameters} params - The worker initialization parameters.\n */\nclass PDFWorker {\n  static #workerPorts;\n\n  constructor({\n    name = null,\n    port = null,\n    verbosity = getVerbosityLevel(),\n  } = {}) {\n    this.name = name;\n    this.destroyed = false;\n    this.verbosity = verbosity;\n\n    this._readyCapability = new PromiseCapability();\n    this._port = null;\n    this._webWorker = null;\n    this._messageHandler = null;\n\n    if (\n      (typeof PDFJSDev === \"undefined\" || !PDFJSDev.test(\"MOZCENTRAL\")) &&\n      port\n    ) {\n      if (PDFWorker.#workerPorts?.has(port)) {\n        throw new Error(\"Cannot use more than one PDFWorker per port.\");\n      }\n      (PDFWorker.#workerPorts ||= new WeakMap()).set(port, this);\n      this._initializeFromPort(port);\n      return;\n    }\n    this._initialize();\n  }\n\n  /**\n   * Promise for worker initialization completion.\n   * @type {Promise<void>}\n   */\n  get promise() {\n    return this._readyCapability.promise;\n  }\n\n  /**\n   * The current `workerPort`, when it exists.\n   * @type {Worker}\n   */\n  get port() {\n    return this._port;\n  }\n\n  /**\n   * The current MessageHandler-instance.\n   * @type {MessageHandler}\n   */\n  get messageHandler() {\n    return this._messageHandler;\n  }\n\n  _initializeFromPort(port) {\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n      throw new Error(\"Not implemented: _initializeFromPort\");\n    }\n    this._port = port;\n    this._messageHandler = new MessageHandler(\"main\", \"worker\", port);\n    this._messageHandler.on(\"ready\", function () {\n      // Ignoring \"ready\" event -- MessageHandler should already be initialized\n      // and ready to accept messages.\n    });\n    this._readyCapability.resolve();\n    // Send global setting, e.g. verbosity level.\n    this._messageHandler.send(\"configure\", {\n      verbosity: this.verbosity,\n    });\n  }\n\n  _initialize() {\n    // If worker support isn't disabled explicit and the browser has worker\n    // support, create a new web worker and test if it/the browser fulfills\n    // all requirements to run parts of pdf.js in a web worker.\n    // Right now, the requirement is, that an Uint8Array is still an\n    // Uint8Array as it arrives on the worker. (Chrome added this with v.15.)\n    if (\n      !PDFWorkerUtil.isWorkerDisabled &&\n      !PDFWorker.#mainThreadWorkerMessageHandler\n    ) {\n      let { workerSrc } = PDFWorker;\n\n      try {\n        // Wraps workerSrc path into blob URL, if the former does not belong\n        // to the same origin.\n        if (\n          typeof PDFJSDev !== \"undefined\" &&\n          PDFJSDev.test(\"GENERIC\") &&\n          !PDFWorkerUtil.isSameOrigin(window.location.href, workerSrc)\n        ) {\n          workerSrc = PDFWorkerUtil.createCDNWrapper(\n            new URL(workerSrc, window.location).href\n          );\n        }\n\n        const worker = new Worker(workerSrc, { type: \"module\" });\n        const messageHandler = new MessageHandler(\"main\", \"worker\", worker);\n        const terminateEarly = () => {\n          worker.removeEventListener(\"error\", onWorkerError);\n          messageHandler.destroy();\n          worker.terminate();\n          if (this.destroyed) {\n            this._readyCapability.reject(new Error(\"Worker was destroyed\"));\n          } else {\n            // Fall back to fake worker if the termination is caused by an\n            // error (e.g. NetworkError / SecurityError).\n            this._setupFakeWorker();\n          }\n        };\n\n        const onWorkerError = () => {\n          if (!this._webWorker) {\n            // Worker failed to initialize due to an error. Clean up and fall\n            // back to the fake worker.\n            terminateEarly();\n          }\n        };\n        worker.addEventListener(\"error\", onWorkerError);\n\n        messageHandler.on(\"test\", data => {\n          worker.removeEventListener(\"error\", onWorkerError);\n          if (this.destroyed) {\n            terminateEarly();\n            return; // worker was destroyed\n          }\n          if (data) {\n            this._messageHandler = messageHandler;\n            this._port = worker;\n            this._webWorker = worker;\n\n            this._readyCapability.resolve();\n            // Send global setting, e.g. verbosity level.\n            messageHandler.send(\"configure\", {\n              verbosity: this.verbosity,\n            });\n          } else {\n            this._setupFakeWorker();\n            messageHandler.destroy();\n            worker.terminate();\n          }\n        });\n\n        messageHandler.on(\"ready\", data => {\n          worker.removeEventListener(\"error\", onWorkerError);\n          if (this.destroyed) {\n            terminateEarly();\n            return; // worker was destroyed\n          }\n          try {\n            sendTest();\n          } catch {\n            // We need fallback to a faked worker.\n            this._setupFakeWorker();\n          }\n        });\n\n        const sendTest = () => {\n          const testObj = new Uint8Array();\n          // Ensure that we can use `postMessage` transfers.\n          messageHandler.send(\"test\", testObj, [testObj.buffer]);\n        };\n\n        // It might take time for the worker to initialize. We will try to send\n        // the \"test\" message immediately, and once the \"ready\" message arrives.\n        // The worker shall process only the first received \"test\" message.\n        sendTest();\n        return;\n      } catch {\n        info(\"The worker has been disabled.\");\n      }\n    }\n    // Either workers are disabled, not supported or have thrown an exception.\n    // Thus, we fallback to a faked worker.\n    this._setupFakeWorker();\n  }\n\n  _setupFakeWorker() {\n    if (!PDFWorkerUtil.isWorkerDisabled) {\n      warn(\"Setting up fake worker.\");\n      PDFWorkerUtil.isWorkerDisabled = true;\n    }\n\n    PDFWorker._setupFakeWorkerGlobal\n      .then(WorkerMessageHandler => {\n        if (this.destroyed) {\n          this._readyCapability.reject(new Error(\"Worker was destroyed\"));\n          return;\n        }\n        const port = new LoopbackPort();\n        this._port = port;\n\n        // All fake workers use the same port, making id unique.\n        const id = `fake${PDFWorkerUtil.fakeWorkerId++}`;\n\n        // If the main thread is our worker, setup the handling for the\n        // messages -- the main thread sends to it self.\n        const workerHandler = new MessageHandler(id + \"_worker\", id, port);\n        WorkerMessageHandler.setup(workerHandler, port);\n\n        const messageHandler = new MessageHandler(id, id + \"_worker\", port);\n        this._messageHandler = messageHandler;\n        this._readyCapability.resolve();\n        // Send global setting, e.g. verbosity level.\n        messageHandler.send(\"configure\", {\n          verbosity: this.verbosity,\n        });\n      })\n      .catch(reason => {\n        this._readyCapability.reject(\n          new Error(`Setting up fake worker failed: \"${reason.message}\".`)\n        );\n      });\n  }\n\n  /**\n   * Destroys the worker instance.\n   */\n  destroy() {\n    this.destroyed = true;\n    if (this._webWorker) {\n      // We need to terminate only web worker created resource.\n      this._webWorker.terminate();\n      this._webWorker = null;\n    }\n    PDFWorker.#workerPorts?.delete(this._port);\n    this._port = null;\n    if (this._messageHandler) {\n      this._messageHandler.destroy();\n      this._messageHandler = null;\n    }\n  }\n\n  /**\n   * @param {PDFWorkerParameters} params - The worker initialization parameters.\n   */\n  static fromPort(params) {\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n      throw new Error(\"Not implemented: fromPort\");\n    }\n    if (!params?.port) {\n      throw new Error(\"PDFWorker.fromPort - invalid method signature.\");\n    }\n    const cachedPort = this.#workerPorts?.get(params.port);\n    if (cachedPort) {\n      if (cachedPort._pendingDestroy) {\n        throw new Error(\n          \"PDFWorker.fromPort - the worker is being destroyed.\\n\" +\n            \"Please remember to await `PDFDocumentLoadingTask.destroy()`-calls.\"\n        );\n      }\n      return cachedPort;\n    }\n    return new PDFWorker(params);\n  }\n\n  /**\n   * The current `workerSrc`, when it exists.\n   * @type {string}\n   */\n  static get workerSrc() {\n    if (GlobalWorkerOptions.workerSrc) {\n      return GlobalWorkerOptions.workerSrc;\n    }\n    throw new Error('No \"GlobalWorkerOptions.workerSrc\" specified.');\n  }\n\n  static get #mainThreadWorkerMessageHandler() {\n    try {\n      return globalThis.pdfjsWorker?.WorkerMessageHandler || null;\n    } catch {\n      return null;\n    }\n  }\n\n  // Loads worker code into the main-thread.\n  static get _setupFakeWorkerGlobal() {\n    const loader = async () => {\n      if (this.#mainThreadWorkerMessageHandler) {\n        // The worker was already loaded using e.g. a `<script>` tag.\n        return this.#mainThreadWorkerMessageHandler;\n      }\n      const worker =\n        typeof PDFJSDev === \"undefined\"\n          ? await import(\"pdfjs/pdf.worker.js\")\n          : await import(/* webpackIgnore: true */ this.workerSrc);\n      return worker.WorkerMessageHandler;\n    };\n\n    return shadow(this, \"_setupFakeWorkerGlobal\", loader());\n  }\n}\n\n/**\n * For internal use only.\n * @ignore\n */\nclass WorkerTransport {\n  #methodPromises = new Map();\n\n  #pageCache = new Map();\n\n  #pagePromises = new Map();\n\n  #passwordCapability = null;\n\n  constructor(messageHandler, loadingTask, networkStream, params, factory) {\n    this.messageHandler = messageHandler;\n    this.loadingTask = loadingTask;\n    this.commonObjs = new PDFObjects();\n    this.fontLoader = new FontLoader({\n      ownerDocument: params.ownerDocument,\n      styleElement: params.styleElement,\n    });\n    this._params = params;\n\n    this.canvasFactory = factory.canvasFactory;\n    this.filterFactory = factory.filterFactory;\n    this.cMapReaderFactory = factory.cMapReaderFactory;\n    this.standardFontDataFactory = factory.standardFontDataFactory;\n\n    this.destroyed = false;\n    this.destroyCapability = null;\n\n    this._networkStream = networkStream;\n    this._fullReader = null;\n    this._lastProgress = null;\n    this.downloadInfoCapability = new PromiseCapability();\n\n    this.setupMessageHandler();\n\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      // For testing purposes.\n      Object.defineProperty(this, \"getXFADatasets\", {\n        value: () => {\n          return this.messageHandler.sendWithPromise(\"GetXFADatasets\", null);\n        },\n      });\n      Object.defineProperty(this, \"getXRefPrevValue\", {\n        value: () => {\n          return this.messageHandler.sendWithPromise(\"GetXRefPrevValue\", null);\n        },\n      });\n      Object.defineProperty(this, \"getAnnotArray\", {\n        value: pageIndex => {\n          return this.messageHandler.sendWithPromise(\"GetAnnotArray\", {\n            pageIndex,\n          });\n        },\n      });\n    }\n  }\n\n  #cacheSimpleMethod(name, data = null) {\n    const cachedPromise = this.#methodPromises.get(name);\n    if (cachedPromise) {\n      return cachedPromise;\n    }\n    const promise = this.messageHandler.sendWithPromise(name, data);\n\n    this.#methodPromises.set(name, promise);\n    return promise;\n  }\n\n  get annotationStorage() {\n    return shadow(this, \"annotationStorage\", new AnnotationStorage());\n  }\n\n  getRenderingIntent(\n    intent,\n    annotationMode = AnnotationMode.ENABLE,\n    printAnnotationStorage = null,\n    isOpList = false\n  ) {\n    let renderingIntent = RenderingIntentFlag.DISPLAY; // Default value.\n    let annotationStorageSerializable = SerializableEmpty;\n\n    switch (intent) {\n      case \"any\":\n        renderingIntent = RenderingIntentFlag.ANY;\n        break;\n      case \"display\":\n        break;\n      case \"print\":\n        renderingIntent = RenderingIntentFlag.PRINT;\n        break;\n      default:\n        warn(`getRenderingIntent - invalid intent: ${intent}`);\n    }\n\n    switch (annotationMode) {\n      case AnnotationMode.DISABLE:\n        renderingIntent += RenderingIntentFlag.ANNOTATIONS_DISABLE;\n        break;\n      case AnnotationMode.ENABLE:\n        break;\n      case AnnotationMode.ENABLE_FORMS:\n        renderingIntent += RenderingIntentFlag.ANNOTATIONS_FORMS;\n        break;\n      case AnnotationMode.ENABLE_STORAGE:\n        renderingIntent += RenderingIntentFlag.ANNOTATIONS_STORAGE;\n\n        const annotationStorage =\n          renderingIntent & RenderingIntentFlag.PRINT &&\n          printAnnotationStorage instanceof PrintAnnotationStorage\n            ? printAnnotationStorage\n            : this.annotationStorage;\n\n        annotationStorageSerializable = annotationStorage.serializable;\n        break;\n      default:\n        warn(`getRenderingIntent - invalid annotationMode: ${annotationMode}`);\n    }\n\n    if (isOpList) {\n      renderingIntent += RenderingIntentFlag.OPLIST;\n    }\n\n    return {\n      renderingIntent,\n      cacheKey: `${renderingIntent}_${annotationStorageSerializable.hash}`,\n      annotationStorageSerializable,\n    };\n  }\n\n  destroy() {\n    if (this.destroyCapability) {\n      return this.destroyCapability.promise;\n    }\n\n    this.destroyed = true;\n    this.destroyCapability = new PromiseCapability();\n\n    this.#passwordCapability?.reject(\n      new Error(\"Worker was destroyed during onPassword callback\")\n    );\n\n    const waitOn = [];\n    // We need to wait for all renderings to be completed, e.g.\n    // timeout/rAF can take a long time.\n    for (const page of this.#pageCache.values()) {\n      waitOn.push(page._destroy());\n    }\n    this.#pageCache.clear();\n    this.#pagePromises.clear();\n    // Allow `AnnotationStorage`-related clean-up when destroying the document.\n    if (this.hasOwnProperty(\"annotationStorage\")) {\n      this.annotationStorage.resetModified();\n    }\n    // We also need to wait for the worker to finish its long running tasks.\n    const terminated = this.messageHandler.sendWithPromise(\"Terminate\", null);\n    waitOn.push(terminated);\n\n    Promise.all(waitOn).then(() => {\n      this.commonObjs.clear();\n      this.fontLoader.clear();\n      this.#methodPromises.clear();\n      this.filterFactory.destroy();\n\n      this._networkStream?.cancelAllRequests(\n        new AbortException(\"Worker was terminated.\")\n      );\n\n      if (this.messageHandler) {\n        this.messageHandler.destroy();\n        this.messageHandler = null;\n      }\n      this.destroyCapability.resolve();\n    }, this.destroyCapability.reject);\n    return this.destroyCapability.promise;\n  }\n\n  setupMessageHandler() {\n    const { messageHandler, loadingTask } = this;\n\n    messageHandler.on(\"GetReader\", (data, sink) => {\n      assert(\n        this._networkStream,\n        \"GetReader - no `IPDFStream` instance available.\"\n      );\n      this._fullReader = this._networkStream.getFullReader();\n      this._fullReader.onProgress = evt => {\n        this._lastProgress = {\n          loaded: evt.loaded,\n          total: evt.total,\n        };\n      };\n      sink.onPull = () => {\n        this._fullReader\n          .read()\n          .then(function ({ value, done }) {\n            if (done) {\n              sink.close();\n              return;\n            }\n            assert(\n              value instanceof ArrayBuffer,\n              \"GetReader - expected an ArrayBuffer.\"\n            );\n            // Enqueue data chunk into sink, and transfer it\n            // to other side as `Transferable` object.\n            sink.enqueue(new Uint8Array(value), 1, [value]);\n          })\n          .catch(reason => {\n            sink.error(reason);\n          });\n      };\n\n      sink.onCancel = reason => {\n        this._fullReader.cancel(reason);\n\n        sink.ready.catch(readyReason => {\n          if (this.destroyed) {\n            return; // Ignore any pending requests if the worker was terminated.\n          }\n          throw readyReason;\n        });\n      };\n    });\n\n    messageHandler.on(\"ReaderHeadersReady\", data => {\n      const headersCapability = new PromiseCapability();\n      const fullReader = this._fullReader;\n      fullReader.headersReady.then(() => {\n        // If stream or range are disabled, it's our only way to report\n        // loading progress.\n        if (!fullReader.isStreamingSupported || !fullReader.isRangeSupported) {\n          if (this._lastProgress) {\n            loadingTask.onProgress?.(this._lastProgress);\n          }\n          fullReader.onProgress = evt => {\n            loadingTask.onProgress?.({\n              loaded: evt.loaded,\n              total: evt.total,\n            });\n          };\n        }\n\n        headersCapability.resolve({\n          isStreamingSupported: fullReader.isStreamingSupported,\n          isRangeSupported: fullReader.isRangeSupported,\n          contentLength: fullReader.contentLength,\n        });\n      }, headersCapability.reject);\n\n      return headersCapability.promise;\n    });\n\n    messageHandler.on(\"GetRangeReader\", (data, sink) => {\n      assert(\n        this._networkStream,\n        \"GetRangeReader - no `IPDFStream` instance available.\"\n      );\n      const rangeReader = this._networkStream.getRangeReader(\n        data.begin,\n        data.end\n      );\n\n      // When streaming is enabled, it's possible that the data requested here\n      // has already been fetched via the `_fullRequestReader` implementation.\n      // However, given that the PDF data is loaded asynchronously on the\n      // main-thread and then sent via `postMessage` to the worker-thread,\n      // it may not have been available during parsing (hence the attempt to\n      // use range requests here).\n      //\n      // To avoid wasting time and resources here, we'll thus *not* dispatch\n      // range requests if the data was already loaded but has not been sent to\n      // the worker-thread yet (which will happen via the `_fullRequestReader`).\n      if (!rangeReader) {\n        sink.close();\n        return;\n      }\n\n      sink.onPull = () => {\n        rangeReader\n          .read()\n          .then(function ({ value, done }) {\n            if (done) {\n              sink.close();\n              return;\n            }\n            assert(\n              value instanceof ArrayBuffer,\n              \"GetRangeReader - expected an ArrayBuffer.\"\n            );\n            sink.enqueue(new Uint8Array(value), 1, [value]);\n          })\n          .catch(reason => {\n            sink.error(reason);\n          });\n      };\n\n      sink.onCancel = reason => {\n        rangeReader.cancel(reason);\n\n        sink.ready.catch(readyReason => {\n          if (this.destroyed) {\n            return; // Ignore any pending requests if the worker was terminated.\n          }\n          throw readyReason;\n        });\n      };\n    });\n\n    messageHandler.on(\"GetDoc\", ({ pdfInfo }) => {\n      this._numPages = pdfInfo.numPages;\n      this._htmlForXfa = pdfInfo.htmlForXfa;\n      delete pdfInfo.htmlForXfa;\n      loadingTask._capability.resolve(new PDFDocumentProxy(pdfInfo, this));\n    });\n\n    messageHandler.on(\"DocException\", function (ex) {\n      let reason;\n      switch (ex.name) {\n        case \"PasswordException\":\n          reason = new PasswordException(ex.message, ex.code);\n          break;\n        case \"InvalidPDFException\":\n          reason = new InvalidPDFException(ex.message);\n          break;\n        case \"MissingPDFException\":\n          reason = new MissingPDFException(ex.message);\n          break;\n        case \"UnexpectedResponseException\":\n          reason = new UnexpectedResponseException(ex.message, ex.status);\n          break;\n        case \"UnknownErrorException\":\n          reason = new UnknownErrorException(ex.message, ex.details);\n          break;\n        default:\n          unreachable(\"DocException - expected a valid Error.\");\n      }\n      loadingTask._capability.reject(reason);\n    });\n\n    messageHandler.on(\"PasswordRequest\", exception => {\n      this.#passwordCapability = new PromiseCapability();\n\n      if (loadingTask.onPassword) {\n        const updatePassword = password => {\n          if (password instanceof Error) {\n            this.#passwordCapability.reject(password);\n          } else {\n            this.#passwordCapability.resolve({ password });\n          }\n        };\n        try {\n          loadingTask.onPassword(updatePassword, exception.code);\n        } catch (ex) {\n          this.#passwordCapability.reject(ex);\n        }\n      } else {\n        this.#passwordCapability.reject(\n          new PasswordException(exception.message, exception.code)\n        );\n      }\n      return this.#passwordCapability.promise;\n    });\n\n    messageHandler.on(\"DataLoaded\", data => {\n      // For consistency: Ensure that progress is always reported when the\n      // entire PDF file has been loaded, regardless of how it was fetched.\n      loadingTask.onProgress?.({\n        loaded: data.length,\n        total: data.length,\n      });\n\n      this.downloadInfoCapability.resolve(data);\n    });\n\n    messageHandler.on(\"StartRenderPage\", data => {\n      if (this.destroyed) {\n        return; // Ignore any pending requests if the worker was terminated.\n      }\n\n      const page = this.#pageCache.get(data.pageIndex);\n      page._startRenderPage(data.transparency, data.cacheKey);\n    });\n\n    messageHandler.on(\"commonobj\", ([id, type, exportedData]) => {\n      if (this.destroyed) {\n        return null; // Ignore any pending requests if the worker was terminated.\n      }\n\n      if (this.commonObjs.has(id)) {\n        return null;\n      }\n\n      switch (type) {\n        case \"Font\":\n          const params = this._params;\n\n          if (\"error\" in exportedData) {\n            const exportedError = exportedData.error;\n            warn(`Error during font loading: ${exportedError}`);\n            this.commonObjs.resolve(id, exportedError);\n            break;\n          }\n\n          const inspectFont =\n            params.pdfBug && globalThis.FontInspector?.enabled\n              ? (font, url) => globalThis.FontInspector.fontAdded(font, url)\n              : null;\n          const font = new FontFaceObject(exportedData, {\n            isEvalSupported: params.isEvalSupported,\n            disableFontFace: params.disableFontFace,\n            ignoreErrors: params.ignoreErrors,\n            inspectFont,\n          });\n\n          this.fontLoader\n            .bind(font)\n            .catch(reason => {\n              return messageHandler.sendWithPromise(\"FontFallback\", { id });\n            })\n            .finally(() => {\n              if (!params.fontExtraProperties && font.data) {\n                // Immediately release the `font.data` property once the font\n                // has been attached to the DOM, since it's no longer needed,\n                // rather than waiting for a `PDFDocumentProxy.cleanup` call.\n                // Since `font.data` could be very large, e.g. in some cases\n                // multiple megabytes, this will help reduce memory usage.\n                font.data = null;\n              }\n              this.commonObjs.resolve(id, font);\n            });\n          break;\n        case \"CopyLocalImage\":\n          const { imageRef } = exportedData;\n          assert(imageRef, \"The imageRef must be defined.\");\n\n          for (const pageProxy of this.#pageCache.values()) {\n            for (const [, data] of pageProxy.objs) {\n              if (data.ref !== imageRef) {\n                continue;\n              }\n              if (!data.dataLen) {\n                return null;\n              }\n              this.commonObjs.resolve(id, structuredClone(data));\n              return data.dataLen;\n            }\n          }\n          break;\n        case \"FontPath\":\n        case \"Image\":\n        case \"Pattern\":\n          this.commonObjs.resolve(id, exportedData);\n          break;\n        default:\n          throw new Error(`Got unknown common object type ${type}`);\n      }\n\n      return null;\n    });\n\n    messageHandler.on(\"obj\", ([id, pageIndex, type, imageData]) => {\n      if (this.destroyed) {\n        // Ignore any pending requests if the worker was terminated.\n        return;\n      }\n\n      const pageProxy = this.#pageCache.get(pageIndex);\n      if (pageProxy.objs.has(id)) {\n        return;\n      }\n      // Don't store data *after* cleanup has successfully run, see bug 1854145.\n      if (pageProxy._intentStates.size === 0) {\n        imageData?.bitmap?.close(); // Release any `ImageBitmap` data.\n        return;\n      }\n\n      switch (type) {\n        case \"Image\":\n          pageProxy.objs.resolve(id, imageData);\n\n          // Heuristic that will allow us not to store large data.\n          if (imageData?.dataLen > MAX_IMAGE_SIZE_TO_CACHE) {\n            pageProxy._maybeCleanupAfterRender = true;\n          }\n          break;\n        case \"Pattern\":\n          pageProxy.objs.resolve(id, imageData);\n          break;\n        default:\n          throw new Error(`Got unknown object type ${type}`);\n      }\n    });\n\n    messageHandler.on(\"DocProgress\", data => {\n      if (this.destroyed) {\n        return; // Ignore any pending requests if the worker was terminated.\n      }\n      loadingTask.onProgress?.({\n        loaded: data.loaded,\n        total: data.total,\n      });\n    });\n\n    messageHandler.on(\"FetchBuiltInCMap\", data => {\n      if (this.destroyed) {\n        return Promise.reject(new Error(\"Worker was destroyed.\"));\n      }\n      if (!this.cMapReaderFactory) {\n        return Promise.reject(\n          new Error(\n            \"CMapReaderFactory not initialized, see the `useWorkerFetch` parameter.\"\n          )\n        );\n      }\n      return this.cMapReaderFactory.fetch(data);\n    });\n\n    messageHandler.on(\"FetchStandardFontData\", data => {\n      if (this.destroyed) {\n        return Promise.reject(new Error(\"Worker was destroyed.\"));\n      }\n      if (!this.standardFontDataFactory) {\n        return Promise.reject(\n          new Error(\n            \"StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.\"\n          )\n        );\n      }\n      return this.standardFontDataFactory.fetch(data);\n    });\n  }\n\n  getData() {\n    return this.messageHandler.sendWithPromise(\"GetData\", null);\n  }\n\n  saveDocument() {\n    if (this.annotationStorage.size <= 0) {\n      warn(\n        \"saveDocument called while `annotationStorage` is empty, \" +\n          \"please use the getData-method instead.\"\n      );\n    }\n    const { map, transfer } = this.annotationStorage.serializable;\n\n    return this.messageHandler\n      .sendWithPromise(\n        \"SaveDocument\",\n        {\n          isPureXfa: !!this._htmlForXfa,\n          numPages: this._numPages,\n          annotationStorage: map,\n          filename: this._fullReader?.filename ?? null,\n        },\n        transfer\n      )\n      .finally(() => {\n        this.annotationStorage.resetModified();\n      });\n  }\n\n  getPage(pageNumber) {\n    if (\n      !Number.isInteger(pageNumber) ||\n      pageNumber <= 0 ||\n      pageNumber > this._numPages\n    ) {\n      return Promise.reject(new Error(\"Invalid page request.\"));\n    }\n\n    const pageIndex = pageNumber - 1,\n      cachedPromise = this.#pagePromises.get(pageIndex);\n    if (cachedPromise) {\n      return cachedPromise;\n    }\n    const promise = this.messageHandler\n      .sendWithPromise(\"GetPage\", {\n        pageIndex,\n      })\n      .then(pageInfo => {\n        if (this.destroyed) {\n          throw new Error(\"Transport destroyed\");\n        }\n        const page = new PDFPageProxy(\n          pageIndex,\n          pageInfo,\n          this,\n          this._params.pdfBug\n        );\n        this.#pageCache.set(pageIndex, page);\n        return page;\n      });\n    this.#pagePromises.set(pageIndex, promise);\n    return promise;\n  }\n\n  getPageIndex(ref) {\n    if (\n      typeof ref !== \"object\" ||\n      ref === null ||\n      !Number.isInteger(ref.num) ||\n      ref.num < 0 ||\n      !Number.isInteger(ref.gen) ||\n      ref.gen < 0\n    ) {\n      return Promise.reject(new Error(\"Invalid pageIndex request.\"));\n    }\n    return this.messageHandler.sendWithPromise(\"GetPageIndex\", {\n      num: ref.num,\n      gen: ref.gen,\n    });\n  }\n\n  getAnnotations(pageIndex, intent) {\n    return this.messageHandler.sendWithPromise(\"GetAnnotations\", {\n      pageIndex,\n      intent,\n    });\n  }\n\n  getFieldObjects() {\n    return this.#cacheSimpleMethod(\"GetFieldObjects\");\n  }\n\n  hasJSActions() {\n    return this.#cacheSimpleMethod(\"HasJSActions\");\n  }\n\n  getCalculationOrderIds() {\n    return this.messageHandler.sendWithPromise(\"GetCalculationOrderIds\", null);\n  }\n\n  getDestinations() {\n    return this.messageHandler.sendWithPromise(\"GetDestinations\", null);\n  }\n\n  getDestination(id) {\n    if (typeof id !== \"string\") {\n      return Promise.reject(new Error(\"Invalid destination request.\"));\n    }\n    return this.messageHandler.sendWithPromise(\"GetDestination\", {\n      id,\n    });\n  }\n\n  getPageLabels() {\n    return this.messageHandler.sendWithPromise(\"GetPageLabels\", null);\n  }\n\n  getPageLayout() {\n    return this.messageHandler.sendWithPromise(\"GetPageLayout\", null);\n  }\n\n  getPageMode() {\n    return this.messageHandler.sendWithPromise(\"GetPageMode\", null);\n  }\n\n  getViewerPreferences() {\n    return this.messageHandler.sendWithPromise(\"GetViewerPreferences\", null);\n  }\n\n  getOpenAction() {\n    return this.messageHandler.sendWithPromise(\"GetOpenAction\", null);\n  }\n\n  getAttachments() {\n    return this.messageHandler.sendWithPromise(\"GetAttachments\", null);\n  }\n\n  getDocJSActions() {\n    return this.#cacheSimpleMethod(\"GetDocJSActions\");\n  }\n\n  getPageJSActions(pageIndex) {\n    return this.messageHandler.sendWithPromise(\"GetPageJSActions\", {\n      pageIndex,\n    });\n  }\n\n  getStructTree(pageIndex) {\n    return this.messageHandler.sendWithPromise(\"GetStructTree\", {\n      pageIndex,\n    });\n  }\n\n  getOutline() {\n    return this.messageHandler.sendWithPromise(\"GetOutline\", null);\n  }\n\n  getOptionalContentConfig() {\n    return this.messageHandler\n      .sendWithPromise(\"GetOptionalContentConfig\", null)\n      .then(results => {\n        return new OptionalContentConfig(results);\n      });\n  }\n\n  getPermissions() {\n    return this.messageHandler.sendWithPromise(\"GetPermissions\", null);\n  }\n\n  getMetadata() {\n    const name = \"GetMetadata\",\n      cachedPromise = this.#methodPromises.get(name);\n    if (cachedPromise) {\n      return cachedPromise;\n    }\n    const promise = this.messageHandler\n      .sendWithPromise(name, null)\n      .then(results => {\n        return {\n          info: results[0],\n          metadata: results[1] ? new Metadata(results[1]) : null,\n          contentDispositionFilename: this._fullReader?.filename ?? null,\n          contentLength: this._fullReader?.contentLength ?? null,\n        };\n      });\n    this.#methodPromises.set(name, promise);\n    return promise;\n  }\n\n  getMarkInfo() {\n    return this.messageHandler.sendWithPromise(\"GetMarkInfo\", null);\n  }\n\n  async startCleanup(keepLoadedFonts = false) {\n    if (this.destroyed) {\n      return; // No need to manually clean-up when destruction has started.\n    }\n    await this.messageHandler.sendWithPromise(\"Cleanup\", null);\n\n    for (const page of this.#pageCache.values()) {\n      const cleanupSuccessful = page.cleanup();\n\n      if (!cleanupSuccessful) {\n        throw new Error(\n          `startCleanup: Page ${page.pageNumber} is currently rendering.`\n        );\n      }\n    }\n    this.commonObjs.clear();\n    if (!keepLoadedFonts) {\n      this.fontLoader.clear();\n    }\n    this.#methodPromises.clear();\n    this.filterFactory.destroy(/* keepHCM = */ true);\n  }\n\n  get loadingParams() {\n    const { disableAutoFetch, enableXfa } = this._params;\n    return shadow(this, \"loadingParams\", {\n      disableAutoFetch,\n      enableXfa,\n    });\n  }\n}\n\n/**\n * A PDF document and page is built of many objects. E.g. there are objects for\n * fonts, images, rendering code, etc. These objects may get processed inside of\n * a worker. This class implements some basic methods to manage these objects.\n */\nclass PDFObjects {\n  #objs = Object.create(null);\n\n  /**\n   * Ensures there is an object defined for `objId`.\n   *\n   * @param {string} objId\n   * @returns {Object}\n   */\n  #ensureObj(objId) {\n    return (this.#objs[objId] ||= {\n      capability: new PromiseCapability(),\n      data: null,\n    });\n  }\n\n  /**\n   * If called *without* callback, this returns the data of `objId` but the\n   * object needs to be resolved. If it isn't, this method throws.\n   *\n   * If called *with* a callback, the callback is called with the data of the\n   * object once the object is resolved. That means, if you call this method\n   * and the object is already resolved, the callback gets called right away.\n   *\n   * @param {string} objId\n   * @param {function} [callback]\n   * @returns {any}\n   */\n  get(objId, callback = null) {\n    // If there is a callback, then the get can be async and the object is\n    // not required to be resolved right now.\n    if (callback) {\n      const obj = this.#ensureObj(objId);\n      obj.capability.promise.then(() => callback(obj.data));\n      return null;\n    }\n    // If there isn't a callback, the user expects to get the resolved data\n    // directly.\n    const obj = this.#objs[objId];\n    // If there isn't an object yet or the object isn't resolved, then the\n    // data isn't ready yet!\n    if (!obj?.capability.settled) {\n      throw new Error(`Requesting object that isn't resolved yet ${objId}.`);\n    }\n    return obj.data;\n  }\n\n  /**\n   * @param {string} objId\n   * @returns {boolean}\n   */\n  has(objId) {\n    const obj = this.#objs[objId];\n    return obj?.capability.settled ?? false;\n  }\n\n  /**\n   * Resolves the object `objId` with optional `data`.\n   *\n   * @param {string} objId\n   * @param {any} [data]\n   */\n  resolve(objId, data = null) {\n    const obj = this.#ensureObj(objId);\n    obj.data = data;\n    obj.capability.resolve();\n  }\n\n  clear() {\n    for (const objId in this.#objs) {\n      const { data } = this.#objs[objId];\n      data?.bitmap?.close(); // Release any `ImageBitmap` data.\n    }\n    this.#objs = Object.create(null);\n  }\n\n  *[Symbol.iterator]() {\n    for (const objId in this.#objs) {\n      const { capability, data } = this.#objs[objId];\n\n      if (!capability.settled) {\n        continue;\n      }\n      yield [objId, data];\n    }\n  }\n}\n\n/**\n * Allows controlling of the rendering tasks.\n */\nclass RenderTask {\n  #internalRenderTask = null;\n\n  constructor(internalRenderTask) {\n    this.#internalRenderTask = internalRenderTask;\n\n    /**\n     * Callback for incremental rendering -- a function that will be called\n     * each time the rendering is paused.  To continue rendering call the\n     * function that is the first argument to the callback.\n     * @type {function}\n     */\n    this.onContinue = null;\n\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      // For testing purposes.\n      Object.defineProperty(this, \"getOperatorList\", {\n        value: () => {\n          return this.#internalRenderTask.operatorList;\n        },\n      });\n    }\n  }\n\n  /**\n   * Promise for rendering task completion.\n   * @type {Promise<void>}\n   */\n  get promise() {\n    return this.#internalRenderTask.capability.promise;\n  }\n\n  /**\n   * Cancels the rendering task. If the task is currently rendering it will\n   * not be cancelled until graphics pauses with a timeout. The promise that\n   * this object extends will be rejected when cancelled.\n   *\n   * @param {number} [extraDelay]\n   */\n  cancel(extraDelay = 0) {\n    this.#internalRenderTask.cancel(/* error = */ null, extraDelay);\n  }\n\n  /**\n   * Whether form fields are rendered separately from the main operatorList.\n   * @type {boolean}\n   */\n  get separateAnnots() {\n    const { separateAnnots } = this.#internalRenderTask.operatorList;\n    if (!separateAnnots) {\n      return false;\n    }\n    const { annotationCanvasMap } = this.#internalRenderTask;\n    return (\n      separateAnnots.form ||\n      (separateAnnots.canvas && annotationCanvasMap?.size > 0)\n    );\n  }\n}\n\n/**\n * For internal use only.\n * @ignore\n */\nclass InternalRenderTask {\n  static #canvasInUse = new WeakSet();\n\n  constructor({\n    callback,\n    params,\n    objs,\n    commonObjs,\n    annotationCanvasMap,\n    operatorList,\n    pageIndex,\n    canvasFactory,\n    filterFactory,\n    useRequestAnimationFrame = false,\n    pdfBug = false,\n    pageColors = null,\n  }) {\n    this.callback = callback;\n    this.params = params;\n    this.objs = objs;\n    this.commonObjs = commonObjs;\n    this.annotationCanvasMap = annotationCanvasMap;\n    this.operatorListIdx = null;\n    this.operatorList = operatorList;\n    this._pageIndex = pageIndex;\n    this.canvasFactory = canvasFactory;\n    this.filterFactory = filterFactory;\n    this._pdfBug = pdfBug;\n    this.pageColors = pageColors;\n\n    this.running = false;\n    this.graphicsReadyCallback = null;\n    this.graphicsReady = false;\n    this._useRequestAnimationFrame =\n      useRequestAnimationFrame === true && typeof window !== \"undefined\";\n    this.cancelled = false;\n    this.capability = new PromiseCapability();\n    this.task = new RenderTask(this);\n    // caching this-bound methods\n    this._cancelBound = this.cancel.bind(this);\n    this._continueBound = this._continue.bind(this);\n    this._scheduleNextBound = this._scheduleNext.bind(this);\n    this._nextBound = this._next.bind(this);\n    this._canvas = params.canvasContext.canvas;\n  }\n\n  get completed() {\n    return this.capability.promise.catch(function () {\n      // Ignoring errors, since we only want to know when rendering is\n      // no longer pending.\n    });\n  }\n\n  initializeGraphics({ transparency = false, optionalContentConfig }) {\n    if (this.cancelled) {\n      return;\n    }\n    if (this._canvas) {\n      if (InternalRenderTask.#canvasInUse.has(this._canvas)) {\n        throw new Error(\n          \"Cannot use the same canvas during multiple render() operations. \" +\n            \"Use different canvas or ensure previous operations were \" +\n            \"cancelled or completed.\"\n        );\n      }\n      InternalRenderTask.#canvasInUse.add(this._canvas);\n    }\n\n    if (this._pdfBug && globalThis.StepperManager?.enabled) {\n      this.stepper = globalThis.StepperManager.create(this._pageIndex);\n      this.stepper.init(this.operatorList);\n      this.stepper.nextBreakPoint = this.stepper.getNextBreakPoint();\n    }\n    const { canvasContext, viewport, transform, background } = this.params;\n\n    this.gfx = new CanvasGraphics(\n      canvasContext,\n      this.commonObjs,\n      this.objs,\n      this.canvasFactory,\n      this.filterFactory,\n      { optionalContentConfig },\n      this.annotationCanvasMap,\n      this.pageColors\n    );\n    this.gfx.beginDrawing({\n      transform,\n      viewport,\n      transparency,\n      background,\n    });\n    this.operatorListIdx = 0;\n    this.graphicsReady = true;\n    this.graphicsReadyCallback?.();\n  }\n\n  cancel(error = null, extraDelay = 0) {\n    this.running = false;\n    this.cancelled = true;\n    this.gfx?.endDrawing();\n    InternalRenderTask.#canvasInUse.delete(this._canvas);\n\n    this.callback(\n      error ||\n        new RenderingCancelledException(\n          `Rendering cancelled, page ${this._pageIndex + 1}`,\n          extraDelay\n        )\n    );\n  }\n\n  operatorListChanged() {\n    if (!this.graphicsReady) {\n      this.graphicsReadyCallback ||= this._continueBound;\n      return;\n    }\n    this.stepper?.updateOperatorList(this.operatorList);\n\n    if (this.running) {\n      return;\n    }\n    this._continue();\n  }\n\n  _continue() {\n    this.running = true;\n    if (this.cancelled) {\n      return;\n    }\n    if (this.task.onContinue) {\n      this.task.onContinue(this._scheduleNextBound);\n    } else {\n      this._scheduleNext();\n    }\n  }\n\n  _scheduleNext() {\n    if (this._useRequestAnimationFrame) {\n      window.requestAnimationFrame(() => {\n        this._nextBound().catch(this._cancelBound);\n      });\n    } else {\n      Promise.resolve().then(this._nextBound).catch(this._cancelBound);\n    }\n  }\n\n  async _next() {\n    if (this.cancelled) {\n      return;\n    }\n    this.operatorListIdx = this.gfx.executeOperatorList(\n      this.operatorList,\n      this.operatorListIdx,\n      this._continueBound,\n      this.stepper\n    );\n    if (this.operatorListIdx === this.operatorList.argsArray.length) {\n      this.running = false;\n      if (this.operatorList.lastChunk) {\n        this.gfx.endDrawing();\n        InternalRenderTask.#canvasInUse.delete(this._canvas);\n\n        this.callback();\n      }\n    }\n  }\n}\n\n/** @type {string} */\nconst version =\n  typeof PDFJSDev !== \"undefined\" ? PDFJSDev.eval(\"BUNDLE_VERSION\") : null;\n/** @type {string} */\nconst build =\n  typeof PDFJSDev !== \"undefined\" ? PDFJSDev.eval(\"BUNDLE_BUILD\") : null;\n\nexport {\n  build,\n  DefaultCanvasFactory,\n  DefaultCMapReaderFactory,\n  DefaultFilterFactory,\n  DefaultStandardFontDataFactory,\n  getDocument,\n  LoopbackPort,\n  PDFDataRangeTransport,\n  PDFDocumentLoadingTask,\n  PDFDocumentProxy,\n  PDFPageProxy,\n  PDFWorker,\n  PDFWorkerUtil,\n  RenderTask,\n  version,\n};\n", "/* Copyright 2015 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { CMapCompressionType, unreachable } from \"../shared/util.js\";\n\nclass BaseFilterFactory {\n  constructor() {\n    if (this.constructor === BaseFilterFactory) {\n      unreachable(\"Cannot initialize BaseFilterFactory.\");\n    }\n  }\n\n  addFilter(maps) {\n    return \"none\";\n  }\n\n  addHCMFilter(fgColor, bgColor) {\n    return \"none\";\n  }\n\n  addHighlightHCMFilter(fgColor, bgColor, newFgColor, newBgColor) {\n    return \"none\";\n  }\n\n  destroy(keepHCM = false) {}\n}\n\nclass BaseCanvasFactory {\n  constructor() {\n    if (this.constructor === BaseCanvasFactory) {\n      unreachable(\"Cannot initialize BaseCanvasFactory.\");\n    }\n  }\n\n  create(width, height) {\n    if (width <= 0 || height <= 0) {\n      throw new Error(\"Invalid canvas size\");\n    }\n    const canvas = this._createCanvas(width, height);\n    return {\n      canvas,\n      context: canvas.getContext(\"2d\"),\n    };\n  }\n\n  reset(canvasAndContext, width, height) {\n    if (!canvasAndContext.canvas) {\n      throw new Error(\"Canvas is not specified\");\n    }\n    if (width <= 0 || height <= 0) {\n      throw new Error(\"Invalid canvas size\");\n    }\n    canvasAndContext.canvas.width = width;\n    canvasAndContext.canvas.height = height;\n  }\n\n  destroy(canvasAndContext) {\n    if (!canvasAndContext.canvas) {\n      throw new Error(\"Canvas is not specified\");\n    }\n    // Zeroing the width and height cause Firefox to release graphics\n    // resources immediately, which can greatly reduce memory consumption.\n    canvasAndContext.canvas.width = 0;\n    canvasAndContext.canvas.height = 0;\n    canvasAndContext.canvas = null;\n    canvasAndContext.context = null;\n  }\n\n  /**\n   * @ignore\n   */\n  _createCanvas(width, height) {\n    unreachable(\"Abstract method `_createCanvas` called.\");\n  }\n}\n\nclass BaseCMapReaderFactory {\n  constructor({ baseUrl = null, isCompressed = true }) {\n    if (this.constructor === BaseCMapReaderFactory) {\n      unreachable(\"Cannot initialize BaseCMapReaderFactory.\");\n    }\n    this.baseUrl = baseUrl;\n    this.isCompressed = isCompressed;\n  }\n\n  async fetch({ name }) {\n    if (!this.baseUrl) {\n      throw new Error(\n        'The CMap \"baseUrl\" parameter must be specified, ensure that ' +\n          'the \"cMapUrl\" and \"cMapPacked\" API parameters are provided.'\n      );\n    }\n    if (!name) {\n      throw new Error(\"CMap name must be specified.\");\n    }\n    const url = this.baseUrl + name + (this.isCompressed ? \".bcmap\" : \"\");\n    const compressionType = this.isCompressed\n      ? CMapCompressionType.BINARY\n      : CMapCompressionType.NONE;\n\n    return this._fetchData(url, compressionType).catch(reason => {\n      throw new Error(\n        `Unable to load ${this.isCompressed ? \"binary \" : \"\"}CMap at: ${url}`\n      );\n    });\n  }\n\n  /**\n   * @ignore\n   */\n  _fetchData(url, compressionType) {\n    unreachable(\"Abstract method `_fetchData` called.\");\n  }\n}\n\nclass BaseStandardFontDataFactory {\n  constructor({ baseUrl = null }) {\n    if (this.constructor === BaseStandardFontDataFactory) {\n      unreachable(\"Cannot initialize BaseStandardFontDataFactory.\");\n    }\n    this.baseUrl = baseUrl;\n  }\n\n  async fetch({ filename }) {\n    if (!this.baseUrl) {\n      throw new Error(\n        'The standard font \"baseUrl\" parameter must be specified, ensure that ' +\n          'the \"standardFontDataUrl\" API parameter is provided.'\n      );\n    }\n    if (!filename) {\n      throw new Error(\"Font filename must be specified.\");\n    }\n    const url = `${this.baseUrl}${filename}`;\n\n    return this._fetchData(url).catch(reason => {\n      throw new Error(`Unable to load font data at: ${url}`);\n    });\n  }\n\n  /**\n   * @ignore\n   */\n  _fetchData(url) {\n    unreachable(\"Abstract method `_fetchData` called.\");\n  }\n}\n\nclass BaseSVGFactory {\n  constructor() {\n    if (this.constructor === BaseSVGFactory) {\n      unreachable(\"Cannot initialize BaseSVGFactory.\");\n    }\n  }\n\n  create(width, height, skipDimensions = false) {\n    if (width <= 0 || height <= 0) {\n      throw new Error(\"Invalid SVG dimensions\");\n    }\n    const svg = this._createSVG(\"svg:svg\");\n    svg.setAttribute(\"version\", \"1.1\");\n\n    if (!skipDimensions) {\n      svg.setAttribute(\"width\", `${width}px`);\n      svg.setAttribute(\"height\", `${height}px`);\n    }\n\n    svg.setAttribute(\"preserveAspectRatio\", \"none\");\n    svg.setAttribute(\"viewBox\", `0 0 ${width} ${height}`);\n\n    return svg;\n  }\n\n  createElement(type) {\n    if (typeof type !== \"string\") {\n      throw new Error(\"Invalid SVG element type\");\n    }\n    return this._createSVG(type);\n  }\n\n  /**\n   * @ignore\n   */\n  _createSVG(type) {\n    unreachable(\"Abstract method `_createSVG` called.\");\n  }\n}\n\nexport {\n  BaseCanvasFactory,\n  BaseCMapReaderFactory,\n  BaseFilterFactory,\n  BaseStandardFontDataFactory,\n  BaseSVGFactory,\n};\n", "/* Copyright 2014 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { FormatError, info, unreachable, Util } from \"../shared/util.js\";\nimport { getCurrentTransform } from \"./display_utils.js\";\n\nconst PathType = {\n  FILL: \"Fill\",\n  STROKE: \"Stroke\",\n  SHADING: \"Shading\",\n};\n\nfunction applyBoundingBox(ctx, bbox) {\n  if (!bbox) {\n    return;\n  }\n  const width = bbox[2] - bbox[0];\n  const height = bbox[3] - bbox[1];\n  const region = new Path2D();\n  region.rect(bbox[0], bbox[1], width, height);\n  ctx.clip(region);\n}\n\nclass BaseShadingPattern {\n  constructor() {\n    if (this.constructor === BaseShadingPattern) {\n      unreachable(\"Cannot initialize BaseShadingPattern.\");\n    }\n  }\n\n  getPattern() {\n    unreachable(\"Abstract method `getPattern` called.\");\n  }\n}\n\nclass RadialAxialShadingPattern extends BaseShadingPattern {\n  constructor(IR) {\n    super();\n    this._type = IR[1];\n    this._bbox = IR[2];\n    this._colorStops = IR[3];\n    this._p0 = IR[4];\n    this._p1 = IR[5];\n    this._r0 = IR[6];\n    this._r1 = IR[7];\n    this.matrix = null;\n  }\n\n  _createGradient(ctx) {\n    let grad;\n    if (this._type === \"axial\") {\n      grad = ctx.createLinearGradient(\n        this._p0[0],\n        this._p0[1],\n        this._p1[0],\n        this._p1[1]\n      );\n    } else if (this._type === \"radial\") {\n      grad = ctx.createRadialGradient(\n        this._p0[0],\n        this._p0[1],\n        this._r0,\n        this._p1[0],\n        this._p1[1],\n        this._r1\n      );\n    }\n\n    for (const colorStop of this._colorStops) {\n      grad.addColorStop(colorStop[0], colorStop[1]);\n    }\n    return grad;\n  }\n\n  getPattern(ctx, owner, inverse, pathType) {\n    let pattern;\n    if (pathType === PathType.STROKE || pathType === PathType.FILL) {\n      const ownerBBox = owner.current.getClippedPathBoundingBox(\n        pathType,\n        getCurrentTransform(ctx)\n      ) || [0, 0, 0, 0];\n      // Create a canvas that is only as big as the current path. This doesn't\n      // allow us to cache the pattern, but it generally creates much smaller\n      // canvases and saves memory use. See bug 1722807 for an example.\n      const width = Math.ceil(ownerBBox[2] - ownerBBox[0]) || 1;\n      const height = Math.ceil(ownerBBox[3] - ownerBBox[1]) || 1;\n\n      const tmpCanvas = owner.cachedCanvases.getCanvas(\n        \"pattern\",\n        width,\n        height,\n        true\n      );\n\n      const tmpCtx = tmpCanvas.context;\n      tmpCtx.clearRect(0, 0, tmpCtx.canvas.width, tmpCtx.canvas.height);\n      tmpCtx.beginPath();\n      tmpCtx.rect(0, 0, tmpCtx.canvas.width, tmpCtx.canvas.height);\n      // Non shading fill patterns are positioned relative to the base transform\n      // (usually the page's initial transform), but we may have created a\n      // smaller canvas based on the path, so we must account for the shift.\n      tmpCtx.translate(-ownerBBox[0], -ownerBBox[1]);\n      inverse = Util.transform(inverse, [\n        1,\n        0,\n        0,\n        1,\n        ownerBBox[0],\n        ownerBBox[1],\n      ]);\n\n      tmpCtx.transform(...owner.baseTransform);\n      if (this.matrix) {\n        tmpCtx.transform(...this.matrix);\n      }\n      applyBoundingBox(tmpCtx, this._bbox);\n\n      tmpCtx.fillStyle = this._createGradient(tmpCtx);\n      tmpCtx.fill();\n\n      pattern = ctx.createPattern(tmpCanvas.canvas, \"no-repeat\");\n      const domMatrix = new DOMMatrix(inverse);\n      pattern.setTransform(domMatrix);\n    } else {\n      // Shading fills are applied relative to the current matrix which is also\n      // how canvas gradients work, so there's no need to do anything special\n      // here.\n      applyBoundingBox(ctx, this._bbox);\n      pattern = this._createGradient(ctx);\n    }\n    return pattern;\n  }\n}\n\nfunction drawTriangle(data, context, p1, p2, p3, c1, c2, c3) {\n  // Very basic Gouraud-shaded triangle rasterization algorithm.\n  const coords = context.coords,\n    colors = context.colors;\n  const bytes = data.data,\n    rowSize = data.width * 4;\n  let tmp;\n  if (coords[p1 + 1] > coords[p2 + 1]) {\n    tmp = p1;\n    p1 = p2;\n    p2 = tmp;\n    tmp = c1;\n    c1 = c2;\n    c2 = tmp;\n  }\n  if (coords[p2 + 1] > coords[p3 + 1]) {\n    tmp = p2;\n    p2 = p3;\n    p3 = tmp;\n    tmp = c2;\n    c2 = c3;\n    c3 = tmp;\n  }\n  if (coords[p1 + 1] > coords[p2 + 1]) {\n    tmp = p1;\n    p1 = p2;\n    p2 = tmp;\n    tmp = c1;\n    c1 = c2;\n    c2 = tmp;\n  }\n  const x1 = (coords[p1] + context.offsetX) * context.scaleX;\n  const y1 = (coords[p1 + 1] + context.offsetY) * context.scaleY;\n  const x2 = (coords[p2] + context.offsetX) * context.scaleX;\n  const y2 = (coords[p2 + 1] + context.offsetY) * context.scaleY;\n  const x3 = (coords[p3] + context.offsetX) * context.scaleX;\n  const y3 = (coords[p3 + 1] + context.offsetY) * context.scaleY;\n  if (y1 >= y3) {\n    return;\n  }\n  const c1r = colors[c1],\n    c1g = colors[c1 + 1],\n    c1b = colors[c1 + 2];\n  const c2r = colors[c2],\n    c2g = colors[c2 + 1],\n    c2b = colors[c2 + 2];\n  const c3r = colors[c3],\n    c3g = colors[c3 + 1],\n    c3b = colors[c3 + 2];\n\n  const minY = Math.round(y1),\n    maxY = Math.round(y3);\n  let xa, car, cag, cab;\n  let xb, cbr, cbg, cbb;\n  for (let y = minY; y <= maxY; y++) {\n    if (y < y2) {\n      const k = y < y1 ? 0 : (y1 - y) / (y1 - y2);\n      xa = x1 - (x1 - x2) * k;\n      car = c1r - (c1r - c2r) * k;\n      cag = c1g - (c1g - c2g) * k;\n      cab = c1b - (c1b - c2b) * k;\n    } else {\n      let k;\n      if (y > y3) {\n        k = 1;\n      } else if (y2 === y3) {\n        k = 0;\n      } else {\n        k = (y2 - y) / (y2 - y3);\n      }\n      xa = x2 - (x2 - x3) * k;\n      car = c2r - (c2r - c3r) * k;\n      cag = c2g - (c2g - c3g) * k;\n      cab = c2b - (c2b - c3b) * k;\n    }\n\n    let k;\n    if (y < y1) {\n      k = 0;\n    } else if (y > y3) {\n      k = 1;\n    } else {\n      k = (y1 - y) / (y1 - y3);\n    }\n    xb = x1 - (x1 - x3) * k;\n    cbr = c1r - (c1r - c3r) * k;\n    cbg = c1g - (c1g - c3g) * k;\n    cbb = c1b - (c1b - c3b) * k;\n    const x1_ = Math.round(Math.min(xa, xb));\n    const x2_ = Math.round(Math.max(xa, xb));\n    let j = rowSize * y + x1_ * 4;\n    for (let x = x1_; x <= x2_; x++) {\n      k = (xa - x) / (xa - xb);\n      if (k < 0) {\n        k = 0;\n      } else if (k > 1) {\n        k = 1;\n      }\n      bytes[j++] = (car - (car - cbr) * k) | 0;\n      bytes[j++] = (cag - (cag - cbg) * k) | 0;\n      bytes[j++] = (cab - (cab - cbb) * k) | 0;\n      bytes[j++] = 255;\n    }\n  }\n}\n\nfunction drawFigure(data, figure, context) {\n  const ps = figure.coords;\n  const cs = figure.colors;\n  let i, ii;\n  switch (figure.type) {\n    case \"lattice\":\n      const verticesPerRow = figure.verticesPerRow;\n      const rows = Math.floor(ps.length / verticesPerRow) - 1;\n      const cols = verticesPerRow - 1;\n      for (i = 0; i < rows; i++) {\n        let q = i * verticesPerRow;\n        for (let j = 0; j < cols; j++, q++) {\n          drawTriangle(\n            data,\n            context,\n            ps[q],\n            ps[q + 1],\n            ps[q + verticesPerRow],\n            cs[q],\n            cs[q + 1],\n            cs[q + verticesPerRow]\n          );\n          drawTriangle(\n            data,\n            context,\n            ps[q + verticesPerRow + 1],\n            ps[q + 1],\n            ps[q + verticesPerRow],\n            cs[q + verticesPerRow + 1],\n            cs[q + 1],\n            cs[q + verticesPerRow]\n          );\n        }\n      }\n      break;\n    case \"triangles\":\n      for (i = 0, ii = ps.length; i < ii; i += 3) {\n        drawTriangle(\n          data,\n          context,\n          ps[i],\n          ps[i + 1],\n          ps[i + 2],\n          cs[i],\n          cs[i + 1],\n          cs[i + 2]\n        );\n      }\n      break;\n    default:\n      throw new Error(\"illegal figure\");\n  }\n}\n\nclass MeshShadingPattern extends BaseShadingPattern {\n  constructor(IR) {\n    super();\n    this._coords = IR[2];\n    this._colors = IR[3];\n    this._figures = IR[4];\n    this._bounds = IR[5];\n    this._bbox = IR[7];\n    this._background = IR[8];\n    this.matrix = null;\n  }\n\n  _createMeshCanvas(combinedScale, backgroundColor, cachedCanvases) {\n    // we will increase scale on some weird factor to let antialiasing take\n    // care of \"rough\" edges\n    const EXPECTED_SCALE = 1.1;\n    // MAX_PATTERN_SIZE is used to avoid OOM situation.\n    const MAX_PATTERN_SIZE = 3000; // 10in @ 300dpi shall be enough\n    // We need to keep transparent border around our pattern for fill():\n    // createPattern with 'no-repeat' will bleed edges across entire area.\n    const BORDER_SIZE = 2;\n\n    const offsetX = Math.floor(this._bounds[0]);\n    const offsetY = Math.floor(this._bounds[1]);\n    const boundsWidth = Math.ceil(this._bounds[2]) - offsetX;\n    const boundsHeight = Math.ceil(this._bounds[3]) - offsetY;\n\n    const width = Math.min(\n      Math.ceil(Math.abs(boundsWidth * combinedScale[0] * EXPECTED_SCALE)),\n      MAX_PATTERN_SIZE\n    );\n    const height = Math.min(\n      Math.ceil(Math.abs(boundsHeight * combinedScale[1] * EXPECTED_SCALE)),\n      MAX_PATTERN_SIZE\n    );\n    const scaleX = boundsWidth / width;\n    const scaleY = boundsHeight / height;\n\n    const context = {\n      coords: this._coords,\n      colors: this._colors,\n      offsetX: -offsetX,\n      offsetY: -offsetY,\n      scaleX: 1 / scaleX,\n      scaleY: 1 / scaleY,\n    };\n\n    const paddedWidth = width + BORDER_SIZE * 2;\n    const paddedHeight = height + BORDER_SIZE * 2;\n\n    const tmpCanvas = cachedCanvases.getCanvas(\n      \"mesh\",\n      paddedWidth,\n      paddedHeight,\n      false\n    );\n    const tmpCtx = tmpCanvas.context;\n\n    const data = tmpCtx.createImageData(width, height);\n    if (backgroundColor) {\n      const bytes = data.data;\n      for (let i = 0, ii = bytes.length; i < ii; i += 4) {\n        bytes[i] = backgroundColor[0];\n        bytes[i + 1] = backgroundColor[1];\n        bytes[i + 2] = backgroundColor[2];\n        bytes[i + 3] = 255;\n      }\n    }\n    for (const figure of this._figures) {\n      drawFigure(data, figure, context);\n    }\n    tmpCtx.putImageData(data, BORDER_SIZE, BORDER_SIZE);\n    const canvas = tmpCanvas.canvas;\n\n    return {\n      canvas,\n      offsetX: offsetX - BORDER_SIZE * scaleX,\n      offsetY: offsetY - BORDER_SIZE * scaleY,\n      scaleX,\n      scaleY,\n    };\n  }\n\n  getPattern(ctx, owner, inverse, pathType) {\n    applyBoundingBox(ctx, this._bbox);\n    let scale;\n    if (pathType === PathType.SHADING) {\n      scale = Util.singularValueDecompose2dScale(getCurrentTransform(ctx));\n    } else {\n      // Obtain scale from matrix and current transformation matrix.\n      scale = Util.singularValueDecompose2dScale(owner.baseTransform);\n      if (this.matrix) {\n        const matrixScale = Util.singularValueDecompose2dScale(this.matrix);\n        scale = [scale[0] * matrixScale[0], scale[1] * matrixScale[1]];\n      }\n    }\n\n    // Rasterizing on the main thread since sending/queue large canvases\n    // might cause OOM.\n    const temporaryPatternCanvas = this._createMeshCanvas(\n      scale,\n      pathType === PathType.SHADING ? null : this._background,\n      owner.cachedCanvases\n    );\n\n    if (pathType !== PathType.SHADING) {\n      ctx.setTransform(...owner.baseTransform);\n      if (this.matrix) {\n        ctx.transform(...this.matrix);\n      }\n    }\n\n    ctx.translate(\n      temporaryPatternCanvas.offsetX,\n      temporaryPatternCanvas.offsetY\n    );\n    ctx.scale(temporaryPatternCanvas.scaleX, temporaryPatternCanvas.scaleY);\n\n    return ctx.createPattern(temporaryPatternCanvas.canvas, \"no-repeat\");\n  }\n}\n\nclass DummyShadingPattern extends BaseShadingPattern {\n  getPattern() {\n    return \"hotpink\";\n  }\n}\n\nfunction getShadingPattern(IR) {\n  switch (IR[0]) {\n    case \"RadialAxial\":\n      return new RadialAxialShadingPattern(IR);\n    case \"Mesh\":\n      return new MeshShadingPattern(IR);\n    case \"Dummy\":\n      return new DummyShadingPattern();\n  }\n  throw new Error(`Unknown IR type: ${IR[0]}`);\n}\n\nconst PaintType = {\n  COLORED: 1,\n  UNCOLORED: 2,\n};\n\nclass TilingPattern {\n  // 10in @ 300dpi shall be enough.\n  static MAX_PATTERN_SIZE = 3000;\n\n  constructor(IR, color, ctx, canvasGraphicsFactory, baseTransform) {\n    this.operatorList = IR[2];\n    this.matrix = IR[3] || [1, 0, 0, 1, 0, 0];\n    this.bbox = IR[4];\n    this.xstep = IR[5];\n    this.ystep = IR[6];\n    this.paintType = IR[7];\n    this.tilingType = IR[8];\n    this.color = color;\n    this.ctx = ctx;\n    this.canvasGraphicsFactory = canvasGraphicsFactory;\n    this.baseTransform = baseTransform;\n  }\n\n  createPatternCanvas(owner) {\n    const operatorList = this.operatorList;\n    const bbox = this.bbox;\n    const xstep = this.xstep;\n    const ystep = this.ystep;\n    const paintType = this.paintType;\n    const tilingType = this.tilingType;\n    const color = this.color;\n    const canvasGraphicsFactory = this.canvasGraphicsFactory;\n\n    info(\"TilingType: \" + tilingType);\n\n    // A tiling pattern as defined by PDF spec 8.7.2 is a cell whose size is\n    // described by bbox, and may repeat regularly by shifting the cell by\n    // xstep and ystep.\n    // Because the HTML5 canvas API does not support pattern repetition with\n    // gaps in between, we use the xstep/ystep instead of the bbox's size.\n    //\n    // This has the following consequences (similarly for ystep):\n    //\n    // - If xstep is the same as bbox, then there is no observable difference.\n    //\n    // - If xstep is larger than bbox, then the pattern canvas is partially\n    //   empty: the area bounded by bbox is painted, the outside area is void.\n    //\n    // - If xstep is smaller than bbox, then the pixels between xstep and the\n    //   bbox boundary will be missing. This is INCORRECT behavior.\n    //   \"Figures on adjacent tiles should not overlap\" (PDF spec 8.7.3.1),\n    //   but overlapping cells without common pixels are still valid.\n    //   TODO: Fix the implementation, to allow this scenario to be painted\n    //   correctly.\n\n    const x0 = bbox[0],\n      y0 = bbox[1],\n      x1 = bbox[2],\n      y1 = bbox[3];\n\n    // Obtain scale from matrix and current transformation matrix.\n    const matrixScale = Util.singularValueDecompose2dScale(this.matrix);\n    const curMatrixScale = Util.singularValueDecompose2dScale(\n      this.baseTransform\n    );\n    const combinedScale = [\n      matrixScale[0] * curMatrixScale[0],\n      matrixScale[1] * curMatrixScale[1],\n    ];\n\n    // Use width and height values that are as close as possible to the end\n    // result when the pattern is used. Too low value makes the pattern look\n    // blurry. Too large value makes it look too crispy.\n    const dimx = this.getSizeAndScale(\n      xstep,\n      this.ctx.canvas.width,\n      combinedScale[0]\n    );\n    const dimy = this.getSizeAndScale(\n      ystep,\n      this.ctx.canvas.height,\n      combinedScale[1]\n    );\n\n    const tmpCanvas = owner.cachedCanvases.getCanvas(\n      \"pattern\",\n      dimx.size,\n      dimy.size,\n      true\n    );\n    const tmpCtx = tmpCanvas.context;\n    const graphics = canvasGraphicsFactory.createCanvasGraphics(tmpCtx);\n    graphics.groupLevel = owner.groupLevel;\n\n    this.setFillAndStrokeStyleToContext(graphics, paintType, color);\n\n    let adjustedX0 = x0;\n    let adjustedY0 = y0;\n    let adjustedX1 = x1;\n    let adjustedY1 = y1;\n    // Some bounding boxes have negative x0/y0 coordinates which will cause the\n    // some of the drawing to be off of the canvas. To avoid this shift the\n    // bounding box over.\n    if (x0 < 0) {\n      adjustedX0 = 0;\n      adjustedX1 += Math.abs(x0);\n    }\n    if (y0 < 0) {\n      adjustedY0 = 0;\n      adjustedY1 += Math.abs(y0);\n    }\n    tmpCtx.translate(-(dimx.scale * adjustedX0), -(dimy.scale * adjustedY0));\n    graphics.transform(dimx.scale, 0, 0, dimy.scale, 0, 0);\n\n    // To match CanvasGraphics beginDrawing we must save the context here or\n    // else we end up with unbalanced save/restores.\n    tmpCtx.save();\n\n    this.clipBbox(graphics, adjustedX0, adjustedY0, adjustedX1, adjustedY1);\n\n    graphics.baseTransform = getCurrentTransform(graphics.ctx);\n\n    graphics.executeOperatorList(operatorList);\n\n    graphics.endDrawing();\n\n    return {\n      canvas: tmpCanvas.canvas,\n      scaleX: dimx.scale,\n      scaleY: dimy.scale,\n      offsetX: adjustedX0,\n      offsetY: adjustedY0,\n    };\n  }\n\n  getSizeAndScale(step, realOutputSize, scale) {\n    // xstep / ystep may be negative -- normalize.\n    step = Math.abs(step);\n    // MAX_PATTERN_SIZE is used to avoid OOM situation.\n    // Use the destination canvas's size if it is bigger than the hard-coded\n    // limit of MAX_PATTERN_SIZE to avoid clipping patterns that cover the\n    // whole canvas.\n    const maxSize = Math.max(TilingPattern.MAX_PATTERN_SIZE, realOutputSize);\n    let size = Math.ceil(step * scale);\n    if (size >= maxSize) {\n      size = maxSize;\n    } else {\n      scale = size / step;\n    }\n    return { scale, size };\n  }\n\n  clipBbox(graphics, x0, y0, x1, y1) {\n    const bboxWidth = x1 - x0;\n    const bboxHeight = y1 - y0;\n    graphics.ctx.rect(x0, y0, bboxWidth, bboxHeight);\n    graphics.current.updateRectMinMax(getCurrentTransform(graphics.ctx), [\n      x0,\n      y0,\n      x1,\n      y1,\n    ]);\n    graphics.clip();\n    graphics.endPath();\n  }\n\n  setFillAndStrokeStyleToContext(graphics, paintType, color) {\n    const context = graphics.ctx,\n      current = graphics.current;\n    switch (paintType) {\n      case PaintType.COLORED:\n        const ctx = this.ctx;\n        context.fillStyle = ctx.fillStyle;\n        context.strokeStyle = ctx.strokeStyle;\n        current.fillColor = ctx.fillStyle;\n        current.strokeColor = ctx.strokeStyle;\n        break;\n      case PaintType.UNCOLORED:\n        const cssColor = Util.makeHexColor(color[0], color[1], color[2]);\n        context.fillStyle = cssColor;\n        context.strokeStyle = cssColor;\n        // Set color needed by image masks (fixes issues 3226 and 8741).\n        current.fillColor = cssColor;\n        current.strokeColor = cssColor;\n        break;\n      default:\n        throw new FormatError(`Unsupported paint type: ${paintType}`);\n    }\n  }\n\n  getPattern(ctx, owner, inverse, pathType) {\n    // PDF spec 8.7.2 NOTE 1: pattern's matrix is relative to initial matrix.\n    let matrix = inverse;\n    if (pathType !== PathType.SHADING) {\n      matrix = Util.transform(matrix, owner.baseTransform);\n      if (this.matrix) {\n        matrix = Util.transform(matrix, this.matrix);\n      }\n    }\n\n    const temporaryPatternCanvas = this.createPatternCanvas(owner);\n\n    let domMatrix = new DOMMatrix(matrix);\n    // Rescale and so that the ctx.createPattern call generates a pattern with\n    // the desired size.\n    domMatrix = domMatrix.translate(\n      temporaryPatternCanvas.offsetX,\n      temporaryPatternCanvas.offsetY\n    );\n    domMatrix = domMatrix.scale(\n      1 / temporaryPatternCanvas.scaleX,\n      1 / temporaryPatternCanvas.scaleY\n    );\n\n    const pattern = ctx.createPattern(temporaryPatternCanvas.canvas, \"repeat\");\n    pattern.setTransform(domMatrix);\n\n    return pattern;\n  }\n}\n\nexport { getShadingPattern, PathType, TilingPattern };\n", "/* Copyright 2022 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { FeatureTest, ImageKind } from \"./util.js\";\n\nfunction convertToRGBA(params) {\n  switch (params.kind) {\n    case ImageKind.GRAYSCALE_1BPP:\n      return convertBlackAndWhiteToRGBA(params);\n    case ImageKind.RGB_24BPP:\n      return convertRGBToRGBA(params);\n  }\n\n  return null;\n}\n\nfunction convertBlackAndWhiteToRGBA({\n  src,\n  srcPos = 0,\n  dest,\n  width,\n  height,\n  nonBlackColor = 0xffffffff,\n  inverseDecode = false,\n}) {\n  const black = FeatureTest.isLittleEndian ? 0xff000000 : 0x000000ff;\n  const [zeroMapping, oneMapping] = inverseDecode\n    ? [nonBlackColor, black]\n    : [black, nonBlackColor];\n  const widthInSource = width >> 3;\n  const widthRemainder = width & 7;\n  const srcLength = src.length;\n  dest = new Uint32Array(dest.buffer);\n  let destPos = 0;\n\n  for (let i = 0; i < height; i++) {\n    for (const max = srcPos + widthInSource; srcPos < max; srcPos++) {\n      const elem = srcPos < srcLength ? src[srcPos] : 255;\n      dest[destPos++] = elem & 0b10000000 ? oneMapping : zeroMapping;\n      dest[destPos++] = elem & 0b1000000 ? oneMapping : zeroMapping;\n      dest[destPos++] = elem & 0b100000 ? oneMapping : zeroMapping;\n      dest[destPos++] = elem & 0b10000 ? oneMapping : zeroMapping;\n      dest[destPos++] = elem & 0b1000 ? oneMapping : zeroMapping;\n      dest[destPos++] = elem & 0b100 ? oneMapping : zeroMapping;\n      dest[destPos++] = elem & 0b10 ? oneMapping : zeroMapping;\n      dest[destPos++] = elem & 0b1 ? oneMapping : zeroMapping;\n    }\n    if (widthRemainder === 0) {\n      continue;\n    }\n    const elem = srcPos < srcLength ? src[srcPos++] : 255;\n    for (let j = 0; j < widthRemainder; j++) {\n      dest[destPos++] = elem & (1 << (7 - j)) ? oneMapping : zeroMapping;\n    }\n  }\n  return { srcPos, destPos };\n}\n\nfunction convertRGBToRGBA({\n  src,\n  srcPos = 0,\n  dest,\n  destPos = 0,\n  width,\n  height,\n}) {\n  let i = 0;\n  const len32 = src.length >> 2;\n  const src32 = new Uint32Array(src.buffer, srcPos, len32);\n\n  if (FeatureTest.isLittleEndian) {\n    // It's a way faster to do the shuffle manually instead of working\n    // component by component with some Uint8 arrays.\n    for (; i < len32 - 2; i += 3, destPos += 4) {\n      const s1 = src32[i]; // R2B1G1R1\n      const s2 = src32[i + 1]; // G3R3B2G2\n      const s3 = src32[i + 2]; // B4G4R4B3\n\n      dest[destPos] = s1 | 0xff000000;\n      dest[destPos + 1] = (s1 >>> 24) | (s2 << 8) | 0xff000000;\n      dest[destPos + 2] = (s2 >>> 16) | (s3 << 16) | 0xff000000;\n      dest[destPos + 3] = (s3 >>> 8) | 0xff000000;\n    }\n\n    for (let j = i * 4, jj = src.length; j < jj; j += 3) {\n      dest[destPos++] =\n        src[j] | (src[j + 1] << 8) | (src[j + 2] << 16) | 0xff000000;\n    }\n  } else {\n    for (; i < len32 - 2; i += 3, destPos += 4) {\n      const s1 = src32[i]; // R1G1B1R2\n      const s2 = src32[i + 1]; // G2B2R3G3\n      const s3 = src32[i + 2]; // B3R4G4B4\n\n      dest[destPos] = s1 | 0xff;\n      dest[destPos + 1] = (s1 << 24) | (s2 >>> 8) | 0xff;\n      dest[destPos + 2] = (s2 << 16) | (s3 >>> 16) | 0xff;\n      dest[destPos + 3] = (s3 << 8) | 0xff;\n    }\n\n    for (let j = i * 4, jj = src.length; j < jj; j += 3) {\n      dest[destPos++] =\n        (src[j] << 24) | (src[j + 1] << 16) | (src[j + 2] << 8) | 0xff;\n    }\n  }\n\n  return { srcPos, destPos };\n}\n\nfunction grayToRGBA(src, dest) {\n  if (FeatureTest.isLittleEndian) {\n    for (let i = 0, ii = src.length; i < ii; i++) {\n      dest[i] = (src[i] * 0x10101) | 0xff000000;\n    }\n  } else {\n    for (let i = 0, ii = src.length; i < ii; i++) {\n      dest[i] = (src[i] * 0x1010100) | 0x000000ff;\n    }\n  }\n}\n\nexport { convertBlackAndWhiteToRGBA, convertToRGBA, grayToRGBA };\n", "/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  FeatureTest,\n  FONT_IDENTITY_MATRIX,\n  IDENTITY_MATRIX,\n  ImageKind,\n  info,\n  isNodeJS,\n  OPS,\n  shadow,\n  TextRenderingMode,\n  unreachable,\n  Util,\n  warn,\n} from \"../shared/util.js\";\nimport {\n  getCurrentTransform,\n  getCurrentTransformInverse,\n  PixelsPerInch,\n} from \"./display_utils.js\";\nimport {\n  getShadingPattern,\n  PathType,\n  TilingPattern,\n} from \"./pattern_helper.js\";\nimport { convertBlackAndWhiteToRGBA } from \"../shared/image_utils.js\";\n\n// <canvas> contexts store most of the state we need natively.\n// However, PDF needs a bit more state, which we store here.\n// Minimal font size that would be used during canvas fillText operations.\nconst MIN_FONT_SIZE = 16;\n// Maximum font size that would be used during canvas fillText operations.\nconst MAX_FONT_SIZE = 100;\nconst MAX_GROUP_SIZE = 4096;\n\n// Defines the time the `executeOperatorList`-method is going to be executing\n// before it stops and schedules a continue of execution.\nconst EXECUTION_TIME = 15; // ms\n// Defines the number of steps before checking the execution time.\nconst EXECUTION_STEPS = 10;\n\n// To disable Type3 compilation, set the value to `-1`.\nconst MAX_SIZE_TO_COMPILE = 1000;\n\nconst FULL_CHUNK_HEIGHT = 16;\n\n/**\n * Overrides certain methods on a 2d ctx so that when they are called they\n * will also call the same method on the destCtx. The methods that are\n * overridden are all the transformation state modifiers, path creation, and\n * save/restore. We only forward these specific methods because they are the\n * only state modifiers that we cannot copy over when we switch contexts.\n *\n * To remove mirroring call `ctx._removeMirroring()`.\n *\n * @param {Object} ctx - The 2d canvas context that will duplicate its calls on\n *   the destCtx.\n * @param {Object} destCtx - The 2d canvas context that will receive the\n *   forwarded calls.\n */\nfunction mirrorContextOperations(ctx, destCtx) {\n  if (ctx._removeMirroring) {\n    throw new Error(\"Context is already forwarding operations.\");\n  }\n  ctx.__originalSave = ctx.save;\n  ctx.__originalRestore = ctx.restore;\n  ctx.__originalRotate = ctx.rotate;\n  ctx.__originalScale = ctx.scale;\n  ctx.__originalTranslate = ctx.translate;\n  ctx.__originalTransform = ctx.transform;\n  ctx.__originalSetTransform = ctx.setTransform;\n  ctx.__originalResetTransform = ctx.resetTransform;\n  ctx.__originalClip = ctx.clip;\n  ctx.__originalMoveTo = ctx.moveTo;\n  ctx.__originalLineTo = ctx.lineTo;\n  ctx.__originalBezierCurveTo = ctx.bezierCurveTo;\n  ctx.__originalRect = ctx.rect;\n  ctx.__originalClosePath = ctx.closePath;\n  ctx.__originalBeginPath = ctx.beginPath;\n\n  ctx._removeMirroring = () => {\n    ctx.save = ctx.__originalSave;\n    ctx.restore = ctx.__originalRestore;\n    ctx.rotate = ctx.__originalRotate;\n    ctx.scale = ctx.__originalScale;\n    ctx.translate = ctx.__originalTranslate;\n    ctx.transform = ctx.__originalTransform;\n    ctx.setTransform = ctx.__originalSetTransform;\n    ctx.resetTransform = ctx.__originalResetTransform;\n\n    ctx.clip = ctx.__originalClip;\n    ctx.moveTo = ctx.__originalMoveTo;\n    ctx.lineTo = ctx.__originalLineTo;\n    ctx.bezierCurveTo = ctx.__originalBezierCurveTo;\n    ctx.rect = ctx.__originalRect;\n    ctx.closePath = ctx.__originalClosePath;\n    ctx.beginPath = ctx.__originalBeginPath;\n    delete ctx._removeMirroring;\n  };\n\n  ctx.save = function ctxSave() {\n    destCtx.save();\n    this.__originalSave();\n  };\n\n  ctx.restore = function ctxRestore() {\n    destCtx.restore();\n    this.__originalRestore();\n  };\n\n  ctx.translate = function ctxTranslate(x, y) {\n    destCtx.translate(x, y);\n    this.__originalTranslate(x, y);\n  };\n\n  ctx.scale = function ctxScale(x, y) {\n    destCtx.scale(x, y);\n    this.__originalScale(x, y);\n  };\n\n  ctx.transform = function ctxTransform(a, b, c, d, e, f) {\n    destCtx.transform(a, b, c, d, e, f);\n    this.__originalTransform(a, b, c, d, e, f);\n  };\n\n  ctx.setTransform = function ctxSetTransform(a, b, c, d, e, f) {\n    destCtx.setTransform(a, b, c, d, e, f);\n    this.__originalSetTransform(a, b, c, d, e, f);\n  };\n\n  ctx.resetTransform = function ctxResetTransform() {\n    destCtx.resetTransform();\n    this.__originalResetTransform();\n  };\n\n  ctx.rotate = function ctxRotate(angle) {\n    destCtx.rotate(angle);\n    this.__originalRotate(angle);\n  };\n\n  ctx.clip = function ctxRotate(rule) {\n    destCtx.clip(rule);\n    this.__originalClip(rule);\n  };\n\n  ctx.moveTo = function (x, y) {\n    destCtx.moveTo(x, y);\n    this.__originalMoveTo(x, y);\n  };\n\n  ctx.lineTo = function (x, y) {\n    destCtx.lineTo(x, y);\n    this.__originalLineTo(x, y);\n  };\n\n  ctx.bezierCurveTo = function (cp1x, cp1y, cp2x, cp2y, x, y) {\n    destCtx.bezierCurveTo(cp1x, cp1y, cp2x, cp2y, x, y);\n    this.__originalBezierCurveTo(cp1x, cp1y, cp2x, cp2y, x, y);\n  };\n\n  ctx.rect = function (x, y, width, height) {\n    destCtx.rect(x, y, width, height);\n    this.__originalRect(x, y, width, height);\n  };\n\n  ctx.closePath = function () {\n    destCtx.closePath();\n    this.__originalClosePath();\n  };\n\n  ctx.beginPath = function () {\n    destCtx.beginPath();\n    this.__originalBeginPath();\n  };\n}\n\nclass CachedCanvases {\n  constructor(canvasFactory) {\n    this.canvasFactory = canvasFactory;\n    this.cache = Object.create(null);\n  }\n\n  getCanvas(id, width, height) {\n    let canvasEntry;\n    if (this.cache[id] !== undefined) {\n      canvasEntry = this.cache[id];\n      this.canvasFactory.reset(canvasEntry, width, height);\n    } else {\n      canvasEntry = this.canvasFactory.create(width, height);\n      this.cache[id] = canvasEntry;\n    }\n    return canvasEntry;\n  }\n\n  delete(id) {\n    delete this.cache[id];\n  }\n\n  clear() {\n    for (const id in this.cache) {\n      const canvasEntry = this.cache[id];\n      this.canvasFactory.destroy(canvasEntry);\n      delete this.cache[id];\n    }\n  }\n}\n\nfunction drawImageAtIntegerCoords(\n  ctx,\n  srcImg,\n  srcX,\n  srcY,\n  srcW,\n  srcH,\n  destX,\n  destY,\n  destW,\n  destH\n) {\n  const [a, b, c, d, tx, ty] = getCurrentTransform(ctx);\n  if (b === 0 && c === 0) {\n    // top-left corner is at (X, Y) and\n    // bottom-right one is at (X + width, Y + height).\n\n    // If leftX is 4.321 then it's rounded to 4.\n    // If width is 10.432 then it's rounded to 11 because\n    // rightX = leftX + width = 14.753 which is rounded to 15\n    // so after rounding the total width is 11 (15 - 4).\n    // It's why we can't just floor/ceil uniformly, it just depends\n    // on the values we've.\n\n    const tlX = destX * a + tx;\n    const rTlX = Math.round(tlX);\n    const tlY = destY * d + ty;\n    const rTlY = Math.round(tlY);\n    const brX = (destX + destW) * a + tx;\n\n    // Some pdf contains images with 1x1 images so in case of 0-width after\n    // scaling we must fallback on 1 to be sure there is something.\n    const rWidth = Math.abs(Math.round(brX) - rTlX) || 1;\n    const brY = (destY + destH) * d + ty;\n    const rHeight = Math.abs(Math.round(brY) - rTlY) || 1;\n\n    // We must apply a transformation in order to apply it on the image itself.\n    // For example if a == 1 && d == -1, it means that the image itself is\n    // mirrored w.r.t. the x-axis.\n    ctx.setTransform(Math.sign(a), 0, 0, Math.sign(d), rTlX, rTlY);\n    ctx.drawImage(srcImg, srcX, srcY, srcW, srcH, 0, 0, rWidth, rHeight);\n    ctx.setTransform(a, b, c, d, tx, ty);\n\n    return [rWidth, rHeight];\n  }\n\n  if (a === 0 && d === 0) {\n    // This path is taken in issue9462.pdf (page 3).\n    const tlX = destY * c + tx;\n    const rTlX = Math.round(tlX);\n    const tlY = destX * b + ty;\n    const rTlY = Math.round(tlY);\n    const brX = (destY + destH) * c + tx;\n    const rWidth = Math.abs(Math.round(brX) - rTlX) || 1;\n    const brY = (destX + destW) * b + ty;\n    const rHeight = Math.abs(Math.round(brY) - rTlY) || 1;\n\n    ctx.setTransform(0, Math.sign(b), Math.sign(c), 0, rTlX, rTlY);\n    ctx.drawImage(srcImg, srcX, srcY, srcW, srcH, 0, 0, rHeight, rWidth);\n    ctx.setTransform(a, b, c, d, tx, ty);\n\n    return [rHeight, rWidth];\n  }\n\n  // Not a scale matrix so let the render handle the case without rounding.\n  ctx.drawImage(srcImg, srcX, srcY, srcW, srcH, destX, destY, destW, destH);\n\n  const scaleX = Math.hypot(a, b);\n  const scaleY = Math.hypot(c, d);\n  return [scaleX * destW, scaleY * destH];\n}\n\nfunction compileType3Glyph(imgData) {\n  const { width, height } = imgData;\n  if (width > MAX_SIZE_TO_COMPILE || height > MAX_SIZE_TO_COMPILE) {\n    return null;\n  }\n\n  const POINT_TO_PROCESS_LIMIT = 1000;\n  const POINT_TYPES = new Uint8Array([\n    0, 2, 4, 0, 1, 0, 5, 4, 8, 10, 0, 8, 0, 2, 1, 0,\n  ]);\n\n  const width1 = width + 1;\n  let points = new Uint8Array(width1 * (height + 1));\n  let i, j, j0;\n\n  // decodes bit-packed mask data\n  const lineSize = (width + 7) & ~7;\n  let data = new Uint8Array(lineSize * height),\n    pos = 0;\n  for (const elem of imgData.data) {\n    let mask = 128;\n    while (mask > 0) {\n      data[pos++] = elem & mask ? 0 : 255;\n      mask >>= 1;\n    }\n  }\n\n  // finding interesting points: every point is located between mask pixels,\n  // so there will be points of the (width + 1)x(height + 1) grid. Every point\n  // will have flags assigned based on neighboring mask pixels:\n  //   4 | 8\n  //   --P--\n  //   2 | 1\n  // We are interested only in points with the flags:\n  //   - outside corners: 1, 2, 4, 8;\n  //   - inside corners: 7, 11, 13, 14;\n  //   - and, intersections: 5, 10.\n  let count = 0;\n  pos = 0;\n  if (data[pos] !== 0) {\n    points[0] = 1;\n    ++count;\n  }\n  for (j = 1; j < width; j++) {\n    if (data[pos] !== data[pos + 1]) {\n      points[j] = data[pos] ? 2 : 1;\n      ++count;\n    }\n    pos++;\n  }\n  if (data[pos] !== 0) {\n    points[j] = 2;\n    ++count;\n  }\n  for (i = 1; i < height; i++) {\n    pos = i * lineSize;\n    j0 = i * width1;\n    if (data[pos - lineSize] !== data[pos]) {\n      points[j0] = data[pos] ? 1 : 8;\n      ++count;\n    }\n    // 'sum' is the position of the current pixel configuration in the 'TYPES'\n    // array (in order 8-1-2-4, so we can use '>>2' to shift the column).\n    let sum = (data[pos] ? 4 : 0) + (data[pos - lineSize] ? 8 : 0);\n    for (j = 1; j < width; j++) {\n      sum =\n        (sum >> 2) +\n        (data[pos + 1] ? 4 : 0) +\n        (data[pos - lineSize + 1] ? 8 : 0);\n      if (POINT_TYPES[sum]) {\n        points[j0 + j] = POINT_TYPES[sum];\n        ++count;\n      }\n      pos++;\n    }\n    if (data[pos - lineSize] !== data[pos]) {\n      points[j0 + j] = data[pos] ? 2 : 4;\n      ++count;\n    }\n\n    if (count > POINT_TO_PROCESS_LIMIT) {\n      return null;\n    }\n  }\n\n  pos = lineSize * (height - 1);\n  j0 = i * width1;\n  if (data[pos] !== 0) {\n    points[j0] = 8;\n    ++count;\n  }\n  for (j = 1; j < width; j++) {\n    if (data[pos] !== data[pos + 1]) {\n      points[j0 + j] = data[pos] ? 4 : 8;\n      ++count;\n    }\n    pos++;\n  }\n  if (data[pos] !== 0) {\n    points[j0 + j] = 4;\n    ++count;\n  }\n  if (count > POINT_TO_PROCESS_LIMIT) {\n    return null;\n  }\n\n  // building outlines\n  const steps = new Int32Array([0, width1, -1, 0, -width1, 0, 0, 0, 1]);\n  const path = new Path2D();\n\n  for (i = 0; count && i <= height; i++) {\n    let p = i * width1;\n    const end = p + width;\n    while (p < end && !points[p]) {\n      p++;\n    }\n    if (p === end) {\n      continue;\n    }\n    path.moveTo(p % width1, i);\n\n    const p0 = p;\n    let type = points[p];\n    do {\n      const step = steps[type];\n      do {\n        p += step;\n      } while (!points[p]);\n\n      const pp = points[p];\n      if (pp !== 5 && pp !== 10) {\n        // set new direction\n        type = pp;\n        // delete mark\n        points[p] = 0;\n      } else {\n        // type is 5 or 10, ie, a crossing\n        // set new direction\n        type = pp & ((0x33 * type) >> 4);\n        // set new type for \"future hit\"\n        points[p] &= (type >> 2) | (type << 2);\n      }\n      path.lineTo(p % width1, (p / width1) | 0);\n\n      if (!points[p]) {\n        --count;\n      }\n    } while (p0 !== p);\n    --i;\n  }\n\n  // Immediately release the, potentially large, `Uint8Array`s after parsing.\n  data = null;\n  points = null;\n\n  const drawOutline = function (c) {\n    c.save();\n    // the path shall be painted in [0..1]x[0..1] space\n    c.scale(1 / width, -1 / height);\n    c.translate(0, -height);\n    c.fill(path);\n    c.beginPath();\n    c.restore();\n  };\n\n  return drawOutline;\n}\n\nclass CanvasExtraState {\n  constructor(width, height) {\n    // Are soft masks and alpha values shapes or opacities?\n    this.alphaIsShape = false;\n    this.fontSize = 0;\n    this.fontSizeScale = 1;\n    this.textMatrix = IDENTITY_MATRIX;\n    this.textMatrixScale = 1;\n    this.fontMatrix = FONT_IDENTITY_MATRIX;\n    this.leading = 0;\n    // Current point (in user coordinates)\n    this.x = 0;\n    this.y = 0;\n    // Start of text line (in text coordinates)\n    this.lineX = 0;\n    this.lineY = 0;\n    // Character and word spacing\n    this.charSpacing = 0;\n    this.wordSpacing = 0;\n    this.textHScale = 1;\n    this.textRenderingMode = TextRenderingMode.FILL;\n    this.textRise = 0;\n    // Default fore and background colors\n    this.fillColor = \"#000000\";\n    this.strokeColor = \"#000000\";\n    this.patternFill = false;\n    // Note: fill alpha applies to all non-stroking operations\n    this.fillAlpha = 1;\n    this.strokeAlpha = 1;\n    this.lineWidth = 1;\n    this.activeSMask = null;\n    this.transferMaps = \"none\";\n\n    this.startNewPathAndClipBox([0, 0, width, height]);\n  }\n\n  clone() {\n    const clone = Object.create(this);\n    clone.clipBox = this.clipBox.slice();\n    return clone;\n  }\n\n  setCurrentPoint(x, y) {\n    this.x = x;\n    this.y = y;\n  }\n\n  updatePathMinMax(transform, x, y) {\n    [x, y] = Util.applyTransform([x, y], transform);\n    this.minX = Math.min(this.minX, x);\n    this.minY = Math.min(this.minY, y);\n    this.maxX = Math.max(this.maxX, x);\n    this.maxY = Math.max(this.maxY, y);\n  }\n\n  updateRectMinMax(transform, rect) {\n    const p1 = Util.applyTransform(rect, transform);\n    const p2 = Util.applyTransform(rect.slice(2), transform);\n    const p3 = Util.applyTransform([rect[0], rect[3]], transform);\n    const p4 = Util.applyTransform([rect[2], rect[1]], transform);\n\n    this.minX = Math.min(this.minX, p1[0], p2[0], p3[0], p4[0]);\n    this.minY = Math.min(this.minY, p1[1], p2[1], p3[1], p4[1]);\n    this.maxX = Math.max(this.maxX, p1[0], p2[0], p3[0], p4[0]);\n    this.maxY = Math.max(this.maxY, p1[1], p2[1], p3[1], p4[1]);\n  }\n\n  updateScalingPathMinMax(transform, minMax) {\n    Util.scaleMinMax(transform, minMax);\n    this.minX = Math.min(this.minX, minMax[0]);\n    this.maxX = Math.max(this.maxX, minMax[1]);\n    this.minY = Math.min(this.minY, minMax[2]);\n    this.maxY = Math.max(this.maxY, minMax[3]);\n  }\n\n  updateCurvePathMinMax(transform, x0, y0, x1, y1, x2, y2, x3, y3, minMax) {\n    const box = Util.bezierBoundingBox(x0, y0, x1, y1, x2, y2, x3, y3);\n    if (minMax) {\n      minMax[0] = Math.min(minMax[0], box[0], box[2]);\n      minMax[1] = Math.max(minMax[1], box[0], box[2]);\n      minMax[2] = Math.min(minMax[2], box[1], box[3]);\n      minMax[3] = Math.max(minMax[3], box[1], box[3]);\n      return;\n    }\n    this.updateRectMinMax(transform, box);\n  }\n\n  getPathBoundingBox(pathType = PathType.FILL, transform = null) {\n    const box = [this.minX, this.minY, this.maxX, this.maxY];\n    if (pathType === PathType.STROKE) {\n      if (!transform) {\n        unreachable(\"Stroke bounding box must include transform.\");\n      }\n      // Stroked paths can be outside of the path bounding box by 1/2 the line\n      // width.\n      const scale = Util.singularValueDecompose2dScale(transform);\n      const xStrokePad = (scale[0] * this.lineWidth) / 2;\n      const yStrokePad = (scale[1] * this.lineWidth) / 2;\n      box[0] -= xStrokePad;\n      box[1] -= yStrokePad;\n      box[2] += xStrokePad;\n      box[3] += yStrokePad;\n    }\n    return box;\n  }\n\n  updateClipFromPath() {\n    const intersect = Util.intersect(this.clipBox, this.getPathBoundingBox());\n    this.startNewPathAndClipBox(intersect || [0, 0, 0, 0]);\n  }\n\n  isEmptyClip() {\n    return this.minX === Infinity;\n  }\n\n  startNewPathAndClipBox(box) {\n    this.clipBox = box;\n    this.minX = Infinity;\n    this.minY = Infinity;\n    this.maxX = 0;\n    this.maxY = 0;\n  }\n\n  getClippedPathBoundingBox(pathType = PathType.FILL, transform = null) {\n    return Util.intersect(\n      this.clipBox,\n      this.getPathBoundingBox(pathType, transform)\n    );\n  }\n}\n\nfunction putBinaryImageData(ctx, imgData) {\n  if (typeof ImageData !== \"undefined\" && imgData instanceof ImageData) {\n    ctx.putImageData(imgData, 0, 0);\n    return;\n  }\n\n  // Put the image data to the canvas in chunks, rather than putting the\n  // whole image at once.  This saves JS memory, because the ImageData object\n  // is smaller. It also possibly saves C++ memory within the implementation\n  // of putImageData(). (E.g. in Firefox we make two short-lived copies of\n  // the data passed to putImageData()). |n| shouldn't be too small, however,\n  // because too many putImageData() calls will slow things down.\n  //\n  // Note: as written, if the last chunk is partial, the putImageData() call\n  // will (conceptually) put pixels past the bounds of the canvas.  But\n  // that's ok; any such pixels are ignored.\n\n  const height = imgData.height,\n    width = imgData.width;\n  const partialChunkHeight = height % FULL_CHUNK_HEIGHT;\n  const fullChunks = (height - partialChunkHeight) / FULL_CHUNK_HEIGHT;\n  const totalChunks = partialChunkHeight === 0 ? fullChunks : fullChunks + 1;\n\n  const chunkImgData = ctx.createImageData(width, FULL_CHUNK_HEIGHT);\n  let srcPos = 0,\n    destPos;\n  const src = imgData.data;\n  const dest = chunkImgData.data;\n  let i, j, thisChunkHeight, elemsInThisChunk;\n\n  // There are multiple forms in which the pixel data can be passed, and\n  // imgData.kind tells us which one this is.\n  if (imgData.kind === ImageKind.GRAYSCALE_1BPP) {\n    // Grayscale, 1 bit per pixel (i.e. black-and-white).\n    const srcLength = src.byteLength;\n    const dest32 = new Uint32Array(dest.buffer, 0, dest.byteLength >> 2);\n    const dest32DataLength = dest32.length;\n    const fullSrcDiff = (width + 7) >> 3;\n    const white = 0xffffffff;\n    const black = FeatureTest.isLittleEndian ? 0xff000000 : 0x000000ff;\n\n    for (i = 0; i < totalChunks; i++) {\n      thisChunkHeight = i < fullChunks ? FULL_CHUNK_HEIGHT : partialChunkHeight;\n      destPos = 0;\n      for (j = 0; j < thisChunkHeight; j++) {\n        const srcDiff = srcLength - srcPos;\n        let k = 0;\n        const kEnd = srcDiff > fullSrcDiff ? width : srcDiff * 8 - 7;\n        const kEndUnrolled = kEnd & ~7;\n        let mask = 0;\n        let srcByte = 0;\n        for (; k < kEndUnrolled; k += 8) {\n          srcByte = src[srcPos++];\n          dest32[destPos++] = srcByte & 128 ? white : black;\n          dest32[destPos++] = srcByte & 64 ? white : black;\n          dest32[destPos++] = srcByte & 32 ? white : black;\n          dest32[destPos++] = srcByte & 16 ? white : black;\n          dest32[destPos++] = srcByte & 8 ? white : black;\n          dest32[destPos++] = srcByte & 4 ? white : black;\n          dest32[destPos++] = srcByte & 2 ? white : black;\n          dest32[destPos++] = srcByte & 1 ? white : black;\n        }\n        for (; k < kEnd; k++) {\n          if (mask === 0) {\n            srcByte = src[srcPos++];\n            mask = 128;\n          }\n\n          dest32[destPos++] = srcByte & mask ? white : black;\n          mask >>= 1;\n        }\n      }\n      // We ran out of input. Make all remaining pixels transparent.\n      while (destPos < dest32DataLength) {\n        dest32[destPos++] = 0;\n      }\n\n      ctx.putImageData(chunkImgData, 0, i * FULL_CHUNK_HEIGHT);\n    }\n  } else if (imgData.kind === ImageKind.RGBA_32BPP) {\n    // RGBA, 32-bits per pixel.\n    j = 0;\n    elemsInThisChunk = width * FULL_CHUNK_HEIGHT * 4;\n    for (i = 0; i < fullChunks; i++) {\n      dest.set(src.subarray(srcPos, srcPos + elemsInThisChunk));\n      srcPos += elemsInThisChunk;\n\n      ctx.putImageData(chunkImgData, 0, j);\n      j += FULL_CHUNK_HEIGHT;\n    }\n    if (i < totalChunks) {\n      elemsInThisChunk = width * partialChunkHeight * 4;\n      dest.set(src.subarray(srcPos, srcPos + elemsInThisChunk));\n\n      ctx.putImageData(chunkImgData, 0, j);\n    }\n  } else if (imgData.kind === ImageKind.RGB_24BPP) {\n    // RGB, 24-bits per pixel.\n    thisChunkHeight = FULL_CHUNK_HEIGHT;\n    elemsInThisChunk = width * thisChunkHeight;\n    for (i = 0; i < totalChunks; i++) {\n      if (i >= fullChunks) {\n        thisChunkHeight = partialChunkHeight;\n        elemsInThisChunk = width * thisChunkHeight;\n      }\n\n      destPos = 0;\n      for (j = elemsInThisChunk; j--; ) {\n        dest[destPos++] = src[srcPos++];\n        dest[destPos++] = src[srcPos++];\n        dest[destPos++] = src[srcPos++];\n        dest[destPos++] = 255;\n      }\n\n      ctx.putImageData(chunkImgData, 0, i * FULL_CHUNK_HEIGHT);\n    }\n  } else {\n    throw new Error(`bad image kind: ${imgData.kind}`);\n  }\n}\n\nfunction putBinaryImageMask(ctx, imgData) {\n  if (imgData.bitmap) {\n    // The bitmap has been created in the worker.\n    ctx.drawImage(imgData.bitmap, 0, 0);\n    return;\n  }\n\n  // Slow path: OffscreenCanvas isn't available in the worker.\n  const height = imgData.height,\n    width = imgData.width;\n  const partialChunkHeight = height % FULL_CHUNK_HEIGHT;\n  const fullChunks = (height - partialChunkHeight) / FULL_CHUNK_HEIGHT;\n  const totalChunks = partialChunkHeight === 0 ? fullChunks : fullChunks + 1;\n\n  const chunkImgData = ctx.createImageData(width, FULL_CHUNK_HEIGHT);\n  let srcPos = 0;\n  const src = imgData.data;\n  const dest = chunkImgData.data;\n\n  for (let i = 0; i < totalChunks; i++) {\n    const thisChunkHeight =\n      i < fullChunks ? FULL_CHUNK_HEIGHT : partialChunkHeight;\n\n    // Expand the mask so it can be used by the canvas.  Any required\n    // inversion has already been handled.\n\n    ({ srcPos } = convertBlackAndWhiteToRGBA({\n      src,\n      srcPos,\n      dest,\n      width,\n      height: thisChunkHeight,\n      nonBlackColor: 0,\n    }));\n\n    ctx.putImageData(chunkImgData, 0, i * FULL_CHUNK_HEIGHT);\n  }\n}\n\nfunction copyCtxState(sourceCtx, destCtx) {\n  const properties = [\n    \"strokeStyle\",\n    \"fillStyle\",\n    \"fillRule\",\n    \"globalAlpha\",\n    \"lineWidth\",\n    \"lineCap\",\n    \"lineJoin\",\n    \"miterLimit\",\n    \"globalCompositeOperation\",\n    \"font\",\n    \"filter\",\n  ];\n  for (const property of properties) {\n    if (sourceCtx[property] !== undefined) {\n      destCtx[property] = sourceCtx[property];\n    }\n  }\n  if (sourceCtx.setLineDash !== undefined) {\n    destCtx.setLineDash(sourceCtx.getLineDash());\n    destCtx.lineDashOffset = sourceCtx.lineDashOffset;\n  }\n}\n\nfunction resetCtxToDefault(ctx) {\n  ctx.strokeStyle = ctx.fillStyle = \"#000000\";\n  ctx.fillRule = \"nonzero\";\n  ctx.globalAlpha = 1;\n  ctx.lineWidth = 1;\n  ctx.lineCap = \"butt\";\n  ctx.lineJoin = \"miter\";\n  ctx.miterLimit = 10;\n  ctx.globalCompositeOperation = \"source-over\";\n  ctx.font = \"10px sans-serif\";\n  if (ctx.setLineDash !== undefined) {\n    ctx.setLineDash([]);\n    ctx.lineDashOffset = 0;\n  }\n  if (\n    (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) ||\n    !isNodeJS\n  ) {\n    const { filter } = ctx;\n    if (filter !== \"none\" && filter !== \"\") {\n      ctx.filter = \"none\";\n    }\n  }\n}\n\nfunction composeSMaskBackdrop(bytes, r0, g0, b0) {\n  const length = bytes.length;\n  for (let i = 3; i < length; i += 4) {\n    const alpha = bytes[i];\n    if (alpha === 0) {\n      bytes[i - 3] = r0;\n      bytes[i - 2] = g0;\n      bytes[i - 1] = b0;\n    } else if (alpha < 255) {\n      const alpha_ = 255 - alpha;\n      bytes[i - 3] = (bytes[i - 3] * alpha + r0 * alpha_) >> 8;\n      bytes[i - 2] = (bytes[i - 2] * alpha + g0 * alpha_) >> 8;\n      bytes[i - 1] = (bytes[i - 1] * alpha + b0 * alpha_) >> 8;\n    }\n  }\n}\n\nfunction composeSMaskAlpha(maskData, layerData, transferMap) {\n  const length = maskData.length;\n  const scale = 1 / 255;\n  for (let i = 3; i < length; i += 4) {\n    const alpha = transferMap ? transferMap[maskData[i]] : maskData[i];\n    layerData[i] = (layerData[i] * alpha * scale) | 0;\n  }\n}\n\nfunction composeSMaskLuminosity(maskData, layerData, transferMap) {\n  const length = maskData.length;\n  for (let i = 3; i < length; i += 4) {\n    const y =\n      maskData[i - 3] * 77 + // * 0.3 / 255 * 0x10000\n      maskData[i - 2] * 152 + // * 0.59 ....\n      maskData[i - 1] * 28; // * 0.11 ....\n    layerData[i] = transferMap\n      ? (layerData[i] * transferMap[y >> 8]) >> 8\n      : (layerData[i] * y) >> 16;\n  }\n}\n\nfunction genericComposeSMask(\n  maskCtx,\n  layerCtx,\n  width,\n  height,\n  subtype,\n  backdrop,\n  transferMap,\n  layerOffsetX,\n  layerOffsetY,\n  maskOffsetX,\n  maskOffsetY\n) {\n  const hasBackdrop = !!backdrop;\n  const r0 = hasBackdrop ? backdrop[0] : 0;\n  const g0 = hasBackdrop ? backdrop[1] : 0;\n  const b0 = hasBackdrop ? backdrop[2] : 0;\n\n  const composeFn =\n    subtype === \"Luminosity\" ? composeSMaskLuminosity : composeSMaskAlpha;\n\n  // processing image in chunks to save memory\n  const PIXELS_TO_PROCESS = 1048576;\n  const chunkSize = Math.min(height, Math.ceil(PIXELS_TO_PROCESS / width));\n  for (let row = 0; row < height; row += chunkSize) {\n    const chunkHeight = Math.min(chunkSize, height - row);\n    const maskData = maskCtx.getImageData(\n      layerOffsetX - maskOffsetX,\n      row + (layerOffsetY - maskOffsetY),\n      width,\n      chunkHeight\n    );\n    const layerData = layerCtx.getImageData(\n      layerOffsetX,\n      row + layerOffsetY,\n      width,\n      chunkHeight\n    );\n\n    if (hasBackdrop) {\n      composeSMaskBackdrop(maskData.data, r0, g0, b0);\n    }\n    composeFn(maskData.data, layerData.data, transferMap);\n\n    layerCtx.putImageData(layerData, layerOffsetX, row + layerOffsetY);\n  }\n}\n\nfunction composeSMask(ctx, smask, layerCtx, layerBox) {\n  const layerOffsetX = layerBox[0];\n  const layerOffsetY = layerBox[1];\n  const layerWidth = layerBox[2] - layerOffsetX;\n  const layerHeight = layerBox[3] - layerOffsetY;\n  if (layerWidth === 0 || layerHeight === 0) {\n    return;\n  }\n  genericComposeSMask(\n    smask.context,\n    layerCtx,\n    layerWidth,\n    layerHeight,\n    smask.subtype,\n    smask.backdrop,\n    smask.transferMap,\n    layerOffsetX,\n    layerOffsetY,\n    smask.offsetX,\n    smask.offsetY\n  );\n  ctx.save();\n  ctx.globalAlpha = 1;\n  ctx.globalCompositeOperation = \"source-over\";\n  ctx.setTransform(1, 0, 0, 1, 0, 0);\n  ctx.drawImage(layerCtx.canvas, 0, 0);\n  ctx.restore();\n}\n\nfunction getImageSmoothingEnabled(transform, interpolate) {\n  const scale = Util.singularValueDecompose2dScale(transform);\n  // Round to a 32bit float so that `<=` check below will pass for numbers that\n  // are very close, but not exactly the same 64bit floats.\n  scale[0] = Math.fround(scale[0]);\n  scale[1] = Math.fround(scale[1]);\n  const actualScale = Math.fround(\n    (globalThis.devicePixelRatio || 1) * PixelsPerInch.PDF_TO_CSS_UNITS\n  );\n  if (interpolate !== undefined) {\n    // If the value is explicitly set use it.\n    return interpolate;\n  } else if (scale[0] <= actualScale || scale[1] <= actualScale) {\n    // Smooth when downscaling.\n    return true;\n  }\n  // Don't smooth when upscaling.\n  return false;\n}\n\nconst LINE_CAP_STYLES = [\"butt\", \"round\", \"square\"];\nconst LINE_JOIN_STYLES = [\"miter\", \"round\", \"bevel\"];\nconst NORMAL_CLIP = {};\nconst EO_CLIP = {};\n\nclass CanvasGraphics {\n  constructor(\n    canvasCtx,\n    commonObjs,\n    objs,\n    canvasFactory,\n    filterFactory,\n    { optionalContentConfig, markedContentStack = null },\n    annotationCanvasMap,\n    pageColors\n  ) {\n    this.ctx = canvasCtx;\n    this.current = new CanvasExtraState(\n      this.ctx.canvas.width,\n      this.ctx.canvas.height\n    );\n    this.stateStack = [];\n    this.pendingClip = null;\n    this.pendingEOFill = false;\n    this.res = null;\n    this.xobjs = null;\n    this.commonObjs = commonObjs;\n    this.objs = objs;\n    this.canvasFactory = canvasFactory;\n    this.filterFactory = filterFactory;\n    this.groupStack = [];\n    this.processingType3 = null;\n    // Patterns are painted relative to the initial page/form transform, see\n    // PDF spec 8.7.2 NOTE 1.\n    this.baseTransform = null;\n    this.baseTransformStack = [];\n    this.groupLevel = 0;\n    this.smaskStack = [];\n    this.smaskCounter = 0;\n    this.tempSMask = null;\n    this.suspendedCtx = null;\n    this.contentVisible = true;\n    this.markedContentStack = markedContentStack || [];\n    this.optionalContentConfig = optionalContentConfig;\n    this.cachedCanvases = new CachedCanvases(this.canvasFactory);\n    this.cachedPatterns = new Map();\n    this.annotationCanvasMap = annotationCanvasMap;\n    this.viewportScale = 1;\n    this.outputScaleX = 1;\n    this.outputScaleY = 1;\n    this.pageColors = pageColors;\n\n    this._cachedScaleForStroking = [-1, 0];\n    this._cachedGetSinglePixelWidth = null;\n    this._cachedBitmapsMap = new Map();\n  }\n\n  getObject(data, fallback = null) {\n    if (typeof data === \"string\") {\n      return data.startsWith(\"g_\")\n        ? this.commonObjs.get(data)\n        : this.objs.get(data);\n    }\n    return fallback;\n  }\n\n  beginDrawing({\n    transform,\n    viewport,\n    transparency = false,\n    background = null,\n  }) {\n    // For pdfs that use blend modes we have to clear the canvas else certain\n    // blend modes can look wrong since we'd be blending with a white\n    // backdrop. The problem with a transparent backdrop though is we then\n    // don't get sub pixel anti aliasing on text, creating temporary\n    // transparent canvas when we have blend modes.\n    const width = this.ctx.canvas.width;\n    const height = this.ctx.canvas.height;\n\n    const savedFillStyle = this.ctx.fillStyle;\n    this.ctx.fillStyle = background || \"#ffffff\";\n    this.ctx.fillRect(0, 0, width, height);\n    this.ctx.fillStyle = savedFillStyle;\n\n    if (transparency) {\n      const transparentCanvas = this.cachedCanvases.getCanvas(\n        \"transparent\",\n        width,\n        height\n      );\n      this.compositeCtx = this.ctx;\n      this.transparentCanvas = transparentCanvas.canvas;\n      this.ctx = transparentCanvas.context;\n      this.ctx.save();\n      // The transform can be applied before rendering, transferring it to\n      // the new canvas.\n      this.ctx.transform(...getCurrentTransform(this.compositeCtx));\n    }\n\n    this.ctx.save();\n    resetCtxToDefault(this.ctx);\n    if (transform) {\n      this.ctx.transform(...transform);\n      this.outputScaleX = transform[0];\n      this.outputScaleY = transform[0];\n    }\n    this.ctx.transform(...viewport.transform);\n    this.viewportScale = viewport.scale;\n\n    this.baseTransform = getCurrentTransform(this.ctx);\n  }\n\n  executeOperatorList(\n    operatorList,\n    executionStartIdx,\n    continueCallback,\n    stepper\n  ) {\n    const argsArray = operatorList.argsArray;\n    const fnArray = operatorList.fnArray;\n    let i = executionStartIdx || 0;\n    const argsArrayLen = argsArray.length;\n\n    // Sometimes the OperatorList to execute is empty.\n    if (argsArrayLen === i) {\n      return i;\n    }\n\n    const chunkOperations =\n      argsArrayLen - i > EXECUTION_STEPS &&\n      typeof continueCallback === \"function\";\n    const endTime = chunkOperations ? Date.now() + EXECUTION_TIME : 0;\n    let steps = 0;\n\n    const commonObjs = this.commonObjs;\n    const objs = this.objs;\n    let fnId;\n\n    while (true) {\n      if (stepper !== undefined && i === stepper.nextBreakPoint) {\n        stepper.breakIt(i, continueCallback);\n        return i;\n      }\n\n      fnId = fnArray[i];\n\n      if (fnId !== OPS.dependency) {\n        // eslint-disable-next-line prefer-spread\n        this[fnId].apply(this, argsArray[i]);\n      } else {\n        for (const depObjId of argsArray[i]) {\n          const objsPool = depObjId.startsWith(\"g_\") ? commonObjs : objs;\n\n          // If the promise isn't resolved yet, add the continueCallback\n          // to the promise and bail out.\n          if (!objsPool.has(depObjId)) {\n            objsPool.get(depObjId, continueCallback);\n            return i;\n          }\n        }\n      }\n\n      i++;\n\n      // If the entire operatorList was executed, stop as were done.\n      if (i === argsArrayLen) {\n        return i;\n      }\n\n      // If the execution took longer then a certain amount of time and\n      // `continueCallback` is specified, interrupt the execution.\n      if (chunkOperations && ++steps > EXECUTION_STEPS) {\n        if (Date.now() > endTime) {\n          continueCallback();\n          return i;\n        }\n        steps = 0;\n      }\n\n      // If the operatorList isn't executed completely yet OR the execution\n      // time was short enough, do another execution round.\n    }\n  }\n\n  #restoreInitialState() {\n    // Finishing all opened operations such as SMask group painting.\n    while (this.stateStack.length || this.inSMaskMode) {\n      this.restore();\n    }\n\n    this.ctx.restore();\n\n    if (this.transparentCanvas) {\n      this.ctx = this.compositeCtx;\n      this.ctx.save();\n      this.ctx.setTransform(1, 0, 0, 1, 0, 0); // Avoid apply transform twice\n      this.ctx.drawImage(this.transparentCanvas, 0, 0);\n      this.ctx.restore();\n      this.transparentCanvas = null;\n    }\n  }\n\n  endDrawing() {\n    this.#restoreInitialState();\n\n    this.cachedCanvases.clear();\n    this.cachedPatterns.clear();\n\n    for (const cache of this._cachedBitmapsMap.values()) {\n      for (const canvas of cache.values()) {\n        if (\n          typeof HTMLCanvasElement !== \"undefined\" &&\n          canvas instanceof HTMLCanvasElement\n        ) {\n          canvas.width = canvas.height = 0;\n        }\n      }\n      cache.clear();\n    }\n    this._cachedBitmapsMap.clear();\n    this.#drawFilter();\n  }\n\n  #drawFilter() {\n    if (this.pageColors) {\n      const hcmFilterId = this.filterFactory.addHCMFilter(\n        this.pageColors.foreground,\n        this.pageColors.background\n      );\n      if (hcmFilterId !== \"none\") {\n        const savedFilter = this.ctx.filter;\n        this.ctx.filter = hcmFilterId;\n        this.ctx.drawImage(this.ctx.canvas, 0, 0);\n        this.ctx.filter = savedFilter;\n      }\n    }\n  }\n\n  _scaleImage(img, inverseTransform) {\n    // Vertical or horizontal scaling shall not be more than 2 to not lose the\n    // pixels during drawImage operation, painting on the temporary canvas(es)\n    // that are twice smaller in size.\n    const width = img.width;\n    const height = img.height;\n    let widthScale = Math.max(\n      Math.hypot(inverseTransform[0], inverseTransform[1]),\n      1\n    );\n    let heightScale = Math.max(\n      Math.hypot(inverseTransform[2], inverseTransform[3]),\n      1\n    );\n\n    let paintWidth = width,\n      paintHeight = height;\n    let tmpCanvasId = \"prescale1\";\n    let tmpCanvas, tmpCtx;\n    while (\n      (widthScale > 2 && paintWidth > 1) ||\n      (heightScale > 2 && paintHeight > 1)\n    ) {\n      let newWidth = paintWidth,\n        newHeight = paintHeight;\n      if (widthScale > 2 && paintWidth > 1) {\n        // See bug 1820511 (Windows specific bug).\n        // TODO: once the above bug is fixed we could revert to:\n        // newWidth = Math.ceil(paintWidth / 2);\n        newWidth =\n          paintWidth >= 16384\n            ? Math.floor(paintWidth / 2) - 1 || 1\n            : Math.ceil(paintWidth / 2);\n        widthScale /= paintWidth / newWidth;\n      }\n      if (heightScale > 2 && paintHeight > 1) {\n        // TODO: see the comment above.\n        newHeight =\n          paintHeight >= 16384\n            ? Math.floor(paintHeight / 2) - 1 || 1\n            : Math.ceil(paintHeight) / 2;\n        heightScale /= paintHeight / newHeight;\n      }\n      tmpCanvas = this.cachedCanvases.getCanvas(\n        tmpCanvasId,\n        newWidth,\n        newHeight\n      );\n      tmpCtx = tmpCanvas.context;\n      tmpCtx.clearRect(0, 0, newWidth, newHeight);\n      tmpCtx.drawImage(\n        img,\n        0,\n        0,\n        paintWidth,\n        paintHeight,\n        0,\n        0,\n        newWidth,\n        newHeight\n      );\n      img = tmpCanvas.canvas;\n      paintWidth = newWidth;\n      paintHeight = newHeight;\n      tmpCanvasId = tmpCanvasId === \"prescale1\" ? \"prescale2\" : \"prescale1\";\n    }\n    return {\n      img,\n      paintWidth,\n      paintHeight,\n    };\n  }\n\n  _createMaskCanvas(img) {\n    const ctx = this.ctx;\n    const { width, height } = img;\n    const fillColor = this.current.fillColor;\n    const isPatternFill = this.current.patternFill;\n    const currentTransform = getCurrentTransform(ctx);\n\n    let cache, cacheKey, scaled, maskCanvas;\n    if ((img.bitmap || img.data) && img.count > 1) {\n      const mainKey = img.bitmap || img.data.buffer;\n      // We're reusing the same image several times, so we can cache it.\n      // In case we've a pattern fill we just keep the scaled version of\n      // the image.\n      // Only the scaling part matters, the translation part is just used\n      // to compute offsets (but not when filling patterns see #15573).\n      // TODO: handle the case of a pattern fill if it's possible.\n      cacheKey = JSON.stringify(\n        isPatternFill\n          ? currentTransform\n          : [currentTransform.slice(0, 4), fillColor]\n      );\n\n      cache = this._cachedBitmapsMap.get(mainKey);\n      if (!cache) {\n        cache = new Map();\n        this._cachedBitmapsMap.set(mainKey, cache);\n      }\n      const cachedImage = cache.get(cacheKey);\n      if (cachedImage && !isPatternFill) {\n        const offsetX = Math.round(\n          Math.min(currentTransform[0], currentTransform[2]) +\n            currentTransform[4]\n        );\n        const offsetY = Math.round(\n          Math.min(currentTransform[1], currentTransform[3]) +\n            currentTransform[5]\n        );\n        return {\n          canvas: cachedImage,\n          offsetX,\n          offsetY,\n        };\n      }\n      scaled = cachedImage;\n    }\n\n    if (!scaled) {\n      maskCanvas = this.cachedCanvases.getCanvas(\"maskCanvas\", width, height);\n      putBinaryImageMask(maskCanvas.context, img);\n    }\n\n    // Create the mask canvas at the size it will be drawn at and also set\n    // its transform to match the current transform so if there are any\n    // patterns applied they will be applied relative to the correct\n    // transform.\n\n    let maskToCanvas = Util.transform(currentTransform, [\n      1 / width,\n      0,\n      0,\n      -1 / height,\n      0,\n      0,\n    ]);\n    maskToCanvas = Util.transform(maskToCanvas, [1, 0, 0, 1, 0, -height]);\n    const [minX, minY, maxX, maxY] = Util.getAxialAlignedBoundingBox(\n      [0, 0, width, height],\n      maskToCanvas\n    );\n    const drawnWidth = Math.round(maxX - minX) || 1;\n    const drawnHeight = Math.round(maxY - minY) || 1;\n    const fillCanvas = this.cachedCanvases.getCanvas(\n      \"fillCanvas\",\n      drawnWidth,\n      drawnHeight\n    );\n    const fillCtx = fillCanvas.context;\n\n    // The offset will be the top-left cordinate mask.\n    // If objToCanvas is [a,b,c,d,e,f] then:\n    //   - offsetX = min(a, c) + e\n    //   - offsetY = min(b, d) + f\n    const offsetX = minX;\n    const offsetY = minY;\n    fillCtx.translate(-offsetX, -offsetY);\n    fillCtx.transform(...maskToCanvas);\n\n    if (!scaled) {\n      // Pre-scale if needed to improve image smoothing.\n      scaled = this._scaleImage(\n        maskCanvas.canvas,\n        getCurrentTransformInverse(fillCtx)\n      );\n      scaled = scaled.img;\n      if (cache && isPatternFill) {\n        cache.set(cacheKey, scaled);\n      }\n    }\n\n    fillCtx.imageSmoothingEnabled = getImageSmoothingEnabled(\n      getCurrentTransform(fillCtx),\n      img.interpolate\n    );\n\n    drawImageAtIntegerCoords(\n      fillCtx,\n      scaled,\n      0,\n      0,\n      scaled.width,\n      scaled.height,\n      0,\n      0,\n      width,\n      height\n    );\n    fillCtx.globalCompositeOperation = \"source-in\";\n\n    const inverse = Util.transform(getCurrentTransformInverse(fillCtx), [\n      1,\n      0,\n      0,\n      1,\n      -offsetX,\n      -offsetY,\n    ]);\n    fillCtx.fillStyle = isPatternFill\n      ? fillColor.getPattern(ctx, this, inverse, PathType.FILL)\n      : fillColor;\n\n    fillCtx.fillRect(0, 0, width, height);\n\n    if (cache && !isPatternFill) {\n      // The fill canvas is put in the cache associated to the mask image\n      // so we must remove from the cached canvas: it mustn't be used again.\n      this.cachedCanvases.delete(\"fillCanvas\");\n      cache.set(cacheKey, fillCanvas.canvas);\n    }\n\n    // Round the offsets to avoid drawing fractional pixels.\n    return {\n      canvas: fillCanvas.canvas,\n      offsetX: Math.round(offsetX),\n      offsetY: Math.round(offsetY),\n    };\n  }\n\n  // Graphics state\n  setLineWidth(width) {\n    if (width !== this.current.lineWidth) {\n      this._cachedScaleForStroking[0] = -1;\n    }\n    this.current.lineWidth = width;\n    this.ctx.lineWidth = width;\n  }\n\n  setLineCap(style) {\n    this.ctx.lineCap = LINE_CAP_STYLES[style];\n  }\n\n  setLineJoin(style) {\n    this.ctx.lineJoin = LINE_JOIN_STYLES[style];\n  }\n\n  setMiterLimit(limit) {\n    this.ctx.miterLimit = limit;\n  }\n\n  setDash(dashArray, dashPhase) {\n    const ctx = this.ctx;\n    if (ctx.setLineDash !== undefined) {\n      ctx.setLineDash(dashArray);\n      ctx.lineDashOffset = dashPhase;\n    }\n  }\n\n  setRenderingIntent(intent) {\n    // This operation is ignored since we haven't found a use case for it yet.\n  }\n\n  setFlatness(flatness) {\n    // This operation is ignored since we haven't found a use case for it yet.\n  }\n\n  setGState(states) {\n    for (const [key, value] of states) {\n      switch (key) {\n        case \"LW\":\n          this.setLineWidth(value);\n          break;\n        case \"LC\":\n          this.setLineCap(value);\n          break;\n        case \"LJ\":\n          this.setLineJoin(value);\n          break;\n        case \"ML\":\n          this.setMiterLimit(value);\n          break;\n        case \"D\":\n          this.setDash(value[0], value[1]);\n          break;\n        case \"RI\":\n          this.setRenderingIntent(value);\n          break;\n        case \"FL\":\n          this.setFlatness(value);\n          break;\n        case \"Font\":\n          this.setFont(value[0], value[1]);\n          break;\n        case \"CA\":\n          this.current.strokeAlpha = value;\n          break;\n        case \"ca\":\n          this.current.fillAlpha = value;\n          this.ctx.globalAlpha = value;\n          break;\n        case \"BM\":\n          this.ctx.globalCompositeOperation = value;\n          break;\n        case \"SMask\":\n          this.current.activeSMask = value ? this.tempSMask : null;\n          this.tempSMask = null;\n          this.checkSMaskState();\n          break;\n        case \"TR\":\n          this.ctx.filter = this.current.transferMaps =\n            this.filterFactory.addFilter(value);\n          break;\n      }\n    }\n  }\n\n  get inSMaskMode() {\n    return !!this.suspendedCtx;\n  }\n\n  checkSMaskState() {\n    const inSMaskMode = this.inSMaskMode;\n    if (this.current.activeSMask && !inSMaskMode) {\n      this.beginSMaskMode();\n    } else if (!this.current.activeSMask && inSMaskMode) {\n      this.endSMaskMode();\n    }\n    // Else, the state is okay and nothing needs to be done.\n  }\n\n  /**\n   * Soft mask mode takes the current main drawing canvas and replaces it with\n   * a temporary canvas. Any drawing operations that happen on the temporary\n   * canvas need to be composed with the main canvas that was suspended (see\n   * `compose()`). The temporary canvas also duplicates many of its operations\n   * on the suspended canvas to keep them in sync, so that when the soft mask\n   * mode ends any clipping paths or transformations will still be active and in\n   * the right order on the canvas' graphics state stack.\n   */\n  beginSMaskMode() {\n    if (this.inSMaskMode) {\n      throw new Error(\"beginSMaskMode called while already in smask mode\");\n    }\n    const drawnWidth = this.ctx.canvas.width;\n    const drawnHeight = this.ctx.canvas.height;\n    const cacheId = \"smaskGroupAt\" + this.groupLevel;\n    const scratchCanvas = this.cachedCanvases.getCanvas(\n      cacheId,\n      drawnWidth,\n      drawnHeight\n    );\n    this.suspendedCtx = this.ctx;\n    this.ctx = scratchCanvas.context;\n    const ctx = this.ctx;\n    ctx.setTransform(...getCurrentTransform(this.suspendedCtx));\n    copyCtxState(this.suspendedCtx, ctx);\n    mirrorContextOperations(ctx, this.suspendedCtx);\n\n    this.setGState([\n      [\"BM\", \"source-over\"],\n      [\"ca\", 1],\n      [\"CA\", 1],\n    ]);\n  }\n\n  endSMaskMode() {\n    if (!this.inSMaskMode) {\n      throw new Error(\"endSMaskMode called while not in smask mode\");\n    }\n    // The soft mask is done, now restore the suspended canvas as the main\n    // drawing canvas.\n    this.ctx._removeMirroring();\n    copyCtxState(this.ctx, this.suspendedCtx);\n    this.ctx = this.suspendedCtx;\n\n    this.suspendedCtx = null;\n  }\n\n  compose(dirtyBox) {\n    if (!this.current.activeSMask) {\n      return;\n    }\n\n    if (!dirtyBox) {\n      dirtyBox = [0, 0, this.ctx.canvas.width, this.ctx.canvas.height];\n    } else {\n      dirtyBox[0] = Math.floor(dirtyBox[0]);\n      dirtyBox[1] = Math.floor(dirtyBox[1]);\n      dirtyBox[2] = Math.ceil(dirtyBox[2]);\n      dirtyBox[3] = Math.ceil(dirtyBox[3]);\n    }\n    const smask = this.current.activeSMask;\n    const suspendedCtx = this.suspendedCtx;\n\n    composeSMask(suspendedCtx, smask, this.ctx, dirtyBox);\n    // Whatever was drawn has been moved to the suspended canvas, now clear it\n    // out of the current canvas.\n    this.ctx.save();\n    this.ctx.setTransform(1, 0, 0, 1, 0, 0);\n    this.ctx.clearRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);\n    this.ctx.restore();\n  }\n\n  save() {\n    if (this.inSMaskMode) {\n      // SMask mode may be turned on/off causing us to lose graphics state.\n      // Copy the temporary canvas state to the main(suspended) canvas to keep\n      // it in sync.\n      copyCtxState(this.ctx, this.suspendedCtx);\n      // Don't bother calling save on the temporary canvas since state is not\n      // saved there.\n      this.suspendedCtx.save();\n    } else {\n      this.ctx.save();\n    }\n    const old = this.current;\n    this.stateStack.push(old);\n    this.current = old.clone();\n  }\n\n  restore() {\n    if (this.stateStack.length === 0 && this.inSMaskMode) {\n      this.endSMaskMode();\n    }\n    if (this.stateStack.length !== 0) {\n      this.current = this.stateStack.pop();\n      if (this.inSMaskMode) {\n        // Graphics state is stored on the main(suspended) canvas. Restore its\n        // state then copy it over to the temporary canvas.\n        this.suspendedCtx.restore();\n        copyCtxState(this.suspendedCtx, this.ctx);\n      } else {\n        this.ctx.restore();\n      }\n      this.checkSMaskState();\n\n      // Ensure that the clipping path is reset (fixes issue6413.pdf).\n      this.pendingClip = null;\n\n      this._cachedScaleForStroking[0] = -1;\n      this._cachedGetSinglePixelWidth = null;\n    }\n  }\n\n  transform(a, b, c, d, e, f) {\n    this.ctx.transform(a, b, c, d, e, f);\n\n    this._cachedScaleForStroking[0] = -1;\n    this._cachedGetSinglePixelWidth = null;\n  }\n\n  // Path\n  constructPath(ops, args, minMax) {\n    const ctx = this.ctx;\n    const current = this.current;\n    let x = current.x,\n      y = current.y;\n    let startX, startY;\n    const currentTransform = getCurrentTransform(ctx);\n\n    // Most of the time the current transform is a scaling matrix\n    // so we don't need to transform points before computing min/max:\n    // we can compute min/max first and then smartly \"apply\" the\n    // transform (see Util.scaleMinMax).\n    // For rectangle, moveTo and lineTo, min/max are computed in the\n    // worker (see evaluator.js).\n    const isScalingMatrix =\n      (currentTransform[0] === 0 && currentTransform[3] === 0) ||\n      (currentTransform[1] === 0 && currentTransform[2] === 0);\n    const minMaxForBezier = isScalingMatrix ? minMax.slice(0) : null;\n\n    for (let i = 0, j = 0, ii = ops.length; i < ii; i++) {\n      switch (ops[i] | 0) {\n        case OPS.rectangle:\n          x = args[j++];\n          y = args[j++];\n          const width = args[j++];\n          const height = args[j++];\n\n          const xw = x + width;\n          const yh = y + height;\n          ctx.moveTo(x, y);\n          if (width === 0 || height === 0) {\n            ctx.lineTo(xw, yh);\n          } else {\n            ctx.lineTo(xw, y);\n            ctx.lineTo(xw, yh);\n            ctx.lineTo(x, yh);\n          }\n          if (!isScalingMatrix) {\n            current.updateRectMinMax(currentTransform, [x, y, xw, yh]);\n          }\n          ctx.closePath();\n          break;\n        case OPS.moveTo:\n          x = args[j++];\n          y = args[j++];\n          ctx.moveTo(x, y);\n          if (!isScalingMatrix) {\n            current.updatePathMinMax(currentTransform, x, y);\n          }\n          break;\n        case OPS.lineTo:\n          x = args[j++];\n          y = args[j++];\n          ctx.lineTo(x, y);\n          if (!isScalingMatrix) {\n            current.updatePathMinMax(currentTransform, x, y);\n          }\n          break;\n        case OPS.curveTo:\n          startX = x;\n          startY = y;\n          x = args[j + 4];\n          y = args[j + 5];\n          ctx.bezierCurveTo(\n            args[j],\n            args[j + 1],\n            args[j + 2],\n            args[j + 3],\n            x,\n            y\n          );\n          current.updateCurvePathMinMax(\n            currentTransform,\n            startX,\n            startY,\n            args[j],\n            args[j + 1],\n            args[j + 2],\n            args[j + 3],\n            x,\n            y,\n            minMaxForBezier\n          );\n          j += 6;\n          break;\n        case OPS.curveTo2:\n          startX = x;\n          startY = y;\n          ctx.bezierCurveTo(\n            x,\n            y,\n            args[j],\n            args[j + 1],\n            args[j + 2],\n            args[j + 3]\n          );\n          current.updateCurvePathMinMax(\n            currentTransform,\n            startX,\n            startY,\n            x,\n            y,\n            args[j],\n            args[j + 1],\n            args[j + 2],\n            args[j + 3],\n            minMaxForBezier\n          );\n          x = args[j + 2];\n          y = args[j + 3];\n          j += 4;\n          break;\n        case OPS.curveTo3:\n          startX = x;\n          startY = y;\n          x = args[j + 2];\n          y = args[j + 3];\n          ctx.bezierCurveTo(args[j], args[j + 1], x, y, x, y);\n          current.updateCurvePathMinMax(\n            currentTransform,\n            startX,\n            startY,\n            args[j],\n            args[j + 1],\n            x,\n            y,\n            x,\n            y,\n            minMaxForBezier\n          );\n          j += 4;\n          break;\n        case OPS.closePath:\n          ctx.closePath();\n          break;\n      }\n    }\n\n    if (isScalingMatrix) {\n      current.updateScalingPathMinMax(currentTransform, minMaxForBezier);\n    }\n\n    current.setCurrentPoint(x, y);\n  }\n\n  closePath() {\n    this.ctx.closePath();\n  }\n\n  stroke(consumePath = true) {\n    const ctx = this.ctx;\n    const strokeColor = this.current.strokeColor;\n    // For stroke we want to temporarily change the global alpha to the\n    // stroking alpha.\n    ctx.globalAlpha = this.current.strokeAlpha;\n    if (this.contentVisible) {\n      if (typeof strokeColor === \"object\" && strokeColor?.getPattern) {\n        ctx.save();\n        ctx.strokeStyle = strokeColor.getPattern(\n          ctx,\n          this,\n          getCurrentTransformInverse(ctx),\n          PathType.STROKE\n        );\n        this.rescaleAndStroke(/* saveRestore */ false);\n        ctx.restore();\n      } else {\n        this.rescaleAndStroke(/* saveRestore */ true);\n      }\n    }\n    if (consumePath) {\n      this.consumePath(this.current.getClippedPathBoundingBox());\n    }\n    // Restore the global alpha to the fill alpha\n    ctx.globalAlpha = this.current.fillAlpha;\n  }\n\n  closeStroke() {\n    this.closePath();\n    this.stroke();\n  }\n\n  fill(consumePath = true) {\n    const ctx = this.ctx;\n    const fillColor = this.current.fillColor;\n    const isPatternFill = this.current.patternFill;\n    let needRestore = false;\n\n    if (isPatternFill) {\n      ctx.save();\n      ctx.fillStyle = fillColor.getPattern(\n        ctx,\n        this,\n        getCurrentTransformInverse(ctx),\n        PathType.FILL\n      );\n      needRestore = true;\n    }\n\n    const intersect = this.current.getClippedPathBoundingBox();\n    if (this.contentVisible && intersect !== null) {\n      if (this.pendingEOFill) {\n        ctx.fill(\"evenodd\");\n        this.pendingEOFill = false;\n      } else {\n        ctx.fill();\n      }\n    }\n\n    if (needRestore) {\n      ctx.restore();\n    }\n    if (consumePath) {\n      this.consumePath(intersect);\n    }\n  }\n\n  eoFill() {\n    this.pendingEOFill = true;\n    this.fill();\n  }\n\n  fillStroke() {\n    this.fill(false);\n    this.stroke(false);\n\n    this.consumePath();\n  }\n\n  eoFillStroke() {\n    this.pendingEOFill = true;\n    this.fillStroke();\n  }\n\n  closeFillStroke() {\n    this.closePath();\n    this.fillStroke();\n  }\n\n  closeEOFillStroke() {\n    this.pendingEOFill = true;\n    this.closePath();\n    this.fillStroke();\n  }\n\n  endPath() {\n    this.consumePath();\n  }\n\n  // Clipping\n  clip() {\n    this.pendingClip = NORMAL_CLIP;\n  }\n\n  eoClip() {\n    this.pendingClip = EO_CLIP;\n  }\n\n  // Text\n  beginText() {\n    this.current.textMatrix = IDENTITY_MATRIX;\n    this.current.textMatrixScale = 1;\n    this.current.x = this.current.lineX = 0;\n    this.current.y = this.current.lineY = 0;\n  }\n\n  endText() {\n    const paths = this.pendingTextPaths;\n    const ctx = this.ctx;\n    if (paths === undefined) {\n      ctx.beginPath();\n      return;\n    }\n\n    ctx.save();\n    ctx.beginPath();\n    for (const path of paths) {\n      ctx.setTransform(...path.transform);\n      ctx.translate(path.x, path.y);\n      path.addToPath(ctx, path.fontSize);\n    }\n    ctx.restore();\n    ctx.clip();\n    ctx.beginPath();\n    delete this.pendingTextPaths;\n  }\n\n  setCharSpacing(spacing) {\n    this.current.charSpacing = spacing;\n  }\n\n  setWordSpacing(spacing) {\n    this.current.wordSpacing = spacing;\n  }\n\n  setHScale(scale) {\n    this.current.textHScale = scale / 100;\n  }\n\n  setLeading(leading) {\n    this.current.leading = -leading;\n  }\n\n  setFont(fontRefName, size) {\n    const fontObj = this.commonObjs.get(fontRefName);\n    const current = this.current;\n\n    if (!fontObj) {\n      throw new Error(`Can't find font for ${fontRefName}`);\n    }\n    current.fontMatrix = fontObj.fontMatrix || FONT_IDENTITY_MATRIX;\n\n    // A valid matrix needs all main diagonal elements to be non-zero\n    // This also ensures we bypass FF bugzilla bug #719844.\n    if (current.fontMatrix[0] === 0 || current.fontMatrix[3] === 0) {\n      warn(\"Invalid font matrix for font \" + fontRefName);\n    }\n\n    // The spec for Tf (setFont) says that 'size' specifies the font 'scale',\n    // and in some docs this can be negative (inverted x-y axes).\n    if (size < 0) {\n      size = -size;\n      current.fontDirection = -1;\n    } else {\n      current.fontDirection = 1;\n    }\n\n    this.current.font = fontObj;\n    this.current.fontSize = size;\n\n    if (fontObj.isType3Font) {\n      return; // we don't need ctx.font for Type3 fonts\n    }\n\n    const name = fontObj.loadedName || \"sans-serif\";\n    const typeface =\n      fontObj.systemFontInfo?.css || `\"${name}\", ${fontObj.fallbackName}`;\n\n    let bold = \"normal\";\n    if (fontObj.black) {\n      bold = \"900\";\n    } else if (fontObj.bold) {\n      bold = \"bold\";\n    }\n    const italic = fontObj.italic ? \"italic\" : \"normal\";\n\n    // Some font backends cannot handle fonts below certain size.\n    // Keeping the font at minimal size and using the fontSizeScale to change\n    // the current transformation matrix before the fillText/strokeText.\n    // See https://bugzilla.mozilla.org/show_bug.cgi?id=726227\n    let browserFontSize = size;\n    if (size < MIN_FONT_SIZE) {\n      browserFontSize = MIN_FONT_SIZE;\n    } else if (size > MAX_FONT_SIZE) {\n      browserFontSize = MAX_FONT_SIZE;\n    }\n    this.current.fontSizeScale = size / browserFontSize;\n\n    this.ctx.font = `${italic} ${bold} ${browserFontSize}px ${typeface}`;\n  }\n\n  setTextRenderingMode(mode) {\n    this.current.textRenderingMode = mode;\n  }\n\n  setTextRise(rise) {\n    this.current.textRise = rise;\n  }\n\n  moveText(x, y) {\n    this.current.x = this.current.lineX += x;\n    this.current.y = this.current.lineY += y;\n  }\n\n  setLeadingMoveText(x, y) {\n    this.setLeading(-y);\n    this.moveText(x, y);\n  }\n\n  setTextMatrix(a, b, c, d, e, f) {\n    this.current.textMatrix = [a, b, c, d, e, f];\n    this.current.textMatrixScale = Math.hypot(a, b);\n\n    this.current.x = this.current.lineX = 0;\n    this.current.y = this.current.lineY = 0;\n  }\n\n  nextLine() {\n    this.moveText(0, this.current.leading);\n  }\n\n  paintChar(character, x, y, patternTransform) {\n    const ctx = this.ctx;\n    const current = this.current;\n    const font = current.font;\n    const textRenderingMode = current.textRenderingMode;\n    const fontSize = current.fontSize / current.fontSizeScale;\n    const fillStrokeMode =\n      textRenderingMode & TextRenderingMode.FILL_STROKE_MASK;\n    const isAddToPathSet = !!(\n      textRenderingMode & TextRenderingMode.ADD_TO_PATH_FLAG\n    );\n    const patternFill = current.patternFill && !font.missingFile;\n\n    let addToPath;\n    if (font.disableFontFace || isAddToPathSet || patternFill) {\n      addToPath = font.getPathGenerator(this.commonObjs, character);\n    }\n\n    if (font.disableFontFace || patternFill) {\n      ctx.save();\n      ctx.translate(x, y);\n      ctx.beginPath();\n      addToPath(ctx, fontSize);\n      if (patternTransform) {\n        ctx.setTransform(...patternTransform);\n      }\n      if (\n        fillStrokeMode === TextRenderingMode.FILL ||\n        fillStrokeMode === TextRenderingMode.FILL_STROKE\n      ) {\n        ctx.fill();\n      }\n      if (\n        fillStrokeMode === TextRenderingMode.STROKE ||\n        fillStrokeMode === TextRenderingMode.FILL_STROKE\n      ) {\n        ctx.stroke();\n      }\n      ctx.restore();\n    } else {\n      if (\n        fillStrokeMode === TextRenderingMode.FILL ||\n        fillStrokeMode === TextRenderingMode.FILL_STROKE\n      ) {\n        ctx.fillText(character, x, y);\n      }\n      if (\n        fillStrokeMode === TextRenderingMode.STROKE ||\n        fillStrokeMode === TextRenderingMode.FILL_STROKE\n      ) {\n        ctx.strokeText(character, x, y);\n      }\n    }\n\n    if (isAddToPathSet) {\n      const paths = (this.pendingTextPaths ||= []);\n      paths.push({\n        transform: getCurrentTransform(ctx),\n        x,\n        y,\n        fontSize,\n        addToPath,\n      });\n    }\n  }\n\n  get isFontSubpixelAAEnabled() {\n    // Checks if anti-aliasing is enabled when scaled text is painted.\n    // On Windows GDI scaled fonts looks bad.\n    const { context: ctx } = this.cachedCanvases.getCanvas(\n      \"isFontSubpixelAAEnabled\",\n      10,\n      10\n    );\n    ctx.scale(1.5, 1);\n    ctx.fillText(\"I\", 0, 10);\n    const data = ctx.getImageData(0, 0, 10, 10).data;\n    let enabled = false;\n    for (let i = 3; i < data.length; i += 4) {\n      if (data[i] > 0 && data[i] < 255) {\n        enabled = true;\n        break;\n      }\n    }\n    return shadow(this, \"isFontSubpixelAAEnabled\", enabled);\n  }\n\n  showText(glyphs) {\n    const current = this.current;\n    const font = current.font;\n    if (font.isType3Font) {\n      return this.showType3Text(glyphs);\n    }\n\n    const fontSize = current.fontSize;\n    if (fontSize === 0) {\n      return undefined;\n    }\n\n    const ctx = this.ctx;\n    const fontSizeScale = current.fontSizeScale;\n    const charSpacing = current.charSpacing;\n    const wordSpacing = current.wordSpacing;\n    const fontDirection = current.fontDirection;\n    const textHScale = current.textHScale * fontDirection;\n    const glyphsLength = glyphs.length;\n    const vertical = font.vertical;\n    const spacingDir = vertical ? 1 : -1;\n    const defaultVMetrics = font.defaultVMetrics;\n    const widthAdvanceScale = fontSize * current.fontMatrix[0];\n\n    const simpleFillText =\n      current.textRenderingMode === TextRenderingMode.FILL &&\n      !font.disableFontFace &&\n      !current.patternFill;\n\n    ctx.save();\n    ctx.transform(...current.textMatrix);\n    ctx.translate(current.x, current.y + current.textRise);\n\n    if (fontDirection > 0) {\n      ctx.scale(textHScale, -1);\n    } else {\n      ctx.scale(textHScale, 1);\n    }\n\n    let patternTransform;\n    if (current.patternFill) {\n      ctx.save();\n      const pattern = current.fillColor.getPattern(\n        ctx,\n        this,\n        getCurrentTransformInverse(ctx),\n        PathType.FILL\n      );\n      patternTransform = getCurrentTransform(ctx);\n      ctx.restore();\n      ctx.fillStyle = pattern;\n    }\n\n    let lineWidth = current.lineWidth;\n    const scale = current.textMatrixScale;\n    if (scale === 0 || lineWidth === 0) {\n      const fillStrokeMode =\n        current.textRenderingMode & TextRenderingMode.FILL_STROKE_MASK;\n      if (\n        fillStrokeMode === TextRenderingMode.STROKE ||\n        fillStrokeMode === TextRenderingMode.FILL_STROKE\n      ) {\n        lineWidth = this.getSinglePixelWidth();\n      }\n    } else {\n      lineWidth /= scale;\n    }\n\n    if (fontSizeScale !== 1.0) {\n      ctx.scale(fontSizeScale, fontSizeScale);\n      lineWidth /= fontSizeScale;\n    }\n\n    ctx.lineWidth = lineWidth;\n\n    if (font.isInvalidPDFjsFont) {\n      const chars = [];\n      let width = 0;\n      for (const glyph of glyphs) {\n        chars.push(glyph.unicode);\n        width += glyph.width;\n      }\n      ctx.fillText(chars.join(\"\"), 0, 0);\n      current.x += width * widthAdvanceScale * textHScale;\n      ctx.restore();\n      this.compose();\n\n      return undefined;\n    }\n\n    let x = 0,\n      i;\n    for (i = 0; i < glyphsLength; ++i) {\n      const glyph = glyphs[i];\n      if (typeof glyph === \"number\") {\n        x += (spacingDir * glyph * fontSize) / 1000;\n        continue;\n      }\n\n      let restoreNeeded = false;\n      const spacing = (glyph.isSpace ? wordSpacing : 0) + charSpacing;\n      const character = glyph.fontChar;\n      const accent = glyph.accent;\n      let scaledX, scaledY;\n      let width = glyph.width;\n      if (vertical) {\n        const vmetric = glyph.vmetric || defaultVMetrics;\n        const vx =\n          -(glyph.vmetric ? vmetric[1] : width * 0.5) * widthAdvanceScale;\n        const vy = vmetric[2] * widthAdvanceScale;\n\n        width = vmetric ? -vmetric[0] : width;\n        scaledX = vx / fontSizeScale;\n        scaledY = (x + vy) / fontSizeScale;\n      } else {\n        scaledX = x / fontSizeScale;\n        scaledY = 0;\n      }\n\n      if (font.remeasure && width > 0) {\n        // Some standard fonts may not have the exact width: rescale per\n        // character if measured width is greater than expected glyph width\n        // and subpixel-aa is enabled, otherwise just center the glyph.\n        const measuredWidth =\n          ((ctx.measureText(character).width * 1000) / fontSize) *\n          fontSizeScale;\n        if (width < measuredWidth && this.isFontSubpixelAAEnabled) {\n          const characterScaleX = width / measuredWidth;\n          restoreNeeded = true;\n          ctx.save();\n          ctx.scale(characterScaleX, 1);\n          scaledX /= characterScaleX;\n        } else if (width !== measuredWidth) {\n          scaledX +=\n            (((width - measuredWidth) / 2000) * fontSize) / fontSizeScale;\n        }\n      }\n\n      // Only attempt to draw the glyph if it is actually in the embedded font\n      // file or if there isn't a font file so the fallback font is shown.\n      if (this.contentVisible && (glyph.isInFont || font.missingFile)) {\n        if (simpleFillText && !accent) {\n          // common case\n          ctx.fillText(character, scaledX, scaledY);\n        } else {\n          this.paintChar(character, scaledX, scaledY, patternTransform);\n          if (accent) {\n            const scaledAccentX =\n              scaledX + (fontSize * accent.offset.x) / fontSizeScale;\n            const scaledAccentY =\n              scaledY - (fontSize * accent.offset.y) / fontSizeScale;\n            this.paintChar(\n              accent.fontChar,\n              scaledAccentX,\n              scaledAccentY,\n              patternTransform\n            );\n          }\n        }\n      }\n\n      const charWidth = vertical\n        ? width * widthAdvanceScale - spacing * fontDirection\n        : width * widthAdvanceScale + spacing * fontDirection;\n      x += charWidth;\n\n      if (restoreNeeded) {\n        ctx.restore();\n      }\n    }\n    if (vertical) {\n      current.y -= x;\n    } else {\n      current.x += x * textHScale;\n    }\n    ctx.restore();\n    this.compose();\n\n    return undefined;\n  }\n\n  showType3Text(glyphs) {\n    // Type3 fonts - each glyph is a \"mini-PDF\"\n    const ctx = this.ctx;\n    const current = this.current;\n    const font = current.font;\n    const fontSize = current.fontSize;\n    const fontDirection = current.fontDirection;\n    const spacingDir = font.vertical ? 1 : -1;\n    const charSpacing = current.charSpacing;\n    const wordSpacing = current.wordSpacing;\n    const textHScale = current.textHScale * fontDirection;\n    const fontMatrix = current.fontMatrix || FONT_IDENTITY_MATRIX;\n    const glyphsLength = glyphs.length;\n    const isTextInvisible =\n      current.textRenderingMode === TextRenderingMode.INVISIBLE;\n    let i, glyph, width, spacingLength;\n\n    if (isTextInvisible || fontSize === 0) {\n      return;\n    }\n    this._cachedScaleForStroking[0] = -1;\n    this._cachedGetSinglePixelWidth = null;\n\n    ctx.save();\n    ctx.transform(...current.textMatrix);\n    ctx.translate(current.x, current.y);\n\n    ctx.scale(textHScale, fontDirection);\n\n    for (i = 0; i < glyphsLength; ++i) {\n      glyph = glyphs[i];\n      if (typeof glyph === \"number\") {\n        spacingLength = (spacingDir * glyph * fontSize) / 1000;\n        this.ctx.translate(spacingLength, 0);\n        current.x += spacingLength * textHScale;\n        continue;\n      }\n\n      const spacing = (glyph.isSpace ? wordSpacing : 0) + charSpacing;\n      const operatorList = font.charProcOperatorList[glyph.operatorListId];\n      if (!operatorList) {\n        warn(`Type3 character \"${glyph.operatorListId}\" is not available.`);\n        continue;\n      }\n      if (this.contentVisible) {\n        this.processingType3 = glyph;\n        this.save();\n        ctx.scale(fontSize, fontSize);\n        ctx.transform(...fontMatrix);\n        this.executeOperatorList(operatorList);\n        this.restore();\n      }\n\n      const transformed = Util.applyTransform([glyph.width, 0], fontMatrix);\n      width = transformed[0] * fontSize + spacing;\n\n      ctx.translate(width, 0);\n      current.x += width * textHScale;\n    }\n    ctx.restore();\n    this.processingType3 = null;\n  }\n\n  // Type3 fonts\n  setCharWidth(xWidth, yWidth) {\n    // We can safely ignore this since the width should be the same\n    // as the width in the Widths array.\n  }\n\n  setCharWidthAndBounds(xWidth, yWidth, llx, lly, urx, ury) {\n    this.ctx.rect(llx, lly, urx - llx, ury - lly);\n    this.ctx.clip();\n    this.endPath();\n  }\n\n  // Color\n  getColorN_Pattern(IR) {\n    let pattern;\n    if (IR[0] === \"TilingPattern\") {\n      const color = IR[1];\n      const baseTransform = this.baseTransform || getCurrentTransform(this.ctx);\n      const canvasGraphicsFactory = {\n        createCanvasGraphics: ctx => {\n          return new CanvasGraphics(\n            ctx,\n            this.commonObjs,\n            this.objs,\n            this.canvasFactory,\n            this.filterFactory,\n            {\n              optionalContentConfig: this.optionalContentConfig,\n              markedContentStack: this.markedContentStack,\n            }\n          );\n        },\n      };\n      pattern = new TilingPattern(\n        IR,\n        color,\n        this.ctx,\n        canvasGraphicsFactory,\n        baseTransform\n      );\n    } else {\n      pattern = this._getPattern(IR[1], IR[2]);\n    }\n    return pattern;\n  }\n\n  setStrokeColorN() {\n    this.current.strokeColor = this.getColorN_Pattern(arguments);\n  }\n\n  setFillColorN() {\n    this.current.fillColor = this.getColorN_Pattern(arguments);\n    this.current.patternFill = true;\n  }\n\n  setStrokeRGBColor(r, g, b) {\n    const color = Util.makeHexColor(r, g, b);\n    this.ctx.strokeStyle = color;\n    this.current.strokeColor = color;\n  }\n\n  setFillRGBColor(r, g, b) {\n    const color = Util.makeHexColor(r, g, b);\n    this.ctx.fillStyle = color;\n    this.current.fillColor = color;\n    this.current.patternFill = false;\n  }\n\n  _getPattern(objId, matrix = null) {\n    let pattern;\n    if (this.cachedPatterns.has(objId)) {\n      pattern = this.cachedPatterns.get(objId);\n    } else {\n      pattern = getShadingPattern(this.getObject(objId));\n      this.cachedPatterns.set(objId, pattern);\n    }\n    if (matrix) {\n      pattern.matrix = matrix;\n    }\n    return pattern;\n  }\n\n  shadingFill(objId) {\n    if (!this.contentVisible) {\n      return;\n    }\n    const ctx = this.ctx;\n\n    this.save();\n    const pattern = this._getPattern(objId);\n    ctx.fillStyle = pattern.getPattern(\n      ctx,\n      this,\n      getCurrentTransformInverse(ctx),\n      PathType.SHADING\n    );\n\n    const inv = getCurrentTransformInverse(ctx);\n    if (inv) {\n      const { width, height } = ctx.canvas;\n      const [x0, y0, x1, y1] = Util.getAxialAlignedBoundingBox(\n        [0, 0, width, height],\n        inv\n      );\n\n      this.ctx.fillRect(x0, y0, x1 - x0, y1 - y0);\n    } else {\n      // HACK to draw the gradient onto an infinite rectangle.\n      // PDF gradients are drawn across the entire image while\n      // Canvas only allows gradients to be drawn in a rectangle\n      // The following bug should allow us to remove this.\n      // https://bugzilla.mozilla.org/show_bug.cgi?id=664884\n\n      this.ctx.fillRect(-1e10, -1e10, 2e10, 2e10);\n    }\n\n    this.compose(this.current.getClippedPathBoundingBox());\n    this.restore();\n  }\n\n  // Images\n  beginInlineImage() {\n    unreachable(\"Should not call beginInlineImage\");\n  }\n\n  beginImageData() {\n    unreachable(\"Should not call beginImageData\");\n  }\n\n  paintFormXObjectBegin(matrix, bbox) {\n    if (!this.contentVisible) {\n      return;\n    }\n    this.save();\n    this.baseTransformStack.push(this.baseTransform);\n\n    if (Array.isArray(matrix) && matrix.length === 6) {\n      this.transform(...matrix);\n    }\n\n    this.baseTransform = getCurrentTransform(this.ctx);\n\n    if (bbox) {\n      const width = bbox[2] - bbox[0];\n      const height = bbox[3] - bbox[1];\n      this.ctx.rect(bbox[0], bbox[1], width, height);\n      this.current.updateRectMinMax(getCurrentTransform(this.ctx), bbox);\n      this.clip();\n      this.endPath();\n    }\n  }\n\n  paintFormXObjectEnd() {\n    if (!this.contentVisible) {\n      return;\n    }\n    this.restore();\n    this.baseTransform = this.baseTransformStack.pop();\n  }\n\n  beginGroup(group) {\n    if (!this.contentVisible) {\n      return;\n    }\n\n    this.save();\n    // If there's an active soft mask we don't want it enabled for the group, so\n    // clear it out. The mask and suspended canvas will be restored in endGroup.\n    if (this.inSMaskMode) {\n      this.endSMaskMode();\n      this.current.activeSMask = null;\n    }\n\n    const currentCtx = this.ctx;\n    // TODO non-isolated groups - according to Rik at adobe non-isolated\n    // group results aren't usually that different and they even have tools\n    // that ignore this setting. Notes from Rik on implementing:\n    // - When you encounter an transparency group, create a new canvas with\n    // the dimensions of the bbox\n    // - copy the content from the previous canvas to the new canvas\n    // - draw as usual\n    // - remove the backdrop alpha:\n    // alphaNew = 1 - (1 - alpha)/(1 - alphaBackdrop) with 'alpha' the alpha\n    // value of your transparency group and 'alphaBackdrop' the alpha of the\n    // backdrop\n    // - remove background color:\n    // colorNew = color - alphaNew *colorBackdrop /(1 - alphaNew)\n    if (!group.isolated) {\n      info(\"TODO: Support non-isolated groups.\");\n    }\n\n    // TODO knockout - supposedly possible with the clever use of compositing\n    // modes.\n    if (group.knockout) {\n      warn(\"Knockout groups not supported.\");\n    }\n\n    const currentTransform = getCurrentTransform(currentCtx);\n    if (group.matrix) {\n      currentCtx.transform(...group.matrix);\n    }\n    if (!group.bbox) {\n      throw new Error(\"Bounding box is required.\");\n    }\n\n    // Based on the current transform figure out how big the bounding box\n    // will actually be.\n    let bounds = Util.getAxialAlignedBoundingBox(\n      group.bbox,\n      getCurrentTransform(currentCtx)\n    );\n    // Clip the bounding box to the current canvas.\n    const canvasBounds = [\n      0,\n      0,\n      currentCtx.canvas.width,\n      currentCtx.canvas.height,\n    ];\n    bounds = Util.intersect(bounds, canvasBounds) || [0, 0, 0, 0];\n    // Use ceil in case we're between sizes so we don't create canvas that is\n    // too small and make the canvas at least 1x1 pixels.\n    const offsetX = Math.floor(bounds[0]);\n    const offsetY = Math.floor(bounds[1]);\n    let drawnWidth = Math.max(Math.ceil(bounds[2]) - offsetX, 1);\n    let drawnHeight = Math.max(Math.ceil(bounds[3]) - offsetY, 1);\n    let scaleX = 1,\n      scaleY = 1;\n    if (drawnWidth > MAX_GROUP_SIZE) {\n      scaleX = drawnWidth / MAX_GROUP_SIZE;\n      drawnWidth = MAX_GROUP_SIZE;\n    }\n    if (drawnHeight > MAX_GROUP_SIZE) {\n      scaleY = drawnHeight / MAX_GROUP_SIZE;\n      drawnHeight = MAX_GROUP_SIZE;\n    }\n\n    this.current.startNewPathAndClipBox([0, 0, drawnWidth, drawnHeight]);\n\n    let cacheId = \"groupAt\" + this.groupLevel;\n    if (group.smask) {\n      // Using two cache entries is case if masks are used one after another.\n      cacheId += \"_smask_\" + (this.smaskCounter++ % 2);\n    }\n    const scratchCanvas = this.cachedCanvases.getCanvas(\n      cacheId,\n      drawnWidth,\n      drawnHeight\n    );\n    const groupCtx = scratchCanvas.context;\n\n    // Since we created a new canvas that is just the size of the bounding box\n    // we have to translate the group ctx.\n    groupCtx.scale(1 / scaleX, 1 / scaleY);\n    groupCtx.translate(-offsetX, -offsetY);\n    groupCtx.transform(...currentTransform);\n\n    if (group.smask) {\n      // Saving state and cached mask to be used in setGState.\n      this.smaskStack.push({\n        canvas: scratchCanvas.canvas,\n        context: groupCtx,\n        offsetX,\n        offsetY,\n        scaleX,\n        scaleY,\n        subtype: group.smask.subtype,\n        backdrop: group.smask.backdrop,\n        transferMap: group.smask.transferMap || null,\n        startTransformInverse: null, // used during suspend operation\n      });\n    } else {\n      // Setup the current ctx so when the group is popped we draw it at the\n      // right location.\n      currentCtx.setTransform(1, 0, 0, 1, 0, 0);\n      currentCtx.translate(offsetX, offsetY);\n      currentCtx.scale(scaleX, scaleY);\n      currentCtx.save();\n    }\n    // The transparency group inherits all off the current graphics state\n    // except the blend mode, soft mask, and alpha constants.\n    copyCtxState(currentCtx, groupCtx);\n    this.ctx = groupCtx;\n    this.setGState([\n      [\"BM\", \"source-over\"],\n      [\"ca\", 1],\n      [\"CA\", 1],\n    ]);\n    this.groupStack.push(currentCtx);\n    this.groupLevel++;\n  }\n\n  endGroup(group) {\n    if (!this.contentVisible) {\n      return;\n    }\n    this.groupLevel--;\n    const groupCtx = this.ctx;\n    const ctx = this.groupStack.pop();\n    this.ctx = ctx;\n    // Turn off image smoothing to avoid sub pixel interpolation which can\n    // look kind of blurry for some pdfs.\n    this.ctx.imageSmoothingEnabled = false;\n\n    if (group.smask) {\n      this.tempSMask = this.smaskStack.pop();\n      this.restore();\n    } else {\n      this.ctx.restore();\n      const currentMtx = getCurrentTransform(this.ctx);\n      this.restore();\n      this.ctx.save();\n      this.ctx.setTransform(...currentMtx);\n      const dirtyBox = Util.getAxialAlignedBoundingBox(\n        [0, 0, groupCtx.canvas.width, groupCtx.canvas.height],\n        currentMtx\n      );\n      this.ctx.drawImage(groupCtx.canvas, 0, 0);\n      this.ctx.restore();\n      this.compose(dirtyBox);\n    }\n  }\n\n  beginAnnotation(id, rect, transform, matrix, hasOwnCanvas) {\n    // The annotations are drawn just after the page content.\n    // The page content drawing can potentially have set a transform,\n    // a clipping path, whatever...\n    // So in order to have something clean, we restore the initial state.\n    this.#restoreInitialState();\n    resetCtxToDefault(this.ctx);\n\n    this.ctx.save();\n    this.save();\n\n    if (this.baseTransform) {\n      this.ctx.setTransform(...this.baseTransform);\n    }\n\n    if (Array.isArray(rect) && rect.length === 4) {\n      const width = rect[2] - rect[0];\n      const height = rect[3] - rect[1];\n\n      if (hasOwnCanvas && this.annotationCanvasMap) {\n        transform = transform.slice();\n        transform[4] -= rect[0];\n        transform[5] -= rect[1];\n\n        rect = rect.slice();\n        rect[0] = rect[1] = 0;\n        rect[2] = width;\n        rect[3] = height;\n\n        const [scaleX, scaleY] = Util.singularValueDecompose2dScale(\n          getCurrentTransform(this.ctx)\n        );\n        const { viewportScale } = this;\n        const canvasWidth = Math.ceil(\n          width * this.outputScaleX * viewportScale\n        );\n        const canvasHeight = Math.ceil(\n          height * this.outputScaleY * viewportScale\n        );\n\n        this.annotationCanvas = this.canvasFactory.create(\n          canvasWidth,\n          canvasHeight\n        );\n        const { canvas, context } = this.annotationCanvas;\n        this.annotationCanvasMap.set(id, canvas);\n        this.annotationCanvas.savedCtx = this.ctx;\n        this.ctx = context;\n        this.ctx.save();\n        this.ctx.setTransform(scaleX, 0, 0, -scaleY, 0, height * scaleY);\n\n        resetCtxToDefault(this.ctx);\n      } else {\n        resetCtxToDefault(this.ctx);\n\n        this.ctx.rect(rect[0], rect[1], width, height);\n        this.ctx.clip();\n        this.endPath();\n      }\n    }\n\n    this.current = new CanvasExtraState(\n      this.ctx.canvas.width,\n      this.ctx.canvas.height\n    );\n\n    this.transform(...transform);\n    this.transform(...matrix);\n  }\n\n  endAnnotation() {\n    if (this.annotationCanvas) {\n      this.ctx.restore();\n      this.#drawFilter();\n\n      this.ctx = this.annotationCanvas.savedCtx;\n      delete this.annotationCanvas.savedCtx;\n      delete this.annotationCanvas;\n    }\n  }\n\n  paintImageMaskXObject(img) {\n    if (!this.contentVisible) {\n      return;\n    }\n    const count = img.count;\n    img = this.getObject(img.data, img);\n    img.count = count;\n\n    const ctx = this.ctx;\n    const glyph = this.processingType3;\n\n    if (glyph) {\n      if (glyph.compiled === undefined) {\n        glyph.compiled = compileType3Glyph(img);\n      }\n\n      if (glyph.compiled) {\n        glyph.compiled(ctx);\n        return;\n      }\n    }\n    const mask = this._createMaskCanvas(img);\n    const maskCanvas = mask.canvas;\n\n    ctx.save();\n    // The mask is drawn with the transform applied. Reset the current\n    // transform to draw to the identity.\n    ctx.setTransform(1, 0, 0, 1, 0, 0);\n    ctx.drawImage(maskCanvas, mask.offsetX, mask.offsetY);\n    ctx.restore();\n    this.compose();\n  }\n\n  paintImageMaskXObjectRepeat(\n    img,\n    scaleX,\n    skewX = 0,\n    skewY = 0,\n    scaleY,\n    positions\n  ) {\n    if (!this.contentVisible) {\n      return;\n    }\n\n    img = this.getObject(img.data, img);\n\n    const ctx = this.ctx;\n    ctx.save();\n    const currentTransform = getCurrentTransform(ctx);\n    ctx.transform(scaleX, skewX, skewY, scaleY, 0, 0);\n    const mask = this._createMaskCanvas(img);\n\n    ctx.setTransform(\n      1,\n      0,\n      0,\n      1,\n      mask.offsetX - currentTransform[4],\n      mask.offsetY - currentTransform[5]\n    );\n    for (let i = 0, ii = positions.length; i < ii; i += 2) {\n      const trans = Util.transform(currentTransform, [\n        scaleX,\n        skewX,\n        skewY,\n        scaleY,\n        positions[i],\n        positions[i + 1],\n      ]);\n\n      const [x, y] = Util.applyTransform([0, 0], trans);\n      ctx.drawImage(mask.canvas, x, y);\n    }\n    ctx.restore();\n    this.compose();\n  }\n\n  paintImageMaskXObjectGroup(images) {\n    if (!this.contentVisible) {\n      return;\n    }\n    const ctx = this.ctx;\n\n    const fillColor = this.current.fillColor;\n    const isPatternFill = this.current.patternFill;\n\n    for (const image of images) {\n      const { data, width, height, transform } = image;\n\n      const maskCanvas = this.cachedCanvases.getCanvas(\n        \"maskCanvas\",\n        width,\n        height\n      );\n      const maskCtx = maskCanvas.context;\n      maskCtx.save();\n\n      const img = this.getObject(data, image);\n      putBinaryImageMask(maskCtx, img);\n\n      maskCtx.globalCompositeOperation = \"source-in\";\n\n      maskCtx.fillStyle = isPatternFill\n        ? fillColor.getPattern(\n            maskCtx,\n            this,\n            getCurrentTransformInverse(ctx),\n            PathType.FILL\n          )\n        : fillColor;\n      maskCtx.fillRect(0, 0, width, height);\n\n      maskCtx.restore();\n\n      ctx.save();\n      ctx.transform(...transform);\n      ctx.scale(1, -1);\n      drawImageAtIntegerCoords(\n        ctx,\n        maskCanvas.canvas,\n        0,\n        0,\n        width,\n        height,\n        0,\n        -1,\n        1,\n        1\n      );\n      ctx.restore();\n    }\n    this.compose();\n  }\n\n  paintImageXObject(objId) {\n    if (!this.contentVisible) {\n      return;\n    }\n    const imgData = this.getObject(objId);\n    if (!imgData) {\n      warn(\"Dependent image isn't ready yet\");\n      return;\n    }\n\n    this.paintInlineImageXObject(imgData);\n  }\n\n  paintImageXObjectRepeat(objId, scaleX, scaleY, positions) {\n    if (!this.contentVisible) {\n      return;\n    }\n    const imgData = this.getObject(objId);\n    if (!imgData) {\n      warn(\"Dependent image isn't ready yet\");\n      return;\n    }\n\n    const width = imgData.width;\n    const height = imgData.height;\n    const map = [];\n    for (let i = 0, ii = positions.length; i < ii; i += 2) {\n      map.push({\n        transform: [scaleX, 0, 0, scaleY, positions[i], positions[i + 1]],\n        x: 0,\n        y: 0,\n        w: width,\n        h: height,\n      });\n    }\n    this.paintInlineImageXObjectGroup(imgData, map);\n  }\n\n  applyTransferMapsToCanvas(ctx) {\n    if (this.current.transferMaps !== \"none\") {\n      ctx.filter = this.current.transferMaps;\n      ctx.drawImage(ctx.canvas, 0, 0);\n      ctx.filter = \"none\";\n    }\n    return ctx.canvas;\n  }\n\n  applyTransferMapsToBitmap(imgData) {\n    if (this.current.transferMaps === \"none\") {\n      return imgData.bitmap;\n    }\n    const { bitmap, width, height } = imgData;\n    const tmpCanvas = this.cachedCanvases.getCanvas(\n      \"inlineImage\",\n      width,\n      height\n    );\n    const tmpCtx = tmpCanvas.context;\n    tmpCtx.filter = this.current.transferMaps;\n    tmpCtx.drawImage(bitmap, 0, 0);\n    tmpCtx.filter = \"none\";\n\n    return tmpCanvas.canvas;\n  }\n\n  paintInlineImageXObject(imgData) {\n    if (!this.contentVisible) {\n      return;\n    }\n    const width = imgData.width;\n    const height = imgData.height;\n    const ctx = this.ctx;\n\n    this.save();\n\n    if (\n      (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) ||\n      !isNodeJS\n    ) {\n      // The filter, if any, will be applied in applyTransferMapsToBitmap.\n      // It must be applied to the image before rescaling else some artifacts\n      // could appear.\n      // The final restore will reset it to its value.\n      const { filter } = ctx;\n      if (filter !== \"none\" && filter !== \"\") {\n        ctx.filter = \"none\";\n      }\n    }\n\n    // scale the image to the unit square\n    ctx.scale(1 / width, -1 / height);\n\n    let imgToPaint;\n    if (imgData.bitmap) {\n      imgToPaint = this.applyTransferMapsToBitmap(imgData);\n    } else if (\n      (typeof HTMLElement === \"function\" && imgData instanceof HTMLElement) ||\n      !imgData.data\n    ) {\n      // typeof check is needed due to node.js support, see issue #8489\n      imgToPaint = imgData;\n    } else {\n      const tmpCanvas = this.cachedCanvases.getCanvas(\n        \"inlineImage\",\n        width,\n        height\n      );\n      const tmpCtx = tmpCanvas.context;\n      putBinaryImageData(tmpCtx, imgData);\n      imgToPaint = this.applyTransferMapsToCanvas(tmpCtx);\n    }\n\n    const scaled = this._scaleImage(\n      imgToPaint,\n      getCurrentTransformInverse(ctx)\n    );\n    ctx.imageSmoothingEnabled = getImageSmoothingEnabled(\n      getCurrentTransform(ctx),\n      imgData.interpolate\n    );\n\n    drawImageAtIntegerCoords(\n      ctx,\n      scaled.img,\n      0,\n      0,\n      scaled.paintWidth,\n      scaled.paintHeight,\n      0,\n      -height,\n      width,\n      height\n    );\n    this.compose();\n    this.restore();\n  }\n\n  paintInlineImageXObjectGroup(imgData, map) {\n    if (!this.contentVisible) {\n      return;\n    }\n    const ctx = this.ctx;\n    let imgToPaint;\n    if (imgData.bitmap) {\n      imgToPaint = imgData.bitmap;\n    } else {\n      const w = imgData.width;\n      const h = imgData.height;\n\n      const tmpCanvas = this.cachedCanvases.getCanvas(\"inlineImage\", w, h);\n      const tmpCtx = tmpCanvas.context;\n      putBinaryImageData(tmpCtx, imgData);\n      imgToPaint = this.applyTransferMapsToCanvas(tmpCtx);\n    }\n\n    for (const entry of map) {\n      ctx.save();\n      ctx.transform(...entry.transform);\n      ctx.scale(1, -1);\n      drawImageAtIntegerCoords(\n        ctx,\n        imgToPaint,\n        entry.x,\n        entry.y,\n        entry.w,\n        entry.h,\n        0,\n        -1,\n        1,\n        1\n      );\n      ctx.restore();\n    }\n    this.compose();\n  }\n\n  paintSolidColorImageMask() {\n    if (!this.contentVisible) {\n      return;\n    }\n    this.ctx.fillRect(0, 0, 1, 1);\n    this.compose();\n  }\n\n  // Marked content\n\n  markPoint(tag) {\n    // TODO Marked content.\n  }\n\n  markPointProps(tag, properties) {\n    // TODO Marked content.\n  }\n\n  beginMarkedContent(tag) {\n    this.markedContentStack.push({\n      visible: true,\n    });\n  }\n\n  beginMarkedContentProps(tag, properties) {\n    if (tag === \"OC\") {\n      this.markedContentStack.push({\n        visible: this.optionalContentConfig.isVisible(properties),\n      });\n    } else {\n      this.markedContentStack.push({\n        visible: true,\n      });\n    }\n    this.contentVisible = this.isContentVisible();\n  }\n\n  endMarkedContent() {\n    this.markedContentStack.pop();\n    this.contentVisible = this.isContentVisible();\n  }\n\n  // Compatibility\n\n  beginCompat() {\n    // TODO ignore undefined operators (should we do that anyway?)\n  }\n\n  endCompat() {\n    // TODO stop ignoring undefined operators\n  }\n\n  // Helper functions\n\n  consumePath(clipBox) {\n    const isEmpty = this.current.isEmptyClip();\n    if (this.pendingClip) {\n      this.current.updateClipFromPath();\n    }\n    if (!this.pendingClip) {\n      this.compose(clipBox);\n    }\n    const ctx = this.ctx;\n    if (this.pendingClip) {\n      if (!isEmpty) {\n        if (this.pendingClip === EO_CLIP) {\n          ctx.clip(\"evenodd\");\n        } else {\n          ctx.clip();\n        }\n      }\n      this.pendingClip = null;\n    }\n    this.current.startNewPathAndClipBox(this.current.clipBox);\n    ctx.beginPath();\n  }\n\n  getSinglePixelWidth() {\n    if (!this._cachedGetSinglePixelWidth) {\n      const m = getCurrentTransform(this.ctx);\n      if (m[1] === 0 && m[2] === 0) {\n        // Fast path\n        this._cachedGetSinglePixelWidth =\n          1 / Math.min(Math.abs(m[0]), Math.abs(m[3]));\n      } else {\n        const absDet = Math.abs(m[0] * m[3] - m[2] * m[1]);\n        const normX = Math.hypot(m[0], m[2]);\n        const normY = Math.hypot(m[1], m[3]);\n        this._cachedGetSinglePixelWidth = Math.max(normX, normY) / absDet;\n      }\n    }\n    return this._cachedGetSinglePixelWidth;\n  }\n\n  getScaleForStroking() {\n    // A pixel has thicknessX = thicknessY = 1;\n    // A transformed pixel is a parallelogram and the thicknesses\n    // corresponds to the heights.\n    // The goal of this function is to rescale before setting the\n    // lineWidth in order to have both thicknesses greater or equal\n    // to 1 after transform.\n    if (this._cachedScaleForStroking[0] === -1) {\n      const { lineWidth } = this.current;\n      const { a, b, c, d } = this.ctx.getTransform();\n      let scaleX, scaleY;\n\n      if (b === 0 && c === 0) {\n        // Fast path\n        const normX = Math.abs(a);\n        const normY = Math.abs(d);\n        if (normX === normY) {\n          if (lineWidth === 0) {\n            scaleX = scaleY = 1 / normX;\n          } else {\n            const scaledLineWidth = normX * lineWidth;\n            scaleX = scaleY = scaledLineWidth < 1 ? 1 / scaledLineWidth : 1;\n          }\n        } else if (lineWidth === 0) {\n          scaleX = 1 / normX;\n          scaleY = 1 / normY;\n        } else {\n          const scaledXLineWidth = normX * lineWidth;\n          const scaledYLineWidth = normY * lineWidth;\n          scaleX = scaledXLineWidth < 1 ? 1 / scaledXLineWidth : 1;\n          scaleY = scaledYLineWidth < 1 ? 1 / scaledYLineWidth : 1;\n        }\n      } else {\n        // A pixel (base (x, y)) is transformed by M into a parallelogram:\n        //  - its area is |det(M)|;\n        //  - heightY (orthogonal to Mx) has a length: |det(M)| / norm(Mx);\n        //  - heightX (orthogonal to My) has a length: |det(M)| / norm(My).\n        // heightX and heightY are the thicknesses of the transformed pixel\n        // and they must be both greater or equal to 1.\n        const absDet = Math.abs(a * d - b * c);\n        const normX = Math.hypot(a, b);\n        const normY = Math.hypot(c, d);\n        if (lineWidth === 0) {\n          scaleX = normY / absDet;\n          scaleY = normX / absDet;\n        } else {\n          const baseArea = lineWidth * absDet;\n          scaleX = normY > baseArea ? normY / baseArea : 1;\n          scaleY = normX > baseArea ? normX / baseArea : 1;\n        }\n      }\n      this._cachedScaleForStroking[0] = scaleX;\n      this._cachedScaleForStroking[1] = scaleY;\n    }\n    return this._cachedScaleForStroking;\n  }\n\n  // Rescale before stroking in order to have a final lineWidth\n  // with both thicknesses greater or equal to 1.\n  rescaleAndStroke(saveRestore) {\n    const { ctx } = this;\n    const { lineWidth } = this.current;\n    const [scaleX, scaleY] = this.getScaleForStroking();\n\n    ctx.lineWidth = lineWidth || 1;\n\n    if (scaleX === 1 && scaleY === 1) {\n      ctx.stroke();\n      return;\n    }\n\n    const dashes = ctx.getLineDash();\n    if (saveRestore) {\n      ctx.save();\n    }\n\n    ctx.scale(scaleX, scaleY);\n\n    // How the dashed line is rendered depends on the current transform...\n    // so we added a rescale to handle too thin lines and consequently\n    // the way the line is dashed will be modified.\n    // If scaleX === scaleY, the dashed lines will be rendered correctly\n    // else we'll have some bugs (but only with too thin lines).\n    // Here we take the max... why not taking the min... or something else.\n    // Anyway, as said it's buggy when scaleX !== scaleY.\n    if (dashes.length > 0) {\n      const scale = Math.max(scaleX, scaleY);\n      ctx.setLineDash(dashes.map(x => x / scale));\n      ctx.lineDashOffset /= scale;\n    }\n\n    ctx.stroke();\n\n    if (saveRestore) {\n      ctx.restore();\n    }\n  }\n\n  isContentVisible() {\n    for (let i = this.markedContentStack.length - 1; i >= 0; i--) {\n      if (!this.markedContentStack[i].visible) {\n        return false;\n      }\n    }\n    return true;\n  }\n}\n\nfor (const op in OPS) {\n  if (CanvasGraphics.prototype[op] !== undefined) {\n    CanvasGraphics.prototype[OPS[op]] = CanvasGraphics.prototype[op];\n  }\n}\n\nexport { CanvasGraphics };\n", "/* Copyright 2015 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  BaseCanvasFactory,\n  BaseCMapReaderFactory,\n  BaseFilterFactory,\n  BaseStandardFontDataFactory,\n  BaseSVGFactory,\n} from \"./base_factory.js\";\nimport {\n  BaseException,\n  FeatureTest,\n  shadow,\n  stringToBytes,\n  Util,\n  warn,\n} from \"../shared/util.js\";\n\nconst SVG_NS = \"http://www.w3.org/2000/svg\";\n\nclass PixelsPerInch {\n  static CSS = 96.0;\n\n  static PDF = 72.0;\n\n  static PDF_TO_CSS_UNITS = this.CSS / this.PDF;\n}\n\n/**\n * FilterFactory aims to create some SVG filters we can use when drawing an\n * image (or whatever) on a canvas.\n * Filters aren't applied with ctx.putImageData because it just overwrites the\n * underlying pixels.\n * With these filters, it's possible for example to apply some transfer maps on\n * an image without the need to apply them on the pixel arrays: the renderer\n * does the magic for us.\n */\nclass DOMFilterFactory extends BaseFilterFactory {\n  #_cache;\n\n  #_defs;\n\n  #docId;\n\n  #document;\n\n  #hcmFilter;\n\n  #hcmKey;\n\n  #hcmUrl;\n\n  #hcmHighlightFilter;\n\n  #hcmHighlightKey;\n\n  #hcmHighlightUrl;\n\n  #id = 0;\n\n  constructor({ docId, ownerDocument = globalThis.document } = {}) {\n    super();\n    this.#docId = docId;\n    this.#document = ownerDocument;\n  }\n\n  get #cache() {\n    return (this.#_cache ||= new Map());\n  }\n\n  get #defs() {\n    if (!this.#_defs) {\n      const div = this.#document.createElement(\"div\");\n      const { style } = div;\n      style.visibility = \"hidden\";\n      style.contain = \"strict\";\n      style.width = style.height = 0;\n      style.position = \"absolute\";\n      style.top = style.left = 0;\n      style.zIndex = -1;\n\n      const svg = this.#document.createElementNS(SVG_NS, \"svg\");\n      svg.setAttribute(\"width\", 0);\n      svg.setAttribute(\"height\", 0);\n      this.#_defs = this.#document.createElementNS(SVG_NS, \"defs\");\n      div.append(svg);\n      svg.append(this.#_defs);\n      this.#document.body.append(div);\n    }\n    return this.#_defs;\n  }\n\n  addFilter(maps) {\n    if (!maps) {\n      return \"none\";\n    }\n\n    // When a page is zoomed the page is re-drawn but the maps are likely\n    // the same.\n    let value = this.#cache.get(maps);\n    if (value) {\n      return value;\n    }\n\n    let tableR, tableG, tableB, key;\n    if (maps.length === 1) {\n      const mapR = maps[0];\n      const buffer = new Array(256);\n      for (let i = 0; i < 256; i++) {\n        buffer[i] = mapR[i] / 255;\n      }\n      key = tableR = tableG = tableB = buffer.join(\",\");\n    } else {\n      const [mapR, mapG, mapB] = maps;\n      const bufferR = new Array(256);\n      const bufferG = new Array(256);\n      const bufferB = new Array(256);\n      for (let i = 0; i < 256; i++) {\n        bufferR[i] = mapR[i] / 255;\n        bufferG[i] = mapG[i] / 255;\n        bufferB[i] = mapB[i] / 255;\n      }\n      tableR = bufferR.join(\",\");\n      tableG = bufferG.join(\",\");\n      tableB = bufferB.join(\",\");\n      key = `${tableR}${tableG}${tableB}`;\n    }\n\n    value = this.#cache.get(key);\n    if (value) {\n      this.#cache.set(maps, value);\n      return value;\n    }\n\n    // We create a SVG filter: feComponentTransferElement\n    //  https://www.w3.org/TR/SVG11/filters.html#feComponentTransferElement\n\n    const id = `g_${this.#docId}_transfer_map_${this.#id++}`;\n    const url = `url(#${id})`;\n    this.#cache.set(maps, url);\n    this.#cache.set(key, url);\n\n    const filter = this.#createFilter(id);\n    this.#addTransferMapConversion(tableR, tableG, tableB, filter);\n\n    return url;\n  }\n\n  addHCMFilter(fgColor, bgColor) {\n    const key = `${fgColor}-${bgColor}`;\n    if (this.#hcmKey === key) {\n      return this.#hcmUrl;\n    }\n\n    this.#hcmKey = key;\n    this.#hcmUrl = \"none\";\n    this.#hcmFilter?.remove();\n\n    if (!fgColor || !bgColor) {\n      return this.#hcmUrl;\n    }\n\n    const fgRGB = this.#getRGB(fgColor);\n    fgColor = Util.makeHexColor(...fgRGB);\n    const bgRGB = this.#getRGB(bgColor);\n    bgColor = Util.makeHexColor(...bgRGB);\n    this.#defs.style.color = \"\";\n\n    if (\n      (fgColor === \"#000000\" && bgColor === \"#ffffff\") ||\n      fgColor === bgColor\n    ) {\n      return this.#hcmUrl;\n    }\n\n    // https://developer.mozilla.org/en-US/docs/Web/Accessibility/Understanding_Colors_and_Luminance\n    //\n    // Relative luminance:\n    // https://www.w3.org/TR/WCAG20/#relativeluminancedef\n    //\n    // We compute the rounded luminance of the default background color.\n    // Then for every color in the pdf, if its rounded luminance is the\n    // same as the background one then it's replaced by the new\n    // background color else by the foreground one.\n    const map = new Array(256);\n    for (let i = 0; i <= 255; i++) {\n      const x = i / 255;\n      map[i] = x <= 0.03928 ? x / 12.92 : ((x + 0.055) / 1.055) ** 2.4;\n    }\n    const table = map.join(\",\");\n\n    const id = `g_${this.#docId}_hcm_filter`;\n    const filter = (this.#hcmHighlightFilter = this.#createFilter(id));\n    this.#addTransferMapConversion(table, table, table, filter);\n    this.#addGrayConversion(filter);\n\n    const getSteps = (c, n) => {\n      const start = fgRGB[c] / 255;\n      const end = bgRGB[c] / 255;\n      const arr = new Array(n + 1);\n      for (let i = 0; i <= n; i++) {\n        arr[i] = start + (i / n) * (end - start);\n      }\n      return arr.join(\",\");\n    };\n    this.#addTransferMapConversion(\n      getSteps(0, 5),\n      getSteps(1, 5),\n      getSteps(2, 5),\n      filter\n    );\n\n    this.#hcmUrl = `url(#${id})`;\n    return this.#hcmUrl;\n  }\n\n  addHighlightHCMFilter(fgColor, bgColor, newFgColor, newBgColor) {\n    const key = `${fgColor}-${bgColor}-${newFgColor}-${newBgColor}`;\n    if (this.#hcmHighlightKey === key) {\n      return this.#hcmHighlightUrl;\n    }\n\n    this.#hcmHighlightKey = key;\n    this.#hcmHighlightUrl = \"none\";\n    this.#hcmHighlightFilter?.remove();\n\n    if (!fgColor || !bgColor) {\n      return this.#hcmHighlightUrl;\n    }\n\n    const [fgRGB, bgRGB] = [fgColor, bgColor].map(this.#getRGB.bind(this));\n    let fgGray = Math.round(\n      0.2126 * fgRGB[0] + 0.7152 * fgRGB[1] + 0.0722 * fgRGB[2]\n    );\n    let bgGray = Math.round(\n      0.2126 * bgRGB[0] + 0.7152 * bgRGB[1] + 0.0722 * bgRGB[2]\n    );\n    let [newFgRGB, newBgRGB] = [newFgColor, newBgColor].map(\n      this.#getRGB.bind(this)\n    );\n    if (bgGray < fgGray) {\n      [fgGray, bgGray, newFgRGB, newBgRGB] = [\n        bgGray,\n        fgGray,\n        newBgRGB,\n        newFgRGB,\n      ];\n    }\n    this.#defs.style.color = \"\";\n\n    // Now we can create the filters to highlight some canvas parts.\n    // The colors in the pdf will almost be Canvas and CanvasText, hence we\n    // want to filter them to finally get Highlight and HighlightText.\n    // Since we're in HCM the background color and the foreground color should\n    // be really different when converted to grayscale (if they're not then it\n    // means that we've a poor contrast). Once the canvas colors are converted\n    // to grayscale we can easily map them on their new colors.\n    // The grayscale step is important because if we've something like:\n    //   fgColor = #FF....\n    //   bgColor = #FF....\n    //   then we are enable to map the red component on the new red components\n    //   which can be different.\n\n    const getSteps = (fg, bg, n) => {\n      const arr = new Array(256);\n      const step = (bgGray - fgGray) / n;\n      const newStart = fg / 255;\n      const newStep = (bg - fg) / (255 * n);\n      let prev = 0;\n      for (let i = 0; i <= n; i++) {\n        const k = Math.round(fgGray + i * step);\n        const value = newStart + i * newStep;\n        for (let j = prev; j <= k; j++) {\n          arr[j] = value;\n        }\n        prev = k + 1;\n      }\n      for (let i = prev; i < 256; i++) {\n        arr[i] = arr[prev - 1];\n      }\n      return arr.join(\",\");\n    };\n\n    const id = `g_${this.#docId}_hcm_highlight_filter`;\n    const filter = (this.#hcmHighlightFilter = this.#createFilter(id));\n\n    this.#addGrayConversion(filter);\n    this.#addTransferMapConversion(\n      getSteps(newFgRGB[0], newBgRGB[0], 5),\n      getSteps(newFgRGB[1], newBgRGB[1], 5),\n      getSteps(newFgRGB[2], newBgRGB[2], 5),\n      filter\n    );\n\n    this.#hcmHighlightUrl = `url(#${id})`;\n    return this.#hcmHighlightUrl;\n  }\n\n  destroy(keepHCM = false) {\n    if (keepHCM && (this.#hcmUrl || this.#hcmHighlightUrl)) {\n      return;\n    }\n    if (this.#_defs) {\n      this.#_defs.parentNode.parentNode.remove();\n      this.#_defs = null;\n    }\n    if (this.#_cache) {\n      this.#_cache.clear();\n      this.#_cache = null;\n    }\n    this.#id = 0;\n  }\n\n  #addGrayConversion(filter) {\n    const feColorMatrix = this.#document.createElementNS(\n      SVG_NS,\n      \"feColorMatrix\"\n    );\n    feColorMatrix.setAttribute(\"type\", \"matrix\");\n    feColorMatrix.setAttribute(\n      \"values\",\n      \"0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0\"\n    );\n    filter.append(feColorMatrix);\n  }\n\n  #createFilter(id) {\n    const filter = this.#document.createElementNS(SVG_NS, \"filter\");\n    filter.setAttribute(\"color-interpolation-filters\", \"sRGB\");\n    filter.setAttribute(\"id\", id);\n    this.#defs.append(filter);\n\n    return filter;\n  }\n\n  #appendFeFunc(feComponentTransfer, func, table) {\n    const feFunc = this.#document.createElementNS(SVG_NS, func);\n    feFunc.setAttribute(\"type\", \"discrete\");\n    feFunc.setAttribute(\"tableValues\", table);\n    feComponentTransfer.append(feFunc);\n  }\n\n  #addTransferMapConversion(rTable, gTable, bTable, filter) {\n    const feComponentTransfer = this.#document.createElementNS(\n      SVG_NS,\n      \"feComponentTransfer\"\n    );\n    filter.append(feComponentTransfer);\n    this.#appendFeFunc(feComponentTransfer, \"feFuncR\", rTable);\n    this.#appendFeFunc(feComponentTransfer, \"feFuncG\", gTable);\n    this.#appendFeFunc(feComponentTransfer, \"feFuncB\", bTable);\n  }\n\n  #getRGB(color) {\n    this.#defs.style.color = color;\n    return getRGB(getComputedStyle(this.#defs).getPropertyValue(\"color\"));\n  }\n}\n\nclass DOMCanvasFactory extends BaseCanvasFactory {\n  constructor({ ownerDocument = globalThis.document } = {}) {\n    super();\n    this._document = ownerDocument;\n  }\n\n  /**\n   * @ignore\n   */\n  _createCanvas(width, height) {\n    const canvas = this._document.createElement(\"canvas\");\n    canvas.width = width;\n    canvas.height = height;\n    return canvas;\n  }\n}\n\nasync function fetchData(url, type = \"text\") {\n  if (\n    (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) ||\n    isValidFetchUrl(url, document.baseURI)\n  ) {\n    const response = await fetch(url);\n    if (!response.ok) {\n      throw new Error(response.statusText);\n    }\n    switch (type) {\n      case \"arraybuffer\":\n        return response.arrayBuffer();\n      case \"blob\":\n        return response.blob();\n      case \"json\":\n        return response.json();\n    }\n    return response.text();\n  }\n\n  // The Fetch API is not supported.\n  return new Promise((resolve, reject) => {\n    const request = new XMLHttpRequest();\n    request.open(\"GET\", url, /* async = */ true);\n    request.responseType = type;\n\n    request.onreadystatechange = () => {\n      if (request.readyState !== XMLHttpRequest.DONE) {\n        return;\n      }\n      if (request.status === 200 || request.status === 0) {\n        let data;\n        switch (type) {\n          case \"arraybuffer\":\n          case \"blob\":\n          case \"json\":\n            data = request.response;\n            break;\n          default:\n            data = request.responseText;\n            break;\n        }\n        if (data) {\n          resolve(data);\n          return;\n        }\n      }\n      reject(new Error(request.statusText));\n    };\n\n    request.send(null);\n  });\n}\n\nclass DOMCMapReaderFactory extends BaseCMapReaderFactory {\n  /**\n   * @ignore\n   */\n  _fetchData(url, compressionType) {\n    return fetchData(\n      url,\n      /* type = */ this.isCompressed ? \"arraybuffer\" : \"text\"\n    ).then(data => {\n      return {\n        cMapData:\n          data instanceof ArrayBuffer\n            ? new Uint8Array(data)\n            : stringToBytes(data),\n        compressionType,\n      };\n    });\n  }\n}\n\nclass DOMStandardFontDataFactory extends BaseStandardFontDataFactory {\n  /**\n   * @ignore\n   */\n  _fetchData(url) {\n    return fetchData(url, /* type = */ \"arraybuffer\").then(data => {\n      return new Uint8Array(data);\n    });\n  }\n}\n\nclass DOMSVGFactory extends BaseSVGFactory {\n  /**\n   * @ignore\n   */\n  _createSVG(type) {\n    return document.createElementNS(SVG_NS, type);\n  }\n}\n\n/**\n * @typedef {Object} PageViewportParameters\n * @property {Array<number>} viewBox - The xMin, yMin, xMax and\n *   yMax coordinates.\n * @property {number} scale - The scale of the viewport.\n * @property {number} rotation - The rotation, in degrees, of the viewport.\n * @property {number} [offsetX] - The horizontal, i.e. x-axis, offset. The\n *   default value is `0`.\n * @property {number} [offsetY] - The vertical, i.e. y-axis, offset. The\n *   default value is `0`.\n * @property {boolean} [dontFlip] - If true, the y-axis will not be flipped.\n *   The default value is `false`.\n */\n\n/**\n * @typedef {Object} PageViewportCloneParameters\n * @property {number} [scale] - The scale, overriding the one in the cloned\n *   viewport. The default value is `this.scale`.\n * @property {number} [rotation] - The rotation, in degrees, overriding the one\n *   in the cloned viewport. The default value is `this.rotation`.\n * @property {number} [offsetX] - The horizontal, i.e. x-axis, offset.\n *   The default value is `this.offsetX`.\n * @property {number} [offsetY] - The vertical, i.e. y-axis, offset.\n *   The default value is `this.offsetY`.\n * @property {boolean} [dontFlip] - If true, the x-axis will not be flipped.\n *   The default value is `false`.\n */\n\n/**\n * PDF page viewport created based on scale, rotation and offset.\n */\nclass PageViewport {\n  /**\n   * @param {PageViewportParameters}\n   */\n  constructor({\n    viewBox,\n    scale,\n    rotation,\n    offsetX = 0,\n    offsetY = 0,\n    dontFlip = false,\n  }) {\n    this.viewBox = viewBox;\n    this.scale = scale;\n    this.rotation = rotation;\n    this.offsetX = offsetX;\n    this.offsetY = offsetY;\n\n    // creating transform to convert pdf coordinate system to the normal\n    // canvas like coordinates taking in account scale and rotation\n    const centerX = (viewBox[2] + viewBox[0]) / 2;\n    const centerY = (viewBox[3] + viewBox[1]) / 2;\n    let rotateA, rotateB, rotateC, rotateD;\n    // Normalize the rotation, by clamping it to the [0, 360) range.\n    rotation %= 360;\n    if (rotation < 0) {\n      rotation += 360;\n    }\n    switch (rotation) {\n      case 180:\n        rotateA = -1;\n        rotateB = 0;\n        rotateC = 0;\n        rotateD = 1;\n        break;\n      case 90:\n        rotateA = 0;\n        rotateB = 1;\n        rotateC = 1;\n        rotateD = 0;\n        break;\n      case 270:\n        rotateA = 0;\n        rotateB = -1;\n        rotateC = -1;\n        rotateD = 0;\n        break;\n      case 0:\n        rotateA = 1;\n        rotateB = 0;\n        rotateC = 0;\n        rotateD = -1;\n        break;\n      default:\n        throw new Error(\n          \"PageViewport: Invalid rotation, must be a multiple of 90 degrees.\"\n        );\n    }\n\n    if (dontFlip) {\n      rotateC = -rotateC;\n      rotateD = -rotateD;\n    }\n\n    let offsetCanvasX, offsetCanvasY;\n    let width, height;\n    if (rotateA === 0) {\n      offsetCanvasX = Math.abs(centerY - viewBox[1]) * scale + offsetX;\n      offsetCanvasY = Math.abs(centerX - viewBox[0]) * scale + offsetY;\n      width = (viewBox[3] - viewBox[1]) * scale;\n      height = (viewBox[2] - viewBox[0]) * scale;\n    } else {\n      offsetCanvasX = Math.abs(centerX - viewBox[0]) * scale + offsetX;\n      offsetCanvasY = Math.abs(centerY - viewBox[1]) * scale + offsetY;\n      width = (viewBox[2] - viewBox[0]) * scale;\n      height = (viewBox[3] - viewBox[1]) * scale;\n    }\n    // creating transform for the following operations:\n    // translate(-centerX, -centerY), rotate and flip vertically,\n    // scale, and translate(offsetCanvasX, offsetCanvasY)\n    this.transform = [\n      rotateA * scale,\n      rotateB * scale,\n      rotateC * scale,\n      rotateD * scale,\n      offsetCanvasX - rotateA * scale * centerX - rotateC * scale * centerY,\n      offsetCanvasY - rotateB * scale * centerX - rotateD * scale * centerY,\n    ];\n\n    this.width = width;\n    this.height = height;\n  }\n\n  /**\n   * The original, un-scaled, viewport dimensions.\n   * @type {Object}\n   */\n  get rawDims() {\n    const { viewBox } = this;\n    return shadow(this, \"rawDims\", {\n      pageWidth: viewBox[2] - viewBox[0],\n      pageHeight: viewBox[3] - viewBox[1],\n      pageX: viewBox[0],\n      pageY: viewBox[1],\n    });\n  }\n\n  /**\n   * Clones viewport, with optional additional properties.\n   * @param {PageViewportCloneParameters} [params]\n   * @returns {PageViewport} Cloned viewport.\n   */\n  clone({\n    scale = this.scale,\n    rotation = this.rotation,\n    offsetX = this.offsetX,\n    offsetY = this.offsetY,\n    dontFlip = false,\n  } = {}) {\n    return new PageViewport({\n      viewBox: this.viewBox.slice(),\n      scale,\n      rotation,\n      offsetX,\n      offsetY,\n      dontFlip,\n    });\n  }\n\n  /**\n   * Converts PDF point to the viewport coordinates. For examples, useful for\n   * converting PDF location into canvas pixel coordinates.\n   * @param {number} x - The x-coordinate.\n   * @param {number} y - The y-coordinate.\n   * @returns {Array} Array containing `x`- and `y`-coordinates of the\n   *   point in the viewport coordinate space.\n   * @see {@link convertToPdfPoint}\n   * @see {@link convertToViewportRectangle}\n   */\n  convertToViewportPoint(x, y) {\n    return Util.applyTransform([x, y], this.transform);\n  }\n\n  /**\n   * Converts PDF rectangle to the viewport coordinates.\n   * @param {Array} rect - The xMin, yMin, xMax and yMax coordinates.\n   * @returns {Array} Array containing corresponding coordinates of the\n   *   rectangle in the viewport coordinate space.\n   * @see {@link convertToViewportPoint}\n   */\n  convertToViewportRectangle(rect) {\n    const topLeft = Util.applyTransform([rect[0], rect[1]], this.transform);\n    const bottomRight = Util.applyTransform([rect[2], rect[3]], this.transform);\n    return [topLeft[0], topLeft[1], bottomRight[0], bottomRight[1]];\n  }\n\n  /**\n   * Converts viewport coordinates to the PDF location. For examples, useful\n   * for converting canvas pixel location into PDF one.\n   * @param {number} x - The x-coordinate.\n   * @param {number} y - The y-coordinate.\n   * @returns {Array} Array containing `x`- and `y`-coordinates of the\n   *   point in the PDF coordinate space.\n   * @see {@link convertToViewportPoint}\n   */\n  convertToPdfPoint(x, y) {\n    return Util.applyInverseTransform([x, y], this.transform);\n  }\n}\n\nclass RenderingCancelledException extends BaseException {\n  constructor(msg, extraDelay = 0) {\n    super(msg, \"RenderingCancelledException\");\n    this.extraDelay = extraDelay;\n  }\n}\n\nfunction isDataScheme(url) {\n  const ii = url.length;\n  let i = 0;\n  while (i < ii && url[i].trim() === \"\") {\n    i++;\n  }\n  return url.substring(i, i + 5).toLowerCase() === \"data:\";\n}\n\nfunction isPdfFile(filename) {\n  return typeof filename === \"string\" && /\\.pdf$/i.test(filename);\n}\n\n/**\n * Gets the filename from a given URL.\n * @param {string} url\n * @param {boolean} [onlyStripPath]\n * @returns {string}\n */\nfunction getFilenameFromUrl(url, onlyStripPath = false) {\n  if (!onlyStripPath) {\n    [url] = url.split(/[#?]/, 1);\n  }\n  return url.substring(url.lastIndexOf(\"/\") + 1);\n}\n\n/**\n * Returns the filename or guessed filename from the url (see issue 3455).\n * @param {string} url - The original PDF location.\n * @param {string} defaultFilename - The value returned if the filename is\n *   unknown, or the protocol is unsupported.\n * @returns {string} Guessed PDF filename.\n */\nfunction getPdfFilenameFromUrl(url, defaultFilename = \"document.pdf\") {\n  if (typeof url !== \"string\") {\n    return defaultFilename;\n  }\n  if (isDataScheme(url)) {\n    warn('getPdfFilenameFromUrl: ignore \"data:\"-URL for performance reasons.');\n    return defaultFilename;\n  }\n  const reURI = /^(?:(?:[^:]+:)?\\/\\/[^/]+)?([^?#]*)(\\?[^#]*)?(#.*)?$/;\n  //              SCHEME        HOST        1.PATH  2.QUERY   3.REF\n  // Pattern to get last matching NAME.pdf\n  const reFilename = /[^/?#=]+\\.pdf\\b(?!.*\\.pdf\\b)/i;\n  const splitURI = reURI.exec(url);\n  let suggestedFilename =\n    reFilename.exec(splitURI[1]) ||\n    reFilename.exec(splitURI[2]) ||\n    reFilename.exec(splitURI[3]);\n  if (suggestedFilename) {\n    suggestedFilename = suggestedFilename[0];\n    if (suggestedFilename.includes(\"%\")) {\n      // URL-encoded %2Fpath%2Fto%2Ffile.pdf should be file.pdf\n      try {\n        suggestedFilename = reFilename.exec(\n          decodeURIComponent(suggestedFilename)\n        )[0];\n      } catch {\n        // Possible (extremely rare) errors:\n        // URIError \"Malformed URI\", e.g. for \"%AA.pdf\"\n        // TypeError \"null has no properties\", e.g. for \"%2F.pdf\"\n      }\n    }\n  }\n  return suggestedFilename || defaultFilename;\n}\n\nclass StatTimer {\n  started = Object.create(null);\n\n  times = [];\n\n  time(name) {\n    if (name in this.started) {\n      warn(`Timer is already running for ${name}`);\n    }\n    this.started[name] = Date.now();\n  }\n\n  timeEnd(name) {\n    if (!(name in this.started)) {\n      warn(`Timer has not been started for ${name}`);\n    }\n    this.times.push({\n      name,\n      start: this.started[name],\n      end: Date.now(),\n    });\n    // Remove timer from started so it can be called again.\n    delete this.started[name];\n  }\n\n  toString() {\n    // Find the longest name for padding purposes.\n    const outBuf = [];\n    let longest = 0;\n    for (const { name } of this.times) {\n      longest = Math.max(name.length, longest);\n    }\n    for (const { name, start, end } of this.times) {\n      outBuf.push(`${name.padEnd(longest)} ${end - start}ms\\n`);\n    }\n    return outBuf.join(\"\");\n  }\n}\n\nfunction isValidFetchUrl(url, baseUrl) {\n  if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n    throw new Error(\"Not implemented: isValidFetchUrl\");\n  }\n  try {\n    const { protocol } = baseUrl ? new URL(url, baseUrl) : new URL(url);\n    // The Fetch API only supports the http/https protocols, and not file/ftp.\n    return protocol === \"http:\" || protocol === \"https:\";\n  } catch {\n    return false; // `new URL()` will throw on incorrect data.\n  }\n}\n\n/**\n * Event handler to suppress context menu.\n */\nfunction noContextMenu(e) {\n  e.preventDefault();\n}\n\n// Deprecated API function -- display regardless of the `verbosity` setting.\nfunction deprecated(details) {\n  console.log(\"Deprecated API usage: \" + details);\n}\n\nlet pdfDateStringRegex;\n\nclass PDFDateString {\n  /**\n   * Convert a PDF date string to a JavaScript `Date` object.\n   *\n   * The PDF date string format is described in section 7.9.4 of the official\n   * PDF 32000-1:2008 specification. However, in the PDF 1.7 reference (sixth\n   * edition) Adobe describes the same format including a trailing apostrophe.\n   * This syntax in incorrect, but Adobe Acrobat creates PDF files that contain\n   * them. We ignore all apostrophes as they are not necessary for date parsing.\n   *\n   * Moreover, Adobe Acrobat doesn't handle changing the date to universal time\n   * and doesn't use the user's time zone (effectively ignoring the HH' and mm'\n   * parts of the date string).\n   *\n   * @param {string} input\n   * @returns {Date|null}\n   */\n  static toDateObject(input) {\n    if (!input || typeof input !== \"string\") {\n      return null;\n    }\n\n    // Lazily initialize the regular expression.\n    pdfDateStringRegex ||= new RegExp(\n      \"^D:\" + // Prefix (required)\n        \"(\\\\d{4})\" + // Year (required)\n        \"(\\\\d{2})?\" + // Month (optional)\n        \"(\\\\d{2})?\" + // Day (optional)\n        \"(\\\\d{2})?\" + // Hour (optional)\n        \"(\\\\d{2})?\" + // Minute (optional)\n        \"(\\\\d{2})?\" + // Second (optional)\n        \"([Z|+|-])?\" + // Universal time relation (optional)\n        \"(\\\\d{2})?\" + // Offset hour (optional)\n        \"'?\" + // Splitting apostrophe (optional)\n        \"(\\\\d{2})?\" + // Offset minute (optional)\n        \"'?\" // Trailing apostrophe (optional)\n    );\n\n    // Optional fields that don't satisfy the requirements from the regular\n    // expression (such as incorrect digit counts or numbers that are out of\n    // range) will fall back the defaults from the specification.\n    const matches = pdfDateStringRegex.exec(input);\n    if (!matches) {\n      return null;\n    }\n\n    // JavaScript's `Date` object expects the month to be between 0 and 11\n    // instead of 1 and 12, so we have to correct for that.\n    const year = parseInt(matches[1], 10);\n    let month = parseInt(matches[2], 10);\n    month = month >= 1 && month <= 12 ? month - 1 : 0;\n    let day = parseInt(matches[3], 10);\n    day = day >= 1 && day <= 31 ? day : 1;\n    let hour = parseInt(matches[4], 10);\n    hour = hour >= 0 && hour <= 23 ? hour : 0;\n    let minute = parseInt(matches[5], 10);\n    minute = minute >= 0 && minute <= 59 ? minute : 0;\n    let second = parseInt(matches[6], 10);\n    second = second >= 0 && second <= 59 ? second : 0;\n    const universalTimeRelation = matches[7] || \"Z\";\n    let offsetHour = parseInt(matches[8], 10);\n    offsetHour = offsetHour >= 0 && offsetHour <= 23 ? offsetHour : 0;\n    let offsetMinute = parseInt(matches[9], 10) || 0;\n    offsetMinute = offsetMinute >= 0 && offsetMinute <= 59 ? offsetMinute : 0;\n\n    // Universal time relation 'Z' means that the local time is equal to the\n    // universal time, whereas the relations '+'/'-' indicate that the local\n    // time is later respectively earlier than the universal time. Every date\n    // is normalized to universal time.\n    if (universalTimeRelation === \"-\") {\n      hour += offsetHour;\n      minute += offsetMinute;\n    } else if (universalTimeRelation === \"+\") {\n      hour -= offsetHour;\n      minute -= offsetMinute;\n    }\n\n    return new Date(Date.UTC(year, month, day, hour, minute, second));\n  }\n}\n\n/**\n * NOTE: This is (mostly) intended to support printing of XFA forms.\n */\nfunction getXfaPageViewport(xfaPage, { scale = 1, rotation = 0 }) {\n  const { width, height } = xfaPage.attributes.style;\n  const viewBox = [0, 0, parseInt(width), parseInt(height)];\n\n  return new PageViewport({\n    viewBox,\n    scale,\n    rotation,\n  });\n}\n\nfunction getRGB(color) {\n  if (color.startsWith(\"#\")) {\n    const colorRGB = parseInt(color.slice(1), 16);\n    return [\n      (colorRGB & 0xff0000) >> 16,\n      (colorRGB & 0x00ff00) >> 8,\n      colorRGB & 0x0000ff,\n    ];\n  }\n\n  if (color.startsWith(\"rgb(\")) {\n    // getComputedStyle(...).color returns a `rgb(R, G, B)` color.\n    return color\n      .slice(/* \"rgb(\".length */ 4, -1) // Strip out \"rgb(\" and \")\".\n      .split(\",\")\n      .map(x => parseInt(x));\n  }\n\n  if (color.startsWith(\"rgba(\")) {\n    return color\n      .slice(/* \"rgba(\".length */ 5, -1) // Strip out \"rgba(\" and \")\".\n      .split(\",\")\n      .map(x => parseInt(x))\n      .slice(0, 3);\n  }\n\n  warn(`Not a valid color format: \"${color}\"`);\n  return [0, 0, 0];\n}\n\nfunction getColorValues(colors) {\n  const span = document.createElement(\"span\");\n  span.style.visibility = \"hidden\";\n  document.body.append(span);\n  for (const name of colors.keys()) {\n    span.style.color = name;\n    const computedColor = window.getComputedStyle(span).color;\n    colors.set(name, getRGB(computedColor));\n  }\n  span.remove();\n}\n\nfunction getCurrentTransform(ctx) {\n  const { a, b, c, d, e, f } = ctx.getTransform();\n  return [a, b, c, d, e, f];\n}\n\nfunction getCurrentTransformInverse(ctx) {\n  const { a, b, c, d, e, f } = ctx.getTransform().invertSelf();\n  return [a, b, c, d, e, f];\n}\n\n/**\n * @param {HTMLDivElement} div\n * @param {PageViewport} viewport\n * @param {boolean} mustFlip\n * @param {boolean} mustRotate\n */\nfunction setLayerDimensions(\n  div,\n  viewport,\n  mustFlip = false,\n  mustRotate = true\n) {\n  if (viewport instanceof PageViewport) {\n    const { pageWidth, pageHeight } = viewport.rawDims;\n    const { style } = div;\n    const useRound = FeatureTest.isCSSRoundSupported;\n\n    const w = `var(--scale-factor) * ${pageWidth}px`,\n      h = `var(--scale-factor) * ${pageHeight}px`;\n    const widthStr = useRound ? `round(${w}, 1px)` : `calc(${w})`,\n      heightStr = useRound ? `round(${h}, 1px)` : `calc(${h})`;\n\n    if (!mustFlip || viewport.rotation % 180 === 0) {\n      style.width = widthStr;\n      style.height = heightStr;\n    } else {\n      style.width = heightStr;\n      style.height = widthStr;\n    }\n  }\n\n  if (mustRotate) {\n    div.setAttribute(\"data-main-rotation\", viewport.rotation);\n  }\n}\n\nexport {\n  deprecated,\n  DOMCanvasFactory,\n  DOMCMapReaderFactory,\n  DOMFilterFactory,\n  DOMStandardFontDataFactory,\n  DOMSVGFactory,\n  fetchData,\n  getColorValues,\n  getCurrentTransform,\n  getCurrentTransformInverse,\n  getFilenameFromUrl,\n  getPdfFilenameFromUrl,\n  getRGB,\n  getXfaPageViewport,\n  isDataScheme,\n  isPdfFile,\n  isValidFetchUrl,\n  noContextMenu,\n  PageViewport,\n  PDFDateString,\n  PixelsPerInch,\n  RenderingCancelledException,\n  setLayerDimensions,\n  StatTimer,\n};\n", "/* Copyright 2023 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DOMSVGFactory } from \"./display_utils.js\";\nimport { shadow } from \"../shared/util.js\";\n\n/**\n * Manage the SVGs drawn on top of the page canvas.\n * It's important to have them directly on top of the canvas because we want to\n * be able to use mix-blend-mode for some of them.\n */\nclass DrawLayer {\n  #parent = null;\n\n  #id = 0;\n\n  #mapping = new Map();\n\n  constructor({ pageIndex }) {\n    this.pageIndex = pageIndex;\n  }\n\n  setParent(parent) {\n    if (!this.#parent) {\n      this.#parent = parent;\n      return;\n    }\n\n    if (this.#parent !== parent) {\n      if (this.#mapping.size > 0) {\n        for (const root of this.#mapping.values()) {\n          root.remove();\n          parent.append(root);\n        }\n      }\n      this.#parent = parent;\n    }\n  }\n\n  static get _svgFactory() {\n    return shadow(this, \"_svgFactory\", new DOMSVGFactory());\n  }\n\n  static #setBox(element, { x, y, width, height }) {\n    const { style } = element;\n    style.top = `${100 * y}%`;\n    style.left = `${100 * x}%`;\n    style.width = `${100 * width}%`;\n    style.height = `${100 * height}%`;\n  }\n\n  #createSVG(box) {\n    const svg = DrawLayer._svgFactory.create(1, 1, /* skipDimensions = */ true);\n    this.#parent.append(svg);\n    DrawLayer.#setBox(svg, box);\n\n    return svg;\n  }\n\n  highlight({ outlines, box }, color, opacity) {\n    const id = this.#id++;\n    const root = this.#createSVG(box);\n    root.classList.add(\"highlight\");\n    const defs = DrawLayer._svgFactory.createElement(\"defs\");\n    root.append(defs);\n    const path = DrawLayer._svgFactory.createElement(\"path\");\n    defs.append(path);\n    const pathId = `path_p${this.pageIndex}_${id}`;\n    path.setAttribute(\"id\", pathId);\n    path.setAttribute(\n      \"d\",\n      DrawLayer.#extractPathFromHighlightOutlines(outlines)\n    );\n\n    // Create the clipping path for the editor div.\n    const clipPath = DrawLayer._svgFactory.createElement(\"clipPath\");\n    defs.append(clipPath);\n    const clipPathId = `clip_${pathId}`;\n    clipPath.setAttribute(\"id\", clipPathId);\n    clipPath.setAttribute(\"clipPathUnits\", \"objectBoundingBox\");\n    const clipPathUse = DrawLayer._svgFactory.createElement(\"use\");\n    clipPath.append(clipPathUse);\n    clipPathUse.setAttribute(\"href\", `#${pathId}`);\n    clipPathUse.classList.add(\"clip\");\n\n    const use = DrawLayer._svgFactory.createElement(\"use\");\n    root.append(use);\n    root.setAttribute(\"fill\", color);\n    root.setAttribute(\"fill-opacity\", opacity);\n    use.setAttribute(\"href\", `#${pathId}`);\n\n    this.#mapping.set(id, root);\n\n    return { id, clipPathId: `url(#${clipPathId})` };\n  }\n\n  highlightOutline({ outlines, box }) {\n    // We cannot draw the outline directly in the SVG for highlights because\n    // it composes with its parent with mix-blend-mode: multiply.\n    // But the outline has a different mix-blend-mode, so we need to draw it in\n    // its own SVG.\n    const id = this.#id++;\n    const root = this.#createSVG(box);\n    root.classList.add(\"highlightOutline\");\n    const defs = DrawLayer._svgFactory.createElement(\"defs\");\n    root.append(defs);\n    const path = DrawLayer._svgFactory.createElement(\"path\");\n    defs.append(path);\n    const pathId = `path_p${this.pageIndex}_${id}`;\n    path.setAttribute(\"id\", pathId);\n    path.setAttribute(\n      \"d\",\n      DrawLayer.#extractPathFromHighlightOutlines(outlines)\n    );\n    path.setAttribute(\"vector-effect\", \"non-scaling-stroke\");\n\n    const use1 = DrawLayer._svgFactory.createElement(\"use\");\n    root.append(use1);\n    use1.setAttribute(\"href\", `#${pathId}`);\n    const use2 = use1.cloneNode();\n    root.append(use2);\n    use1.classList.add(\"mainOutline\");\n    use2.classList.add(\"secondaryOutline\");\n\n    this.#mapping.set(id, root);\n\n    return id;\n  }\n\n  static #extractPathFromHighlightOutlines(polygons) {\n    const buffer = [];\n    for (const polygon of polygons) {\n      let [prevX, prevY] = polygon;\n      buffer.push(`M${prevX} ${prevY}`);\n      for (let i = 2; i < polygon.length; i += 2) {\n        const x = polygon[i];\n        const y = polygon[i + 1];\n        if (x === prevX) {\n          buffer.push(`V${y}`);\n          prevY = y;\n        } else if (y === prevY) {\n          buffer.push(`H${x}`);\n          prevX = x;\n        }\n      }\n      buffer.push(\"Z\");\n    }\n    return buffer.join(\" \");\n  }\n\n  updateBox(id, box) {\n    DrawLayer.#setBox(this.#mapping.get(id), box);\n  }\n\n  rotate(id, angle) {\n    this.#mapping.get(id).setAttribute(\"data-main-rotation\", angle);\n  }\n\n  changeColor(id, color) {\n    this.#mapping.get(id).setAttribute(\"fill\", color);\n  }\n\n  changeOpacity(id, opacity) {\n    this.#mapping.get(id).setAttribute(\"fill-opacity\", opacity);\n  }\n\n  addClass(id, className) {\n    this.#mapping.get(id).classList.add(className);\n  }\n\n  removeClass(id, className) {\n    this.#mapping.get(id).classList.remove(className);\n  }\n\n  remove(id) {\n    if (this.#parent === null) {\n      return;\n    }\n    this.#mapping.get(id).remove();\n    this.#mapping.delete(id);\n  }\n\n  destroy() {\n    this.#parent = null;\n    for (const root of this.#mapping.values()) {\n      root.remove();\n    }\n    this.#mapping.clear();\n  }\n}\n\nexport { DrawLayer };\n", "/* Copyright 2022 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// eslint-disable-next-line max-len\n/** @typedef {import(\"./annotation_editor_layer.js\").AnnotationEditorLayer} AnnotationEditorLayer */\n\nimport {\n  AnnotationEditorParamsType,\n  AnnotationEditorType,\n  assert,\n  LINE_FACTOR,\n  shadow,\n  Util,\n} from \"../../shared/util.js\";\nimport {\n  AnnotationEditorUIManager,\n  bindEvents,\n  KeyboardManager,\n} from \"./tools.js\";\nimport { AnnotationEditor } from \"./editor.js\";\nimport { FreeTextAnnotationElement } from \"../annotation_layer.js\";\n\n/**\n * Basic text editor in order to create a FreeTex annotation.\n */\nclass FreeTextEditor extends AnnotationEditor {\n  #boundEditorDivBlur = this.editorDivBlur.bind(this);\n\n  #boundEditorDivFocus = this.editorDivFocus.bind(this);\n\n  #boundEditorDivInput = this.editorDivInput.bind(this);\n\n  #boundEditorDivKeydown = this.editorDivKeydown.bind(this);\n\n  #color;\n\n  #content = \"\";\n\n  #editorDivId = `${this.id}-editor`;\n\n  #fontSize;\n\n  #initialData = null;\n\n  static _freeTextDefaultContent = \"\";\n\n  static _internalPadding = 0;\n\n  static _defaultColor = null;\n\n  static _defaultFontSize = 10;\n\n  static get _keyboardManager() {\n    const proto = FreeTextEditor.prototype;\n\n    const arrowChecker = self => self.isEmpty();\n\n    const small = AnnotationEditorUIManager.TRANSLATE_SMALL;\n    const big = AnnotationEditorUIManager.TRANSLATE_BIG;\n\n    return shadow(\n      this,\n      \"_keyboardManager\",\n      new KeyboardManager([\n        [\n          // Commit the text in case the user use ctrl+s to save the document.\n          // The event must bubble in order to be caught by the viewer.\n          // See bug 1831574.\n          [\"ctrl+s\", \"mac+meta+s\", \"ctrl+p\", \"mac+meta+p\"],\n          proto.commitOrRemove,\n          { bubbles: true },\n        ],\n        [\n          [\"ctrl+Enter\", \"mac+meta+Enter\", \"Escape\", \"mac+Escape\"],\n          proto.commitOrRemove,\n        ],\n        [\n          [\"ArrowLeft\", \"mac+ArrowLeft\"],\n          proto._translateEmpty,\n          { args: [-small, 0], checker: arrowChecker },\n        ],\n        [\n          [\"ctrl+ArrowLeft\", \"mac+shift+ArrowLeft\"],\n          proto._translateEmpty,\n          { args: [-big, 0], checker: arrowChecker },\n        ],\n        [\n          [\"ArrowRight\", \"mac+ArrowRight\"],\n          proto._translateEmpty,\n          { args: [small, 0], checker: arrowChecker },\n        ],\n        [\n          [\"ctrl+ArrowRight\", \"mac+shift+ArrowRight\"],\n          proto._translateEmpty,\n          { args: [big, 0], checker: arrowChecker },\n        ],\n        [\n          [\"ArrowUp\", \"mac+ArrowUp\"],\n          proto._translateEmpty,\n          { args: [0, -small], checker: arrowChecker },\n        ],\n        [\n          [\"ctrl+ArrowUp\", \"mac+shift+ArrowUp\"],\n          proto._translateEmpty,\n          { args: [0, -big], checker: arrowChecker },\n        ],\n        [\n          [\"ArrowDown\", \"mac+ArrowDown\"],\n          proto._translateEmpty,\n          { args: [0, small], checker: arrowChecker },\n        ],\n        [\n          [\"ctrl+ArrowDown\", \"mac+shift+ArrowDown\"],\n          proto._translateEmpty,\n          { args: [0, big], checker: arrowChecker },\n        ],\n      ])\n    );\n  }\n\n  static _type = \"freetext\";\n\n  static _editorType = AnnotationEditorType.FREETEXT;\n\n  constructor(params) {\n    super({ ...params, name: \"freeTextEditor\" });\n    this.#color =\n      params.color ||\n      FreeTextEditor._defaultColor ||\n      AnnotationEditor._defaultLineColor;\n    this.#fontSize = params.fontSize || FreeTextEditor._defaultFontSize;\n  }\n\n  /** @inheritdoc */\n  static initialize(l10n) {\n    AnnotationEditor.initialize(l10n, {\n      strings: [\"pdfjs-free-text-default-content\"],\n    });\n    const style = getComputedStyle(document.documentElement);\n\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      const lineHeight = parseFloat(\n        style.getPropertyValue(\"--freetext-line-height\")\n      );\n      assert(\n        lineHeight === LINE_FACTOR,\n        \"Update the CSS variable to agree with the constant.\"\n      );\n    }\n\n    this._internalPadding = parseFloat(\n      style.getPropertyValue(\"--freetext-padding\")\n    );\n  }\n\n  /** @inheritdoc */\n  static updateDefaultParams(type, value) {\n    switch (type) {\n      case AnnotationEditorParamsType.FREETEXT_SIZE:\n        FreeTextEditor._defaultFontSize = value;\n        break;\n      case AnnotationEditorParamsType.FREETEXT_COLOR:\n        FreeTextEditor._defaultColor = value;\n        break;\n    }\n  }\n\n  /** @inheritdoc */\n  updateParams(type, value) {\n    switch (type) {\n      case AnnotationEditorParamsType.FREETEXT_SIZE:\n        this.#updateFontSize(value);\n        break;\n      case AnnotationEditorParamsType.FREETEXT_COLOR:\n        this.#updateColor(value);\n        break;\n    }\n  }\n\n  /** @inheritdoc */\n  static get defaultPropertiesToUpdate() {\n    return [\n      [\n        AnnotationEditorParamsType.FREETEXT_SIZE,\n        FreeTextEditor._defaultFontSize,\n      ],\n      [\n        AnnotationEditorParamsType.FREETEXT_COLOR,\n        FreeTextEditor._defaultColor || AnnotationEditor._defaultLineColor,\n      ],\n    ];\n  }\n\n  /** @inheritdoc */\n  get propertiesToUpdate() {\n    return [\n      [AnnotationEditorParamsType.FREETEXT_SIZE, this.#fontSize],\n      [AnnotationEditorParamsType.FREETEXT_COLOR, this.#color],\n    ];\n  }\n\n  /**\n   * Update the font size and make this action as undoable.\n   * @param {number} fontSize\n   */\n  #updateFontSize(fontSize) {\n    const setFontsize = size => {\n      this.editorDiv.style.fontSize = `calc(${size}px * var(--scale-factor))`;\n      this.translate(0, -(size - this.#fontSize) * this.parentScale);\n      this.#fontSize = size;\n      this.#setEditorDimensions();\n    };\n    const savedFontsize = this.#fontSize;\n    this.addCommands({\n      cmd: () => {\n        setFontsize(fontSize);\n      },\n      undo: () => {\n        setFontsize(savedFontsize);\n      },\n      mustExec: true,\n      type: AnnotationEditorParamsType.FREETEXT_SIZE,\n      overwriteIfSameType: true,\n      keepUndo: true,\n    });\n  }\n\n  /**\n   * Update the color and make this action undoable.\n   * @param {string} color\n   */\n  #updateColor(color) {\n    const savedColor = this.#color;\n    this.addCommands({\n      cmd: () => {\n        this.#color = this.editorDiv.style.color = color;\n      },\n      undo: () => {\n        this.#color = this.editorDiv.style.color = savedColor;\n      },\n      mustExec: true,\n      type: AnnotationEditorParamsType.FREETEXT_COLOR,\n      overwriteIfSameType: true,\n      keepUndo: true,\n    });\n  }\n\n  /**\n   * Helper to translate the editor with the keyboard when it's empty.\n   * @param {number} x in page units.\n   * @param {number} y in page units.\n   */\n  _translateEmpty(x, y) {\n    this._uiManager.translateSelectedEditors(x, y, /* noCommit = */ true);\n  }\n\n  /** @inheritdoc */\n  getInitialTranslation() {\n    // The start of the base line is where the user clicked.\n    const scale = this.parentScale;\n    return [\n      -FreeTextEditor._internalPadding * scale,\n      -(FreeTextEditor._internalPadding + this.#fontSize) * scale,\n    ];\n  }\n\n  /** @inheritdoc */\n  rebuild() {\n    if (!this.parent) {\n      return;\n    }\n    super.rebuild();\n    if (this.div === null) {\n      return;\n    }\n\n    if (!this.isAttachedToDOM) {\n      // At some point this editor was removed and we're rebuilting it,\n      // hence we must add it to its parent.\n      this.parent.add(this);\n    }\n  }\n\n  /** @inheritdoc */\n  enableEditMode() {\n    if (this.isInEditMode()) {\n      return;\n    }\n\n    this.parent.setEditingState(false);\n    this.parent.updateToolbar(AnnotationEditorType.FREETEXT);\n    super.enableEditMode();\n    this.overlayDiv.classList.remove(\"enabled\");\n    this.editorDiv.contentEditable = true;\n    this._isDraggable = false;\n    this.div.removeAttribute(\"aria-activedescendant\");\n    this.editorDiv.addEventListener(\"keydown\", this.#boundEditorDivKeydown);\n    this.editorDiv.addEventListener(\"focus\", this.#boundEditorDivFocus);\n    this.editorDiv.addEventListener(\"blur\", this.#boundEditorDivBlur);\n    this.editorDiv.addEventListener(\"input\", this.#boundEditorDivInput);\n  }\n\n  /** @inheritdoc */\n  disableEditMode() {\n    if (!this.isInEditMode()) {\n      return;\n    }\n\n    this.parent.setEditingState(true);\n    super.disableEditMode();\n    this.overlayDiv.classList.add(\"enabled\");\n    this.editorDiv.contentEditable = false;\n    this.div.setAttribute(\"aria-activedescendant\", this.#editorDivId);\n    this._isDraggable = true;\n    this.editorDiv.removeEventListener(\"keydown\", this.#boundEditorDivKeydown);\n    this.editorDiv.removeEventListener(\"focus\", this.#boundEditorDivFocus);\n    this.editorDiv.removeEventListener(\"blur\", this.#boundEditorDivBlur);\n    this.editorDiv.removeEventListener(\"input\", this.#boundEditorDivInput);\n\n    // On Chrome, the focus is given to <body> when contentEditable is set to\n    // false, hence we focus the div.\n    this.div.focus({\n      preventScroll: true /* See issue #15744 */,\n    });\n\n    // In case the blur callback hasn't been called.\n    this.isEditing = false;\n    this.parent.div.classList.add(\"freetextEditing\");\n  }\n\n  /** @inheritdoc */\n  focusin(event) {\n    if (!this._focusEventsAllowed) {\n      return;\n    }\n    super.focusin(event);\n    if (event.target !== this.editorDiv) {\n      this.editorDiv.focus();\n    }\n  }\n\n  /** @inheritdoc */\n  onceAdded() {\n    if (this.width) {\n      this.#cheatInitialRect();\n      // The editor was created in using ctrl+c.\n      return;\n    }\n    this.enableEditMode();\n    this.editorDiv.focus();\n    if (this._initialOptions?.isCentered) {\n      this.center();\n    }\n    this._initialOptions = null;\n  }\n\n  /** @inheritdoc */\n  isEmpty() {\n    return !this.editorDiv || this.editorDiv.innerText.trim() === \"\";\n  }\n\n  /** @inheritdoc */\n  remove() {\n    this.isEditing = false;\n    if (this.parent) {\n      this.parent.setEditingState(true);\n      this.parent.div.classList.add(\"freetextEditing\");\n    }\n    super.remove();\n  }\n\n  /**\n   * Extract the text from this editor.\n   * @returns {string}\n   */\n  #extractText() {\n    const divs = this.editorDiv.getElementsByTagName(\"div\");\n    if (divs.length === 0) {\n      return this.editorDiv.innerText;\n    }\n    const buffer = [];\n    for (const div of divs) {\n      buffer.push(div.innerText.replace(/\\r\\n?|\\n/, \"\"));\n    }\n    return buffer.join(\"\\n\");\n  }\n\n  #setEditorDimensions() {\n    const [parentWidth, parentHeight] = this.parentDimensions;\n\n    let rect;\n    if (this.isAttachedToDOM) {\n      rect = this.div.getBoundingClientRect();\n    } else {\n      // This editor isn't on screen but we need to get its dimensions, so\n      // we just insert it in the DOM, get its bounding box and then remove it.\n      const { currentLayer, div } = this;\n      const savedDisplay = div.style.display;\n      div.style.display = \"hidden\";\n      currentLayer.div.append(this.div);\n      rect = div.getBoundingClientRect();\n      div.remove();\n      div.style.display = savedDisplay;\n    }\n\n    // The dimensions are relative to the rotation of the page, hence we need to\n    // take that into account (see issue #16636).\n    if (this.rotation % 180 === this.parentRotation % 180) {\n      this.width = rect.width / parentWidth;\n      this.height = rect.height / parentHeight;\n    } else {\n      this.width = rect.height / parentWidth;\n      this.height = rect.width / parentHeight;\n    }\n    this.fixAndSetPosition();\n  }\n\n  /**\n   * Commit the content we have in this editor.\n   * @returns {undefined}\n   */\n  commit() {\n    if (!this.isInEditMode()) {\n      return;\n    }\n\n    super.commit();\n    this.disableEditMode();\n    const savedText = this.#content;\n    const newText = (this.#content = this.#extractText().trimEnd());\n    if (savedText === newText) {\n      return;\n    }\n\n    const setText = text => {\n      this.#content = text;\n      if (!text) {\n        this.remove();\n        return;\n      }\n      this.#setContent();\n      this._uiManager.rebuild(this);\n      this.#setEditorDimensions();\n    };\n    this.addCommands({\n      cmd: () => {\n        setText(newText);\n      },\n      undo: () => {\n        setText(savedText);\n      },\n      mustExec: false,\n    });\n    this.#setEditorDimensions();\n  }\n\n  /** @inheritdoc */\n  shouldGetKeyboardEvents() {\n    return this.isInEditMode();\n  }\n\n  /** @inheritdoc */\n  enterInEditMode() {\n    this.enableEditMode();\n    this.editorDiv.focus();\n  }\n\n  /**\n   * ondblclick callback.\n   * @param {MouseEvent} event\n   */\n  dblclick(event) {\n    this.enterInEditMode();\n  }\n\n  /**\n   * onkeydown callback.\n   * @param {KeyboardEvent} event\n   */\n  keydown(event) {\n    if (event.target === this.div && event.key === \"Enter\") {\n      this.enterInEditMode();\n      // Avoid to add an unwanted new line.\n      event.preventDefault();\n    }\n  }\n\n  editorDivKeydown(event) {\n    FreeTextEditor._keyboardManager.exec(this, event);\n  }\n\n  editorDivFocus(event) {\n    this.isEditing = true;\n  }\n\n  editorDivBlur(event) {\n    this.isEditing = false;\n  }\n\n  editorDivInput(event) {\n    this.parent.div.classList.toggle(\"freetextEditing\", this.isEmpty());\n  }\n\n  /** @inheritdoc */\n  disableEditing() {\n    this.editorDiv.setAttribute(\"role\", \"comment\");\n    this.editorDiv.removeAttribute(\"aria-multiline\");\n  }\n\n  /** @inheritdoc */\n  enableEditing() {\n    this.editorDiv.setAttribute(\"role\", \"textbox\");\n    this.editorDiv.setAttribute(\"aria-multiline\", true);\n  }\n\n  /** @inheritdoc */\n  render() {\n    if (this.div) {\n      return this.div;\n    }\n\n    let baseX, baseY;\n    if (this.width) {\n      baseX = this.x;\n      baseY = this.y;\n    }\n\n    super.render();\n    this.editorDiv = document.createElement(\"div\");\n    this.editorDiv.className = \"internal\";\n\n    this.editorDiv.setAttribute(\"id\", this.#editorDivId);\n    this.editorDiv.setAttribute(\"data-l10n-id\", \"pdfjs-free-text\");\n    this.enableEditing();\n\n    AnnotationEditor._l10nPromise\n      .get(\"pdfjs-free-text-default-content\")\n      .then(msg => this.editorDiv?.setAttribute(\"default-content\", msg));\n    this.editorDiv.contentEditable = true;\n\n    const { style } = this.editorDiv;\n    style.fontSize = `calc(${this.#fontSize}px * var(--scale-factor))`;\n    style.color = this.#color;\n\n    this.div.append(this.editorDiv);\n\n    this.overlayDiv = document.createElement(\"div\");\n    this.overlayDiv.classList.add(\"overlay\", \"enabled\");\n    this.div.append(this.overlayDiv);\n\n    // TODO: implement paste callback.\n    // The goal is to sanitize and have something suitable for this\n    // editor.\n    bindEvents(this, this.div, [\"dblclick\", \"keydown\"]);\n\n    if (this.width) {\n      // This editor was created in using copy (ctrl+c).\n      const [parentWidth, parentHeight] = this.parentDimensions;\n      if (this.annotationElementId) {\n        // This stuff is hard to test: if something is changed here, please\n        // test with the following PDF file:\n        //  - freetexts.pdf\n        //  - rotated_freetexts.pdf\n        // Only small variations between the original annotation and its editor\n        // are allowed.\n\n        // position is the position of the first glyph in the annotation\n        // and it's relative to its container.\n        const { position } = this.#initialData;\n        let [tx, ty] = this.getInitialTranslation();\n        [tx, ty] = this.pageTranslationToScreen(tx, ty);\n        const [pageWidth, pageHeight] = this.pageDimensions;\n        const [pageX, pageY] = this.pageTranslation;\n        let posX, posY;\n        switch (this.rotation) {\n          case 0:\n            posX = baseX + (position[0] - pageX) / pageWidth;\n            posY = baseY + this.height - (position[1] - pageY) / pageHeight;\n            break;\n          case 90:\n            posX = baseX + (position[0] - pageX) / pageWidth;\n            posY = baseY - (position[1] - pageY) / pageHeight;\n            [tx, ty] = [ty, -tx];\n            break;\n          case 180:\n            posX = baseX - this.width + (position[0] - pageX) / pageWidth;\n            posY = baseY - (position[1] - pageY) / pageHeight;\n            [tx, ty] = [-tx, -ty];\n            break;\n          case 270:\n            posX =\n              baseX +\n              (position[0] - pageX - this.height * pageHeight) / pageWidth;\n            posY =\n              baseY +\n              (position[1] - pageY - this.width * pageWidth) / pageHeight;\n            [tx, ty] = [-ty, tx];\n            break;\n        }\n        this.setAt(posX * parentWidth, posY * parentHeight, tx, ty);\n      } else {\n        this.setAt(\n          baseX * parentWidth,\n          baseY * parentHeight,\n          this.width * parentWidth,\n          this.height * parentHeight\n        );\n      }\n\n      this.#setContent();\n      this._isDraggable = true;\n      this.editorDiv.contentEditable = false;\n    } else {\n      this._isDraggable = false;\n      this.editorDiv.contentEditable = true;\n    }\n\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")) {\n      this.div.setAttribute(\"annotation-id\", this.annotationElementId);\n    }\n\n    return this.div;\n  }\n\n  #setContent() {\n    this.editorDiv.replaceChildren();\n    if (!this.#content) {\n      return;\n    }\n    for (const line of this.#content.split(\"\\n\")) {\n      const div = document.createElement(\"div\");\n      div.append(\n        line ? document.createTextNode(line) : document.createElement(\"br\")\n      );\n      this.editorDiv.append(div);\n    }\n  }\n\n  /** @inheritdoc */\n  get contentDiv() {\n    return this.editorDiv;\n  }\n\n  /** @inheritdoc */\n  static deserialize(data, parent, uiManager) {\n    let initialData = null;\n    if (data instanceof FreeTextAnnotationElement) {\n      const {\n        data: {\n          defaultAppearanceData: { fontSize, fontColor },\n          rect,\n          rotation,\n          id,\n        },\n        textContent,\n        textPosition,\n        parent: {\n          page: { pageNumber },\n        },\n      } = data;\n      // textContent is supposed to be an array of strings containing each line\n      // of text. However, it can be null or empty.\n      if (!textContent || textContent.length === 0) {\n        // Empty annotation.\n        return null;\n      }\n      initialData = data = {\n        annotationType: AnnotationEditorType.FREETEXT,\n        color: Array.from(fontColor),\n        fontSize,\n        value: textContent.join(\"\\n\"),\n        position: textPosition,\n        pageIndex: pageNumber - 1,\n        rect,\n        rotation,\n        id,\n        deleted: false,\n      };\n    }\n    const editor = super.deserialize(data, parent, uiManager);\n\n    editor.#fontSize = data.fontSize;\n    editor.#color = Util.makeHexColor(...data.color);\n    editor.#content = data.value;\n    editor.annotationElementId = data.id || null;\n    editor.#initialData = initialData;\n\n    return editor;\n  }\n\n  /** @inheritdoc */\n  serialize(isForCopying = false) {\n    if (this.isEmpty()) {\n      return null;\n    }\n\n    if (this.deleted) {\n      return {\n        pageIndex: this.pageIndex,\n        id: this.annotationElementId,\n        deleted: true,\n      };\n    }\n\n    const padding = FreeTextEditor._internalPadding * this.parentScale;\n    const rect = this.getRect(padding, padding);\n    const color = AnnotationEditor._colorManager.convert(\n      this.isAttachedToDOM\n        ? getComputedStyle(this.editorDiv).color\n        : this.#color\n    );\n\n    const serialized = {\n      annotationType: AnnotationEditorType.FREETEXT,\n      color,\n      fontSize: this.#fontSize,\n      value: this.#content,\n      pageIndex: this.pageIndex,\n      rect,\n      rotation: this.rotation,\n      structTreeParentId: this._structTreeParentId,\n    };\n\n    if (isForCopying) {\n      // Don't add the id when copying because the pasted editor mustn't be\n      // linked to an existing annotation.\n      return serialized;\n    }\n\n    if (this.annotationElementId && !this.#hasElementChanged(serialized)) {\n      return null;\n    }\n\n    serialized.id = this.annotationElementId;\n\n    return serialized;\n  }\n\n  #hasElementChanged(serialized) {\n    const { value, fontSize, color, rect, pageIndex } = this.#initialData;\n\n    return (\n      serialized.value !== value ||\n      serialized.fontSize !== fontSize ||\n      serialized.rect.some((x, i) => Math.abs(x - rect[i]) >= 1) ||\n      serialized.color.some((c, i) => c !== color[i]) ||\n      serialized.pageIndex !== pageIndex\n    );\n  }\n\n  #cheatInitialRect(delayed = false) {\n    // The annotation has a rect but the editor has an other one.\n    // When we want to know if the annotation has changed (e.g. has been moved)\n    // we must compare the editor initial rect with the current one.\n    // So this method is a hack to have a way to compare the real rects.\n    if (!this.annotationElementId) {\n      return;\n    }\n\n    this.#setEditorDimensions();\n    if (!delayed && (this.width === 0 || this.height === 0)) {\n      setTimeout(() => this.#cheatInitialRect(/* delayed = */ true), 0);\n      return;\n    }\n\n    const padding = FreeTextEditor._internalPadding * this.parentScale;\n    this.#initialData.rect = this.getRect(padding, padding);\n  }\n}\n\nexport { FreeTextEditor };\n", "/* Copyright 2022 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  AnnotationEditorParamsType,\n  AnnotationEditorType,\n  Util,\n} from \"../../shared/util.js\";\nimport { AnnotationEditor } from \"./editor.js\";\nimport { bindEvents } from \"./tools.js\";\nimport { ColorPicker } from \"./color_picker.js\";\nimport { Outliner } from \"./outliner.js\";\n\n/**\n * Basic draw editor in order to generate an Highlight annotation.\n */\nclass HighlightEditor extends AnnotationEditor {\n  #boxes;\n\n  #clipPathId = null;\n\n  #colorPicker = null;\n\n  #focusOutlines = null;\n\n  #highlightDiv = null;\n\n  #highlightOutlines = null;\n\n  #id = null;\n\n  #lastPoint = null;\n\n  #opacity;\n\n  #outlineId = null;\n\n  static _defaultColor = null;\n\n  static _defaultOpacity = 1;\n\n  static _l10nPromise;\n\n  static _type = \"highlight\";\n\n  static _editorType = AnnotationEditorType.HIGHLIGHT;\n\n  constructor(params) {\n    super({ ...params, name: \"highlightEditor\" });\n    HighlightEditor._defaultColor ||=\n      this._uiManager.highlightColors?.values().next().value || \"#fff066\";\n    this.color = params.color || HighlightEditor._defaultColor;\n    this.#opacity = params.opacity || HighlightEditor._defaultOpacity;\n    this.#boxes = params.boxes || null;\n    this._isDraggable = false;\n\n    this.#createOutlines();\n    this.#addToDrawLayer();\n    this.rotate(this.rotation);\n  }\n\n  #createOutlines() {\n    const outliner = new Outliner(this.#boxes, /* borderWidth = */ 0.001);\n    this.#highlightOutlines = outliner.getOutlines();\n    ({\n      x: this.x,\n      y: this.y,\n      width: this.width,\n      height: this.height,\n    } = this.#highlightOutlines.box);\n\n    const outlinerForOutline = new Outliner(\n      this.#boxes,\n      /* borderWidth = */ 0.0025,\n      /* innerMargin = */ 0.001,\n      this._uiManager.direction === \"ltr\"\n    );\n    this.#focusOutlines = outlinerForOutline.getOutlines();\n\n    // The last point is in the pages coordinate system.\n    const { lastPoint } = this.#focusOutlines.box;\n    this.#lastPoint = [\n      (lastPoint[0] - this.x) / this.width,\n      (lastPoint[1] - this.y) / this.height,\n    ];\n  }\n\n  static initialize(l10n) {\n    AnnotationEditor.initialize(l10n);\n  }\n\n  static updateDefaultParams(type, value) {\n    switch (type) {\n      case AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR:\n        HighlightEditor._defaultColor = value;\n        break;\n    }\n  }\n\n  /** @inheritdoc */\n  get toolbarPosition() {\n    return this.#lastPoint;\n  }\n\n  /** @inheritdoc */\n  updateParams(type, value) {\n    switch (type) {\n      case AnnotationEditorParamsType.HIGHLIGHT_COLOR:\n        this.#updateColor(value);\n        break;\n    }\n  }\n\n  static get defaultPropertiesToUpdate() {\n    return [\n      [\n        AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR,\n        HighlightEditor._defaultColor,\n      ],\n    ];\n  }\n\n  /** @inheritdoc */\n  get propertiesToUpdate() {\n    return [\n      [\n        AnnotationEditorParamsType.HIGHLIGHT_COLOR,\n        this.color || HighlightEditor._defaultColor,\n      ],\n    ];\n  }\n\n  /**\n   * Update the color and make this action undoable.\n   * @param {string} color\n   */\n  #updateColor(color) {\n    const savedColor = this.color;\n    this.addCommands({\n      cmd: () => {\n        this.color = color;\n        this.parent.drawLayer.changeColor(this.#id, color);\n        this.#colorPicker?.updateColor(color);\n      },\n      undo: () => {\n        this.color = savedColor;\n        this.parent.drawLayer.changeColor(this.#id, savedColor);\n        this.#colorPicker?.updateColor(savedColor);\n      },\n      mustExec: true,\n      type: AnnotationEditorParamsType.HIGHLIGHT_COLOR,\n      overwriteIfSameType: true,\n      keepUndo: true,\n    });\n  }\n\n  /** @inheritdoc */\n  async addEditToolbar() {\n    const toolbar = await super.addEditToolbar();\n    if (!toolbar) {\n      return null;\n    }\n    if (this._uiManager.highlightColors) {\n      this.#colorPicker = new ColorPicker({ editor: this });\n      toolbar.addColorPicker(this.#colorPicker);\n    }\n    return toolbar;\n  }\n\n  /** @inheritdoc */\n  disableEditing() {\n    super.disableEditing();\n    this.div.classList.toggle(\"disabled\", true);\n  }\n\n  /** @inheritdoc */\n  enableEditing() {\n    super.enableEditing();\n    this.div.classList.toggle(\"disabled\", false);\n  }\n\n  /** @inheritdoc */\n  fixAndSetPosition() {\n    return super.fixAndSetPosition(0);\n  }\n\n  /** @inheritdoc */\n  getRect(tx, ty) {\n    return super.getRect(tx, ty, 0);\n  }\n\n  /** @inheritdoc */\n  onceAdded() {\n    this.parent.addUndoableEditor(this);\n    this.div.focus();\n  }\n\n  /** @inheritdoc */\n  remove() {\n    super.remove();\n    this.#cleanDrawLayer();\n  }\n\n  /** @inheritdoc */\n  rebuild() {\n    if (!this.parent) {\n      return;\n    }\n    super.rebuild();\n    if (this.div === null) {\n      return;\n    }\n\n    this.#addToDrawLayer();\n\n    if (!this.isAttachedToDOM) {\n      // At some point this editor was removed and we're rebuilting it,\n      // hence we must add it to its parent.\n      this.parent.add(this);\n    }\n  }\n\n  setParent(parent) {\n    let mustBeSelected = false;\n    if (this.parent && !parent) {\n      this.#cleanDrawLayer();\n    } else if (parent) {\n      this.#addToDrawLayer(parent);\n      // If mustBeSelected is true it means that this editor was selected\n      // when its parent has been destroyed, hence we must select it again.\n      mustBeSelected =\n        !this.parent && this.div?.classList.contains(\"selectedEditor\");\n    }\n    super.setParent(parent);\n    if (mustBeSelected) {\n      // We select it after the parent has been set.\n      this.select();\n    }\n  }\n\n  #cleanDrawLayer() {\n    if (this.#id === null || !this.parent) {\n      return;\n    }\n    this.parent.drawLayer.remove(this.#id);\n    this.#id = null;\n    this.parent.drawLayer.remove(this.#outlineId);\n    this.#outlineId = null;\n  }\n\n  #addToDrawLayer(parent = this.parent) {\n    if (this.#id !== null) {\n      return;\n    }\n    ({ id: this.#id, clipPathId: this.#clipPathId } =\n      parent.drawLayer.highlight(\n        this.#highlightOutlines,\n        this.color,\n        this.#opacity\n      ));\n    if (this.#highlightDiv) {\n      this.#highlightDiv.style.clipPath = this.#clipPathId;\n    }\n    this.#outlineId = parent.drawLayer.highlightOutline(this.#focusOutlines);\n  }\n\n  static #rotateBbox({ x, y, width, height }, angle) {\n    switch (angle) {\n      case 90:\n        return {\n          x: 1 - y - height,\n          y: x,\n          width: height,\n          height: width,\n        };\n      case 180:\n        return {\n          x: 1 - x - width,\n          y: 1 - y - height,\n          width,\n          height,\n        };\n      case 270:\n        return {\n          x: y,\n          y: 1 - x - width,\n          width: height,\n          height: width,\n        };\n    }\n    return {\n      x,\n      y,\n      width,\n      height,\n    };\n  }\n\n  /** @inheritdoc */\n  rotate(angle) {\n    const { drawLayer } = this.parent;\n    drawLayer.rotate(this.#id, angle);\n    drawLayer.rotate(this.#outlineId, angle);\n    drawLayer.updateBox(this.#id, HighlightEditor.#rotateBbox(this, angle));\n    drawLayer.updateBox(\n      this.#outlineId,\n      HighlightEditor.#rotateBbox(this.#focusOutlines.box, angle)\n    );\n  }\n\n  /** @inheritdoc */\n  render() {\n    if (this.div) {\n      return this.div;\n    }\n\n    const div = super.render();\n    const highlightDiv = (this.#highlightDiv = document.createElement(\"div\"));\n    div.append(highlightDiv);\n    highlightDiv.className = \"internal\";\n    highlightDiv.style.clipPath = this.#clipPathId;\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    this.setDims(this.width * parentWidth, this.height * parentHeight);\n\n    bindEvents(this, this.#highlightDiv, [\"pointerover\", \"pointerleave\"]);\n    this.enableEditing();\n\n    return div;\n  }\n\n  pointerover() {\n    this.parent.drawLayer.addClass(this.#outlineId, \"hovered\");\n  }\n\n  pointerleave() {\n    this.parent.drawLayer.removeClass(this.#outlineId, \"hovered\");\n  }\n\n  /** @inheritdoc */\n  select() {\n    super.select();\n    this.parent?.drawLayer.removeClass(this.#outlineId, \"hovered\");\n    this.parent?.drawLayer.addClass(this.#outlineId, \"selected\");\n  }\n\n  /** @inheritdoc */\n  unselect() {\n    super.unselect();\n    this.parent?.drawLayer.removeClass(this.#outlineId, \"selected\");\n  }\n\n  #serializeBoxes() {\n    const [pageWidth, pageHeight] = this.pageDimensions;\n    const boxes = this.#boxes;\n    const quadPoints = new Array(boxes.length * 8);\n    let i = 0;\n    for (const { x, y, width, height } of boxes) {\n      const sx = x * pageWidth;\n      const sy = (1 - y - height) * pageHeight;\n      // The specifications say that the rectangle should start from the bottom\n      // left corner and go counter-clockwise.\n      // But when opening the file in Adobe Acrobat it appears that this isn't\n      // correct hence the 4th and 6th numbers are just swapped.\n      quadPoints[i] = quadPoints[i + 4] = sx;\n      quadPoints[i + 1] = quadPoints[i + 3] = sy;\n      quadPoints[i + 2] = quadPoints[i + 6] = sx + width * pageWidth;\n      quadPoints[i + 5] = quadPoints[i + 7] = sy + height * pageHeight;\n      i += 8;\n    }\n    return quadPoints;\n  }\n\n  #serializeOutlines() {\n    const [pageWidth, pageHeight] = this.pageDimensions;\n    const width = this.width * pageWidth;\n    const height = this.height * pageHeight;\n    const tx = this.x * pageWidth;\n    const ty = (1 - this.y - this.height) * pageHeight;\n    const outlines = [];\n    for (const outline of this.#highlightOutlines.outlines) {\n      const points = new Array(outline.length);\n      for (let i = 0; i < outline.length; i += 2) {\n        points[i] = tx + outline[i] * width;\n        points[i + 1] = ty + (1 - outline[i + 1]) * height;\n      }\n      outlines.push(points);\n    }\n    return outlines;\n  }\n\n  /** @inheritdoc */\n  static deserialize(data, parent, uiManager) {\n    const editor = super.deserialize(data, parent, uiManager);\n\n    const { rect, color, quadPoints } = data;\n    editor.color = Util.makeHexColor(...color);\n    editor.#opacity = data.opacity;\n\n    const [pageWidth, pageHeight] = editor.pageDimensions;\n    editor.width = (rect[2] - rect[0]) / pageWidth;\n    editor.height = (rect[3] - rect[1]) / pageHeight;\n    const boxes = (editor.#boxes = []);\n    for (let i = 0; i < quadPoints.length; i += 8) {\n      boxes.push({\n        x: quadPoints[4] / pageWidth,\n        y: 1 - quadPoints[i + 5] / pageHeight,\n        width: (quadPoints[i + 2] - quadPoints[i]) / pageWidth,\n        height: (quadPoints[i + 5] - quadPoints[i + 1]) / pageHeight,\n      });\n    }\n    editor.#createOutlines();\n\n    return editor;\n  }\n\n  /** @inheritdoc */\n  serialize(isForCopying = false) {\n    // It doesn't make sense to copy/paste a highlight annotation.\n    if (this.isEmpty() || isForCopying) {\n      return null;\n    }\n\n    const rect = this.getRect(0, 0);\n    const color = AnnotationEditor._colorManager.convert(this.color);\n\n    return {\n      annotationType: AnnotationEditorType.HIGHLIGHT,\n      color,\n      opacity: this.#opacity,\n      quadPoints: this.#serializeBoxes(),\n      outlines: this.#serializeOutlines(),\n      pageIndex: this.pageIndex,\n      rect,\n      rotation: 0,\n      structTreeParentId: this._structTreeParentId,\n    };\n  }\n\n  static canCreateNewEmptyEditor() {\n    return false;\n  }\n}\n\nexport { HighlightEditor };\n", "/* Copyright 2022 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  AnnotationEditorParamsType,\n  AnnotationEditorType,\n  Util,\n} from \"../../shared/util.js\";\nimport { AnnotationEditor } from \"./editor.js\";\nimport { InkAnnotationElement } from \"../annotation_layer.js\";\nimport { noContextMenu } from \"../display_utils.js\";\nimport { opacityToHex } from \"./tools.js\";\n\n/**\n * Basic draw editor in order to generate an Ink annotation.\n */\nclass InkEditor extends AnnotationEditor {\n  #baseHeight = 0;\n\n  #baseWidth = 0;\n\n  #boundCanvasPointermove = this.canvasPointermove.bind(this);\n\n  #boundCanvasPointerleave = this.canvasPointerleave.bind(this);\n\n  #boundCanvasPointerup = this.canvasPointerup.bind(this);\n\n  #boundCanvasPointerdown = this.canvasPointerdown.bind(this);\n\n  #canvasContextMenuTimeoutId = null;\n\n  #currentPath2D = new Path2D();\n\n  #disableEditing = false;\n\n  #hasSomethingToDraw = false;\n\n  #isCanvasInitialized = false;\n\n  #observer = null;\n\n  #realWidth = 0;\n\n  #realHeight = 0;\n\n  #requestFrameCallback = null;\n\n  static _defaultColor = null;\n\n  static _defaultOpacity = 1;\n\n  static _defaultThickness = 1;\n\n  static _type = \"ink\";\n\n  static _editorType = AnnotationEditorType.INK;\n\n  constructor(params) {\n    super({ ...params, name: \"inkEditor\" });\n    this.color = params.color || null;\n    this.thickness = params.thickness || null;\n    this.opacity = params.opacity || null;\n    this.paths = [];\n    this.bezierPath2D = [];\n    this.allRawPaths = [];\n    this.currentPath = [];\n    this.scaleFactor = 1;\n    this.translationX = this.translationY = 0;\n    this.x = 0;\n    this.y = 0;\n    this._willKeepAspectRatio = true;\n  }\n\n  /** @inheritdoc */\n  static initialize(l10n) {\n    AnnotationEditor.initialize(l10n);\n  }\n\n  /** @inheritdoc */\n  static updateDefaultParams(type, value) {\n    switch (type) {\n      case AnnotationEditorParamsType.INK_THICKNESS:\n        InkEditor._defaultThickness = value;\n        break;\n      case AnnotationEditorParamsType.INK_COLOR:\n        InkEditor._defaultColor = value;\n        break;\n      case AnnotationEditorParamsType.INK_OPACITY:\n        InkEditor._defaultOpacity = value / 100;\n        break;\n    }\n  }\n\n  /** @inheritdoc */\n  updateParams(type, value) {\n    switch (type) {\n      case AnnotationEditorParamsType.INK_THICKNESS:\n        this.#updateThickness(value);\n        break;\n      case AnnotationEditorParamsType.INK_COLOR:\n        this.#updateColor(value);\n        break;\n      case AnnotationEditorParamsType.INK_OPACITY:\n        this.#updateOpacity(value);\n        break;\n    }\n  }\n\n  /** @inheritdoc */\n  static get defaultPropertiesToUpdate() {\n    return [\n      [AnnotationEditorParamsType.INK_THICKNESS, InkEditor._defaultThickness],\n      [\n        AnnotationEditorParamsType.INK_COLOR,\n        InkEditor._defaultColor || AnnotationEditor._defaultLineColor,\n      ],\n      [\n        AnnotationEditorParamsType.INK_OPACITY,\n        Math.round(InkEditor._defaultOpacity * 100),\n      ],\n    ];\n  }\n\n  /** @inheritdoc */\n  get propertiesToUpdate() {\n    return [\n      [\n        AnnotationEditorParamsType.INK_THICKNESS,\n        this.thickness || InkEditor._defaultThickness,\n      ],\n      [\n        AnnotationEditorParamsType.INK_COLOR,\n        this.color ||\n          InkEditor._defaultColor ||\n          AnnotationEditor._defaultLineColor,\n      ],\n      [\n        AnnotationEditorParamsType.INK_OPACITY,\n        Math.round(100 * (this.opacity ?? InkEditor._defaultOpacity)),\n      ],\n    ];\n  }\n\n  /**\n   * Update the thickness and make this action undoable.\n   * @param {number} thickness\n   */\n  #updateThickness(thickness) {\n    const savedThickness = this.thickness;\n    this.addCommands({\n      cmd: () => {\n        this.thickness = thickness;\n        this.#fitToContent();\n      },\n      undo: () => {\n        this.thickness = savedThickness;\n        this.#fitToContent();\n      },\n      mustExec: true,\n      type: AnnotationEditorParamsType.INK_THICKNESS,\n      overwriteIfSameType: true,\n      keepUndo: true,\n    });\n  }\n\n  /**\n   * Update the color and make this action undoable.\n   * @param {string} color\n   */\n  #updateColor(color) {\n    const savedColor = this.color;\n    this.addCommands({\n      cmd: () => {\n        this.color = color;\n        this.#redraw();\n      },\n      undo: () => {\n        this.color = savedColor;\n        this.#redraw();\n      },\n      mustExec: true,\n      type: AnnotationEditorParamsType.INK_COLOR,\n      overwriteIfSameType: true,\n      keepUndo: true,\n    });\n  }\n\n  /**\n   * Update the opacity and make this action undoable.\n   * @param {number} opacity\n   */\n  #updateOpacity(opacity) {\n    opacity /= 100;\n    const savedOpacity = this.opacity;\n    this.addCommands({\n      cmd: () => {\n        this.opacity = opacity;\n        this.#redraw();\n      },\n      undo: () => {\n        this.opacity = savedOpacity;\n        this.#redraw();\n      },\n      mustExec: true,\n      type: AnnotationEditorParamsType.INK_OPACITY,\n      overwriteIfSameType: true,\n      keepUndo: true,\n    });\n  }\n\n  /** @inheritdoc */\n  rebuild() {\n    if (!this.parent) {\n      return;\n    }\n    super.rebuild();\n    if (this.div === null) {\n      return;\n    }\n\n    if (!this.canvas) {\n      this.#createCanvas();\n      this.#createObserver();\n    }\n\n    if (!this.isAttachedToDOM) {\n      // At some point this editor was removed and we're rebuilding it,\n      // hence we must add it to its parent.\n      this.parent.add(this);\n      this.#setCanvasDims();\n    }\n    this.#fitToContent();\n  }\n\n  /** @inheritdoc */\n  remove() {\n    if (this.canvas === null) {\n      return;\n    }\n\n    if (!this.isEmpty()) {\n      this.commit();\n    }\n\n    // Destroy the canvas.\n    this.canvas.width = this.canvas.height = 0;\n    this.canvas.remove();\n    this.canvas = null;\n\n    if (this.#canvasContextMenuTimeoutId) {\n      clearTimeout(this.#canvasContextMenuTimeoutId);\n      this.#canvasContextMenuTimeoutId = null;\n    }\n\n    this.#observer.disconnect();\n    this.#observer = null;\n\n    super.remove();\n  }\n\n  setParent(parent) {\n    if (!this.parent && parent) {\n      // We've a parent hence the rescale will be handled thanks to the\n      // ResizeObserver.\n      this._uiManager.removeShouldRescale(this);\n    } else if (this.parent && parent === null) {\n      // The editor is removed from the DOM, hence we handle the rescale thanks\n      // to the onScaleChanging callback.\n      // This way, it'll be saved/printed correctly.\n      this._uiManager.addShouldRescale(this);\n    }\n    super.setParent(parent);\n  }\n\n  onScaleChanging() {\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    const width = this.width * parentWidth;\n    const height = this.height * parentHeight;\n    this.setDimensions(width, height);\n  }\n\n  /** @inheritdoc */\n  enableEditMode() {\n    if (this.#disableEditing || this.canvas === null) {\n      return;\n    }\n\n    super.enableEditMode();\n    this._isDraggable = false;\n    this.canvas.addEventListener(\"pointerdown\", this.#boundCanvasPointerdown);\n  }\n\n  /** @inheritdoc */\n  disableEditMode() {\n    if (!this.isInEditMode() || this.canvas === null) {\n      return;\n    }\n\n    super.disableEditMode();\n    this._isDraggable = !this.isEmpty();\n    this.div.classList.remove(\"editing\");\n\n    this.canvas.removeEventListener(\n      \"pointerdown\",\n      this.#boundCanvasPointerdown\n    );\n  }\n\n  /** @inheritdoc */\n  onceAdded() {\n    this._isDraggable = !this.isEmpty();\n  }\n\n  /** @inheritdoc */\n  isEmpty() {\n    return (\n      this.paths.length === 0 ||\n      (this.paths.length === 1 && this.paths[0].length === 0)\n    );\n  }\n\n  #getInitialBBox() {\n    const {\n      parentRotation,\n      parentDimensions: [width, height],\n    } = this;\n    switch (parentRotation) {\n      case 90:\n        return [0, height, height, width];\n      case 180:\n        return [width, height, width, height];\n      case 270:\n        return [width, 0, height, width];\n      default:\n        return [0, 0, width, height];\n    }\n  }\n\n  /**\n   * Set line styles.\n   */\n  #setStroke() {\n    const { ctx, color, opacity, thickness, parentScale, scaleFactor } = this;\n    ctx.lineWidth = (thickness * parentScale) / scaleFactor;\n    ctx.lineCap = \"round\";\n    ctx.lineJoin = \"round\";\n    ctx.miterLimit = 10;\n    ctx.strokeStyle = `${color}${opacityToHex(opacity)}`;\n  }\n\n  /**\n   * Start to draw on the canvas.\n   * @param {number} x\n   * @param {number} y\n   */\n  #startDrawing(x, y) {\n    this.canvas.addEventListener(\"contextmenu\", noContextMenu);\n    this.canvas.addEventListener(\"pointerleave\", this.#boundCanvasPointerleave);\n    this.canvas.addEventListener(\"pointermove\", this.#boundCanvasPointermove);\n    this.canvas.addEventListener(\"pointerup\", this.#boundCanvasPointerup);\n    this.canvas.removeEventListener(\n      \"pointerdown\",\n      this.#boundCanvasPointerdown\n    );\n\n    this.isEditing = true;\n    if (!this.#isCanvasInitialized) {\n      this.#isCanvasInitialized = true;\n      this.#setCanvasDims();\n      this.thickness ||= InkEditor._defaultThickness;\n      this.color ||=\n        InkEditor._defaultColor || AnnotationEditor._defaultLineColor;\n      this.opacity ??= InkEditor._defaultOpacity;\n    }\n    this.currentPath.push([x, y]);\n    this.#hasSomethingToDraw = false;\n    this.#setStroke();\n\n    this.#requestFrameCallback = () => {\n      this.#drawPoints();\n      if (this.#requestFrameCallback) {\n        window.requestAnimationFrame(this.#requestFrameCallback);\n      }\n    };\n    window.requestAnimationFrame(this.#requestFrameCallback);\n  }\n\n  /**\n   * Draw on the canvas.\n   * @param {number} x\n   * @param {number} y\n   */\n  #draw(x, y) {\n    const [lastX, lastY] = this.currentPath.at(-1);\n    if (this.currentPath.length > 1 && x === lastX && y === lastY) {\n      return;\n    }\n    const currentPath = this.currentPath;\n    let path2D = this.#currentPath2D;\n    currentPath.push([x, y]);\n    this.#hasSomethingToDraw = true;\n\n    if (currentPath.length <= 2) {\n      path2D.moveTo(...currentPath[0]);\n      path2D.lineTo(x, y);\n      return;\n    }\n\n    if (currentPath.length === 3) {\n      this.#currentPath2D = path2D = new Path2D();\n      path2D.moveTo(...currentPath[0]);\n    }\n\n    this.#makeBezierCurve(\n      path2D,\n      ...currentPath.at(-3),\n      ...currentPath.at(-2),\n      x,\n      y\n    );\n  }\n\n  #endPath() {\n    if (this.currentPath.length === 0) {\n      return;\n    }\n    const lastPoint = this.currentPath.at(-1);\n    this.#currentPath2D.lineTo(...lastPoint);\n  }\n\n  /**\n   * Stop to draw on the canvas.\n   * @param {number} x\n   * @param {number} y\n   */\n  #stopDrawing(x, y) {\n    this.#requestFrameCallback = null;\n\n    x = Math.min(Math.max(x, 0), this.canvas.width);\n    y = Math.min(Math.max(y, 0), this.canvas.height);\n\n    this.#draw(x, y);\n    this.#endPath();\n\n    // Interpolate the path entered by the user with some\n    // Bezier's curves in order to have a smoother path and\n    // to reduce the data size used to draw it in the PDF.\n    let bezier;\n    if (this.currentPath.length !== 1) {\n      bezier = this.#generateBezierPoints();\n    } else {\n      // We have only one point finally.\n      const xy = [x, y];\n      bezier = [[xy, xy.slice(), xy.slice(), xy]];\n    }\n    const path2D = this.#currentPath2D;\n    const currentPath = this.currentPath;\n    this.currentPath = [];\n    this.#currentPath2D = new Path2D();\n\n    const cmd = () => {\n      this.allRawPaths.push(currentPath);\n      this.paths.push(bezier);\n      this.bezierPath2D.push(path2D);\n      this.rebuild();\n    };\n\n    const undo = () => {\n      this.allRawPaths.pop();\n      this.paths.pop();\n      this.bezierPath2D.pop();\n      if (this.paths.length === 0) {\n        this.remove();\n      } else {\n        if (!this.canvas) {\n          this.#createCanvas();\n          this.#createObserver();\n        }\n        this.#fitToContent();\n      }\n    };\n\n    this.addCommands({ cmd, undo, mustExec: true });\n  }\n\n  #drawPoints() {\n    if (!this.#hasSomethingToDraw) {\n      return;\n    }\n    this.#hasSomethingToDraw = false;\n\n    const thickness = Math.ceil(this.thickness * this.parentScale);\n    const lastPoints = this.currentPath.slice(-3);\n    const x = lastPoints.map(xy => xy[0]);\n    const y = lastPoints.map(xy => xy[1]);\n    const xMin = Math.min(...x) - thickness;\n    const xMax = Math.max(...x) + thickness;\n    const yMin = Math.min(...y) - thickness;\n    const yMax = Math.max(...y) + thickness;\n\n    const { ctx } = this;\n    ctx.save();\n\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n      // In Chrome, the clip() method doesn't work as expected.\n      ctx.clearRect(xMin, yMin, xMax - xMin, yMax - yMin);\n      ctx.beginPath();\n      ctx.rect(xMin, yMin, xMax - xMin, yMax - yMin);\n      ctx.clip();\n    } else {\n      ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    }\n\n    for (const path of this.bezierPath2D) {\n      ctx.stroke(path);\n    }\n    ctx.stroke(this.#currentPath2D);\n\n    ctx.restore();\n  }\n\n  #makeBezierCurve(path2D, x0, y0, x1, y1, x2, y2) {\n    const prevX = (x0 + x1) / 2;\n    const prevY = (y0 + y1) / 2;\n    const x3 = (x1 + x2) / 2;\n    const y3 = (y1 + y2) / 2;\n\n    path2D.bezierCurveTo(\n      prevX + (2 * (x1 - prevX)) / 3,\n      prevY + (2 * (y1 - prevY)) / 3,\n      x3 + (2 * (x1 - x3)) / 3,\n      y3 + (2 * (y1 - y3)) / 3,\n      x3,\n      y3\n    );\n  }\n\n  #generateBezierPoints() {\n    const path = this.currentPath;\n    if (path.length <= 2) {\n      return [[path[0], path[0], path.at(-1), path.at(-1)]];\n    }\n\n    const bezierPoints = [];\n    let i;\n    let [x0, y0] = path[0];\n    for (i = 1; i < path.length - 2; i++) {\n      const [x1, y1] = path[i];\n      const [x2, y2] = path[i + 1];\n      const x3 = (x1 + x2) / 2;\n      const y3 = (y1 + y2) / 2;\n\n      // The quadratic is: [[x0, y0], [x1, y1], [x3, y3]].\n      // Convert the quadratic to a cubic\n      // (see https://fontforge.org/docs/techref/bezier.html#converting-truetype-to-postscript)\n      const control1 = [x0 + (2 * (x1 - x0)) / 3, y0 + (2 * (y1 - y0)) / 3];\n      const control2 = [x3 + (2 * (x1 - x3)) / 3, y3 + (2 * (y1 - y3)) / 3];\n\n      bezierPoints.push([[x0, y0], control1, control2, [x3, y3]]);\n\n      [x0, y0] = [x3, y3];\n    }\n\n    const [x1, y1] = path[i];\n    const [x2, y2] = path[i + 1];\n\n    // The quadratic is: [[x0, y0], [x1, y1], [x2, y2]].\n    const control1 = [x0 + (2 * (x1 - x0)) / 3, y0 + (2 * (y1 - y0)) / 3];\n    const control2 = [x2 + (2 * (x1 - x2)) / 3, y2 + (2 * (y1 - y2)) / 3];\n\n    bezierPoints.push([[x0, y0], control1, control2, [x2, y2]]);\n    return bezierPoints;\n  }\n\n  /**\n   * Redraw all the paths.\n   */\n  #redraw() {\n    if (this.isEmpty()) {\n      this.#updateTransform();\n      return;\n    }\n    this.#setStroke();\n\n    const { canvas, ctx } = this;\n    ctx.setTransform(1, 0, 0, 1, 0, 0);\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n    this.#updateTransform();\n\n    for (const path of this.bezierPath2D) {\n      ctx.stroke(path);\n    }\n  }\n\n  /**\n   * Commit the curves we have in this editor.\n   */\n  commit() {\n    if (this.#disableEditing) {\n      return;\n    }\n\n    super.commit();\n\n    this.isEditing = false;\n    this.disableEditMode();\n\n    // This editor must be on top of the main ink editor.\n    this.setInForeground();\n\n    this.#disableEditing = true;\n    this.div.classList.add(\"disabled\");\n\n    this.#fitToContent(/* firstTime = */ true);\n    this.select();\n\n    this.parent.addInkEditorIfNeeded(/* isCommitting = */ true);\n\n    // When commiting, the position of this editor is changed, hence we must\n    // move it to the right position in the DOM.\n    this.moveInDOM();\n    this.div.focus({\n      preventScroll: true /* See issue #15744 */,\n    });\n  }\n\n  /** @inheritdoc */\n  focusin(event) {\n    if (!this._focusEventsAllowed) {\n      return;\n    }\n    super.focusin(event);\n    this.enableEditMode();\n  }\n\n  /**\n   * onpointerdown callback for the canvas we're drawing on.\n   * @param {PointerEvent} event\n   */\n  canvasPointerdown(event) {\n    if (event.button !== 0 || !this.isInEditMode() || this.#disableEditing) {\n      return;\n    }\n\n    // We want to draw on top of any other editors.\n    // Since it's the last child, there's no need to give it a higher z-index.\n    this.setInForeground();\n\n    event.preventDefault();\n\n    if (!this.div.contains(document.activeElement)) {\n      this.div.focus({\n        preventScroll: true /* See issue #17327 */,\n      });\n    }\n\n    this.#startDrawing(event.offsetX, event.offsetY);\n  }\n\n  /**\n   * onpointermove callback for the canvas we're drawing on.\n   * @param {PointerEvent} event\n   */\n  canvasPointermove(event) {\n    event.preventDefault();\n    this.#draw(event.offsetX, event.offsetY);\n  }\n\n  /**\n   * onpointerup callback for the canvas we're drawing on.\n   * @param {PointerEvent} event\n   */\n  canvasPointerup(event) {\n    event.preventDefault();\n    this.#endDrawing(event);\n  }\n\n  /**\n   * onpointerleave callback for the canvas we're drawing on.\n   * @param {PointerEvent} event\n   */\n  canvasPointerleave(event) {\n    this.#endDrawing(event);\n  }\n\n  /**\n   * End the drawing.\n   * @param {PointerEvent} event\n   */\n  #endDrawing(event) {\n    this.canvas.removeEventListener(\n      \"pointerleave\",\n      this.#boundCanvasPointerleave\n    );\n    this.canvas.removeEventListener(\n      \"pointermove\",\n      this.#boundCanvasPointermove\n    );\n    this.canvas.removeEventListener(\"pointerup\", this.#boundCanvasPointerup);\n    this.canvas.addEventListener(\"pointerdown\", this.#boundCanvasPointerdown);\n\n    // Slight delay to avoid the context menu to appear (it can happen on a long\n    // tap with a pen).\n    if (this.#canvasContextMenuTimeoutId) {\n      clearTimeout(this.#canvasContextMenuTimeoutId);\n    }\n    this.#canvasContextMenuTimeoutId = setTimeout(() => {\n      this.#canvasContextMenuTimeoutId = null;\n      this.canvas.removeEventListener(\"contextmenu\", noContextMenu);\n    }, 10);\n\n    this.#stopDrawing(event.offsetX, event.offsetY);\n\n    this.addToAnnotationStorage();\n\n    // Since the ink editor covers all of the page and we want to be able\n    // to select another editor, we just put this one in the background.\n    this.setInBackground();\n  }\n\n  /**\n   * Create the canvas element.\n   */\n  #createCanvas() {\n    this.canvas = document.createElement(\"canvas\");\n    this.canvas.width = this.canvas.height = 0;\n    this.canvas.className = \"inkEditorCanvas\";\n    this.canvas.setAttribute(\"data-l10n-id\", \"pdfjs-ink-canvas\");\n\n    this.div.append(this.canvas);\n    this.ctx = this.canvas.getContext(\"2d\");\n  }\n\n  /**\n   * Create the resize observer.\n   */\n  #createObserver() {\n    this.#observer = new ResizeObserver(entries => {\n      const rect = entries[0].contentRect;\n      if (rect.width && rect.height) {\n        this.setDimensions(rect.width, rect.height);\n      }\n    });\n    this.#observer.observe(this.div);\n  }\n\n  /** @inheritdoc */\n  get isResizable() {\n    return !this.isEmpty() && this.#disableEditing;\n  }\n\n  /** @inheritdoc */\n  render() {\n    if (this.div) {\n      return this.div;\n    }\n\n    let baseX, baseY;\n    if (this.width) {\n      baseX = this.x;\n      baseY = this.y;\n    }\n\n    super.render();\n\n    this.div.setAttribute(\"data-l10n-id\", \"pdfjs-ink\");\n\n    const [x, y, w, h] = this.#getInitialBBox();\n    this.setAt(x, y, 0, 0);\n    this.setDims(w, h);\n\n    this.#createCanvas();\n\n    if (this.width) {\n      // This editor was created in using copy (ctrl+c).\n      const [parentWidth, parentHeight] = this.parentDimensions;\n      this.setAspectRatio(this.width * parentWidth, this.height * parentHeight);\n      this.setAt(\n        baseX * parentWidth,\n        baseY * parentHeight,\n        this.width * parentWidth,\n        this.height * parentHeight\n      );\n      this.#isCanvasInitialized = true;\n      this.#setCanvasDims();\n      this.setDims(this.width * parentWidth, this.height * parentHeight);\n      this.#redraw();\n      this.div.classList.add(\"disabled\");\n    } else {\n      this.div.classList.add(\"editing\");\n      this.enableEditMode();\n    }\n\n    this.#createObserver();\n\n    return this.div;\n  }\n\n  #setCanvasDims() {\n    if (!this.#isCanvasInitialized) {\n      return;\n    }\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    this.canvas.width = Math.ceil(this.width * parentWidth);\n    this.canvas.height = Math.ceil(this.height * parentHeight);\n    this.#updateTransform();\n  }\n\n  /**\n   * When the dimensions of the div change the inner canvas must\n   * renew its dimensions, hence it must redraw its own contents.\n   * @param {number} width - the new width of the div\n   * @param {number} height - the new height of the div\n   * @returns\n   */\n  setDimensions(width, height) {\n    const roundedWidth = Math.round(width);\n    const roundedHeight = Math.round(height);\n    if (\n      this.#realWidth === roundedWidth &&\n      this.#realHeight === roundedHeight\n    ) {\n      return;\n    }\n\n    this.#realWidth = roundedWidth;\n    this.#realHeight = roundedHeight;\n\n    this.canvas.style.visibility = \"hidden\";\n\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    this.width = width / parentWidth;\n    this.height = height / parentHeight;\n    this.fixAndSetPosition();\n\n    if (this.#disableEditing) {\n      this.#setScaleFactor(width, height);\n    }\n\n    this.#setCanvasDims();\n    this.#redraw();\n\n    this.canvas.style.visibility = \"visible\";\n\n    // For any reason the dimensions couldn't be in percent but in pixels, hence\n    // we must fix them.\n    this.fixDims();\n  }\n\n  #setScaleFactor(width, height) {\n    const padding = this.#getPadding();\n    const scaleFactorW = (width - padding) / this.#baseWidth;\n    const scaleFactorH = (height - padding) / this.#baseHeight;\n    this.scaleFactor = Math.min(scaleFactorW, scaleFactorH);\n  }\n\n  /**\n   * Update the canvas transform.\n   */\n  #updateTransform() {\n    const padding = this.#getPadding() / 2;\n    this.ctx.setTransform(\n      this.scaleFactor,\n      0,\n      0,\n      this.scaleFactor,\n      this.translationX * this.scaleFactor + padding,\n      this.translationY * this.scaleFactor + padding\n    );\n  }\n\n  /**\n   * Convert into a Path2D.\n   * @param {Array<Array<number>>} bezier\n   * @returns {Path2D}\n   */\n  static #buildPath2D(bezier) {\n    const path2D = new Path2D();\n    for (let i = 0, ii = bezier.length; i < ii; i++) {\n      const [first, control1, control2, second] = bezier[i];\n      if (i === 0) {\n        path2D.moveTo(...first);\n      }\n      path2D.bezierCurveTo(\n        control1[0],\n        control1[1],\n        control2[0],\n        control2[1],\n        second[0],\n        second[1]\n      );\n    }\n    return path2D;\n  }\n\n  static #toPDFCoordinates(points, rect, rotation) {\n    const [blX, blY, trX, trY] = rect;\n\n    switch (rotation) {\n      case 0:\n        for (let i = 0, ii = points.length; i < ii; i += 2) {\n          points[i] += blX;\n          points[i + 1] = trY - points[i + 1];\n        }\n        break;\n      case 90:\n        for (let i = 0, ii = points.length; i < ii; i += 2) {\n          const x = points[i];\n          points[i] = points[i + 1] + blX;\n          points[i + 1] = x + blY;\n        }\n        break;\n      case 180:\n        for (let i = 0, ii = points.length; i < ii; i += 2) {\n          points[i] = trX - points[i];\n          points[i + 1] += blY;\n        }\n        break;\n      case 270:\n        for (let i = 0, ii = points.length; i < ii; i += 2) {\n          const x = points[i];\n          points[i] = trX - points[i + 1];\n          points[i + 1] = trY - x;\n        }\n        break;\n      default:\n        throw new Error(\"Invalid rotation\");\n    }\n    return points;\n  }\n\n  static #fromPDFCoordinates(points, rect, rotation) {\n    const [blX, blY, trX, trY] = rect;\n\n    switch (rotation) {\n      case 0:\n        for (let i = 0, ii = points.length; i < ii; i += 2) {\n          points[i] -= blX;\n          points[i + 1] = trY - points[i + 1];\n        }\n        break;\n      case 90:\n        for (let i = 0, ii = points.length; i < ii; i += 2) {\n          const x = points[i];\n          points[i] = points[i + 1] - blY;\n          points[i + 1] = x - blX;\n        }\n        break;\n      case 180:\n        for (let i = 0, ii = points.length; i < ii; i += 2) {\n          points[i] = trX - points[i];\n          points[i + 1] -= blY;\n        }\n        break;\n      case 270:\n        for (let i = 0, ii = points.length; i < ii; i += 2) {\n          const x = points[i];\n          points[i] = trY - points[i + 1];\n          points[i + 1] = trX - x;\n        }\n        break;\n      default:\n        throw new Error(\"Invalid rotation\");\n    }\n    return points;\n  }\n\n  /**\n   * Transform and serialize the paths.\n   * @param {number} s - scale factor\n   * @param {number} tx - abscissa of the translation\n   * @param {number} ty - ordinate of the translation\n   * @param {Array<number>} rect - the bounding box of the annotation\n   */\n  #serializePaths(s, tx, ty, rect) {\n    const paths = [];\n    const padding = this.thickness / 2;\n    const shiftX = s * tx + padding;\n    const shiftY = s * ty + padding;\n    for (const bezier of this.paths) {\n      const buffer = [];\n      const points = [];\n      for (let j = 0, jj = bezier.length; j < jj; j++) {\n        const [first, control1, control2, second] = bezier[j];\n        const p10 = s * first[0] + shiftX;\n        const p11 = s * first[1] + shiftY;\n        const p20 = s * control1[0] + shiftX;\n        const p21 = s * control1[1] + shiftY;\n        const p30 = s * control2[0] + shiftX;\n        const p31 = s * control2[1] + shiftY;\n        const p40 = s * second[0] + shiftX;\n        const p41 = s * second[1] + shiftY;\n\n        if (j === 0) {\n          buffer.push(p10, p11);\n          points.push(p10, p11);\n        }\n        buffer.push(p20, p21, p30, p31, p40, p41);\n        points.push(p20, p21);\n        if (j === jj - 1) {\n          points.push(p40, p41);\n        }\n      }\n      paths.push({\n        bezier: InkEditor.#toPDFCoordinates(buffer, rect, this.rotation),\n        points: InkEditor.#toPDFCoordinates(points, rect, this.rotation),\n      });\n    }\n\n    return paths;\n  }\n\n  /**\n   * Get the bounding box containing all the paths.\n   * @returns {Array<number>}\n   */\n  #getBbox() {\n    let xMin = Infinity;\n    let xMax = -Infinity;\n    let yMin = Infinity;\n    let yMax = -Infinity;\n\n    for (const path of this.paths) {\n      for (const [first, control1, control2, second] of path) {\n        const bbox = Util.bezierBoundingBox(\n          ...first,\n          ...control1,\n          ...control2,\n          ...second\n        );\n        xMin = Math.min(xMin, bbox[0]);\n        yMin = Math.min(yMin, bbox[1]);\n        xMax = Math.max(xMax, bbox[2]);\n        yMax = Math.max(yMax, bbox[3]);\n      }\n    }\n\n    return [xMin, yMin, xMax, yMax];\n  }\n\n  /**\n   * The bounding box is computed with null thickness, so we must take\n   * it into account for the display.\n   * It corresponds to the total padding, hence it should be divided by 2\n   * in order to have left/right paddings.\n   * @returns {number}\n   */\n  #getPadding() {\n    return this.#disableEditing\n      ? Math.ceil(this.thickness * this.parentScale)\n      : 0;\n  }\n\n  /**\n   * Set the div position and dimensions in order to fit to\n   * the bounding box of the contents.\n   * @returns {undefined}\n   */\n  #fitToContent(firstTime = false) {\n    if (this.isEmpty()) {\n      return;\n    }\n\n    if (!this.#disableEditing) {\n      this.#redraw();\n      return;\n    }\n\n    const bbox = this.#getBbox();\n    const padding = this.#getPadding();\n    this.#baseWidth = Math.max(AnnotationEditor.MIN_SIZE, bbox[2] - bbox[0]);\n    this.#baseHeight = Math.max(AnnotationEditor.MIN_SIZE, bbox[3] - bbox[1]);\n\n    const width = Math.ceil(padding + this.#baseWidth * this.scaleFactor);\n    const height = Math.ceil(padding + this.#baseHeight * this.scaleFactor);\n\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    this.width = width / parentWidth;\n    this.height = height / parentHeight;\n\n    this.setAspectRatio(width, height);\n\n    const prevTranslationX = this.translationX;\n    const prevTranslationY = this.translationY;\n\n    this.translationX = -bbox[0];\n    this.translationY = -bbox[1];\n    this.#setCanvasDims();\n    this.#redraw();\n\n    this.#realWidth = width;\n    this.#realHeight = height;\n\n    this.setDims(width, height);\n    const unscaledPadding = firstTime ? padding / this.scaleFactor / 2 : 0;\n    this.translate(\n      prevTranslationX - this.translationX - unscaledPadding,\n      prevTranslationY - this.translationY - unscaledPadding\n    );\n  }\n\n  /** @inheritdoc */\n  static deserialize(data, parent, uiManager) {\n    if (data instanceof InkAnnotationElement) {\n      return null;\n    }\n    const editor = super.deserialize(data, parent, uiManager);\n\n    editor.thickness = data.thickness;\n    editor.color = Util.makeHexColor(...data.color);\n    editor.opacity = data.opacity;\n\n    const [pageWidth, pageHeight] = editor.pageDimensions;\n    const width = editor.width * pageWidth;\n    const height = editor.height * pageHeight;\n    const scaleFactor = editor.parentScale;\n    const padding = data.thickness / 2;\n\n    editor.#disableEditing = true;\n    editor.#realWidth = Math.round(width);\n    editor.#realHeight = Math.round(height);\n\n    const { paths, rect, rotation } = data;\n\n    for (let { bezier } of paths) {\n      bezier = InkEditor.#fromPDFCoordinates(bezier, rect, rotation);\n      const path = [];\n      editor.paths.push(path);\n      let p0 = scaleFactor * (bezier[0] - padding);\n      let p1 = scaleFactor * (bezier[1] - padding);\n      for (let i = 2, ii = bezier.length; i < ii; i += 6) {\n        const p10 = scaleFactor * (bezier[i] - padding);\n        const p11 = scaleFactor * (bezier[i + 1] - padding);\n        const p20 = scaleFactor * (bezier[i + 2] - padding);\n        const p21 = scaleFactor * (bezier[i + 3] - padding);\n        const p30 = scaleFactor * (bezier[i + 4] - padding);\n        const p31 = scaleFactor * (bezier[i + 5] - padding);\n        path.push([\n          [p0, p1],\n          [p10, p11],\n          [p20, p21],\n          [p30, p31],\n        ]);\n        p0 = p30;\n        p1 = p31;\n      }\n      const path2D = this.#buildPath2D(path);\n      editor.bezierPath2D.push(path2D);\n    }\n\n    const bbox = editor.#getBbox();\n    editor.#baseWidth = Math.max(AnnotationEditor.MIN_SIZE, bbox[2] - bbox[0]);\n    editor.#baseHeight = Math.max(AnnotationEditor.MIN_SIZE, bbox[3] - bbox[1]);\n    editor.#setScaleFactor(width, height);\n\n    return editor;\n  }\n\n  /** @inheritdoc */\n  serialize() {\n    if (this.isEmpty()) {\n      return null;\n    }\n\n    const rect = this.getRect(0, 0);\n    const color = AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);\n\n    return {\n      annotationType: AnnotationEditorType.INK,\n      color,\n      thickness: this.thickness,\n      opacity: this.opacity,\n      paths: this.#serializePaths(\n        this.scaleFactor / this.parentScale,\n        this.translationX,\n        this.translationY,\n        rect\n      ),\n      pageIndex: this.pageIndex,\n      rect,\n      rotation: this.rotation,\n      structTreeParentId: this._structTreeParentId,\n    };\n  }\n}\n\nexport { InkEditor };\n", "/* Copyright 2022 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { AnnotationEditorType, shadow } from \"../../shared/util.js\";\nimport { AnnotationEditor } from \"./editor.js\";\nimport { PixelsPerInch } from \"../display_utils.js\";\nimport { StampAnnotationElement } from \"../annotation_layer.js\";\n\n/**\n * Basic text editor in order to create a FreeTex annotation.\n */\nclass StampEditor extends AnnotationEditor {\n  #bitmap = null;\n\n  #bitmapId = null;\n\n  #bitmapPromise = null;\n\n  #bitmapUrl = null;\n\n  #bitmapFile = null;\n\n  #bitmapFileName = \"\";\n\n  #canvas = null;\n\n  #observer = null;\n\n  #resizeTimeoutId = null;\n\n  #isSvg = false;\n\n  #hasBeenAddedInUndoStack = false;\n\n  static _type = \"stamp\";\n\n  static _editorType = AnnotationEditorType.STAMP;\n\n  constructor(params) {\n    super({ ...params, name: \"stampEditor\" });\n    this.#bitmapUrl = params.bitmapUrl;\n    this.#bitmapFile = params.bitmapFile;\n  }\n\n  /** @inheritdoc */\n  static initialize(l10n) {\n    AnnotationEditor.initialize(l10n);\n  }\n\n  static get supportedTypes() {\n    // See https://developer.mozilla.org/en-US/docs/Web/Media/Formats/Image_types\n    // to know which types are supported by the browser.\n    const types = [\n      \"apng\",\n      \"avif\",\n      \"bmp\",\n      \"gif\",\n      \"jpeg\",\n      \"png\",\n      \"svg+xml\",\n      \"webp\",\n      \"x-icon\",\n    ];\n    return shadow(\n      this,\n      \"supportedTypes\",\n      types.map(type => `image/${type}`)\n    );\n  }\n\n  static get supportedTypesStr() {\n    return shadow(this, \"supportedTypesStr\", this.supportedTypes.join(\",\"));\n  }\n\n  /** @inheritdoc */\n  static isHandlingMimeForPasting(mime) {\n    return this.supportedTypes.includes(mime);\n  }\n\n  /** @inheritdoc */\n  static paste(item, parent) {\n    parent.pasteEditor(AnnotationEditorType.STAMP, {\n      bitmapFile: item.getAsFile(),\n    });\n  }\n\n  #getBitmapFetched(data, fromId = false) {\n    if (!data) {\n      this.remove();\n      return;\n    }\n    this.#bitmap = data.bitmap;\n    if (!fromId) {\n      this.#bitmapId = data.id;\n      this.#isSvg = data.isSvg;\n    }\n    if (data.file) {\n      this.#bitmapFileName = data.file.name;\n    }\n    this.#createCanvas();\n  }\n\n  #getBitmapDone() {\n    this.#bitmapPromise = null;\n    this._uiManager.enableWaiting(false);\n    if (this.#canvas) {\n      this.div.focus();\n    }\n  }\n\n  #getBitmap() {\n    if (this.#bitmapId) {\n      this._uiManager.enableWaiting(true);\n      this._uiManager.imageManager\n        .getFromId(this.#bitmapId)\n        .then(data => this.#getBitmapFetched(data, /* fromId = */ true))\n        .finally(() => this.#getBitmapDone());\n      return;\n    }\n\n    if (this.#bitmapUrl) {\n      const url = this.#bitmapUrl;\n      this.#bitmapUrl = null;\n      this._uiManager.enableWaiting(true);\n      this.#bitmapPromise = this._uiManager.imageManager\n        .getFromUrl(url)\n        .then(data => this.#getBitmapFetched(data))\n        .finally(() => this.#getBitmapDone());\n      return;\n    }\n\n    if (this.#bitmapFile) {\n      const file = this.#bitmapFile;\n      this.#bitmapFile = null;\n      this._uiManager.enableWaiting(true);\n      this.#bitmapPromise = this._uiManager.imageManager\n        .getFromFile(file)\n        .then(data => this.#getBitmapFetched(data))\n        .finally(() => this.#getBitmapDone());\n      return;\n    }\n\n    const input = document.createElement(\"input\");\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")) {\n      input.hidden = true;\n      input.id = \"stampEditorFileInput\";\n      document.body.append(input);\n    }\n    input.type = \"file\";\n    input.accept = StampEditor.supportedTypesStr;\n    this.#bitmapPromise = new Promise(resolve => {\n      input.addEventListener(\"change\", async () => {\n        if (!input.files || input.files.length === 0) {\n          this.remove();\n        } else {\n          this._uiManager.enableWaiting(true);\n          const data = await this._uiManager.imageManager.getFromFile(\n            input.files[0]\n          );\n          this.#getBitmapFetched(data);\n        }\n        if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")) {\n          input.remove();\n        }\n        resolve();\n      });\n      input.addEventListener(\"cancel\", () => {\n        this.remove();\n        resolve();\n      });\n    }).finally(() => this.#getBitmapDone());\n    if (typeof PDFJSDev === \"undefined\" || !PDFJSDev.test(\"TESTING\")) {\n      input.click();\n    }\n  }\n\n  /** @inheritdoc */\n  remove() {\n    if (this.#bitmapId) {\n      this.#bitmap = null;\n      this._uiManager.imageManager.deleteId(this.#bitmapId);\n      this.#canvas?.remove();\n      this.#canvas = null;\n      this.#observer?.disconnect();\n      this.#observer = null;\n      if (this.#resizeTimeoutId) {\n        clearTimeout(this.#resizeTimeoutId);\n        this.#resizeTimeoutId = null;\n      }\n    }\n    super.remove();\n  }\n\n  /** @inheritdoc */\n  rebuild() {\n    if (!this.parent) {\n      // It's possible to have to rebuild an editor which is not on a visible\n      // page.\n      if (this.#bitmapId) {\n        this.#getBitmap();\n      }\n      return;\n    }\n    super.rebuild();\n    if (this.div === null) {\n      return;\n    }\n\n    if (this.#bitmapId) {\n      this.#getBitmap();\n    }\n\n    if (!this.isAttachedToDOM) {\n      // At some point this editor was removed and we're rebuilting it,\n      // hence we must add it to its parent.\n      this.parent.add(this);\n    }\n  }\n\n  /** @inheritdoc */\n  onceAdded() {\n    this._isDraggable = true;\n    this.div.focus();\n  }\n\n  /** @inheritdoc */\n  isEmpty() {\n    return !(\n      this.#bitmapPromise ||\n      this.#bitmap ||\n      this.#bitmapUrl ||\n      this.#bitmapFile\n    );\n  }\n\n  /** @inheritdoc */\n  get isResizable() {\n    return true;\n  }\n\n  /** @inheritdoc */\n  render() {\n    if (this.div) {\n      return this.div;\n    }\n\n    let baseX, baseY;\n    if (this.width) {\n      baseX = this.x;\n      baseY = this.y;\n    }\n\n    super.render();\n    this.div.hidden = true;\n\n    if (this.#bitmap) {\n      this.#createCanvas();\n    } else {\n      this.#getBitmap();\n    }\n\n    if (this.width) {\n      // This editor was created in using copy (ctrl+c).\n      const [parentWidth, parentHeight] = this.parentDimensions;\n      this.setAt(\n        baseX * parentWidth,\n        baseY * parentHeight,\n        this.width * parentWidth,\n        this.height * parentHeight\n      );\n    }\n\n    return this.div;\n  }\n\n  #createCanvas() {\n    const { div } = this;\n    let { width, height } = this.#bitmap;\n    const [pageWidth, pageHeight] = this.pageDimensions;\n    const MAX_RATIO = 0.75;\n    if (this.width) {\n      width = this.width * pageWidth;\n      height = this.height * pageHeight;\n    } else if (\n      width > MAX_RATIO * pageWidth ||\n      height > MAX_RATIO * pageHeight\n    ) {\n      // If the the image is too big compared to the page dimensions\n      // (more than MAX_RATIO) then we scale it down.\n      const factor = Math.min(\n        (MAX_RATIO * pageWidth) / width,\n        (MAX_RATIO * pageHeight) / height\n      );\n      width *= factor;\n      height *= factor;\n    }\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    this.setDims(\n      (width * parentWidth) / pageWidth,\n      (height * parentHeight) / pageHeight\n    );\n\n    this._uiManager.enableWaiting(false);\n    const canvas = (this.#canvas = document.createElement(\"canvas\"));\n    div.append(canvas);\n    div.hidden = false;\n    this.#drawBitmap(width, height);\n    this.#createObserver();\n    if (!this.#hasBeenAddedInUndoStack) {\n      this.parent.addUndoableEditor(this);\n      this.#hasBeenAddedInUndoStack = true;\n    }\n\n    // There are multiple ways to add an image to the page, so here we just\n    // count the number of times an image is added to the page whatever the way\n    // is.\n    this._uiManager._eventBus.dispatch(\"reporttelemetry\", {\n      source: this,\n      details: {\n        type: \"editing\",\n        subtype: this.editorType,\n        data: {\n          action: \"inserted_image\",\n        },\n      },\n    });\n    this.addAltTextButton();\n    if (this.#bitmapFileName) {\n      canvas.setAttribute(\"aria-label\", this.#bitmapFileName);\n    }\n  }\n\n  /**\n   * When the dimensions of the div change the inner canvas must\n   * renew its dimensions, hence it must redraw its own contents.\n   * @param {number} width - the new width of the div\n   * @param {number} height - the new height of the div\n   * @returns\n   */\n  #setDimensions(width, height) {\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    this.width = width / parentWidth;\n    this.height = height / parentHeight;\n    this.setDims(width, height);\n    if (this._initialOptions?.isCentered) {\n      this.center();\n    } else {\n      this.fixAndSetPosition();\n    }\n    this._initialOptions = null;\n    if (this.#resizeTimeoutId !== null) {\n      clearTimeout(this.#resizeTimeoutId);\n    }\n    // When the user is resizing the editor we just use CSS to scale the image\n    // to avoid redrawing it too often.\n    // And once the user stops resizing the editor we redraw the image in\n    // rescaling it correctly (see this.#scaleBitmap).\n    const TIME_TO_WAIT = 200;\n    this.#resizeTimeoutId = setTimeout(() => {\n      this.#resizeTimeoutId = null;\n      this.#drawBitmap(width, height);\n    }, TIME_TO_WAIT);\n  }\n\n  #scaleBitmap(width, height) {\n    const { width: bitmapWidth, height: bitmapHeight } = this.#bitmap;\n\n    let newWidth = bitmapWidth;\n    let newHeight = bitmapHeight;\n    let bitmap = this.#bitmap;\n    while (newWidth > 2 * width || newHeight > 2 * height) {\n      const prevWidth = newWidth;\n      const prevHeight = newHeight;\n\n      if (newWidth > 2 * width) {\n        // See bug 1820511 (Windows specific bug).\n        // TODO: once the above bug is fixed we could revert to:\n        // newWidth = Math.ceil(newWidth / 2);\n        newWidth =\n          newWidth >= 16384\n            ? Math.floor(newWidth / 2) - 1\n            : Math.ceil(newWidth / 2);\n      }\n      if (newHeight > 2 * height) {\n        newHeight =\n          newHeight >= 16384\n            ? Math.floor(newHeight / 2) - 1\n            : Math.ceil(newHeight / 2);\n      }\n\n      const offscreen = new OffscreenCanvas(newWidth, newHeight);\n      const ctx = offscreen.getContext(\"2d\");\n      ctx.drawImage(\n        bitmap,\n        0,\n        0,\n        prevWidth,\n        prevHeight,\n        0,\n        0,\n        newWidth,\n        newHeight\n      );\n      bitmap = offscreen.transferToImageBitmap();\n    }\n\n    return bitmap;\n  }\n\n  #drawBitmap(width, height) {\n    width = Math.ceil(width);\n    height = Math.ceil(height);\n    const canvas = this.#canvas;\n    if (!canvas || (canvas.width === width && canvas.height === height)) {\n      return;\n    }\n    canvas.width = width;\n    canvas.height = height;\n    const bitmap = this.#isSvg\n      ? this.#bitmap\n      : this.#scaleBitmap(width, height);\n    const ctx = canvas.getContext(\"2d\");\n    ctx.filter = this._uiManager.hcmFilter;\n    ctx.drawImage(\n      bitmap,\n      0,\n      0,\n      bitmap.width,\n      bitmap.height,\n      0,\n      0,\n      width,\n      height\n    );\n  }\n\n  /** @inheritdoc */\n  getImageForAltText() {\n    return this.#canvas;\n  }\n\n  #serializeBitmap(toUrl) {\n    if (toUrl) {\n      if (this.#isSvg) {\n        const url = this._uiManager.imageManager.getSvgUrl(this.#bitmapId);\n        if (url) {\n          return url;\n        }\n      }\n      // We convert to a data url because it's sync and the url can live in the\n      // clipboard.\n      const canvas = document.createElement(\"canvas\");\n      ({ width: canvas.width, height: canvas.height } = this.#bitmap);\n      const ctx = canvas.getContext(\"2d\");\n      ctx.drawImage(this.#bitmap, 0, 0);\n\n      return canvas.toDataURL();\n    }\n\n    if (this.#isSvg) {\n      const [pageWidth, pageHeight] = this.pageDimensions;\n      // Multiply by PixelsPerInch.PDF_TO_CSS_UNITS in order to increase the\n      // image resolution when rasterizing it.\n      const width = Math.round(\n        this.width * pageWidth * PixelsPerInch.PDF_TO_CSS_UNITS\n      );\n      const height = Math.round(\n        this.height * pageHeight * PixelsPerInch.PDF_TO_CSS_UNITS\n      );\n      const offscreen = new OffscreenCanvas(width, height);\n      const ctx = offscreen.getContext(\"2d\");\n      ctx.drawImage(\n        this.#bitmap,\n        0,\n        0,\n        this.#bitmap.width,\n        this.#bitmap.height,\n        0,\n        0,\n        width,\n        height\n      );\n      return offscreen.transferToImageBitmap();\n    }\n\n    return structuredClone(this.#bitmap);\n  }\n\n  /**\n   * Create the resize observer.\n   */\n  #createObserver() {\n    this.#observer = new ResizeObserver(entries => {\n      const rect = entries[0].contentRect;\n      if (rect.width && rect.height) {\n        this.#setDimensions(rect.width, rect.height);\n      }\n    });\n    this.#observer.observe(this.div);\n  }\n\n  /** @inheritdoc */\n  static deserialize(data, parent, uiManager) {\n    if (data instanceof StampAnnotationElement) {\n      return null;\n    }\n    const editor = super.deserialize(data, parent, uiManager);\n    const { rect, bitmapUrl, bitmapId, isSvg, accessibilityData } = data;\n    if (bitmapId && uiManager.imageManager.isValidId(bitmapId)) {\n      editor.#bitmapId = bitmapId;\n    } else {\n      editor.#bitmapUrl = bitmapUrl;\n    }\n    editor.#isSvg = isSvg;\n\n    const [parentWidth, parentHeight] = editor.pageDimensions;\n    editor.width = (rect[2] - rect[0]) / parentWidth;\n    editor.height = (rect[3] - rect[1]) / parentHeight;\n\n    if (accessibilityData) {\n      editor.altTextData = accessibilityData;\n    }\n\n    return editor;\n  }\n\n  /** @inheritdoc */\n  serialize(isForCopying = false, context = null) {\n    if (this.isEmpty()) {\n      return null;\n    }\n\n    const serialized = {\n      annotationType: AnnotationEditorType.STAMP,\n      bitmapId: this.#bitmapId,\n      pageIndex: this.pageIndex,\n      rect: this.getRect(0, 0),\n      rotation: this.rotation,\n      isSvg: this.#isSvg,\n      structTreeParentId: this._structTreeParentId,\n    };\n\n    if (isForCopying) {\n      // We don't know what's the final destination (this pdf or another one)\n      // of this annotation and the clipboard doesn't support ImageBitmaps,\n      // hence we serialize the bitmap to a data url.\n      serialized.bitmapUrl = this.#serializeBitmap(/* toUrl = */ true);\n      serialized.accessibilityData = this.altTextData;\n      return serialized;\n    }\n\n    const { decorative, altText } = this.altTextData;\n    if (!decorative && altText) {\n      serialized.accessibilityData = { type: \"Figure\", alt: altText };\n    }\n\n    if (context === null) {\n      return serialized;\n    }\n\n    context.stamps ||= new Map();\n    const area = this.#isSvg\n      ? (serialized.rect[2] - serialized.rect[0]) *\n        (serialized.rect[3] - serialized.rect[1])\n      : null;\n    if (!context.stamps.has(this.#bitmapId)) {\n      // We don't want to have multiple copies of the same bitmap in the\n      // annotationMap, hence we only add the bitmap the first time we meet it.\n      context.stamps.set(this.#bitmapId, { area, serialized });\n      serialized.bitmap = this.#serializeBitmap(/* toUrl = */ false);\n    } else if (this.#isSvg) {\n      // If we have multiple copies of the same svg but with different sizes,\n      // then we want to keep the biggest one.\n      const prevData = context.stamps.get(this.#bitmapId);\n      if (area > prevData.area) {\n        prevData.area = area;\n        prevData.serialized.bitmap.close();\n        prevData.serialized.bitmap = this.#serializeBitmap(/* toUrl = */ false);\n      }\n    }\n    return serialized;\n  }\n}\n\nexport { StampEditor };\n", "/* Copyright 2022 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// eslint-disable-next-line max-len\n/** @typedef {import(\"./tools.js\").AnnotationEditorUIManager} AnnotationEditorUIManager */\n/** @typedef {import(\"../display_utils.js\").PageViewport} PageViewport */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../../../web/text_accessibility.js\").TextAccessibilityManager} TextAccessibilityManager */\n/** @typedef {import(\"../../../web/interfaces\").IL10n} IL10n */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../annotation_layer.js\").AnnotationLayer} AnnotationLayer */\n/** @typedef {import(\"../draw_layer.js\").DrawLayer} DrawLayer */\n\nimport { AnnotationEditorType, FeatureTest } from \"../../shared/util.js\";\nimport { AnnotationEditor } from \"./editor.js\";\nimport { FreeTextEditor } from \"./freetext.js\";\nimport { HighlightEditor } from \"./highlight.js\";\nimport { InkEditor } from \"./ink.js\";\nimport { setLayerDimensions } from \"../display_utils.js\";\nimport { StampEditor } from \"./stamp.js\";\n\n/**\n * @typedef {Object} AnnotationEditorLayerOptions\n * @property {Object} mode\n * @property {HTMLDivElement} div\n * @property {AnnotationEditorUIManager} uiManager\n * @property {boolean} enabled\n * @property {TextAccessibilityManager} [accessibilityManager]\n * @property {number} pageIndex\n * @property {IL10n} l10n\n * @property {AnnotationLayer} [annotationLayer]\n * @property {HTMLDivElement} [textLayer]\n * @property {DrawLayer} drawLayer\n * @property {PageViewport} viewport\n */\n\n/**\n * @typedef {Object} RenderEditorLayerOptions\n * @property {PageViewport} viewport\n */\n\n/**\n * Manage all the different editors on a page.\n */\nclass AnnotationEditorLayer {\n  #accessibilityManager;\n\n  #allowClick = false;\n\n  #annotationLayer = null;\n\n  #boundPointerup = this.pointerup.bind(this);\n\n  #boundPointerUpAfterSelection = this.pointerUpAfterSelection.bind(this);\n\n  #boundPointerdown = this.pointerdown.bind(this);\n\n  #editorFocusTimeoutId = null;\n\n  #boundSelectionStart = this.selectionStart.bind(this);\n\n  #editors = new Map();\n\n  #hadPointerDown = false;\n\n  #isCleaningUp = false;\n\n  #isDisabling = false;\n\n  #textLayer = null;\n\n  #uiManager;\n\n  static _initialized = false;\n\n  static #editorTypes = new Map(\n    [FreeTextEditor, InkEditor, StampEditor, HighlightEditor].map(type => [\n      type._editorType,\n      type,\n    ])\n  );\n\n  /**\n   * @param {AnnotationEditorLayerOptions} options\n   */\n  constructor({\n    uiManager,\n    pageIndex,\n    div,\n    accessibilityManager,\n    annotationLayer,\n    drawLayer,\n    textLayer,\n    viewport,\n    l10n,\n  }) {\n    const editorTypes = [...AnnotationEditorLayer.#editorTypes.values()];\n    if (!AnnotationEditorLayer._initialized) {\n      AnnotationEditorLayer._initialized = true;\n      for (const editorType of editorTypes) {\n        editorType.initialize(l10n);\n      }\n    }\n    uiManager.registerEditorTypes(editorTypes);\n\n    this.#uiManager = uiManager;\n    this.pageIndex = pageIndex;\n    this.div = div;\n    this.#accessibilityManager = accessibilityManager;\n    this.#annotationLayer = annotationLayer;\n    this.viewport = viewport;\n    this.#textLayer = textLayer;\n    this.drawLayer = drawLayer;\n\n    this.#uiManager.addLayer(this);\n  }\n\n  get isEmpty() {\n    return this.#editors.size === 0;\n  }\n\n  /**\n   * Update the toolbar if it's required to reflect the tool currently used.\n   * @param {number} mode\n   */\n  updateToolbar(mode) {\n    this.#uiManager.updateToolbar(mode);\n  }\n\n  /**\n   * The mode has changed: it must be updated.\n   * @param {number} mode\n   */\n  updateMode(mode = this.#uiManager.getMode()) {\n    this.#cleanup();\n    switch (mode) {\n      case AnnotationEditorType.NONE:\n        this.disableTextSelection();\n        this.togglePointerEvents(false);\n        this.disableClick();\n        break;\n      case AnnotationEditorType.INK:\n        // We always want to have an ink editor ready to draw in.\n        this.addInkEditorIfNeeded(false);\n\n        this.disableTextSelection();\n        this.togglePointerEvents(true);\n        this.disableClick();\n        break;\n      case AnnotationEditorType.HIGHLIGHT:\n        this.enableTextSelection();\n        this.togglePointerEvents(false);\n        this.disableClick();\n        break;\n      default:\n        this.disableTextSelection();\n        this.togglePointerEvents(true);\n        this.enableClick();\n    }\n\n    if (mode !== AnnotationEditorType.NONE) {\n      const { classList } = this.div;\n      for (const editorType of AnnotationEditorLayer.#editorTypes.values()) {\n        classList.toggle(\n          `${editorType._type}Editing`,\n          mode === editorType._editorType\n        );\n      }\n      this.div.hidden = false;\n    }\n  }\n\n  addInkEditorIfNeeded(isCommitting) {\n    if (this.#uiManager.getMode() !== AnnotationEditorType.INK) {\n      // We don't want to add an ink editor if we're not in ink mode!\n      return;\n    }\n\n    if (!isCommitting) {\n      // We're removing an editor but an empty one can already exist so in this\n      // case we don't need to create a new one.\n      for (const editor of this.#editors.values()) {\n        if (editor.isEmpty()) {\n          editor.setInBackground();\n          return;\n        }\n      }\n    }\n\n    const editor = this.#createAndAddNewEditor(\n      { offsetX: 0, offsetY: 0 },\n      /* isCentered = */ false\n    );\n    editor.setInBackground();\n  }\n\n  /**\n   * Set the editing state.\n   * @param {boolean} isEditing\n   */\n  setEditingState(isEditing) {\n    this.#uiManager.setEditingState(isEditing);\n  }\n\n  /**\n   * Add some commands into the CommandManager (undo/redo stuff).\n   * @param {Object} params\n   */\n  addCommands(params) {\n    this.#uiManager.addCommands(params);\n  }\n\n  togglePointerEvents(enabled = false) {\n    this.div.classList.toggle(\"disabled\", !enabled);\n  }\n\n  /**\n   * Enable pointer events on the main div in order to enable\n   * editor creation.\n   */\n  enable() {\n    this.togglePointerEvents(true);\n    const annotationElementIds = new Set();\n    for (const editor of this.#editors.values()) {\n      editor.enableEditing();\n      if (editor.annotationElementId) {\n        annotationElementIds.add(editor.annotationElementId);\n      }\n    }\n\n    if (!this.#annotationLayer) {\n      return;\n    }\n\n    const editables = this.#annotationLayer.getEditableAnnotations();\n    for (const editable of editables) {\n      // The element must be hidden whatever its state is.\n      editable.hide();\n      if (this.#uiManager.isDeletedAnnotationElement(editable.data.id)) {\n        continue;\n      }\n      if (annotationElementIds.has(editable.data.id)) {\n        continue;\n      }\n      const editor = this.deserialize(editable);\n      if (!editor) {\n        continue;\n      }\n      this.addOrRebuild(editor);\n      editor.enableEditing();\n    }\n  }\n\n  /**\n   * Disable editor creation.\n   */\n  disable() {\n    this.#isDisabling = true;\n    this.togglePointerEvents(false);\n    const hiddenAnnotationIds = new Set();\n    for (const editor of this.#editors.values()) {\n      editor.disableEditing();\n      if (!editor.annotationElementId || editor.serialize() !== null) {\n        hiddenAnnotationIds.add(editor.annotationElementId);\n        continue;\n      }\n      this.getEditableAnnotation(editor.annotationElementId)?.show();\n      editor.remove();\n    }\n\n    if (this.#annotationLayer) {\n      // Show the annotations that were hidden in enable().\n      const editables = this.#annotationLayer.getEditableAnnotations();\n      for (const editable of editables) {\n        const { id } = editable.data;\n        if (\n          hiddenAnnotationIds.has(id) ||\n          this.#uiManager.isDeletedAnnotationElement(id)\n        ) {\n          continue;\n        }\n        editable.show();\n      }\n    }\n\n    this.#cleanup();\n    if (this.isEmpty) {\n      this.div.hidden = true;\n    }\n    const { classList } = this.div;\n    for (const editorType of AnnotationEditorLayer.#editorTypes.values()) {\n      classList.remove(`${editorType._type}Editing`);\n    }\n    this.disableTextSelection();\n\n    this.#isDisabling = false;\n  }\n\n  getEditableAnnotation(id) {\n    return this.#annotationLayer?.getEditableAnnotation(id) || null;\n  }\n\n  /**\n   * Set the current editor.\n   * @param {AnnotationEditor} editor\n   */\n  setActiveEditor(editor) {\n    const currentActive = this.#uiManager.getActive();\n    if (currentActive === editor) {\n      return;\n    }\n\n    this.#uiManager.setActiveEditor(editor);\n  }\n\n  enableTextSelection() {\n    if (this.#textLayer?.div) {\n      document.addEventListener(\"selectstart\", this.#boundSelectionStart);\n    }\n  }\n\n  disableTextSelection() {\n    if (this.#textLayer?.div) {\n      document.removeEventListener(\"selectstart\", this.#boundSelectionStart);\n    }\n  }\n\n  enableClick() {\n    this.div.addEventListener(\"pointerdown\", this.#boundPointerdown);\n    this.div.addEventListener(\"pointerup\", this.#boundPointerup);\n  }\n\n  disableClick() {\n    this.div.removeEventListener(\"pointerdown\", this.#boundPointerdown);\n    this.div.removeEventListener(\"pointerup\", this.#boundPointerup);\n  }\n\n  attach(editor) {\n    this.#editors.set(editor.id, editor);\n    const { annotationElementId } = editor;\n    if (\n      annotationElementId &&\n      this.#uiManager.isDeletedAnnotationElement(annotationElementId)\n    ) {\n      this.#uiManager.removeDeletedAnnotationElement(editor);\n    }\n  }\n\n  detach(editor) {\n    this.#editors.delete(editor.id);\n    this.#accessibilityManager?.removePointerInTextLayer(editor.contentDiv);\n\n    if (!this.#isDisabling && editor.annotationElementId) {\n      this.#uiManager.addDeletedAnnotationElement(editor);\n    }\n  }\n\n  /**\n   * Remove an editor.\n   * @param {AnnotationEditor} editor\n   */\n  remove(editor) {\n    // Since we can undo a removal we need to keep the\n    // parent property as it is, so don't null it!\n\n    this.detach(editor);\n    this.#uiManager.removeEditor(editor);\n    editor.div.remove();\n    editor.isAttachedToDOM = false;\n\n    if (!this.#isCleaningUp) {\n      this.addInkEditorIfNeeded(/* isCommitting = */ false);\n    }\n  }\n\n  /**\n   * An editor can have a different parent, for example after having\n   * being dragged and droped from a page to another.\n   * @param {AnnotationEditor} editor\n   */\n  changeParent(editor) {\n    if (editor.parent === this) {\n      return;\n    }\n\n    if (editor.annotationElementId) {\n      this.#uiManager.addDeletedAnnotationElement(editor.annotationElementId);\n      AnnotationEditor.deleteAnnotationElement(editor);\n      editor.annotationElementId = null;\n    }\n\n    this.attach(editor);\n    editor.parent?.detach(editor);\n    editor.setParent(this);\n    if (editor.div && editor.isAttachedToDOM) {\n      editor.div.remove();\n      this.div.append(editor.div);\n    }\n  }\n\n  /**\n   * Add a new editor in the current view.\n   * @param {AnnotationEditor} editor\n   */\n  add(editor) {\n    this.changeParent(editor);\n    this.#uiManager.addEditor(editor);\n    this.attach(editor);\n\n    if (!editor.isAttachedToDOM) {\n      const div = editor.render();\n      this.div.append(div);\n      editor.isAttachedToDOM = true;\n    }\n\n    // The editor will be correctly moved into the DOM (see fixAndSetPosition).\n    editor.fixAndSetPosition();\n    editor.onceAdded();\n    this.#uiManager.addToAnnotationStorage(editor);\n  }\n\n  moveEditorInDOM(editor) {\n    if (!editor.isAttachedToDOM) {\n      return;\n    }\n\n    const { activeElement } = document;\n    if (editor.div.contains(activeElement) && !this.#editorFocusTimeoutId) {\n      // When the div is moved in the DOM the focus can move somewhere else,\n      // so we want to be sure that the focus will stay on the editor but we\n      // don't want to call any focus callbacks, hence we disable them and only\n      // re-enable them when the editor has the focus.\n      editor._focusEventsAllowed = false;\n      this.#editorFocusTimeoutId = setTimeout(() => {\n        this.#editorFocusTimeoutId = null;\n        if (!editor.div.contains(document.activeElement)) {\n          editor.div.addEventListener(\n            \"focusin\",\n            () => {\n              editor._focusEventsAllowed = true;\n            },\n            { once: true }\n          );\n          activeElement.focus();\n        } else {\n          editor._focusEventsAllowed = true;\n        }\n      }, 0);\n    }\n\n    editor._structTreeParentId = this.#accessibilityManager?.moveElementInDOM(\n      this.div,\n      editor.div,\n      editor.contentDiv,\n      /* isRemovable = */ true\n    );\n  }\n\n  /**\n   * Add or rebuild depending if it has been removed or not.\n   * @param {AnnotationEditor} editor\n   */\n  addOrRebuild(editor) {\n    if (editor.needsToBeRebuilt()) {\n      editor.parent ||= this;\n      editor.rebuild();\n    } else {\n      this.add(editor);\n    }\n  }\n\n  /**\n   * Add a new editor and make this addition undoable.\n   * @param {AnnotationEditor} editor\n   */\n  addUndoableEditor(editor) {\n    const cmd = () => editor._uiManager.rebuild(editor);\n    const undo = () => {\n      editor.remove();\n    };\n\n    this.addCommands({ cmd, undo, mustExec: false });\n  }\n\n  /**\n   * Get an id for an editor.\n   * @returns {string}\n   */\n  getNextId() {\n    return this.#uiManager.getId();\n  }\n\n  get #currentEditorType() {\n    return AnnotationEditorLayer.#editorTypes.get(this.#uiManager.getMode());\n  }\n\n  /**\n   * Create a new editor\n   * @param {Object} params\n   * @returns {AnnotationEditor}\n   */\n  #createNewEditor(params) {\n    const editorType = this.#currentEditorType;\n    return editorType ? new editorType.prototype.constructor(params) : null;\n  }\n\n  canCreateNewEmptyEditor() {\n    return this.#currentEditorType?.canCreateNewEmptyEditor();\n  }\n\n  /**\n   * Paste some content into a new editor.\n   * @param {number} mode\n   * @param {Object} params\n   */\n  pasteEditor(mode, params) {\n    this.#uiManager.updateToolbar(mode);\n    this.#uiManager.updateMode(mode);\n\n    const { offsetX, offsetY } = this.#getCenterPoint();\n    const id = this.getNextId();\n    const editor = this.#createNewEditor({\n      parent: this,\n      id,\n      x: offsetX,\n      y: offsetY,\n      uiManager: this.#uiManager,\n      isCentered: true,\n      ...params,\n    });\n    if (editor) {\n      this.add(editor);\n    }\n  }\n\n  /**\n   * Create a new editor\n   * @param {Object} data\n   * @returns {AnnotationEditor | null}\n   */\n  deserialize(data) {\n    return (\n      AnnotationEditorLayer.#editorTypes\n        .get(data.annotationType ?? data.annotationEditorType)\n        ?.deserialize(data, this, this.#uiManager) || null\n    );\n  }\n\n  /**\n   * Create and add a new editor.\n   * @param {PointerEvent} event\n   * @param {boolean} isCentered\n   * @param [Object] data\n   * @returns {AnnotationEditor}\n   */\n  #createAndAddNewEditor(event, isCentered, data = {}) {\n    const id = this.getNextId();\n    const editor = this.#createNewEditor({\n      parent: this,\n      id,\n      x: event.offsetX,\n      y: event.offsetY,\n      uiManager: this.#uiManager,\n      isCentered,\n      ...data,\n    });\n    if (editor) {\n      this.add(editor);\n    }\n\n    return editor;\n  }\n\n  #getCenterPoint() {\n    const { x, y, width, height } = this.div.getBoundingClientRect();\n    const tlX = Math.max(0, x);\n    const tlY = Math.max(0, y);\n    const brX = Math.min(window.innerWidth, x + width);\n    const brY = Math.min(window.innerHeight, y + height);\n    const centerX = (tlX + brX) / 2 - x;\n    const centerY = (tlY + brY) / 2 - y;\n    const [offsetX, offsetY] =\n      this.viewport.rotation % 180 === 0\n        ? [centerX, centerY]\n        : [centerY, centerX];\n\n    return { offsetX, offsetY };\n  }\n\n  /**\n   * Create and add a new editor.\n   */\n  addNewEditor() {\n    this.#createAndAddNewEditor(\n      this.#getCenterPoint(),\n      /* isCentered = */ true\n    );\n  }\n\n  /**\n   * Set the last selected editor.\n   * @param {AnnotationEditor} editor\n   */\n  setSelected(editor) {\n    this.#uiManager.setSelected(editor);\n  }\n\n  /**\n   * Add or remove an editor the current selection.\n   * @param {AnnotationEditor} editor\n   */\n  toggleSelected(editor) {\n    this.#uiManager.toggleSelected(editor);\n  }\n\n  /**\n   * Check if the editor is selected.\n   * @param {AnnotationEditor} editor\n   */\n  isSelected(editor) {\n    return this.#uiManager.isSelected(editor);\n  }\n\n  /**\n   * Unselect an editor.\n   * @param {AnnotationEditor} editor\n   */\n  unselect(editor) {\n    this.#uiManager.unselect(editor);\n  }\n\n  /**\n   * SelectionChange callback.\n   * @param {Event} _event\n   */\n  selectionStart(_event) {\n    this.#textLayer?.div.addEventListener(\n      \"pointerup\",\n      this.#boundPointerUpAfterSelection,\n      { once: true }\n    );\n  }\n\n  /**\n   * Called when the user releases the mouse button after having selected\n   * some text.\n   * @param {PointerEvent} event\n   */\n  pointerUpAfterSelection(event) {\n    const selection = document.getSelection();\n    if (selection.rangeCount === 0) {\n      return;\n    }\n    const range = selection.getRangeAt(0);\n    if (range.collapsed) {\n      return;\n    }\n\n    if (!this.#textLayer?.div.contains(range.commonAncestorContainer)) {\n      return;\n    }\n\n    const {\n      x: layerX,\n      y: layerY,\n      width: parentWidth,\n      height: parentHeight,\n    } = this.#textLayer.div.getBoundingClientRect();\n    const bboxes = range.getClientRects();\n\n    // We must rotate the boxes because we want to have them in the non-rotated\n    // page coordinates.\n    let rotator;\n    switch (this.viewport.rotation) {\n      case 90:\n        rotator = (x, y, w, h) => ({\n          x: (y - layerY) / parentHeight,\n          y: 1 - (x + w - layerX) / parentWidth,\n          width: h / parentHeight,\n          height: w / parentWidth,\n        });\n        break;\n      case 180:\n        rotator = (x, y, w, h) => ({\n          x: 1 - (x + w - layerX) / parentWidth,\n          y: 1 - (y + h - layerY) / parentHeight,\n          width: w / parentWidth,\n          height: h / parentHeight,\n        });\n        break;\n      case 270:\n        rotator = (x, y, w, h) => ({\n          x: 1 - (y + h - layerY) / parentHeight,\n          y: (x - layerX) / parentWidth,\n          width: h / parentHeight,\n          height: w / parentWidth,\n        });\n        break;\n      default:\n        rotator = (x, y, w, h) => ({\n          x: (x - layerX) / parentWidth,\n          y: (y - layerY) / parentHeight,\n          width: w / parentWidth,\n          height: h / parentHeight,\n        });\n        break;\n    }\n\n    const boxes = [];\n    for (const { x, y, width, height } of bboxes) {\n      if (width === 0 || height === 0) {\n        continue;\n      }\n      boxes.push(rotator(x, y, width, height));\n    }\n    if (boxes.length !== 0) {\n      this.#createAndAddNewEditor(event, false, {\n        boxes,\n      });\n    }\n    selection.empty();\n  }\n\n  /**\n   * Pointerup callback.\n   * @param {PointerEvent} event\n   */\n  pointerup(event) {\n    const { isMac } = FeatureTest.platform;\n    if (event.button !== 0 || (event.ctrlKey && isMac)) {\n      // Don't create an editor on right click.\n      return;\n    }\n\n    if (event.target !== this.div) {\n      return;\n    }\n\n    if (!this.#hadPointerDown) {\n      // It can happen when the user starts a drag inside a text editor\n      // and then releases the mouse button outside of it. In such a case\n      // we don't want to create a new editor, hence we check that a pointerdown\n      // occurred on this div previously.\n      return;\n    }\n    this.#hadPointerDown = false;\n\n    if (!this.#allowClick) {\n      this.#allowClick = true;\n      return;\n    }\n\n    if (this.#uiManager.getMode() === AnnotationEditorType.STAMP) {\n      this.#uiManager.unselectAll();\n      return;\n    }\n\n    this.#createAndAddNewEditor(event, /* isCentered = */ false);\n  }\n\n  /**\n   * Pointerdown callback.\n   * @param {PointerEvent} event\n   */\n  pointerdown(event) {\n    if (this.#uiManager.getMode() === AnnotationEditorType.HIGHLIGHT) {\n      this.enableTextSelection();\n    }\n    if (this.#hadPointerDown) {\n      // It's possible to have a second pointerdown event before a pointerup one\n      // when the user puts a finger on a touchscreen and then add a second one\n      // to start a pinch-to-zoom gesture.\n      // That said, in case it's possible to have two pointerdown events with\n      // a mouse, we don't want to create a new editor in such a case either.\n      this.#hadPointerDown = false;\n      return;\n    }\n    const { isMac } = FeatureTest.platform;\n    if (event.button !== 0 || (event.ctrlKey && isMac)) {\n      // Do nothing on right click.\n      return;\n    }\n\n    if (event.target !== this.div) {\n      return;\n    }\n\n    this.#hadPointerDown = true;\n\n    const editor = this.#uiManager.getActive();\n    this.#allowClick = !editor || editor.isEmpty();\n  }\n\n  /**\n   *\n   * @param {AnnotationEditor} editor\n   * @param {number} x\n   * @param {number} y\n   * @returns\n   */\n  findNewParent(editor, x, y) {\n    const layer = this.#uiManager.findParent(x, y);\n    if (layer === null || layer === this) {\n      return false;\n    }\n    layer.changeParent(editor);\n    return true;\n  }\n\n  /**\n   * Destroy the main editor.\n   */\n  destroy() {\n    if (this.#uiManager.getActive()?.parent === this) {\n      // We need to commit the current editor before destroying the layer.\n      this.#uiManager.commitOrRemove();\n      this.#uiManager.setActiveEditor(null);\n    }\n\n    if (this.#editorFocusTimeoutId) {\n      clearTimeout(this.#editorFocusTimeoutId);\n      this.#editorFocusTimeoutId = null;\n    }\n\n    for (const editor of this.#editors.values()) {\n      this.#accessibilityManager?.removePointerInTextLayer(editor.contentDiv);\n      editor.setParent(null);\n      editor.isAttachedToDOM = false;\n      editor.div.remove();\n    }\n    this.div = null;\n    this.#editors.clear();\n    this.#uiManager.removeLayer(this);\n  }\n\n  #cleanup() {\n    // When we're cleaning up, some editors are removed but we don't want\n    // to add a new one which will induce an addition in this.#editors, hence\n    // an infinite loop.\n    this.#isCleaningUp = true;\n    for (const editor of this.#editors.values()) {\n      if (editor.isEmpty()) {\n        editor.remove();\n      }\n    }\n    this.#isCleaningUp = false;\n  }\n\n  /**\n   * Render the main editor.\n   * @param {RenderEditorLayerOptions} parameters\n   */\n  render({ viewport }) {\n    this.viewport = viewport;\n    setLayerDimensions(this.div, viewport);\n    for (const editor of this.#uiManager.getEditors(this.pageIndex)) {\n      this.add(editor);\n    }\n    this.updateMode();\n  }\n\n  /**\n   * Update the main editor.\n   * @param {RenderEditorLayerOptions} parameters\n   */\n  update({ viewport }) {\n    // Editors have their dimensions/positions in percent so to avoid any\n    // issues (see #15582), we must commit the current one before changing\n    // the viewport.\n    this.#uiManager.commitOrRemove();\n\n    const oldRotation = this.viewport.rotation;\n    const rotation = viewport.rotation;\n    this.viewport = viewport;\n    setLayerDimensions(this.div, { rotation });\n    if (oldRotation !== rotation) {\n      for (const editor of this.#editors.values()) {\n        editor.rotate(rotation);\n      }\n    }\n    this.updateMode();\n  }\n\n  /**\n   * Get page dimensions.\n   * @returns {Object} dimensions.\n   */\n  get pageDimensions() {\n    const { pageWidth, pageHeight } = this.viewport.rawDims;\n    return [pageWidth, pageHeight];\n  }\n}\n\nexport { AnnotationEditorLayer };\n", "/* Copyright 2023 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { AnnotationEditorParamsType, shadow } from \"../../shared/util.js\";\nimport { KeyboardManager } from \"./tools.js\";\nimport { noContextMenu } from \"../display_utils.js\";\n\nclass ColorPicker {\n  #boundKeyDown = this.#keyDown.bind(this);\n\n  #button = null;\n\n  #buttonSwatch = null;\n\n  #defaultColor;\n\n  #dropdown = null;\n\n  #dropdownWasFromKeyboard = false;\n\n  #isMainColorPicker = false;\n\n  #eventBus;\n\n  #uiManager = null;\n\n  static get _keyboardManager() {\n    return shadow(\n      this,\n      \"_keyboardManager\",\n      new KeyboardManager([\n        [\n          [\"Escape\", \"mac+Escape\"],\n          ColorPicker.prototype._hideDropdownFromKeyboard,\n        ],\n        [[\" \", \"mac+ \"], ColorPicker.prototype._colorSelectFromKeyboard],\n        [\n          [\"ArrowDown\", \"ArrowRight\", \"mac+ArrowDown\", \"mac+ArrowRight\"],\n          ColorPicker.prototype._moveToNext,\n        ],\n        [\n          [\"ArrowUp\", \"ArrowLeft\", \"mac+ArrowUp\", \"mac+ArrowLeft\"],\n          ColorPicker.prototype._moveToPrevious,\n        ],\n        [[\"Home\", \"mac+Home\"], ColorPicker.prototype._moveToBeginning],\n        [[\"End\", \"mac+End\"], ColorPicker.prototype._moveToEnd],\n      ])\n    );\n  }\n\n  constructor({ editor = null, uiManager = null }) {\n    this.#isMainColorPicker = !editor;\n    this.#uiManager = editor?._uiManager || uiManager;\n    this.#eventBus = this.#uiManager._eventBus;\n    this.#defaultColor =\n      editor?.color ||\n      this.#uiManager?.highlightColors.values().next().value ||\n      \"#FFFF98\";\n  }\n\n  renderButton() {\n    const button = (this.#button = document.createElement(\"button\"));\n    button.className = \"colorPicker\";\n    button.tabIndex = \"0\";\n    button.setAttribute(\"data-l10n-id\", \"pdfjs-editor-colorpicker-button\");\n    button.setAttribute(\"aria-haspopup\", true);\n    button.addEventListener(\"click\", this.#openDropdown.bind(this));\n    const swatch = (this.#buttonSwatch = document.createElement(\"span\"));\n    swatch.className = \"swatch\";\n    swatch.style.backgroundColor = this.#defaultColor;\n    button.append(swatch);\n    return button;\n  }\n\n  renderMainDropdown() {\n    const dropdown = (this.#dropdown = this.#getDropdownRoot(\n      AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR\n    ));\n    dropdown.setAttribute(\"aria-orientation\", \"horizontal\");\n    dropdown.setAttribute(\"aria-labelledby\", \"highlightColorPickerLabel\");\n\n    return dropdown;\n  }\n\n  #getDropdownRoot(paramType) {\n    const div = document.createElement(\"div\");\n    div.addEventListener(\"contextmenu\", noContextMenu);\n    div.className = \"dropdown\";\n    div.role = \"listbox\";\n    div.setAttribute(\"aria-multiselectable\", false);\n    div.setAttribute(\"aria-orientation\", \"vertical\");\n    div.setAttribute(\"data-l10n-id\", \"pdfjs-editor-colorpicker-dropdown\");\n    for (const [name, color] of this.#uiManager.highlightColors) {\n      const button = document.createElement(\"button\");\n      button.tabIndex = \"0\";\n      button.role = \"option\";\n      button.setAttribute(\"data-color\", color);\n      button.title = name;\n      button.setAttribute(\"data-l10n-id\", `pdfjs-editor-colorpicker-${name}`);\n      const swatch = document.createElement(\"span\");\n      button.append(swatch);\n      swatch.className = \"swatch\";\n      swatch.style.backgroundColor = color;\n      button.setAttribute(\"aria-selected\", color === this.#defaultColor);\n      button.addEventListener(\n        \"click\",\n        this.#colorSelect.bind(this, paramType, color)\n      );\n      div.append(button);\n    }\n\n    div.addEventListener(\"keydown\", this.#boundKeyDown);\n\n    return div;\n  }\n\n  #colorSelect(type, color, event) {\n    event.stopPropagation();\n    this.#eventBus.dispatch(\"switchannotationeditorparams\", {\n      source: this,\n      type,\n      value: color,\n    });\n  }\n\n  _colorSelectFromKeyboard(event) {\n    const color = event.target.getAttribute(\"data-color\");\n    if (!color) {\n      return;\n    }\n    this.#colorSelect(color, event);\n  }\n\n  _moveToNext(event) {\n    if (event.target === this.#button) {\n      this.#dropdown.firstChild?.focus();\n      return;\n    }\n    event.target.nextSibling?.focus();\n  }\n\n  _moveToPrevious(event) {\n    event.target.previousSibling?.focus();\n  }\n\n  _moveToBeginning() {\n    this.#dropdown.firstChild?.focus();\n  }\n\n  _moveToEnd() {\n    this.#dropdown.lastChild?.focus();\n  }\n\n  #keyDown(event) {\n    ColorPicker._keyboardManager.exec(this, event);\n  }\n\n  #openDropdown(event) {\n    if (this.#dropdown && !this.#dropdown.classList.contains(\"hidden\")) {\n      this.hideDropdown();\n      return;\n    }\n    this.#button.addEventListener(\"keydown\", this.#boundKeyDown);\n    this.#dropdownWasFromKeyboard = event.detail === 0;\n    if (this.#dropdown) {\n      this.#dropdown.classList.remove(\"hidden\");\n      return;\n    }\n    const root = (this.#dropdown = this.#getDropdownRoot(\n      AnnotationEditorParamsType.HIGHLIGHT_COLOR\n    ));\n    this.#button.append(root);\n  }\n\n  hideDropdown() {\n    this.#dropdown?.classList.add(\"hidden\");\n  }\n\n  _hideDropdownFromKeyboard() {\n    if (\n      this.#isMainColorPicker ||\n      !this.#dropdown ||\n      this.#dropdown.classList.contains(\"hidden\")\n    ) {\n      return;\n    }\n    this.hideDropdown();\n    this.#button.removeEventListener(\"keydown\", this.#boundKeyDown);\n    this.#button.focus({\n      preventScroll: true,\n      focusVisible: this.#dropdownWasFromKeyboard,\n    });\n  }\n\n  updateColor(color) {\n    if (this.#buttonSwatch) {\n      this.#buttonSwatch.style.backgroundColor = color;\n    }\n    if (!this.#dropdown) {\n      return;\n    }\n\n    const i = this.#uiManager.highlightColors.values();\n    for (const child of this.#dropdown.children) {\n      child.setAttribute(\"aria-selected\", i.next().value === color);\n    }\n  }\n\n  destroy() {\n    this.#button?.remove();\n    this.#button = null;\n    this.#buttonSwatch = null;\n    this.#dropdown?.remove();\n    this.#dropdown = null;\n  }\n}\n\nexport { ColorPicker };\n", "/* Copyright 2023 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { noContextMenu } from \"../display_utils.js\";\n\nclass AltText {\n  #altText = \"\";\n\n  #altTextDecorative = false;\n\n  #altTextButton = null;\n\n  #altTextTooltip = null;\n\n  #altTextTooltipTimeout = null;\n\n  #altTextWasFromKeyBoard = false;\n\n  #editor = null;\n\n  static _l10nPromise = null;\n\n  constructor(editor) {\n    this.#editor = editor;\n  }\n\n  static initialize(l10nPromise) {\n    AltText._l10nPromise ||= l10nPromise;\n  }\n\n  async render() {\n    const altText = (this.#altTextButton = document.createElement(\"button\"));\n    altText.className = \"altText\";\n    const msg = await AltText._l10nPromise.get(\n      \"pdfjs-editor-alt-text-button-label\"\n    );\n    altText.textContent = msg;\n    altText.setAttribute(\"aria-label\", msg);\n    altText.tabIndex = \"0\";\n    altText.addEventListener(\"contextmenu\", noContextMenu);\n    altText.addEventListener(\"pointerdown\", event => event.stopPropagation());\n\n    const onClick = event => {\n      event.preventDefault();\n      this.#editor._uiManager.editAltText(this.#editor);\n    };\n    altText.addEventListener(\"click\", onClick, { capture: true });\n    altText.addEventListener(\"keydown\", event => {\n      if (event.target === altText && event.key === \"Enter\") {\n        this.#altTextWasFromKeyBoard = true;\n        onClick(event);\n      }\n    });\n    await this.#setState();\n\n    return altText;\n  }\n\n  finish() {\n    if (!this.#altTextButton) {\n      return;\n    }\n    this.#altTextButton.focus({ focusVisible: this.#altTextWasFromKeyBoard });\n    this.#altTextWasFromKeyBoard = false;\n  }\n\n  get data() {\n    return {\n      altText: this.#altText,\n      decorative: this.#altTextDecorative,\n    };\n  }\n\n  /**\n   * Set the alt text data.\n   */\n  set data({ altText, decorative }) {\n    if (this.#altText === altText && this.#altTextDecorative === decorative) {\n      return;\n    }\n    this.#altText = altText;\n    this.#altTextDecorative = decorative;\n    this.#setState();\n  }\n\n  toggle(enabled = false) {\n    if (!this.#altTextButton) {\n      return;\n    }\n    if (!enabled && this.#altTextTooltipTimeout) {\n      clearTimeout(this.#altTextTooltipTimeout);\n      this.#altTextTooltipTimeout = null;\n    }\n    this.#altTextButton.disabled = !enabled;\n  }\n\n  destroy() {\n    this.#altTextButton?.remove();\n    this.#altTextButton = null;\n    this.#altTextTooltip = null;\n  }\n\n  async #setState() {\n    const button = this.#altTextButton;\n    if (!button) {\n      return;\n    }\n    if (!this.#altText && !this.#altTextDecorative) {\n      button.classList.remove(\"done\");\n      this.#altTextTooltip?.remove();\n      return;\n    }\n    button.classList.add(\"done\");\n\n    AltText._l10nPromise\n      .get(\"pdfjs-editor-alt-text-edit-button-label\")\n      .then(msg => {\n        button.setAttribute(\"aria-label\", msg);\n      });\n    let tooltip = this.#altTextTooltip;\n    if (!tooltip) {\n      this.#altTextTooltip = tooltip = document.createElement(\"span\");\n      tooltip.className = \"tooltip\";\n      tooltip.setAttribute(\"role\", \"tooltip\");\n      const id = (tooltip.id = `alt-text-tooltip-${this.#editor.id}`);\n      button.setAttribute(\"aria-describedby\", id);\n\n      const DELAY_TO_SHOW_TOOLTIP = 100;\n      button.addEventListener(\"mouseenter\", () => {\n        this.#altTextTooltipTimeout = setTimeout(() => {\n          this.#altTextTooltipTimeout = null;\n          this.#altTextTooltip.classList.add(\"show\");\n          this.#editor._uiManager._eventBus.dispatch(\"reporttelemetry\", {\n            source: this,\n            details: {\n              type: \"editing\",\n              subtype: this.#editor.editorType,\n              data: {\n                action: \"alt_text_tooltip\",\n              },\n            },\n          });\n        }, DELAY_TO_SHOW_TOOLTIP);\n      });\n      button.addEventListener(\"mouseleave\", () => {\n        if (this.#altTextTooltipTimeout) {\n          clearTimeout(this.#altTextTooltipTimeout);\n          this.#altTextTooltipTimeout = null;\n        }\n        this.#altTextTooltip?.classList.remove(\"show\");\n      });\n    }\n    tooltip.innerText = this.#altTextDecorative\n      ? await AltText._l10nPromise.get(\n          \"pdfjs-editor-alt-text-decorative-tooltip\"\n        )\n      : this.#altText;\n\n    if (!tooltip.parentNode) {\n      button.append(tooltip);\n    }\n\n    const element = this.#editor.getImageForAltText();\n    element?.setAttribute(\"aria-describedby\", tooltip.id);\n  }\n}\n\nexport { AltText };\n", "/* Copyright 2023 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { noContextMenu } from \"../display_utils.js\";\n\nclass EditorToolbar {\n  #toolbar = null;\n\n  #colorPicker = null;\n\n  #editor;\n\n  #buttons = null;\n\n  constructor(editor) {\n    this.#editor = editor;\n  }\n\n  render() {\n    const editToolbar = (this.#toolbar = document.createElement(\"div\"));\n    editToolbar.className = \"editToolbar\";\n    editToolbar.addEventListener(\"contextmenu\", noContextMenu);\n    editToolbar.addEventListener(\"pointerdown\", EditorToolbar.#pointerDown);\n\n    const buttons = (this.#buttons = document.createElement(\"div\"));\n    buttons.className = \"buttons\";\n    editToolbar.append(buttons);\n\n    const position = this.#editor.toolbarPosition;\n    if (position) {\n      const { style } = editToolbar;\n      const x =\n        this.#editor._uiManager.direction === \"ltr\"\n          ? 1 - position[0]\n          : position[0];\n      style.insetInlineEnd = `${100 * x}%`;\n      style.top = `calc(${\n        100 * position[1]\n      }% + var(--editor-toolbar-vert-offset))`;\n    }\n\n    this.#addDeleteButton();\n\n    return editToolbar;\n  }\n\n  static #pointerDown(e) {\n    e.stopPropagation();\n  }\n\n  #focusIn(e) {\n    this.#editor._focusEventsAllowed = false;\n    e.preventDefault();\n    e.stopPropagation();\n  }\n\n  #focusOut(e) {\n    this.#editor._focusEventsAllowed = true;\n    e.preventDefault();\n    e.stopPropagation();\n  }\n\n  #addListenersToElement(element) {\n    // If we're clicking on a button with the keyboard or with\n    // the mouse, we don't want to trigger any focus events on\n    // the editor.\n    element.addEventListener(\"focusin\", this.#focusIn.bind(this), {\n      capture: true,\n    });\n    element.addEventListener(\"focusout\", this.#focusOut.bind(this), {\n      capture: true,\n    });\n    element.addEventListener(\"contextmenu\", noContextMenu);\n  }\n\n  hide() {\n    this.#toolbar.classList.add(\"hidden\");\n    this.#colorPicker?.hideDropdown();\n  }\n\n  show() {\n    this.#toolbar.classList.remove(\"hidden\");\n  }\n\n  #addDeleteButton() {\n    const button = document.createElement(\"button\");\n    button.className = \"delete\";\n    button.tabIndex = 0;\n    button.setAttribute(\n      \"data-l10n-id\",\n      `pdfjs-editor-remove-${this.#editor.editorType}-button`\n    );\n    this.#addListenersToElement(button);\n    button.addEventListener(\"click\", e => {\n      this.#editor._uiManager.delete();\n    });\n    this.#buttons.append(button);\n  }\n\n  get #divider() {\n    const divider = document.createElement(\"div\");\n    divider.className = \"divider\";\n    return divider;\n  }\n\n  addAltTextButton(button) {\n    this.#addListenersToElement(button);\n    this.#buttons.prepend(button, this.#divider);\n  }\n\n  addColorPicker(colorPicker) {\n    this.#colorPicker = colorPicker;\n    const button = colorPicker.renderButton();\n    this.#addListenersToElement(button);\n    this.#buttons.prepend(button, this.#divider);\n  }\n\n  remove() {\n    this.#toolbar.remove();\n    this.#colorPicker?.destroy();\n    this.#colorPicker = null;\n  }\n}\n\nexport { EditorToolbar };\n", "/* Copyright 2022 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// eslint-disable-next-line max-len\n/** @typedef {import(\"./annotation_editor_layer.js\").AnnotationEditorLayer} AnnotationEditorLayer */\n\nimport {\n  AnnotationEditorUIManager,\n  bindEvents,\n  ColorManager,\n  KeyboardManager,\n} from \"./tools.js\";\nimport { FeatureTest, shadow, unreachable } from \"../../shared/util.js\";\nimport { AltText } from \"./alt_text.js\";\nimport { EditorToolbar } from \"./toolbar.js\";\nimport { noContextMenu } from \"../display_utils.js\";\n\n/**\n * @typedef {Object} AnnotationEditorParameters\n * @property {AnnotationEditorUIManager} uiManager - the global manager\n * @property {AnnotationEditorLayer} parent - the layer containing this editor\n * @property {string} id - editor id\n * @property {number} x - x-coordinate\n * @property {number} y - y-coordinate\n */\n\n/**\n * Base class for editors.\n */\nclass AnnotationEditor {\n  #allResizerDivs = null;\n\n  #altText = null;\n\n  #keepAspectRatio = false;\n\n  #resizersDiv = null;\n\n  #savedDimensions = null;\n\n  #boundFocusin = this.focusin.bind(this);\n\n  #boundFocusout = this.focusout.bind(this);\n\n  #editToolbar = null;\n\n  #focusedResizerName = \"\";\n\n  #hasBeenClicked = false;\n\n  #isEditing = false;\n\n  #isInEditMode = false;\n\n  #isResizerEnabledForKeyboard = false;\n\n  #moveInDOMTimeout = null;\n\n  _initialOptions = Object.create(null);\n\n  _uiManager = null;\n\n  _focusEventsAllowed = true;\n\n  _l10nPromise = null;\n\n  #isDraggable = false;\n\n  #zIndex = AnnotationEditor._zIndex++;\n\n  static _borderLineWidth = -1;\n\n  static _colorManager = new ColorManager();\n\n  static _zIndex = 1;\n\n  static get _resizerKeyboardManager() {\n    const resize = AnnotationEditor.prototype._resizeWithKeyboard;\n    const small = AnnotationEditorUIManager.TRANSLATE_SMALL;\n    const big = AnnotationEditorUIManager.TRANSLATE_BIG;\n\n    return shadow(\n      this,\n      \"_resizerKeyboardManager\",\n      new KeyboardManager([\n        [[\"ArrowLeft\", \"mac+ArrowLeft\"], resize, { args: [-small, 0] }],\n        [\n          [\"ctrl+ArrowLeft\", \"mac+shift+ArrowLeft\"],\n          resize,\n          { args: [-big, 0] },\n        ],\n        [[\"ArrowRight\", \"mac+ArrowRight\"], resize, { args: [small, 0] }],\n        [\n          [\"ctrl+ArrowRight\", \"mac+shift+ArrowRight\"],\n          resize,\n          { args: [big, 0] },\n        ],\n        [[\"ArrowUp\", \"mac+ArrowUp\"], resize, { args: [0, -small] }],\n        [[\"ctrl+ArrowUp\", \"mac+shift+ArrowUp\"], resize, { args: [0, -big] }],\n        [[\"ArrowDown\", \"mac+ArrowDown\"], resize, { args: [0, small] }],\n        [[\"ctrl+ArrowDown\", \"mac+shift+ArrowDown\"], resize, { args: [0, big] }],\n        [\n          [\"Escape\", \"mac+Escape\"],\n          AnnotationEditor.prototype._stopResizingWithKeyboard,\n        ],\n      ])\n    );\n  }\n\n  /**\n   * @param {AnnotationEditorParameters} parameters\n   */\n  constructor(parameters) {\n    if (this.constructor === AnnotationEditor) {\n      unreachable(\"Cannot initialize AnnotationEditor.\");\n    }\n\n    this.parent = parameters.parent;\n    this.id = parameters.id;\n    this.width = this.height = null;\n    this.pageIndex = parameters.parent.pageIndex;\n    this.name = parameters.name;\n    this.div = null;\n    this._uiManager = parameters.uiManager;\n    this.annotationElementId = null;\n    this._willKeepAspectRatio = false;\n    this._initialOptions.isCentered = parameters.isCentered;\n    this._structTreeParentId = null;\n\n    const {\n      rotation,\n      rawDims: { pageWidth, pageHeight, pageX, pageY },\n    } = this.parent.viewport;\n\n    this.rotation = rotation;\n    this.pageRotation =\n      (360 + rotation - this._uiManager.viewParameters.rotation) % 360;\n    this.pageDimensions = [pageWidth, pageHeight];\n    this.pageTranslation = [pageX, pageY];\n\n    const [width, height] = this.parentDimensions;\n    this.x = parameters.x / width;\n    this.y = parameters.y / height;\n\n    this.isAttachedToDOM = false;\n    this.deleted = false;\n  }\n\n  get editorType() {\n    return Object.getPrototypeOf(this).constructor._type;\n  }\n\n  static get _defaultLineColor() {\n    return shadow(\n      this,\n      \"_defaultLineColor\",\n      this._colorManager.getHexCode(\"CanvasText\")\n    );\n  }\n\n  static deleteAnnotationElement(editor) {\n    const fakeEditor = new FakeEditor({\n      id: editor.parent.getNextId(),\n      parent: editor.parent,\n      uiManager: editor._uiManager,\n    });\n    fakeEditor.annotationElementId = editor.annotationElementId;\n    fakeEditor.deleted = true;\n    fakeEditor._uiManager.addToAnnotationStorage(fakeEditor);\n  }\n\n  /**\n   * Initialize the l10n stuff for this type of editor.\n   * @param {Object} l10n\n   */\n  static initialize(l10n, options = null) {\n    AnnotationEditor._l10nPromise ||= new Map(\n      [\n        \"pdfjs-editor-alt-text-button-label\",\n        \"pdfjs-editor-alt-text-edit-button-label\",\n        \"pdfjs-editor-alt-text-decorative-tooltip\",\n        \"pdfjs-editor-resizer-label-topLeft\",\n        \"pdfjs-editor-resizer-label-topMiddle\",\n        \"pdfjs-editor-resizer-label-topRight\",\n        \"pdfjs-editor-resizer-label-middleRight\",\n        \"pdfjs-editor-resizer-label-bottomRight\",\n        \"pdfjs-editor-resizer-label-bottomMiddle\",\n        \"pdfjs-editor-resizer-label-bottomLeft\",\n        \"pdfjs-editor-resizer-label-middleLeft\",\n      ].map(str => [\n        str,\n        l10n.get(str.replaceAll(/([A-Z])/g, c => `-${c.toLowerCase()}`)),\n      ])\n    );\n    if (options?.strings) {\n      for (const str of options.strings) {\n        AnnotationEditor._l10nPromise.set(str, l10n.get(str));\n      }\n    }\n    if (AnnotationEditor._borderLineWidth !== -1) {\n      return;\n    }\n    const style = getComputedStyle(document.documentElement);\n    AnnotationEditor._borderLineWidth =\n      parseFloat(style.getPropertyValue(\"--outline-width\")) || 0;\n  }\n\n  /**\n   * Update the default parameters for this type of editor.\n   * @param {number} _type\n   * @param {*} _value\n   */\n  static updateDefaultParams(_type, _value) {}\n\n  /**\n   * Get the default properties to set in the UI for this type of editor.\n   * @returns {Array}\n   */\n  static get defaultPropertiesToUpdate() {\n    return [];\n  }\n\n  /**\n   * Check if this kind of editor is able to handle the given mime type for\n   * pasting.\n   * @param {string} mime\n   * @returns {boolean}\n   */\n  static isHandlingMimeForPasting(mime) {\n    return false;\n  }\n\n  /**\n   * Extract the data from the clipboard item and delegate the creation of the\n   * editor to the parent.\n   * @param {DataTransferItem} item\n   * @param {AnnotationEditorLayer} parent\n   */\n  static paste(item, parent) {\n    unreachable(\"Not implemented\");\n  }\n\n  /**\n   * Get the properties to update in the UI for this editor.\n   * @returns {Array}\n   */\n  get propertiesToUpdate() {\n    return [];\n  }\n\n  get _isDraggable() {\n    return this.#isDraggable;\n  }\n\n  set _isDraggable(value) {\n    this.#isDraggable = value;\n    this.div?.classList.toggle(\"draggable\", value);\n  }\n\n  /**\n   * @returns {boolean} true if the editor handles the Enter key itself.\n   */\n  get isEnterHandled() {\n    return true;\n  }\n\n  center() {\n    const [pageWidth, pageHeight] = this.pageDimensions;\n    switch (this.parentRotation) {\n      case 90:\n        this.x -= (this.height * pageHeight) / (pageWidth * 2);\n        this.y += (this.width * pageWidth) / (pageHeight * 2);\n        break;\n      case 180:\n        this.x += this.width / 2;\n        this.y += this.height / 2;\n        break;\n      case 270:\n        this.x += (this.height * pageHeight) / (pageWidth * 2);\n        this.y -= (this.width * pageWidth) / (pageHeight * 2);\n        break;\n      default:\n        this.x -= this.width / 2;\n        this.y -= this.height / 2;\n        break;\n    }\n    this.fixAndSetPosition();\n  }\n\n  /**\n   * Add some commands into the CommandManager (undo/redo stuff).\n   * @param {Object} params\n   */\n  addCommands(params) {\n    this._uiManager.addCommands(params);\n  }\n\n  get currentLayer() {\n    return this._uiManager.currentLayer;\n  }\n\n  /**\n   * This editor will be behind the others.\n   */\n  setInBackground() {\n    this.div.style.zIndex = 0;\n  }\n\n  /**\n   * This editor will be in the foreground.\n   */\n  setInForeground() {\n    this.div.style.zIndex = this.#zIndex;\n  }\n\n  setParent(parent) {\n    if (parent !== null) {\n      this.pageIndex = parent.pageIndex;\n      this.pageDimensions = parent.pageDimensions;\n    } else {\n      // The editor is being removed from the DOM, so we need to stop resizing.\n      this.#stopResizing();\n    }\n    this.parent = parent;\n  }\n\n  /**\n   * onfocus callback.\n   */\n  focusin(event) {\n    if (!this._focusEventsAllowed) {\n      return;\n    }\n    if (!this.#hasBeenClicked) {\n      this.parent.setSelected(this);\n    } else {\n      this.#hasBeenClicked = false;\n    }\n  }\n\n  /**\n   * onblur callback.\n   * @param {FocusEvent} event\n   */\n  focusout(event) {\n    if (!this._focusEventsAllowed) {\n      return;\n    }\n\n    if (!this.isAttachedToDOM) {\n      return;\n    }\n\n    // In case of focusout, the relatedTarget is the element which\n    // is grabbing the focus.\n    // So if the related target is an element under the div for this\n    // editor, then the editor isn't unactive.\n    const target = event.relatedTarget;\n    if (target?.closest(`#${this.id}`)) {\n      return;\n    }\n\n    event.preventDefault();\n\n    if (!this.parent?.isMultipleSelection) {\n      this.commitOrRemove();\n    }\n  }\n\n  commitOrRemove() {\n    if (this.isEmpty()) {\n      this.remove();\n    } else {\n      this.commit();\n    }\n  }\n\n  /**\n   * Commit the data contained in this editor.\n   */\n  commit() {\n    this.addToAnnotationStorage();\n  }\n\n  addToAnnotationStorage() {\n    this._uiManager.addToAnnotationStorage(this);\n  }\n\n  /**\n   * Set the editor position within its parent.\n   * @param {number} x\n   * @param {number} y\n   * @param {number} tx - x-translation in screen coordinates.\n   * @param {number} ty - y-translation in screen coordinates.\n   */\n  setAt(x, y, tx, ty) {\n    const [width, height] = this.parentDimensions;\n    [tx, ty] = this.screenToPageTranslation(tx, ty);\n\n    this.x = (x + tx) / width;\n    this.y = (y + ty) / height;\n\n    this.fixAndSetPosition();\n  }\n\n  #translate([width, height], x, y) {\n    [x, y] = this.screenToPageTranslation(x, y);\n\n    this.x += x / width;\n    this.y += y / height;\n\n    this.fixAndSetPosition();\n  }\n\n  /**\n   * Translate the editor position within its parent.\n   * @param {number} x - x-translation in screen coordinates.\n   * @param {number} y - y-translation in screen coordinates.\n   */\n  translate(x, y) {\n    this.#translate(this.parentDimensions, x, y);\n  }\n\n  /**\n   * Translate the editor position within its page and adjust the scroll\n   * in order to have the editor in the view.\n   * @param {number} x - x-translation in page coordinates.\n   * @param {number} y - y-translation in page coordinates.\n   */\n  translateInPage(x, y) {\n    this.#translate(this.pageDimensions, x, y);\n    this.div.scrollIntoView({ block: \"nearest\" });\n  }\n\n  drag(tx, ty) {\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    this.x += tx / parentWidth;\n    this.y += ty / parentHeight;\n    if (this.parent && (this.x < 0 || this.x > 1 || this.y < 0 || this.y > 1)) {\n      // It's possible to not have a parent: for example, when the user is\n      // dragging all the selected editors but this one on a page which has been\n      // destroyed.\n      // It's why we need to check for it. In such a situation, it isn't really\n      // a problem to not find a new parent: it's something which is related to\n      // what the user is seeing, hence it depends on how pages are layed out.\n\n      // The element will be outside of its parent so change the parent.\n      const { x, y } = this.div.getBoundingClientRect();\n      if (this.parent.findNewParent(this, x, y)) {\n        this.x -= Math.floor(this.x);\n        this.y -= Math.floor(this.y);\n      }\n    }\n\n    // The editor can be moved wherever the user wants, so we don't need to fix\n    // the position: it'll be done when the user will release the mouse button.\n\n    let { x, y } = this;\n    const [bx, by] = this.#getBaseTranslation();\n    x += bx;\n    y += by;\n\n    this.div.style.left = `${(100 * x).toFixed(2)}%`;\n    this.div.style.top = `${(100 * y).toFixed(2)}%`;\n    this.div.scrollIntoView({ block: \"nearest\" });\n  }\n\n  #getBaseTranslation() {\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    const { _borderLineWidth } = AnnotationEditor;\n    const x = _borderLineWidth / parentWidth;\n    const y = _borderLineWidth / parentHeight;\n    switch (this.rotation) {\n      case 90:\n        return [-x, y];\n      case 180:\n        return [x, y];\n      case 270:\n        return [x, -y];\n      default:\n        return [-x, -y];\n    }\n  }\n\n  /**\n   * Fix the position of the editor in order to keep it inside its parent page.\n   * @param {number} [rotation] - the rotation of the page.\n   */\n  fixAndSetPosition(rotation = this.rotation) {\n    const [pageWidth, pageHeight] = this.pageDimensions;\n    let { x, y, width, height } = this;\n    width *= pageWidth;\n    height *= pageHeight;\n    x *= pageWidth;\n    y *= pageHeight;\n\n    switch (rotation) {\n      case 0:\n        x = Math.max(0, Math.min(pageWidth - width, x));\n        y = Math.max(0, Math.min(pageHeight - height, y));\n        break;\n      case 90:\n        x = Math.max(0, Math.min(pageWidth - height, x));\n        y = Math.min(pageHeight, Math.max(width, y));\n        break;\n      case 180:\n        x = Math.min(pageWidth, Math.max(width, x));\n        y = Math.min(pageHeight, Math.max(height, y));\n        break;\n      case 270:\n        x = Math.min(pageWidth, Math.max(height, x));\n        y = Math.max(0, Math.min(pageHeight - width, y));\n        break;\n    }\n\n    this.x = x /= pageWidth;\n    this.y = y /= pageHeight;\n\n    const [bx, by] = this.#getBaseTranslation();\n    x += bx;\n    y += by;\n\n    const { style } = this.div;\n    style.left = `${(100 * x).toFixed(2)}%`;\n    style.top = `${(100 * y).toFixed(2)}%`;\n\n    this.moveInDOM();\n  }\n\n  static #rotatePoint(x, y, angle) {\n    switch (angle) {\n      case 90:\n        return [y, -x];\n      case 180:\n        return [-x, -y];\n      case 270:\n        return [-y, x];\n      default:\n        return [x, y];\n    }\n  }\n\n  /**\n   * Convert a screen translation into a page one.\n   * @param {number} x\n   * @param {number} y\n   */\n  screenToPageTranslation(x, y) {\n    return AnnotationEditor.#rotatePoint(x, y, this.parentRotation);\n  }\n\n  /**\n   * Convert a page translation into a screen one.\n   * @param {number} x\n   * @param {number} y\n   */\n  pageTranslationToScreen(x, y) {\n    return AnnotationEditor.#rotatePoint(x, y, 360 - this.parentRotation);\n  }\n\n  #getRotationMatrix(rotation) {\n    switch (rotation) {\n      case 90: {\n        const [pageWidth, pageHeight] = this.pageDimensions;\n        return [0, -pageWidth / pageHeight, pageHeight / pageWidth, 0];\n      }\n      case 180:\n        return [-1, 0, 0, -1];\n      case 270: {\n        const [pageWidth, pageHeight] = this.pageDimensions;\n        return [0, pageWidth / pageHeight, -pageHeight / pageWidth, 0];\n      }\n      default:\n        return [1, 0, 0, 1];\n    }\n  }\n\n  get parentScale() {\n    return this._uiManager.viewParameters.realScale;\n  }\n\n  get parentRotation() {\n    return (this._uiManager.viewParameters.rotation + this.pageRotation) % 360;\n  }\n\n  get parentDimensions() {\n    const {\n      parentScale,\n      pageDimensions: [pageWidth, pageHeight],\n    } = this;\n    const scaledWidth = pageWidth * parentScale;\n    const scaledHeight = pageHeight * parentScale;\n    return FeatureTest.isCSSRoundSupported\n      ? [Math.round(scaledWidth), Math.round(scaledHeight)]\n      : [scaledWidth, scaledHeight];\n  }\n\n  /**\n   * Set the dimensions of this editor.\n   * @param {number} width\n   * @param {number} height\n   */\n  setDims(width, height) {\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    this.div.style.width = `${((100 * width) / parentWidth).toFixed(2)}%`;\n    if (!this.#keepAspectRatio) {\n      this.div.style.height = `${((100 * height) / parentHeight).toFixed(2)}%`;\n    }\n  }\n\n  fixDims() {\n    const { style } = this.div;\n    const { height, width } = style;\n    const widthPercent = width.endsWith(\"%\");\n    const heightPercent = !this.#keepAspectRatio && height.endsWith(\"%\");\n    if (widthPercent && heightPercent) {\n      return;\n    }\n\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    if (!widthPercent) {\n      style.width = `${((100 * parseFloat(width)) / parentWidth).toFixed(2)}%`;\n    }\n    if (!this.#keepAspectRatio && !heightPercent) {\n      style.height = `${((100 * parseFloat(height)) / parentHeight).toFixed(\n        2\n      )}%`;\n    }\n  }\n\n  /**\n   * Get the translation used to position this editor when it's created.\n   * @returns {Array<number>}\n   */\n  getInitialTranslation() {\n    return [0, 0];\n  }\n\n  #createResizers() {\n    if (this.#resizersDiv) {\n      return;\n    }\n    this.#resizersDiv = document.createElement(\"div\");\n    this.#resizersDiv.classList.add(\"resizers\");\n    // When the resizers are used with the keyboard, they're focusable, hence\n    // we want to have them in this order (top left, top middle, top right, ...)\n    // in the DOM to have the focus order correct.\n    const classes = this._willKeepAspectRatio\n      ? [\"topLeft\", \"topRight\", \"bottomRight\", \"bottomLeft\"]\n      : [\n          \"topLeft\",\n          \"topMiddle\",\n          \"topRight\",\n          \"middleRight\",\n          \"bottomRight\",\n          \"bottomMiddle\",\n          \"bottomLeft\",\n          \"middleLeft\",\n        ];\n    for (const name of classes) {\n      const div = document.createElement(\"div\");\n      this.#resizersDiv.append(div);\n      div.classList.add(\"resizer\", name);\n      div.setAttribute(\"data-resizer-name\", name);\n      div.addEventListener(\n        \"pointerdown\",\n        this.#resizerPointerdown.bind(this, name)\n      );\n      div.addEventListener(\"contextmenu\", noContextMenu);\n      div.tabIndex = -1;\n    }\n    this.div.prepend(this.#resizersDiv);\n  }\n\n  #resizerPointerdown(name, event) {\n    event.preventDefault();\n    const { isMac } = FeatureTest.platform;\n    if (event.button !== 0 || (event.ctrlKey && isMac)) {\n      return;\n    }\n\n    this.#altText?.toggle(false);\n\n    const boundResizerPointermove = this.#resizerPointermove.bind(this, name);\n    const savedDraggable = this._isDraggable;\n    this._isDraggable = false;\n    const pointerMoveOptions = { passive: true, capture: true };\n    this.parent.togglePointerEvents(false);\n    window.addEventListener(\n      \"pointermove\",\n      boundResizerPointermove,\n      pointerMoveOptions\n    );\n    const savedX = this.x;\n    const savedY = this.y;\n    const savedWidth = this.width;\n    const savedHeight = this.height;\n    const savedParentCursor = this.parent.div.style.cursor;\n    const savedCursor = this.div.style.cursor;\n    this.div.style.cursor = this.parent.div.style.cursor =\n      window.getComputedStyle(event.target).cursor;\n\n    const pointerUpCallback = () => {\n      this.parent.togglePointerEvents(true);\n      this.#altText?.toggle(true);\n      this._isDraggable = savedDraggable;\n      window.removeEventListener(\"pointerup\", pointerUpCallback);\n      window.removeEventListener(\"blur\", pointerUpCallback);\n      window.removeEventListener(\n        \"pointermove\",\n        boundResizerPointermove,\n        pointerMoveOptions\n      );\n      this.parent.div.style.cursor = savedParentCursor;\n      this.div.style.cursor = savedCursor;\n\n      this.#addResizeToUndoStack(savedX, savedY, savedWidth, savedHeight);\n    };\n    window.addEventListener(\"pointerup\", pointerUpCallback);\n    // If the user switches to another window (with alt+tab), then we end the\n    // resize session.\n    window.addEventListener(\"blur\", pointerUpCallback);\n  }\n\n  #addResizeToUndoStack(savedX, savedY, savedWidth, savedHeight) {\n    const newX = this.x;\n    const newY = this.y;\n    const newWidth = this.width;\n    const newHeight = this.height;\n    if (\n      newX === savedX &&\n      newY === savedY &&\n      newWidth === savedWidth &&\n      newHeight === savedHeight\n    ) {\n      return;\n    }\n\n    this.addCommands({\n      cmd: () => {\n        this.width = newWidth;\n        this.height = newHeight;\n        this.x = newX;\n        this.y = newY;\n        const [parentWidth, parentHeight] = this.parentDimensions;\n        this.setDims(parentWidth * newWidth, parentHeight * newHeight);\n        this.fixAndSetPosition();\n      },\n      undo: () => {\n        this.width = savedWidth;\n        this.height = savedHeight;\n        this.x = savedX;\n        this.y = savedY;\n        const [parentWidth, parentHeight] = this.parentDimensions;\n        this.setDims(parentWidth * savedWidth, parentHeight * savedHeight);\n        this.fixAndSetPosition();\n      },\n      mustExec: true,\n    });\n  }\n\n  #resizerPointermove(name, event) {\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    const savedX = this.x;\n    const savedY = this.y;\n    const savedWidth = this.width;\n    const savedHeight = this.height;\n    const minWidth = AnnotationEditor.MIN_SIZE / parentWidth;\n    const minHeight = AnnotationEditor.MIN_SIZE / parentHeight;\n\n    // 10000 because we multiply by 100 and use toFixed(2) in fixAndSetPosition.\n    // Without rounding, the positions of the corners other than the top left\n    // one can be slightly wrong.\n    const round = x => Math.round(x * 10000) / 10000;\n    const rotationMatrix = this.#getRotationMatrix(this.rotation);\n    const transf = (x, y) => [\n      rotationMatrix[0] * x + rotationMatrix[2] * y,\n      rotationMatrix[1] * x + rotationMatrix[3] * y,\n    ];\n    const invRotationMatrix = this.#getRotationMatrix(360 - this.rotation);\n    const invTransf = (x, y) => [\n      invRotationMatrix[0] * x + invRotationMatrix[2] * y,\n      invRotationMatrix[1] * x + invRotationMatrix[3] * y,\n    ];\n    let getPoint;\n    let getOpposite;\n    let isDiagonal = false;\n    let isHorizontal = false;\n\n    switch (name) {\n      case \"topLeft\":\n        isDiagonal = true;\n        getPoint = (w, h) => [0, 0];\n        getOpposite = (w, h) => [w, h];\n        break;\n      case \"topMiddle\":\n        getPoint = (w, h) => [w / 2, 0];\n        getOpposite = (w, h) => [w / 2, h];\n        break;\n      case \"topRight\":\n        isDiagonal = true;\n        getPoint = (w, h) => [w, 0];\n        getOpposite = (w, h) => [0, h];\n        break;\n      case \"middleRight\":\n        isHorizontal = true;\n        getPoint = (w, h) => [w, h / 2];\n        getOpposite = (w, h) => [0, h / 2];\n        break;\n      case \"bottomRight\":\n        isDiagonal = true;\n        getPoint = (w, h) => [w, h];\n        getOpposite = (w, h) => [0, 0];\n        break;\n      case \"bottomMiddle\":\n        getPoint = (w, h) => [w / 2, h];\n        getOpposite = (w, h) => [w / 2, 0];\n        break;\n      case \"bottomLeft\":\n        isDiagonal = true;\n        getPoint = (w, h) => [0, h];\n        getOpposite = (w, h) => [w, 0];\n        break;\n      case \"middleLeft\":\n        isHorizontal = true;\n        getPoint = (w, h) => [0, h / 2];\n        getOpposite = (w, h) => [w, h / 2];\n        break;\n    }\n\n    const point = getPoint(savedWidth, savedHeight);\n    const oppositePoint = getOpposite(savedWidth, savedHeight);\n    let transfOppositePoint = transf(...oppositePoint);\n    const oppositeX = round(savedX + transfOppositePoint[0]);\n    const oppositeY = round(savedY + transfOppositePoint[1]);\n    let ratioX = 1;\n    let ratioY = 1;\n\n    let [deltaX, deltaY] = this.screenToPageTranslation(\n      event.movementX,\n      event.movementY\n    );\n    [deltaX, deltaY] = invTransf(deltaX / parentWidth, deltaY / parentHeight);\n\n    if (isDiagonal) {\n      const oldDiag = Math.hypot(savedWidth, savedHeight);\n      ratioX = ratioY = Math.max(\n        Math.min(\n          Math.hypot(\n            oppositePoint[0] - point[0] - deltaX,\n            oppositePoint[1] - point[1] - deltaY\n          ) / oldDiag,\n          // Avoid the editor to be larger than the page.\n          1 / savedWidth,\n          1 / savedHeight\n        ),\n        // Avoid the editor to be smaller than the minimum size.\n        minWidth / savedWidth,\n        minHeight / savedHeight\n      );\n    } else if (isHorizontal) {\n      ratioX =\n        Math.max(\n          minWidth,\n          Math.min(1, Math.abs(oppositePoint[0] - point[0] - deltaX))\n        ) / savedWidth;\n    } else {\n      ratioY =\n        Math.max(\n          minHeight,\n          Math.min(1, Math.abs(oppositePoint[1] - point[1] - deltaY))\n        ) / savedHeight;\n    }\n\n    const newWidth = round(savedWidth * ratioX);\n    const newHeight = round(savedHeight * ratioY);\n    transfOppositePoint = transf(...getOpposite(newWidth, newHeight));\n    const newX = oppositeX - transfOppositePoint[0];\n    const newY = oppositeY - transfOppositePoint[1];\n\n    this.width = newWidth;\n    this.height = newHeight;\n    this.x = newX;\n    this.y = newY;\n\n    this.setDims(parentWidth * newWidth, parentHeight * newHeight);\n    this.fixAndSetPosition();\n  }\n\n  altTextFinish() {\n    this.#altText?.finish();\n  }\n\n  /**\n   * Add a toolbar for this editor.\n   * @returns {Promise<EditorToolbar|null>}\n   */\n  async addEditToolbar() {\n    if (this.#editToolbar || this.#isInEditMode) {\n      return this.#editToolbar;\n    }\n    this.#editToolbar = new EditorToolbar(this);\n    this.div.append(this.#editToolbar.render());\n    if (this.#altText) {\n      this.#editToolbar.addAltTextButton(await this.#altText.render());\n    }\n\n    return this.#editToolbar;\n  }\n\n  removeEditToolbar() {\n    if (!this.#editToolbar) {\n      return;\n    }\n    this.#editToolbar.remove();\n    this.#editToolbar = null;\n\n    // We destroy the alt text but we don't null it because we want to be able\n    // to restore it in case the user undoes the deletion.\n    this.#altText?.destroy();\n  }\n\n  getClientDimensions() {\n    return this.div.getBoundingClientRect();\n  }\n\n  async addAltTextButton() {\n    if (this.#altText) {\n      return;\n    }\n    AltText.initialize(AnnotationEditor._l10nPromise);\n    this.#altText = new AltText(this);\n    await this.addEditToolbar();\n  }\n\n  get altTextData() {\n    return this.#altText?.data;\n  }\n\n  /**\n   * Set the alt text data.\n   */\n  set altTextData(data) {\n    if (!this.#altText) {\n      return;\n    }\n    this.#altText.data = data;\n  }\n\n  /**\n   * Render this editor in a div.\n   * @returns {HTMLDivElement | null}\n   */\n  render() {\n    this.div = document.createElement(\"div\");\n    this.div.setAttribute(\"data-editor-rotation\", (360 - this.rotation) % 360);\n    this.div.className = this.name;\n    this.div.setAttribute(\"id\", this.id);\n    this.div.setAttribute(\"tabIndex\", 0);\n\n    this.setInForeground();\n\n    this.div.addEventListener(\"focusin\", this.#boundFocusin);\n    this.div.addEventListener(\"focusout\", this.#boundFocusout);\n\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    if (this.parentRotation % 180 !== 0) {\n      this.div.style.maxWidth = `${((100 * parentHeight) / parentWidth).toFixed(\n        2\n      )}%`;\n      this.div.style.maxHeight = `${(\n        (100 * parentWidth) /\n        parentHeight\n      ).toFixed(2)}%`;\n    }\n\n    const [tx, ty] = this.getInitialTranslation();\n    this.translate(tx, ty);\n\n    bindEvents(this, this.div, [\"pointerdown\"]);\n\n    return this.div;\n  }\n\n  /**\n   * Onpointerdown callback.\n   * @param {PointerEvent} event\n   */\n  pointerdown(event) {\n    const { isMac } = FeatureTest.platform;\n    if (event.button !== 0 || (event.ctrlKey && isMac)) {\n      // Avoid to focus this editor because of a non-left click.\n      event.preventDefault();\n      return;\n    }\n\n    this.#hasBeenClicked = true;\n\n    if (this._isDraggable) {\n      this.#setUpDragSession(event);\n      return;\n    }\n\n    this.#selectOnPointerEvent(event);\n  }\n\n  #selectOnPointerEvent(event) {\n    const { isMac } = FeatureTest.platform;\n    if (\n      (event.ctrlKey && !isMac) ||\n      event.shiftKey ||\n      (event.metaKey && isMac)\n    ) {\n      this.parent.toggleSelected(this);\n    } else {\n      this.parent.setSelected(this);\n    }\n  }\n\n  #setUpDragSession(event) {\n    const isSelected = this._uiManager.isSelected(this);\n    this._uiManager.setUpDragSession();\n\n    let pointerMoveOptions, pointerMoveCallback;\n    if (isSelected) {\n      pointerMoveOptions = { passive: true, capture: true };\n      pointerMoveCallback = e => {\n        const [tx, ty] = this.screenToPageTranslation(e.movementX, e.movementY);\n        this._uiManager.dragSelectedEditors(tx, ty);\n      };\n      window.addEventListener(\n        \"pointermove\",\n        pointerMoveCallback,\n        pointerMoveOptions\n      );\n    }\n\n    const pointerUpCallback = () => {\n      window.removeEventListener(\"pointerup\", pointerUpCallback);\n      window.removeEventListener(\"blur\", pointerUpCallback);\n      if (isSelected) {\n        window.removeEventListener(\n          \"pointermove\",\n          pointerMoveCallback,\n          pointerMoveOptions\n        );\n      }\n\n      this.#hasBeenClicked = false;\n      if (!this._uiManager.endDragSession()) {\n        this.#selectOnPointerEvent(event);\n      }\n    };\n    window.addEventListener(\"pointerup\", pointerUpCallback);\n    // If the user is using alt+tab during the dragging session, the pointerup\n    // event could be not fired, but a blur event is fired so we can use it in\n    // order to interrupt the dragging session.\n    window.addEventListener(\"blur\", pointerUpCallback);\n  }\n\n  moveInDOM() {\n    // Moving the editor in the DOM can be expensive, so we wait a bit before.\n    // It's important to not block the UI (for example when changing the font\n    // size in a FreeText).\n    if (this.#moveInDOMTimeout) {\n      clearTimeout(this.#moveInDOMTimeout);\n    }\n    this.#moveInDOMTimeout = setTimeout(() => {\n      this.#moveInDOMTimeout = null;\n      this.parent?.moveEditorInDOM(this);\n    }, 0);\n  }\n\n  _setParentAndPosition(parent, x, y) {\n    parent.changeParent(this);\n    this.x = x;\n    this.y = y;\n    this.fixAndSetPosition();\n  }\n\n  /**\n   * Convert the current rect into a page one.\n   * @param {number} tx - x-translation in screen coordinates.\n   * @param {number} ty - y-translation in screen coordinates.\n   * @param {number} [rotation] - the rotation of the page.\n   */\n  getRect(tx, ty, rotation = this.rotation) {\n    const scale = this.parentScale;\n    const [pageWidth, pageHeight] = this.pageDimensions;\n    const [pageX, pageY] = this.pageTranslation;\n    const shiftX = tx / scale;\n    const shiftY = ty / scale;\n    const x = this.x * pageWidth;\n    const y = this.y * pageHeight;\n    const width = this.width * pageWidth;\n    const height = this.height * pageHeight;\n\n    switch (rotation) {\n      case 0:\n        return [\n          x + shiftX + pageX,\n          pageHeight - y - shiftY - height + pageY,\n          x + shiftX + width + pageX,\n          pageHeight - y - shiftY + pageY,\n        ];\n      case 90:\n        return [\n          x + shiftY + pageX,\n          pageHeight - y + shiftX + pageY,\n          x + shiftY + height + pageX,\n          pageHeight - y + shiftX + width + pageY,\n        ];\n      case 180:\n        return [\n          x - shiftX - width + pageX,\n          pageHeight - y + shiftY + pageY,\n          x - shiftX + pageX,\n          pageHeight - y + shiftY + height + pageY,\n        ];\n      case 270:\n        return [\n          x - shiftY - height + pageX,\n          pageHeight - y - shiftX - width + pageY,\n          x - shiftY + pageX,\n          pageHeight - y - shiftX + pageY,\n        ];\n      default:\n        throw new Error(\"Invalid rotation\");\n    }\n  }\n\n  getRectInCurrentCoords(rect, pageHeight) {\n    const [x1, y1, x2, y2] = rect;\n\n    const width = x2 - x1;\n    const height = y2 - y1;\n\n    switch (this.rotation) {\n      case 0:\n        return [x1, pageHeight - y2, width, height];\n      case 90:\n        return [x1, pageHeight - y1, height, width];\n      case 180:\n        return [x2, pageHeight - y1, width, height];\n      case 270:\n        return [x2, pageHeight - y2, height, width];\n      default:\n        throw new Error(\"Invalid rotation\");\n    }\n  }\n\n  /**\n   * Executed once this editor has been rendered.\n   */\n  onceAdded() {}\n\n  /**\n   * Check if the editor contains something.\n   * @returns {boolean}\n   */\n  isEmpty() {\n    return false;\n  }\n\n  /**\n   * Enable edit mode.\n   */\n  enableEditMode() {\n    this.#isInEditMode = true;\n  }\n\n  /**\n   * Disable edit mode.\n   */\n  disableEditMode() {\n    this.#isInEditMode = false;\n  }\n\n  /**\n   * Check if the editor is edited.\n   * @returns {boolean}\n   */\n  isInEditMode() {\n    return this.#isInEditMode;\n  }\n\n  /**\n   * If it returns true, then this editor handles the keyboard\n   * events itself.\n   * @returns {boolean}\n   */\n  shouldGetKeyboardEvents() {\n    return this.#isResizerEnabledForKeyboard;\n  }\n\n  /**\n   * Check if this editor needs to be rebuilt or not.\n   * @returns {boolean}\n   */\n  needsToBeRebuilt() {\n    return this.div && !this.isAttachedToDOM;\n  }\n\n  /**\n   * Rebuild the editor in case it has been removed on undo.\n   *\n   * To implement in subclasses.\n   */\n  rebuild() {\n    this.div?.addEventListener(\"focusin\", this.#boundFocusin);\n    this.div?.addEventListener(\"focusout\", this.#boundFocusout);\n  }\n\n  /**\n   * Rotate the editor.\n   * @param {number} angle\n   */\n  rotate(_angle) {}\n\n  /**\n   * Serialize the editor.\n   * The result of the serialization will be used to construct a\n   * new annotation to add to the pdf document.\n   *\n   * To implement in subclasses.\n   * @param {boolean} [isForCopying]\n   * @param {Object | null} [context]\n   * @returns {Object | null}\n   */\n  serialize(isForCopying = false, context = null) {\n    unreachable(\"An editor must be serializable\");\n  }\n\n  /**\n   * Deserialize the editor.\n   * The result of the deserialization is a new editor.\n   *\n   * @param {Object} data\n   * @param {AnnotationEditorLayer} parent\n   * @param {AnnotationEditorUIManager} uiManager\n   * @returns {AnnotationEditor | null}\n   */\n  static deserialize(data, parent, uiManager) {\n    const editor = new this.prototype.constructor({\n      parent,\n      id: parent.getNextId(),\n      uiManager,\n    });\n    editor.rotation = data.rotation;\n\n    const [pageWidth, pageHeight] = editor.pageDimensions;\n    const [x, y, width, height] = editor.getRectInCurrentCoords(\n      data.rect,\n      pageHeight\n    );\n    editor.x = x / pageWidth;\n    editor.y = y / pageHeight;\n    editor.width = width / pageWidth;\n    editor.height = height / pageHeight;\n\n    return editor;\n  }\n\n  /**\n   * Remove this editor.\n   * It's used on ctrl+backspace action.\n   */\n  remove() {\n    this.div.removeEventListener(\"focusin\", this.#boundFocusin);\n    this.div.removeEventListener(\"focusout\", this.#boundFocusout);\n\n    if (!this.isEmpty()) {\n      // The editor is removed but it can be back at some point thanks to\n      // undo/redo so we must commit it before.\n      this.commit();\n    }\n    if (this.parent) {\n      this.parent.remove(this);\n    } else {\n      this._uiManager.removeEditor(this);\n    }\n\n    if (this.#moveInDOMTimeout) {\n      clearTimeout(this.#moveInDOMTimeout);\n      this.#moveInDOMTimeout = null;\n    }\n    this.#stopResizing();\n    this.removeEditToolbar();\n  }\n\n  /**\n   * @returns {boolean} true if this editor can be resized.\n   */\n  get isResizable() {\n    return false;\n  }\n\n  /**\n   * Add the resizers to this editor.\n   */\n  makeResizable() {\n    if (this.isResizable) {\n      this.#createResizers();\n      this.#resizersDiv.classList.remove(\"hidden\");\n      bindEvents(this, this.div, [\"keydown\"]);\n    }\n  }\n\n  get toolbarPosition() {\n    return null;\n  }\n\n  /**\n   * onkeydown callback.\n   * @param {KeyboardEvent} event\n   */\n  keydown(event) {\n    if (\n      !this.isResizable ||\n      event.target !== this.div ||\n      event.key !== \"Enter\"\n    ) {\n      return;\n    }\n    this._uiManager.setSelected(this);\n    this.#savedDimensions = {\n      savedX: this.x,\n      savedY: this.y,\n      savedWidth: this.width,\n      savedHeight: this.height,\n    };\n    const children = this.#resizersDiv.children;\n    if (!this.#allResizerDivs) {\n      this.#allResizerDivs = Array.from(children);\n      const boundResizerKeydown = this.#resizerKeydown.bind(this);\n      const boundResizerBlur = this.#resizerBlur.bind(this);\n      for (const div of this.#allResizerDivs) {\n        const name = div.getAttribute(\"data-resizer-name\");\n        div.setAttribute(\"role\", \"spinbutton\");\n        div.addEventListener(\"keydown\", boundResizerKeydown);\n        div.addEventListener(\"blur\", boundResizerBlur);\n        div.addEventListener(\"focus\", this.#resizerFocus.bind(this, name));\n        AnnotationEditor._l10nPromise\n          .get(`pdfjs-editor-resizer-label-${name}`)\n          .then(msg => div.setAttribute(\"aria-label\", msg));\n      }\n    }\n\n    // We want to have the resizers in the visual order, so we move the first\n    // (top-left) to the right place.\n    const first = this.#allResizerDivs[0];\n    let firstPosition = 0;\n    for (const div of children) {\n      if (div === first) {\n        break;\n      }\n      firstPosition++;\n    }\n    const nextFirstPosition =\n      (((360 - this.rotation + this.parentRotation) % 360) / 90) *\n      (this.#allResizerDivs.length / 4);\n\n    if (nextFirstPosition !== firstPosition) {\n      // We need to reorder the resizers in the DOM in order to have the focus\n      // on the top-left one.\n      if (nextFirstPosition < firstPosition) {\n        for (let i = 0; i < firstPosition - nextFirstPosition; i++) {\n          this.#resizersDiv.append(this.#resizersDiv.firstChild);\n        }\n      } else if (nextFirstPosition > firstPosition) {\n        for (let i = 0; i < nextFirstPosition - firstPosition; i++) {\n          this.#resizersDiv.firstChild.before(this.#resizersDiv.lastChild);\n        }\n      }\n\n      let i = 0;\n      for (const child of children) {\n        const div = this.#allResizerDivs[i++];\n        const name = div.getAttribute(\"data-resizer-name\");\n        AnnotationEditor._l10nPromise\n          .get(`pdfjs-editor-resizer-label-${name}`)\n          .then(msg => child.setAttribute(\"aria-label\", msg));\n      }\n    }\n\n    this.#setResizerTabIndex(0);\n    this.#isResizerEnabledForKeyboard = true;\n    this.#resizersDiv.firstChild.focus({ focusVisible: true });\n    event.preventDefault();\n    event.stopImmediatePropagation();\n  }\n\n  #resizerKeydown(event) {\n    AnnotationEditor._resizerKeyboardManager.exec(this, event);\n  }\n\n  #resizerBlur(event) {\n    if (\n      this.#isResizerEnabledForKeyboard &&\n      event.relatedTarget?.parentNode !== this.#resizersDiv\n    ) {\n      this.#stopResizing();\n    }\n  }\n\n  #resizerFocus(name) {\n    this.#focusedResizerName = this.#isResizerEnabledForKeyboard ? name : \"\";\n  }\n\n  #setResizerTabIndex(value) {\n    if (!this.#allResizerDivs) {\n      return;\n    }\n    for (const div of this.#allResizerDivs) {\n      div.tabIndex = value;\n    }\n  }\n\n  _resizeWithKeyboard(x, y) {\n    if (!this.#isResizerEnabledForKeyboard) {\n      return;\n    }\n    this.#resizerPointermove(this.#focusedResizerName, {\n      movementX: x,\n      movementY: y,\n    });\n  }\n\n  #stopResizing() {\n    this.#isResizerEnabledForKeyboard = false;\n    this.#setResizerTabIndex(-1);\n    if (this.#savedDimensions) {\n      const { savedX, savedY, savedWidth, savedHeight } = this.#savedDimensions;\n      this.#addResizeToUndoStack(savedX, savedY, savedWidth, savedHeight);\n      this.#savedDimensions = null;\n    }\n  }\n\n  _stopResizingWithKeyboard() {\n    this.#stopResizing();\n    this.div.focus();\n  }\n\n  /**\n   * Select this editor.\n   */\n  select() {\n    this.makeResizable();\n    this.div?.classList.add(\"selectedEditor\");\n    if (!this.#editToolbar) {\n      this.addEditToolbar().then(() => {\n        if (this.div?.classList.contains(\"selectedEditor\")) {\n          // The editor can have been unselected while we were waiting for the\n          // edit toolbar to be created, hence we want to be sure that this\n          // editor is still selected.\n          this.#editToolbar?.show();\n        }\n      });\n      return;\n    }\n    this.#editToolbar?.show();\n  }\n\n  /**\n   * Unselect this editor.\n   */\n  unselect() {\n    this.#resizersDiv?.classList.add(\"hidden\");\n    this.div?.classList.remove(\"selectedEditor\");\n    if (this.div?.contains(document.activeElement)) {\n      // Don't use this.div.blur() because we don't know where the focus will\n      // go.\n      this._uiManager.currentLayer.div.focus();\n    }\n    this.#editToolbar?.hide();\n  }\n\n  /**\n   * Update some parameters which have been changed through the UI.\n   * @param {number} type\n   * @param {*} value\n   */\n  updateParams(type, value) {}\n\n  /**\n   * When the user disables the editing mode some editors can change some of\n   * their properties.\n   */\n  disableEditing() {}\n\n  /**\n   * When the user enables the editing mode some editors can change some of\n   * their properties.\n   */\n  enableEditing() {}\n\n  /**\n   * The editor is about to be edited.\n   */\n  enterInEditMode() {}\n\n  /**\n   * @returns {HTMLElement | null} the element requiring an alt text.\n   */\n  getImageForAltText() {\n    return null;\n  }\n\n  /**\n   * Get the div which really contains the displayed content.\n   * @returns {HTMLDivElement | undefined}\n   */\n  get contentDiv() {\n    return this.div;\n  }\n\n  /**\n   * If true then the editor is currently edited.\n   * @type {boolean}\n   */\n  get isEditing() {\n    return this.#isEditing;\n  }\n\n  /**\n   * When set to true, it means that this editor is currently edited.\n   * @param {boolean} value\n   */\n  set isEditing(value) {\n    this.#isEditing = value;\n    if (!this.parent) {\n      return;\n    }\n    if (value) {\n      this.parent.setSelected(this);\n      this.parent.setActiveEditor(this);\n    } else {\n      this.parent.setActiveEditor(null);\n    }\n  }\n\n  /**\n   * Set the aspect ratio to use when resizing.\n   * @param {number} width\n   * @param {number} height\n   */\n  setAspectRatio(width, height) {\n    this.#keepAspectRatio = true;\n    const aspectRatio = width / height;\n    const { style } = this.div;\n    style.aspectRatio = aspectRatio;\n    style.height = \"auto\";\n  }\n\n  static get MIN_SIZE() {\n    return 16;\n  }\n\n  static canCreateNewEmptyEditor() {\n    return true;\n  }\n}\n\n// This class is used to fake an editor which has been deleted.\nclass FakeEditor extends AnnotationEditor {\n  constructor(params) {\n    super(params);\n    this.annotationElementId = params.annotationElementId;\n    this.deleted = true;\n  }\n\n  serialize() {\n    return {\n      id: this.annotationElementId,\n      deleted: true,\n      pageIndex: this.pageIndex,\n    };\n  }\n}\n\nexport { AnnotationEditor };\n", "/* Copyright 2023 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nclass Outliner {\n  #box;\n\n  #verticalEdges = [];\n\n  #intervals = [];\n\n  /**\n   * Construct an outliner.\n   * @param {Array<Object>} boxes - An array of axis-aligned rectangles.\n   * @param {number} borderWidth - The width of the border of the boxes, it\n   *   allows to make the boxes bigger (or smaller).\n   * @param {number} innerMargin - The margin between the boxes and the\n   *   outlines. It's important to not have a null innerMargin when we want to\n   *   draw the outline else the stroked outline could be clipped because of its\n   *   width.\n   * @param {boolean} isLTR - true if we're in LTR mode. It's used to determine\n   *   the last point of the boxes.\n   */\n  constructor(boxes, borderWidth = 0, innerMargin = 0, isLTR = true) {\n    let minX = Infinity;\n    let maxX = -Infinity;\n    let minY = Infinity;\n    let maxY = -Infinity;\n\n    // We round the coordinates to slightly reduce the number of edges in the\n    // final outlines.\n    const NUMBER_OF_DIGITS = 4;\n    const EPSILON = 10 ** -NUMBER_OF_DIGITS;\n\n    // The coordinates of the boxes are in the page coordinate system.\n    for (const { x, y, width, height } of boxes) {\n      const x1 = Math.floor((x - borderWidth) / EPSILON) * EPSILON;\n      const x2 = Math.ceil((x + width + borderWidth) / EPSILON) * EPSILON;\n      const y1 = Math.floor((y - borderWidth) / EPSILON) * EPSILON;\n      const y2 = Math.ceil((y + height + borderWidth) / EPSILON) * EPSILON;\n      const left = [x1, y1, y2, true];\n      const right = [x2, y1, y2, false];\n      this.#verticalEdges.push(left, right);\n\n      minX = Math.min(minX, x1);\n      maxX = Math.max(maxX, x2);\n      minY = Math.min(minY, y1);\n      maxY = Math.max(maxY, y2);\n    }\n\n    const bboxWidth = maxX - minX + 2 * innerMargin;\n    const bboxHeight = maxY - minY + 2 * innerMargin;\n    const shiftedMinX = minX - innerMargin;\n    const shiftedMinY = minY - innerMargin;\n    const lastEdge = this.#verticalEdges.at(isLTR ? -1 : -2);\n    const lastPoint = [lastEdge[0], lastEdge[2]];\n\n    // Convert the coordinates of the edges into box coordinates.\n    for (const edge of this.#verticalEdges) {\n      const [x, y1, y2] = edge;\n      edge[0] = (x - shiftedMinX) / bboxWidth;\n      edge[1] = (y1 - shiftedMinY) / bboxHeight;\n      edge[2] = (y2 - shiftedMinY) / bboxHeight;\n    }\n\n    this.#box = {\n      x: shiftedMinX,\n      y: shiftedMinY,\n      width: bboxWidth,\n      height: bboxHeight,\n      lastPoint,\n    };\n  }\n\n  getOutlines() {\n    // We begin to sort lexicographically the vertical edges by their abscissa,\n    // and then by their ordinate.\n    this.#verticalEdges.sort(\n      (a, b) => a[0] - b[0] || a[1] - b[1] || a[2] - b[2]\n    );\n\n    // We're now using a sweep line algorithm to find the outlines.\n    // We start with the leftmost vertical edge, and we're going to iterate\n    // over all the vertical edges from left to right.\n    // Each time we encounter a left edge, we're going to insert the interval\n    // [y1, y2] in the set of intervals.\n    // This set of intervals is used to break the vertical edges into chunks:\n    // we only take the part of the vertical edge that isn't in the union of\n    // the intervals.\n    const outlineVerticalEdges = [];\n    for (const edge of this.#verticalEdges) {\n      if (edge[3]) {\n        // Left edge.\n        outlineVerticalEdges.push(...this.#breakEdge(edge));\n        this.#insert(edge);\n      } else {\n        // Right edge.\n        this.#remove(edge);\n        outlineVerticalEdges.push(...this.#breakEdge(edge));\n      }\n    }\n    return this.#getOutlines(outlineVerticalEdges);\n  }\n\n  #getOutlines(outlineVerticalEdges) {\n    const edges = [];\n    const allEdges = new Set();\n\n    for (const edge of outlineVerticalEdges) {\n      const [x, y1, y2] = edge;\n      edges.push([x, y1, edge], [x, y2, edge]);\n    }\n\n    // We sort lexicographically the vertices of each edge by their ordinate and\n    // by their abscissa.\n    // Every pair (v_2i, v_{2i + 1}) of vertices defines a horizontal edge.\n    // So for every vertical edge, we're going to add the two vertical edges\n    // which are connected to it through a horizontal edge.\n    edges.sort((a, b) => a[1] - b[1] || a[0] - b[0]);\n    for (let i = 0, ii = edges.length; i < ii; i += 2) {\n      const edge1 = edges[i][2];\n      const edge2 = edges[i + 1][2];\n      edge1.push(edge2);\n      edge2.push(edge1);\n      allEdges.add(edge1);\n      allEdges.add(edge2);\n    }\n    const outlines = [];\n    let outline;\n\n    while (allEdges.size > 0) {\n      const edge = allEdges.values().next().value;\n      let [x, y1, y2, edge1, edge2] = edge;\n      allEdges.delete(edge);\n      let lastPointX = x;\n      let lastPointY = y1;\n\n      outline = [x, y2];\n      outlines.push(outline);\n\n      while (true) {\n        let e;\n        if (allEdges.has(edge1)) {\n          e = edge1;\n        } else if (allEdges.has(edge2)) {\n          e = edge2;\n        } else {\n          break;\n        }\n\n        allEdges.delete(e);\n        [x, y1, y2, edge1, edge2] = e;\n\n        if (lastPointX !== x) {\n          outline.push(lastPointX, lastPointY, x, lastPointY === y1 ? y1 : y2);\n          lastPointX = x;\n        }\n        lastPointY = lastPointY === y1 ? y2 : y1;\n      }\n      outline.push(lastPointX, lastPointY);\n    }\n    return { outlines, box: this.#box };\n  }\n\n  #binarySearch(y) {\n    const array = this.#intervals;\n    let start = 0;\n    let end = array.length - 1;\n\n    while (start <= end) {\n      const middle = (start + end) >> 1;\n      const y1 = array[middle][0];\n      if (y1 === y) {\n        return middle;\n      }\n      if (y1 < y) {\n        start = middle + 1;\n      } else {\n        end = middle - 1;\n      }\n    }\n    return end + 1;\n  }\n\n  #insert([, y1, y2]) {\n    const index = this.#binarySearch(y1);\n    this.#intervals.splice(index, 0, [y1, y2]);\n  }\n\n  #remove([, y1, y2]) {\n    const index = this.#binarySearch(y1);\n    for (let i = index; i < this.#intervals.length; i++) {\n      const [start, end] = this.#intervals[i];\n      if (start !== y1) {\n        break;\n      }\n      if (start === y1 && end === y2) {\n        this.#intervals.splice(i, 1);\n        return;\n      }\n    }\n    for (let i = index - 1; i >= 0; i--) {\n      const [start, end] = this.#intervals[i];\n      if (start !== y1) {\n        break;\n      }\n      if (start === y1 && end === y2) {\n        this.#intervals.splice(i, 1);\n        return;\n      }\n    }\n  }\n\n  #breakEdge(edge) {\n    const [x, y1, y2] = edge;\n    const results = [[x, y1, y2]];\n    const index = this.#binarySearch(y2);\n    for (let i = 0; i < index; i++) {\n      const [start, end] = this.#intervals[i];\n      for (let j = 0, jj = results.length; j < jj; j++) {\n        const [, y3, y4] = results[j];\n        if (end <= y3 || y4 <= start) {\n          // There is no intersection between the interval and the edge, hence\n          // we keep it as is.\n          continue;\n        }\n        if (y3 >= start) {\n          if (y4 > end) {\n            results[j][1] = end;\n          } else {\n            if (jj === 1) {\n              return [];\n            }\n            // The edge is included in the interval, hence we remove it.\n            results.splice(j, 1);\n            j--;\n            jj--;\n          }\n          continue;\n        }\n        results[j][2] = start;\n        if (y4 > end) {\n          results.push([x, end, y4]);\n        }\n      }\n    }\n    return results;\n  }\n}\n\nexport { Outliner };\n", "/* Copyright 2022 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"./editor.js\").AnnotationEditor} AnnotationEditor */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"./annotation_editor_layer.js\").AnnotationEditorLayer} AnnotationEditorLayer */\n\nimport {\n  AnnotationEditorParamsType,\n  AnnotationEditorPrefix,\n  AnnotationEditorType,\n  FeatureTest,\n  getUuid,\n  shadow,\n  Util,\n  warn,\n} from \"../../shared/util.js\";\nimport {\n  fetchData,\n  getColorValues,\n  getRGB,\n  PixelsPerInch,\n} from \"../display_utils.js\";\n\nfunction bindEvents(obj, element, names) {\n  for (const name of names) {\n    element.addEventListener(name, obj[name].bind(obj));\n  }\n}\n\n/**\n * Convert a number between 0 and 100 into an hex number between 0 and 255.\n * @param {number} opacity\n * @return {string}\n */\nfunction opacityToHex(opacity) {\n  return Math.round(Math.min(255, Math.max(1, 255 * opacity)))\n    .toString(16)\n    .padStart(2, \"0\");\n}\n\n/**\n * Class to create some unique ids for the different editors.\n */\nclass IdManager {\n  #id = 0;\n\n  /**\n   * Get a unique id.\n   * @returns {string}\n   */\n  getId() {\n    return `${AnnotationEditorPrefix}${this.#id++}`;\n  }\n}\n\n/**\n * Class to manage the images used by the editors.\n * The main idea is to try to minimize the memory used by the images.\n * The images are cached and reused when possible\n * We use a refCounter to know when an image is not used anymore but we need to\n * be able to restore an image after a remove+undo, so we keep a file reference\n * or an url one.\n */\nclass ImageManager {\n  #baseId = getUuid();\n\n  #id = 0;\n\n  #cache = null;\n\n  static get _isSVGFittingCanvas() {\n    // By default, Firefox doesn't rescale without preserving the aspect ratio\n    // when drawing an SVG image on a canvas, see https://bugzilla.mozilla.org/1547776.\n    // The \"workaround\" is to append \"svgView(preserveAspectRatio(none))\" to the\n    // url, but according to comment #15, it seems that it leads to unexpected\n    // behavior in Safari.\n    const svg = `data:image/svg+xml;charset=UTF-8,<svg viewBox=\"0 0 1 1\" width=\"1\" height=\"1\" xmlns=\"http://www.w3.org/2000/svg\"><rect width=\"1\" height=\"1\" style=\"fill:red;\"/></svg>`;\n    const canvas = new OffscreenCanvas(1, 3);\n    const ctx = canvas.getContext(\"2d\");\n    const image = new Image();\n    image.src = svg;\n    const promise = image.decode().then(() => {\n      ctx.drawImage(image, 0, 0, 1, 1, 0, 0, 1, 3);\n      return new Uint32Array(ctx.getImageData(0, 0, 1, 1).data.buffer)[0] === 0;\n    });\n\n    return shadow(this, \"_isSVGFittingCanvas\", promise);\n  }\n\n  async #get(key, rawData) {\n    this.#cache ||= new Map();\n    let data = this.#cache.get(key);\n    if (data === null) {\n      // We already tried to load the image but it failed.\n      return null;\n    }\n    if (data?.bitmap) {\n      data.refCounter += 1;\n      return data;\n    }\n    try {\n      data ||= {\n        bitmap: null,\n        id: `image_${this.#baseId}_${this.#id++}`,\n        refCounter: 0,\n        isSvg: false,\n      };\n      let image;\n      if (typeof rawData === \"string\") {\n        data.url = rawData;\n        image = await fetchData(rawData, \"blob\");\n      } else {\n        image = data.file = rawData;\n      }\n\n      if (image.type === \"image/svg+xml\") {\n        // Unfortunately, createImageBitmap doesn't work with SVG images.\n        // (see https://bugzilla.mozilla.org/1841972).\n        const mustRemoveAspectRatioPromise = ImageManager._isSVGFittingCanvas;\n        const fileReader = new FileReader();\n        const imageElement = new Image();\n        const imagePromise = new Promise((resolve, reject) => {\n          imageElement.onload = () => {\n            data.bitmap = imageElement;\n            data.isSvg = true;\n            resolve();\n          };\n          fileReader.onload = async () => {\n            const url = (data.svgUrl = fileReader.result);\n            // We need to set the preserveAspectRatio to none in order to let\n            // the image fits the canvas when resizing.\n            imageElement.src = (await mustRemoveAspectRatioPromise)\n              ? `${url}#svgView(preserveAspectRatio(none))`\n              : url;\n          };\n          imageElement.onerror = fileReader.onerror = reject;\n        });\n        fileReader.readAsDataURL(image);\n        await imagePromise;\n      } else {\n        data.bitmap = await createImageBitmap(image);\n      }\n      data.refCounter = 1;\n    } catch (e) {\n      console.error(e);\n      data = null;\n    }\n    this.#cache.set(key, data);\n    if (data) {\n      this.#cache.set(data.id, data);\n    }\n    return data;\n  }\n\n  async getFromFile(file) {\n    const { lastModified, name, size, type } = file;\n    return this.#get(`${lastModified}_${name}_${size}_${type}`, file);\n  }\n\n  async getFromUrl(url) {\n    return this.#get(url, url);\n  }\n\n  async getFromId(id) {\n    this.#cache ||= new Map();\n    const data = this.#cache.get(id);\n    if (!data) {\n      return null;\n    }\n    if (data.bitmap) {\n      data.refCounter += 1;\n      return data;\n    }\n\n    if (data.file) {\n      return this.getFromFile(data.file);\n    }\n    return this.getFromUrl(data.url);\n  }\n\n  getSvgUrl(id) {\n    const data = this.#cache.get(id);\n    if (!data?.isSvg) {\n      return null;\n    }\n    return data.svgUrl;\n  }\n\n  deleteId(id) {\n    this.#cache ||= new Map();\n    const data = this.#cache.get(id);\n    if (!data) {\n      return;\n    }\n    data.refCounter -= 1;\n    if (data.refCounter !== 0) {\n      return;\n    }\n    data.bitmap = null;\n  }\n\n  // We can use the id only if it belongs this manager.\n  // We must take care of having the right manager because we can copy/paste\n  // some images from other documents, hence it'd be a pity to use an id from an\n  // other manager.\n  isValidId(id) {\n    return id.startsWith(`image_${this.#baseId}_`);\n  }\n}\n\n/**\n * Class to handle undo/redo.\n * Commands are just saved in a buffer.\n * If we hit some memory issues we could likely use a circular buffer.\n * It has to be used as a singleton.\n */\nclass CommandManager {\n  #commands = [];\n\n  #locked = false;\n\n  #maxSize;\n\n  #position = -1;\n\n  constructor(maxSize = 128) {\n    this.#maxSize = maxSize;\n  }\n\n  /**\n   * @typedef {Object} addOptions\n   * @property {function} cmd\n   * @property {function} undo\n   * @property {boolean} mustExec\n   * @property {number} type\n   * @property {boolean} overwriteIfSameType\n   * @property {boolean} keepUndo\n   */\n\n  /**\n   * Add a new couple of commands to be used in case of redo/undo.\n   * @param {addOptions} options\n   */\n  add({\n    cmd,\n    undo,\n    mustExec,\n    type = NaN,\n    overwriteIfSameType = false,\n    keepUndo = false,\n  }) {\n    if (mustExec) {\n      cmd();\n    }\n\n    if (this.#locked) {\n      return;\n    }\n\n    const save = { cmd, undo, type };\n    if (this.#position === -1) {\n      if (this.#commands.length > 0) {\n        // All the commands have been undone and then a new one is added\n        // hence we clear the queue.\n        this.#commands.length = 0;\n      }\n      this.#position = 0;\n      this.#commands.push(save);\n      return;\n    }\n\n    if (overwriteIfSameType && this.#commands[this.#position].type === type) {\n      // For example when we change a color we don't want to\n      // be able to undo all the steps, hence we only want to\n      // keep the last undoable action in this sequence of actions.\n      if (keepUndo) {\n        save.undo = this.#commands[this.#position].undo;\n      }\n      this.#commands[this.#position] = save;\n      return;\n    }\n\n    const next = this.#position + 1;\n    if (next === this.#maxSize) {\n      this.#commands.splice(0, 1);\n    } else {\n      this.#position = next;\n      if (next < this.#commands.length) {\n        this.#commands.splice(next);\n      }\n    }\n\n    this.#commands.push(save);\n  }\n\n  /**\n   * Undo the last command.\n   */\n  undo() {\n    if (this.#position === -1) {\n      // Nothing to undo.\n      return;\n    }\n\n    // Avoid to insert something during the undo execution.\n    this.#locked = true;\n    this.#commands[this.#position].undo();\n    this.#locked = false;\n\n    this.#position -= 1;\n  }\n\n  /**\n   * Redo the last command.\n   */\n  redo() {\n    if (this.#position < this.#commands.length - 1) {\n      this.#position += 1;\n\n      // Avoid to insert something during the redo execution.\n      this.#locked = true;\n      this.#commands[this.#position].cmd();\n      this.#locked = false;\n    }\n  }\n\n  /**\n   * Check if there is something to undo.\n   * @returns {boolean}\n   */\n  hasSomethingToUndo() {\n    return this.#position !== -1;\n  }\n\n  /**\n   * Check if there is something to redo.\n   * @returns {boolean}\n   */\n  hasSomethingToRedo() {\n    return this.#position < this.#commands.length - 1;\n  }\n\n  destroy() {\n    this.#commands = null;\n  }\n}\n\n/**\n * Class to handle the different keyboards shortcuts we can have on mac or\n * non-mac OSes.\n */\nclass KeyboardManager {\n  /**\n   * Create a new keyboard manager class.\n   * @param {Array<Array>} callbacks - an array containing an array of shortcuts\n   * and a callback to call.\n   * A shortcut is a string like `ctrl+c` or `mac+ctrl+c` for mac OS.\n   */\n  constructor(callbacks) {\n    this.buffer = [];\n    this.callbacks = new Map();\n    this.allKeys = new Set();\n\n    const { isMac } = FeatureTest.platform;\n    for (const [keys, callback, options = {}] of callbacks) {\n      for (const key of keys) {\n        const isMacKey = key.startsWith(\"mac+\");\n        if (isMac && isMacKey) {\n          this.callbacks.set(key.slice(4), { callback, options });\n          this.allKeys.add(key.split(\"+\").at(-1));\n        } else if (!isMac && !isMacKey) {\n          this.callbacks.set(key, { callback, options });\n          this.allKeys.add(key.split(\"+\").at(-1));\n        }\n      }\n    }\n  }\n\n  /**\n   * Serialize an event into a string in order to match a\n   * potential key for a callback.\n   * @param {KeyboardEvent} event\n   * @returns {string}\n   */\n  #serialize(event) {\n    if (event.altKey) {\n      this.buffer.push(\"alt\");\n    }\n    if (event.ctrlKey) {\n      this.buffer.push(\"ctrl\");\n    }\n    if (event.metaKey) {\n      this.buffer.push(\"meta\");\n    }\n    if (event.shiftKey) {\n      this.buffer.push(\"shift\");\n    }\n    this.buffer.push(event.key);\n    const str = this.buffer.join(\"+\");\n    this.buffer.length = 0;\n\n    return str;\n  }\n\n  /**\n   * Execute a callback, if any, for a given keyboard event.\n   * The self is used as `this` in the callback.\n   * @param {Object} self\n   * @param {KeyboardEvent} event\n   * @returns\n   */\n  exec(self, event) {\n    if (!this.allKeys.has(event.key)) {\n      return;\n    }\n    const info = this.callbacks.get(this.#serialize(event));\n    if (!info) {\n      return;\n    }\n    const {\n      callback,\n      options: { bubbles = false, args = [], checker = null },\n    } = info;\n\n    if (checker && !checker(self, event)) {\n      return;\n    }\n    callback.bind(self, ...args, event)();\n\n    // For example, ctrl+s in a FreeText must be handled by the viewer, hence\n    // the event must bubble.\n    if (!bubbles) {\n      event.stopPropagation();\n      event.preventDefault();\n    }\n  }\n}\n\nclass ColorManager {\n  static _colorsMapping = new Map([\n    [\"CanvasText\", [0, 0, 0]],\n    [\"Canvas\", [255, 255, 255]],\n  ]);\n\n  get _colors() {\n    if (\n      typeof PDFJSDev !== \"undefined\" &&\n      PDFJSDev.test(\"LIB\") &&\n      typeof document === \"undefined\"\n    ) {\n      return shadow(this, \"_colors\", ColorManager._colorsMapping);\n    }\n\n    const colors = new Map([\n      [\"CanvasText\", null],\n      [\"Canvas\", null],\n    ]);\n    getColorValues(colors);\n    return shadow(this, \"_colors\", colors);\n  }\n\n  /**\n   * In High Contrast Mode, the color on the screen is not always the\n   * real color used in the pdf.\n   * For example in some cases white can appear to be black but when saving\n   * we want to have white.\n   * @param {string} color\n   * @returns {Array<number>}\n   */\n  convert(color) {\n    const rgb = getRGB(color);\n    if (!window.matchMedia(\"(forced-colors: active)\").matches) {\n      return rgb;\n    }\n\n    for (const [name, RGB] of this._colors) {\n      if (RGB.every((x, i) => x === rgb[i])) {\n        return ColorManager._colorsMapping.get(name);\n      }\n    }\n    return rgb;\n  }\n\n  /**\n   * An input element must have its color value as a hex string\n   * and not as color name.\n   * So this function converts a name into an hex string.\n   * @param {string} name\n   * @returns {string}\n   */\n  getHexCode(name) {\n    const rgb = this._colors.get(name);\n    if (!rgb) {\n      return name;\n    }\n    return Util.makeHexColor(...rgb);\n  }\n}\n\n/**\n * A pdf has several pages and each of them when it will rendered\n * will have an AnnotationEditorLayer which will contain the some\n * new Annotations associated to an editor in order to modify them.\n *\n * This class is used to manage all the different layers, editors and\n * some action like copy/paste, undo/redo, ...\n */\nclass AnnotationEditorUIManager {\n  #activeEditor = null;\n\n  #allEditors = new Map();\n\n  #allLayers = new Map();\n\n  #altTextManager = null;\n\n  #annotationStorage = null;\n\n  #commandManager = new CommandManager();\n\n  #currentPageIndex = 0;\n\n  #deletedAnnotationsElementIds = new Set();\n\n  #draggingEditors = null;\n\n  #editorTypes = null;\n\n  #editorsToRescale = new Set();\n\n  #filterFactory = null;\n\n  #focusMainContainerTimeoutId = null;\n\n  #highlightColors = null;\n\n  #idManager = new IdManager();\n\n  #isEnabled = false;\n\n  #isWaiting = false;\n\n  #lastActiveElement = null;\n\n  #mainHighlightColorPicker = null;\n\n  #mode = AnnotationEditorType.NONE;\n\n  #selectedEditors = new Set();\n\n  #pageColors = null;\n\n  #boundBlur = this.blur.bind(this);\n\n  #boundFocus = this.focus.bind(this);\n\n  #boundCopy = this.copy.bind(this);\n\n  #boundCut = this.cut.bind(this);\n\n  #boundPaste = this.paste.bind(this);\n\n  #boundKeydown = this.keydown.bind(this);\n\n  #boundOnEditingAction = this.onEditingAction.bind(this);\n\n  #boundOnPageChanging = this.onPageChanging.bind(this);\n\n  #boundOnScaleChanging = this.onScaleChanging.bind(this);\n\n  #boundOnRotationChanging = this.onRotationChanging.bind(this);\n\n  #previousStates = {\n    isEditing: false,\n    isEmpty: true,\n    hasSomethingToUndo: false,\n    hasSomethingToRedo: false,\n    hasSelectedEditor: false,\n  };\n\n  #translation = [0, 0];\n\n  #translationTimeoutId = null;\n\n  #container = null;\n\n  #viewer = null;\n\n  static TRANSLATE_SMALL = 1; // page units.\n\n  static TRANSLATE_BIG = 10; // page units.\n\n  static get _keyboardManager() {\n    const proto = AnnotationEditorUIManager.prototype;\n\n    const arrowChecker = self => {\n      // If the focused element is an input, we don't want to handle the arrow.\n      // For example, sliders can be controlled with the arrow keys.\n      return (\n        self.#container.contains(document.activeElement) &&\n        document.activeElement.tagName !== \"BUTTON\" &&\n        self.hasSomethingToControl()\n      );\n    };\n\n    const textInputChecker = (_self, { target: el }) => {\n      if (el instanceof HTMLInputElement) {\n        const { type } = el;\n        return type !== \"text\" && type !== \"number\";\n      }\n      return true;\n    };\n\n    const small = this.TRANSLATE_SMALL;\n    const big = this.TRANSLATE_BIG;\n\n    return shadow(\n      this,\n      \"_keyboardManager\",\n      new KeyboardManager([\n        [\n          [\"ctrl+a\", \"mac+meta+a\"],\n          proto.selectAll,\n          { checker: textInputChecker },\n        ],\n        [[\"ctrl+z\", \"mac+meta+z\"], proto.undo, { checker: textInputChecker }],\n        [\n          // On mac, depending of the OS version, the event.key is either \"z\" or\n          // \"Z\" when the user presses \"meta+shift+z\".\n          [\n            \"ctrl+y\",\n            \"ctrl+shift+z\",\n            \"mac+meta+shift+z\",\n            \"ctrl+shift+Z\",\n            \"mac+meta+shift+Z\",\n          ],\n          proto.redo,\n          { checker: textInputChecker },\n        ],\n        [\n          [\n            \"Backspace\",\n            \"alt+Backspace\",\n            \"ctrl+Backspace\",\n            \"shift+Backspace\",\n            \"mac+Backspace\",\n            \"mac+alt+Backspace\",\n            \"mac+ctrl+Backspace\",\n            \"Delete\",\n            \"ctrl+Delete\",\n            \"shift+Delete\",\n            \"mac+Delete\",\n          ],\n          proto.delete,\n          { checker: textInputChecker },\n        ],\n        [\n          [\"Enter\", \"mac+Enter\"],\n          proto.addNewEditorFromKeyboard,\n          {\n            // Those shortcuts can be used in the toolbar for some other actions\n            // like zooming, hence we need to check if the container has the\n            // focus.\n            checker: (self, { target: el }) =>\n              !(el instanceof HTMLButtonElement) &&\n              self.#container.contains(el) &&\n              !self.isEnterHandled,\n          },\n        ],\n        [\n          [\" \", \"mac+ \"],\n          proto.addNewEditorFromKeyboard,\n          {\n            // Those shortcuts can be used in the toolbar for some other actions\n            // like zooming, hence we need to check if the container has the\n            // focus.\n            checker: self => self.#container.contains(document.activeElement),\n          },\n        ],\n        [[\"Escape\", \"mac+Escape\"], proto.unselectAll],\n        [\n          [\"ArrowLeft\", \"mac+ArrowLeft\"],\n          proto.translateSelectedEditors,\n          { args: [-small, 0], checker: arrowChecker },\n        ],\n        [\n          [\"ctrl+ArrowLeft\", \"mac+shift+ArrowLeft\"],\n          proto.translateSelectedEditors,\n          { args: [-big, 0], checker: arrowChecker },\n        ],\n        [\n          [\"ArrowRight\", \"mac+ArrowRight\"],\n          proto.translateSelectedEditors,\n          { args: [small, 0], checker: arrowChecker },\n        ],\n        [\n          [\"ctrl+ArrowRight\", \"mac+shift+ArrowRight\"],\n          proto.translateSelectedEditors,\n          { args: [big, 0], checker: arrowChecker },\n        ],\n        [\n          [\"ArrowUp\", \"mac+ArrowUp\"],\n          proto.translateSelectedEditors,\n          { args: [0, -small], checker: arrowChecker },\n        ],\n        [\n          [\"ctrl+ArrowUp\", \"mac+shift+ArrowUp\"],\n          proto.translateSelectedEditors,\n          { args: [0, -big], checker: arrowChecker },\n        ],\n        [\n          [\"ArrowDown\", \"mac+ArrowDown\"],\n          proto.translateSelectedEditors,\n          { args: [0, small], checker: arrowChecker },\n        ],\n        [\n          [\"ctrl+ArrowDown\", \"mac+shift+ArrowDown\"],\n          proto.translateSelectedEditors,\n          { args: [0, big], checker: arrowChecker },\n        ],\n      ])\n    );\n  }\n\n  constructor(\n    container,\n    viewer,\n    altTextManager,\n    eventBus,\n    pdfDocument,\n    pageColors,\n    highlightColors\n  ) {\n    this.#container = container;\n    this.#viewer = viewer;\n    this.#altTextManager = altTextManager;\n    this._eventBus = eventBus;\n    this._eventBus._on(\"editingaction\", this.#boundOnEditingAction);\n    this._eventBus._on(\"pagechanging\", this.#boundOnPageChanging);\n    this._eventBus._on(\"scalechanging\", this.#boundOnScaleChanging);\n    this._eventBus._on(\"rotationchanging\", this.#boundOnRotationChanging);\n    this.#annotationStorage = pdfDocument.annotationStorage;\n    this.#filterFactory = pdfDocument.filterFactory;\n    this.#pageColors = pageColors;\n    this.#highlightColors = highlightColors || null;\n    this.viewParameters = {\n      realScale: PixelsPerInch.PDF_TO_CSS_UNITS,\n      rotation: 0,\n    };\n  }\n\n  destroy() {\n    this.#removeKeyboardManager();\n    this.#removeFocusManager();\n    this._eventBus._off(\"editingaction\", this.#boundOnEditingAction);\n    this._eventBus._off(\"pagechanging\", this.#boundOnPageChanging);\n    this._eventBus._off(\"scalechanging\", this.#boundOnScaleChanging);\n    this._eventBus._off(\"rotationchanging\", this.#boundOnRotationChanging);\n    for (const layer of this.#allLayers.values()) {\n      layer.destroy();\n    }\n    this.#allLayers.clear();\n    this.#allEditors.clear();\n    this.#editorsToRescale.clear();\n    this.#activeEditor = null;\n    this.#selectedEditors.clear();\n    this.#commandManager.destroy();\n    this.#altTextManager?.destroy();\n    if (this.#focusMainContainerTimeoutId) {\n      clearTimeout(this.#focusMainContainerTimeoutId);\n      this.#focusMainContainerTimeoutId = null;\n    }\n    if (this.#translationTimeoutId) {\n      clearTimeout(this.#translationTimeoutId);\n      this.#translationTimeoutId = null;\n    }\n  }\n\n  get hcmFilter() {\n    return shadow(\n      this,\n      \"hcmFilter\",\n      this.#pageColors\n        ? this.#filterFactory.addHCMFilter(\n            this.#pageColors.foreground,\n            this.#pageColors.background\n          )\n        : \"none\"\n    );\n  }\n\n  get direction() {\n    return shadow(\n      this,\n      \"direction\",\n      getComputedStyle(this.#container).direction\n    );\n  }\n\n  get highlightColors() {\n    return shadow(\n      this,\n      \"highlightColors\",\n      this.#highlightColors\n        ? new Map(\n            this.#highlightColors\n              .split(\",\")\n              .map(pair => pair.split(\"=\").map(x => x.trim()))\n          )\n        : null\n    );\n  }\n\n  setMainHighlightColorPicker(colorPicker) {\n    this.#mainHighlightColorPicker = colorPicker;\n  }\n\n  editAltText(editor) {\n    this.#altTextManager?.editAltText(this, editor);\n  }\n\n  onPageChanging({ pageNumber }) {\n    this.#currentPageIndex = pageNumber - 1;\n  }\n\n  focusMainContainer() {\n    this.#container.focus();\n  }\n\n  findParent(x, y) {\n    for (const layer of this.#allLayers.values()) {\n      const {\n        x: layerX,\n        y: layerY,\n        width,\n        height,\n      } = layer.div.getBoundingClientRect();\n      if (\n        x >= layerX &&\n        x <= layerX + width &&\n        y >= layerY &&\n        y <= layerY + height\n      ) {\n        return layer;\n      }\n    }\n    return null;\n  }\n\n  disableUserSelect(value = false) {\n    this.#viewer.classList.toggle(\"noUserSelect\", value);\n  }\n\n  addShouldRescale(editor) {\n    this.#editorsToRescale.add(editor);\n  }\n\n  removeShouldRescale(editor) {\n    this.#editorsToRescale.delete(editor);\n  }\n\n  onScaleChanging({ scale }) {\n    this.commitOrRemove();\n    this.viewParameters.realScale = scale * PixelsPerInch.PDF_TO_CSS_UNITS;\n    for (const editor of this.#editorsToRescale) {\n      editor.onScaleChanging();\n    }\n  }\n\n  onRotationChanging({ pagesRotation }) {\n    this.commitOrRemove();\n    this.viewParameters.rotation = pagesRotation;\n  }\n\n  /**\n   * Add an editor in the annotation storage.\n   * @param {AnnotationEditor} editor\n   */\n  addToAnnotationStorage(editor) {\n    if (\n      !editor.isEmpty() &&\n      this.#annotationStorage &&\n      !this.#annotationStorage.has(editor.id)\n    ) {\n      this.#annotationStorage.setValue(editor.id, editor);\n    }\n  }\n\n  #addFocusManager() {\n    window.addEventListener(\"focus\", this.#boundFocus);\n    window.addEventListener(\"blur\", this.#boundBlur);\n  }\n\n  #removeFocusManager() {\n    window.removeEventListener(\"focus\", this.#boundFocus);\n    window.removeEventListener(\"blur\", this.#boundBlur);\n  }\n\n  blur() {\n    if (!this.hasSelection) {\n      return;\n    }\n    // When several editors are selected and the window loses focus, we want to\n    // keep the last active element in order to be able to focus it again when\n    // the window gets the focus back but we don't want to trigger any focus\n    // callbacks else only one editor will be selected.\n    const { activeElement } = document;\n    for (const editor of this.#selectedEditors) {\n      if (editor.div.contains(activeElement)) {\n        this.#lastActiveElement = [editor, activeElement];\n        editor._focusEventsAllowed = false;\n        break;\n      }\n    }\n  }\n\n  focus() {\n    if (!this.#lastActiveElement) {\n      return;\n    }\n    const [lastEditor, lastActiveElement] = this.#lastActiveElement;\n    this.#lastActiveElement = null;\n    lastActiveElement.addEventListener(\n      \"focusin\",\n      () => {\n        lastEditor._focusEventsAllowed = true;\n      },\n      { once: true }\n    );\n    lastActiveElement.focus();\n  }\n\n  #addKeyboardManager() {\n    // The keyboard events are caught at the container level in order to be able\n    // to execute some callbacks even if the current page doesn't have focus.\n    window.addEventListener(\"keydown\", this.#boundKeydown);\n  }\n\n  #removeKeyboardManager() {\n    window.removeEventListener(\"keydown\", this.#boundKeydown);\n  }\n\n  #addCopyPasteListeners() {\n    document.addEventListener(\"copy\", this.#boundCopy);\n    document.addEventListener(\"cut\", this.#boundCut);\n    document.addEventListener(\"paste\", this.#boundPaste);\n  }\n\n  #removeCopyPasteListeners() {\n    document.removeEventListener(\"copy\", this.#boundCopy);\n    document.removeEventListener(\"cut\", this.#boundCut);\n    document.removeEventListener(\"paste\", this.#boundPaste);\n  }\n\n  addEditListeners() {\n    this.#addKeyboardManager();\n    this.#addCopyPasteListeners();\n  }\n\n  removeEditListeners() {\n    this.#removeKeyboardManager();\n    this.#removeCopyPasteListeners();\n  }\n\n  /**\n   * Copy callback.\n   * @param {ClipboardEvent} event\n   */\n  copy(event) {\n    event.preventDefault();\n\n    // An editor is being edited so just commit it.\n    this.#activeEditor?.commitOrRemove();\n\n    if (!this.hasSelection) {\n      return;\n    }\n\n    const editors = [];\n    for (const editor of this.#selectedEditors) {\n      const serialized = editor.serialize(/* isForCopying = */ true);\n      if (serialized) {\n        editors.push(serialized);\n      }\n    }\n    if (editors.length === 0) {\n      return;\n    }\n\n    event.clipboardData.setData(\"application/pdfjs\", JSON.stringify(editors));\n  }\n\n  /**\n   * Cut callback.\n   * @param {ClipboardEvent} event\n   */\n  cut(event) {\n    this.copy(event);\n    this.delete();\n  }\n\n  /**\n   * Paste callback.\n   * @param {ClipboardEvent} event\n   */\n  paste(event) {\n    event.preventDefault();\n    const { clipboardData } = event;\n    for (const item of clipboardData.items) {\n      for (const editorType of this.#editorTypes) {\n        if (editorType.isHandlingMimeForPasting(item.type)) {\n          editorType.paste(item, this.currentLayer);\n          return;\n        }\n      }\n    }\n\n    let data = clipboardData.getData(\"application/pdfjs\");\n    if (!data) {\n      return;\n    }\n\n    try {\n      data = JSON.parse(data);\n    } catch (ex) {\n      warn(`paste: \"${ex.message}\".`);\n      return;\n    }\n\n    if (!Array.isArray(data)) {\n      return;\n    }\n\n    this.unselectAll();\n    const layer = this.currentLayer;\n\n    try {\n      const newEditors = [];\n      for (const editor of data) {\n        const deserializedEditor = layer.deserialize(editor);\n        if (!deserializedEditor) {\n          return;\n        }\n        newEditors.push(deserializedEditor);\n      }\n\n      const cmd = () => {\n        for (const editor of newEditors) {\n          this.#addEditorToLayer(editor);\n        }\n        this.#selectEditors(newEditors);\n      };\n      const undo = () => {\n        for (const editor of newEditors) {\n          editor.remove();\n        }\n      };\n      this.addCommands({ cmd, undo, mustExec: true });\n    } catch (ex) {\n      warn(`paste: \"${ex.message}\".`);\n    }\n  }\n\n  /**\n   * Keydown callback.\n   * @param {KeyboardEvent} event\n   */\n  keydown(event) {\n    if (!this.isEditorHandlingKeyboard) {\n      AnnotationEditorUIManager._keyboardManager.exec(this, event);\n    }\n  }\n\n  /**\n   * Execute an action for a given name.\n   * For example, the user can click on the \"Undo\" entry in the context menu\n   * and it'll trigger the undo action.\n   * @param {Object} details\n   */\n  onEditingAction(details) {\n    if ([\"undo\", \"redo\", \"delete\", \"selectAll\"].includes(details.name)) {\n      this[details.name]();\n    }\n  }\n\n  /**\n   * Update the different possible states of this manager, e.g. is there\n   * something to undo, redo, ...\n   * @param {Object} details\n   */\n  #dispatchUpdateStates(details) {\n    const hasChanged = Object.entries(details).some(\n      ([key, value]) => this.#previousStates[key] !== value\n    );\n\n    if (hasChanged) {\n      this._eventBus.dispatch(\"annotationeditorstateschanged\", {\n        source: this,\n        details: Object.assign(this.#previousStates, details),\n      });\n    }\n  }\n\n  #dispatchUpdateUI(details) {\n    this._eventBus.dispatch(\"annotationeditorparamschanged\", {\n      source: this,\n      details,\n    });\n  }\n\n  /**\n   * Set the editing state.\n   * It can be useful to temporarily disable it when the user is editing a\n   * FreeText annotation.\n   * @param {boolean} isEditing\n   */\n  setEditingState(isEditing) {\n    if (isEditing) {\n      this.#addFocusManager();\n      this.#addKeyboardManager();\n      this.#addCopyPasteListeners();\n      this.#dispatchUpdateStates({\n        isEditing: this.#mode !== AnnotationEditorType.NONE,\n        isEmpty: this.#isEmpty(),\n        hasSomethingToUndo: this.#commandManager.hasSomethingToUndo(),\n        hasSomethingToRedo: this.#commandManager.hasSomethingToRedo(),\n        hasSelectedEditor: false,\n      });\n    } else {\n      this.#removeFocusManager();\n      this.#removeKeyboardManager();\n      this.#removeCopyPasteListeners();\n      this.#dispatchUpdateStates({\n        isEditing: false,\n      });\n      this.disableUserSelect(false);\n    }\n  }\n\n  registerEditorTypes(types) {\n    if (this.#editorTypes) {\n      return;\n    }\n    this.#editorTypes = types;\n    for (const editorType of this.#editorTypes) {\n      this.#dispatchUpdateUI(editorType.defaultPropertiesToUpdate);\n    }\n  }\n\n  /**\n   * Get an id.\n   * @returns {string}\n   */\n  getId() {\n    return this.#idManager.getId();\n  }\n\n  get currentLayer() {\n    return this.#allLayers.get(this.#currentPageIndex);\n  }\n\n  getLayer(pageIndex) {\n    return this.#allLayers.get(pageIndex);\n  }\n\n  get currentPageIndex() {\n    return this.#currentPageIndex;\n  }\n\n  /**\n   * Add a new layer for a page which will contains the editors.\n   * @param {AnnotationEditorLayer} layer\n   */\n  addLayer(layer) {\n    this.#allLayers.set(layer.pageIndex, layer);\n    if (this.#isEnabled) {\n      layer.enable();\n    } else {\n      layer.disable();\n    }\n  }\n\n  /**\n   * Remove a layer.\n   * @param {AnnotationEditorLayer} layer\n   */\n  removeLayer(layer) {\n    this.#allLayers.delete(layer.pageIndex);\n  }\n\n  /**\n   * Change the editor mode (None, FreeText, Ink, ...)\n   * @param {number} mode\n   * @param {string|null} editId\n   * @param {boolean} [isFromKeyboard] - true if the mode change is due to a\n   *   keyboard action.\n   */\n  updateMode(mode, editId = null, isFromKeyboard = false) {\n    if (this.#mode === mode) {\n      return;\n    }\n    this.#mode = mode;\n    if (mode === AnnotationEditorType.NONE) {\n      this.setEditingState(false);\n      this.#disableAll();\n      return;\n    }\n    this.setEditingState(true);\n    this.#enableAll();\n    this.unselectAll();\n    for (const layer of this.#allLayers.values()) {\n      layer.updateMode(mode);\n    }\n    if (!editId && isFromKeyboard) {\n      this.addNewEditorFromKeyboard();\n      return;\n    }\n\n    if (!editId) {\n      return;\n    }\n    for (const editor of this.#allEditors.values()) {\n      if (editor.annotationElementId === editId) {\n        this.setSelected(editor);\n        editor.enterInEditMode();\n        break;\n      }\n    }\n  }\n\n  addNewEditorFromKeyboard() {\n    if (this.currentLayer.canCreateNewEmptyEditor()) {\n      this.currentLayer.addNewEditor();\n    }\n  }\n\n  /**\n   * Update the toolbar if it's required to reflect the tool currently used.\n   * @param {number} mode\n   * @returns {undefined}\n   */\n  updateToolbar(mode) {\n    if (mode === this.#mode) {\n      return;\n    }\n    this._eventBus.dispatch(\"switchannotationeditormode\", {\n      source: this,\n      mode,\n    });\n  }\n\n  /**\n   * Update a parameter in the current editor or globally.\n   * @param {number} type\n   * @param {*} value\n   */\n  updateParams(type, value) {\n    if (!this.#editorTypes) {\n      return;\n    }\n\n    switch (type) {\n      case AnnotationEditorParamsType.CREATE:\n        this.currentLayer.addNewEditor();\n        return;\n      case AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR:\n        this.#mainHighlightColorPicker?.updateColor(value);\n        break;\n    }\n\n    for (const editor of this.#selectedEditors) {\n      editor.updateParams(type, value);\n    }\n\n    for (const editorType of this.#editorTypes) {\n      editorType.updateDefaultParams(type, value);\n    }\n  }\n\n  enableWaiting(mustWait = false) {\n    if (this.#isWaiting === mustWait) {\n      return;\n    }\n    this.#isWaiting = mustWait;\n    for (const layer of this.#allLayers.values()) {\n      if (mustWait) {\n        layer.disableClick();\n      } else {\n        layer.enableClick();\n      }\n      layer.div.classList.toggle(\"waiting\", mustWait);\n    }\n  }\n\n  /**\n   * Enable all the layers.\n   */\n  #enableAll() {\n    if (!this.#isEnabled) {\n      this.#isEnabled = true;\n      for (const layer of this.#allLayers.values()) {\n        layer.enable();\n      }\n    }\n  }\n\n  /**\n   * Disable all the layers.\n   */\n  #disableAll() {\n    this.unselectAll();\n    if (this.#isEnabled) {\n      this.#isEnabled = false;\n      for (const layer of this.#allLayers.values()) {\n        layer.disable();\n      }\n    }\n  }\n\n  /**\n   * Get all the editors belonging to a given page.\n   * @param {number} pageIndex\n   * @returns {Array<AnnotationEditor>}\n   */\n  getEditors(pageIndex) {\n    const editors = [];\n    for (const editor of this.#allEditors.values()) {\n      if (editor.pageIndex === pageIndex) {\n        editors.push(editor);\n      }\n    }\n    return editors;\n  }\n\n  /**\n   * Get an editor with the given id.\n   * @param {string} id\n   * @returns {AnnotationEditor}\n   */\n  getEditor(id) {\n    return this.#allEditors.get(id);\n  }\n\n  /**\n   * Add a new editor.\n   * @param {AnnotationEditor} editor\n   */\n  addEditor(editor) {\n    this.#allEditors.set(editor.id, editor);\n  }\n\n  /**\n   * Remove an editor.\n   * @param {AnnotationEditor} editor\n   */\n  removeEditor(editor) {\n    if (editor.div.contains(document.activeElement)) {\n      if (this.#focusMainContainerTimeoutId) {\n        clearTimeout(this.#focusMainContainerTimeoutId);\n      }\n      this.#focusMainContainerTimeoutId = setTimeout(() => {\n        // When the div is removed from DOM the focus can move on the\n        // document.body, so we need to move it back to the main container.\n        this.focusMainContainer();\n        this.#focusMainContainerTimeoutId = null;\n      }, 0);\n    }\n    this.#allEditors.delete(editor.id);\n    this.unselect(editor);\n    if (\n      !editor.annotationElementId ||\n      !this.#deletedAnnotationsElementIds.has(editor.annotationElementId)\n    ) {\n      this.#annotationStorage?.remove(editor.id);\n    }\n  }\n\n  /**\n   * The annotation element with the given id has been deleted.\n   * @param {AnnotationEditor} editor\n   */\n  addDeletedAnnotationElement(editor) {\n    this.#deletedAnnotationsElementIds.add(editor.annotationElementId);\n    editor.deleted = true;\n  }\n\n  /**\n   * Check if the annotation element with the given id has been deleted.\n   * @param {string} annotationElementId\n   * @returns {boolean}\n   */\n  isDeletedAnnotationElement(annotationElementId) {\n    return this.#deletedAnnotationsElementIds.has(annotationElementId);\n  }\n\n  /**\n   * The annotation element with the given id have been restored.\n   * @param {AnnotationEditor} editor\n   */\n  removeDeletedAnnotationElement(editor) {\n    this.#deletedAnnotationsElementIds.delete(editor.annotationElementId);\n    editor.deleted = false;\n  }\n\n  /**\n   * Add an editor to the layer it belongs to or add it to the global map.\n   * @param {AnnotationEditor} editor\n   */\n  #addEditorToLayer(editor) {\n    const layer = this.#allLayers.get(editor.pageIndex);\n    if (layer) {\n      layer.addOrRebuild(editor);\n    } else {\n      this.addEditor(editor);\n    }\n  }\n\n  /**\n   * Set the given editor as the active one.\n   * @param {AnnotationEditor} editor\n   */\n  setActiveEditor(editor) {\n    if (this.#activeEditor === editor) {\n      return;\n    }\n\n    this.#activeEditor = editor;\n    if (editor) {\n      this.#dispatchUpdateUI(editor.propertiesToUpdate);\n    }\n  }\n\n  /**\n   * Add or remove an editor the current selection.\n   * @param {AnnotationEditor} editor\n   */\n  toggleSelected(editor) {\n    if (this.#selectedEditors.has(editor)) {\n      this.#selectedEditors.delete(editor);\n      editor.unselect();\n      this.#dispatchUpdateStates({\n        hasSelectedEditor: this.hasSelection,\n      });\n      return;\n    }\n    this.#selectedEditors.add(editor);\n    editor.select();\n    this.#dispatchUpdateUI(editor.propertiesToUpdate);\n    this.#dispatchUpdateStates({\n      hasSelectedEditor: true,\n    });\n  }\n\n  /**\n   * Set the last selected editor.\n   * @param {AnnotationEditor} editor\n   */\n  setSelected(editor) {\n    for (const ed of this.#selectedEditors) {\n      if (ed !== editor) {\n        ed.unselect();\n      }\n    }\n    this.#selectedEditors.clear();\n\n    this.#selectedEditors.add(editor);\n    editor.select();\n    this.#dispatchUpdateUI(editor.propertiesToUpdate);\n    this.#dispatchUpdateStates({\n      hasSelectedEditor: true,\n    });\n  }\n\n  /**\n   * Check if the editor is selected.\n   * @param {AnnotationEditor} editor\n   */\n  isSelected(editor) {\n    return this.#selectedEditors.has(editor);\n  }\n\n  get firstSelectedEditor() {\n    return this.#selectedEditors.values().next().value;\n  }\n\n  /**\n   * Unselect an editor.\n   * @param {AnnotationEditor} editor\n   */\n  unselect(editor) {\n    editor.unselect();\n    this.#selectedEditors.delete(editor);\n    this.#dispatchUpdateStates({\n      hasSelectedEditor: this.hasSelection,\n    });\n  }\n\n  get hasSelection() {\n    return this.#selectedEditors.size !== 0;\n  }\n\n  get isEnterHandled() {\n    return (\n      this.#selectedEditors.size === 1 &&\n      this.firstSelectedEditor.isEnterHandled\n    );\n  }\n\n  /**\n   * Undo the last command.\n   */\n  undo() {\n    this.#commandManager.undo();\n    this.#dispatchUpdateStates({\n      hasSomethingToUndo: this.#commandManager.hasSomethingToUndo(),\n      hasSomethingToRedo: true,\n      isEmpty: this.#isEmpty(),\n    });\n  }\n\n  /**\n   * Redo the last undoed command.\n   */\n  redo() {\n    this.#commandManager.redo();\n    this.#dispatchUpdateStates({\n      hasSomethingToUndo: true,\n      hasSomethingToRedo: this.#commandManager.hasSomethingToRedo(),\n      isEmpty: this.#isEmpty(),\n    });\n  }\n\n  /**\n   * Add a command to execute (cmd) and another one to undo it.\n   * @param {Object} params\n   */\n  addCommands(params) {\n    this.#commandManager.add(params);\n    this.#dispatchUpdateStates({\n      hasSomethingToUndo: true,\n      hasSomethingToRedo: false,\n      isEmpty: this.#isEmpty(),\n    });\n  }\n\n  #isEmpty() {\n    if (this.#allEditors.size === 0) {\n      return true;\n    }\n\n    if (this.#allEditors.size === 1) {\n      for (const editor of this.#allEditors.values()) {\n        return editor.isEmpty();\n      }\n    }\n\n    return false;\n  }\n\n  /**\n   * Delete the current editor or all.\n   */\n  delete() {\n    this.commitOrRemove();\n    if (!this.hasSelection) {\n      return;\n    }\n\n    const editors = [...this.#selectedEditors];\n    const cmd = () => {\n      for (const editor of editors) {\n        editor.remove();\n      }\n    };\n    const undo = () => {\n      for (const editor of editors) {\n        this.#addEditorToLayer(editor);\n      }\n    };\n\n    this.addCommands({ cmd, undo, mustExec: true });\n  }\n\n  commitOrRemove() {\n    // An editor is being edited so just commit it.\n    this.#activeEditor?.commitOrRemove();\n  }\n\n  hasSomethingToControl() {\n    return this.#activeEditor || this.hasSelection;\n  }\n\n  /**\n   * Select the editors.\n   * @param {Array<AnnotationEditor>} editors\n   */\n  #selectEditors(editors) {\n    this.#selectedEditors.clear();\n    for (const editor of editors) {\n      if (editor.isEmpty()) {\n        continue;\n      }\n      this.#selectedEditors.add(editor);\n      editor.select();\n    }\n    this.#dispatchUpdateStates({ hasSelectedEditor: true });\n  }\n\n  /**\n   * Select all the editors.\n   */\n  selectAll() {\n    for (const editor of this.#selectedEditors) {\n      editor.commit();\n    }\n    this.#selectEditors(this.#allEditors.values());\n  }\n\n  /**\n   * Unselect all the selected editors.\n   */\n  unselectAll() {\n    if (this.#activeEditor) {\n      // An editor is being edited so just commit it.\n      this.#activeEditor.commitOrRemove();\n      if (this.#mode !== AnnotationEditorType.NONE) {\n        // If the mode is NONE, we want to really unselect the editor, hence we\n        // mustn't return here.\n        return;\n      }\n    }\n\n    if (!this.hasSelection) {\n      return;\n    }\n    for (const editor of this.#selectedEditors) {\n      editor.unselect();\n    }\n    this.#selectedEditors.clear();\n    this.#dispatchUpdateStates({\n      hasSelectedEditor: false,\n    });\n  }\n\n  translateSelectedEditors(x, y, noCommit = false) {\n    if (!noCommit) {\n      this.commitOrRemove();\n    }\n    if (!this.hasSelection) {\n      return;\n    }\n\n    this.#translation[0] += x;\n    this.#translation[1] += y;\n    const [totalX, totalY] = this.#translation;\n    const editors = [...this.#selectedEditors];\n\n    // We don't want to have an undo/redo for each translation so we wait a bit\n    // before adding the command to the command manager.\n    const TIME_TO_WAIT = 1000;\n\n    if (this.#translationTimeoutId) {\n      clearTimeout(this.#translationTimeoutId);\n    }\n\n    this.#translationTimeoutId = setTimeout(() => {\n      this.#translationTimeoutId = null;\n      this.#translation[0] = this.#translation[1] = 0;\n\n      this.addCommands({\n        cmd: () => {\n          for (const editor of editors) {\n            if (this.#allEditors.has(editor.id)) {\n              editor.translateInPage(totalX, totalY);\n            }\n          }\n        },\n        undo: () => {\n          for (const editor of editors) {\n            if (this.#allEditors.has(editor.id)) {\n              editor.translateInPage(-totalX, -totalY);\n            }\n          }\n        },\n        mustExec: false,\n      });\n    }, TIME_TO_WAIT);\n\n    for (const editor of editors) {\n      editor.translateInPage(x, y);\n    }\n  }\n\n  /**\n   * Set up the drag session for moving the selected editors.\n   */\n  setUpDragSession() {\n    // Note: don't use any references to the editor's parent which can be null\n    // if the editor belongs to a destroyed page.\n    if (!this.hasSelection) {\n      return;\n    }\n    // Avoid to have spurious text selection in the text layer when dragging.\n    this.disableUserSelect(true);\n    this.#draggingEditors = new Map();\n    for (const editor of this.#selectedEditors) {\n      this.#draggingEditors.set(editor, {\n        savedX: editor.x,\n        savedY: editor.y,\n        savedPageIndex: editor.pageIndex,\n        newX: 0,\n        newY: 0,\n        newPageIndex: -1,\n      });\n    }\n  }\n\n  /**\n   * Ends the drag session.\n   * @returns {boolean} true if at least one editor has been moved.\n   */\n  endDragSession() {\n    if (!this.#draggingEditors) {\n      return false;\n    }\n    this.disableUserSelect(false);\n    const map = this.#draggingEditors;\n    this.#draggingEditors = null;\n    let mustBeAddedInUndoStack = false;\n\n    for (const [{ x, y, pageIndex }, value] of map) {\n      value.newX = x;\n      value.newY = y;\n      value.newPageIndex = pageIndex;\n      mustBeAddedInUndoStack ||=\n        x !== value.savedX ||\n        y !== value.savedY ||\n        pageIndex !== value.savedPageIndex;\n    }\n\n    if (!mustBeAddedInUndoStack) {\n      return false;\n    }\n\n    const move = (editor, x, y, pageIndex) => {\n      if (this.#allEditors.has(editor.id)) {\n        // The editor can be undone/redone on a page which is not visible (and\n        // which potentially has no annotation editor layer), hence we need to\n        // use the pageIndex instead of the parent.\n        const parent = this.#allLayers.get(pageIndex);\n        if (parent) {\n          editor._setParentAndPosition(parent, x, y);\n        } else {\n          editor.pageIndex = pageIndex;\n          editor.x = x;\n          editor.y = y;\n        }\n      }\n    };\n\n    this.addCommands({\n      cmd: () => {\n        for (const [editor, { newX, newY, newPageIndex }] of map) {\n          move(editor, newX, newY, newPageIndex);\n        }\n      },\n      undo: () => {\n        for (const [editor, { savedX, savedY, savedPageIndex }] of map) {\n          move(editor, savedX, savedY, savedPageIndex);\n        }\n      },\n      mustExec: true,\n    });\n\n    return true;\n  }\n\n  /**\n   * Drag the set of selected editors.\n   * @param {number} tx\n   * @param {number} ty\n   */\n  dragSelectedEditors(tx, ty) {\n    if (!this.#draggingEditors) {\n      return;\n    }\n    for (const editor of this.#draggingEditors.keys()) {\n      editor.drag(tx, ty);\n    }\n  }\n\n  /**\n   * Rebuild the editor (usually on undo/redo actions) on a potentially\n   * non-rendered page.\n   * @param {AnnotationEditor} editor\n   */\n  rebuild(editor) {\n    if (editor.parent === null) {\n      const parent = this.getLayer(editor.pageIndex);\n      if (parent) {\n        parent.changeParent(editor);\n        parent.addOrRebuild(editor);\n      } else {\n        this.addEditor(editor);\n        this.addToAnnotationStorage(editor);\n        editor.rebuild();\n      }\n    } else {\n      editor.parent.addOrRebuild(editor);\n    }\n  }\n\n  get isEditorHandlingKeyboard() {\n    return (\n      this.getActive()?.shouldGetKeyboardEvents() ||\n      (this.#selectedEditors.size === 1 &&\n        this.firstSelectedEditor.shouldGetKeyboardEvents())\n    );\n  }\n\n  /**\n   * Is the current editor the one passed as argument?\n   * @param {AnnotationEditor} editor\n   * @returns\n   */\n  isActive(editor) {\n    return this.#activeEditor === editor;\n  }\n\n  /**\n   * Get the current active editor.\n   * @returns {AnnotationEditor|null}\n   */\n  getActive() {\n    return this.#activeEditor;\n  }\n\n  /**\n   * Get the current editor mode.\n   * @returns {number}\n   */\n  getMode() {\n    return this.#mode;\n  }\n\n  get imageManager() {\n    return shadow(this, \"imageManager\", new ImageManager());\n  }\n}\n\nexport {\n  AnnotationEditorUIManager,\n  bindEvents,\n  ColorManager,\n  CommandManager,\n  KeyboardManager,\n  opacityToHex,\n};\n", "/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  AbortException,\n  assert,\n  PromiseCapability,\n  warn,\n} from \"../shared/util.js\";\nimport {\n  createResponseStatusError,\n  extractFilenameFromHeader,\n  validateRangeRequestCapabilities,\n  validateResponseStatus,\n} from \"./network_utils.js\";\n\nif (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n  throw new Error(\n    'Module \"./fetch_stream.js\" shall not be used with MOZCENTRAL builds.'\n  );\n}\n\nfunction createFetchOptions(headers, withCredentials, abortController) {\n  return {\n    method: \"GET\",\n    headers,\n    signal: abortController.signal,\n    mode: \"cors\",\n    credentials: withCredentials ? \"include\" : \"same-origin\",\n    redirect: \"follow\",\n  };\n}\n\nfunction createHeaders(httpHeaders) {\n  const headers = new Headers();\n  for (const property in httpHeaders) {\n    const value = httpHeaders[property];\n    if (value === undefined) {\n      continue;\n    }\n    headers.append(property, value);\n  }\n  return headers;\n}\n\nfunction getArrayBuffer(val) {\n  if (val instanceof Uint8Array) {\n    return val.buffer;\n  }\n  if (val instanceof ArrayBuffer) {\n    return val;\n  }\n  warn(`getArrayBuffer - unexpected data format: ${val}`);\n  return new Uint8Array(val).buffer;\n}\n\n/** @implements {IPDFStream} */\nclass PDFFetchStream {\n  constructor(source) {\n    this.source = source;\n    this.isHttp = /^https?:/i.test(source.url);\n    this.httpHeaders = (this.isHttp && source.httpHeaders) || {};\n\n    this._fullRequestReader = null;\n    this._rangeRequestReaders = [];\n  }\n\n  get _progressiveDataLength() {\n    return this._fullRequestReader?._loaded ?? 0;\n  }\n\n  getFullReader() {\n    assert(\n      !this._fullRequestReader,\n      \"PDFFetchStream.getFullReader can only be called once.\"\n    );\n    this._fullRequestReader = new PDFFetchStreamReader(this);\n    return this._fullRequestReader;\n  }\n\n  getRangeReader(begin, end) {\n    if (end <= this._progressiveDataLength) {\n      return null;\n    }\n    const reader = new PDFFetchStreamRangeReader(this, begin, end);\n    this._rangeRequestReaders.push(reader);\n    return reader;\n  }\n\n  cancelAllRequests(reason) {\n    this._fullRequestReader?.cancel(reason);\n\n    for (const reader of this._rangeRequestReaders.slice(0)) {\n      reader.cancel(reason);\n    }\n  }\n}\n\n/** @implements {IPDFStreamReader} */\nclass PDFFetchStreamReader {\n  constructor(stream) {\n    this._stream = stream;\n    this._reader = null;\n    this._loaded = 0;\n    this._filename = null;\n    const source = stream.source;\n    this._withCredentials = source.withCredentials || false;\n    this._contentLength = source.length;\n    this._headersCapability = new PromiseCapability();\n    this._disableRange = source.disableRange || false;\n    this._rangeChunkSize = source.rangeChunkSize;\n    if (!this._rangeChunkSize && !this._disableRange) {\n      this._disableRange = true;\n    }\n\n    this._abortController = new AbortController();\n    this._isStreamingSupported = !source.disableStream;\n    this._isRangeSupported = !source.disableRange;\n\n    this._headers = createHeaders(this._stream.httpHeaders);\n\n    const url = source.url;\n    fetch(\n      url,\n      createFetchOptions(\n        this._headers,\n        this._withCredentials,\n        this._abortController\n      )\n    )\n      .then(response => {\n        if (!validateResponseStatus(response.status)) {\n          throw createResponseStatusError(response.status, url);\n        }\n        this._reader = response.body.getReader();\n        this._headersCapability.resolve();\n\n        const getResponseHeader = name => {\n          return response.headers.get(name);\n        };\n        const { allowRangeRequests, suggestedLength } =\n          validateRangeRequestCapabilities({\n            getResponseHeader,\n            isHttp: this._stream.isHttp,\n            rangeChunkSize: this._rangeChunkSize,\n            disableRange: this._disableRange,\n          });\n\n        this._isRangeSupported = allowRangeRequests;\n        // Setting right content length.\n        this._contentLength = suggestedLength || this._contentLength;\n\n        this._filename = extractFilenameFromHeader(getResponseHeader);\n\n        // We need to stop reading when range is supported and streaming is\n        // disabled.\n        if (!this._isStreamingSupported && this._isRangeSupported) {\n          this.cancel(new AbortException(\"Streaming is disabled.\"));\n        }\n      })\n      .catch(this._headersCapability.reject);\n\n    this.onProgress = null;\n  }\n\n  get headersReady() {\n    return this._headersCapability.promise;\n  }\n\n  get filename() {\n    return this._filename;\n  }\n\n  get contentLength() {\n    return this._contentLength;\n  }\n\n  get isRangeSupported() {\n    return this._isRangeSupported;\n  }\n\n  get isStreamingSupported() {\n    return this._isStreamingSupported;\n  }\n\n  async read() {\n    await this._headersCapability.promise;\n    const { value, done } = await this._reader.read();\n    if (done) {\n      return { value, done };\n    }\n    this._loaded += value.byteLength;\n    this.onProgress?.({\n      loaded: this._loaded,\n      total: this._contentLength,\n    });\n\n    return { value: getArrayBuffer(value), done: false };\n  }\n\n  cancel(reason) {\n    this._reader?.cancel(reason);\n    this._abortController.abort();\n  }\n}\n\n/** @implements {IPDFStreamRangeReader} */\nclass PDFFetchStreamRangeReader {\n  constructor(stream, begin, end) {\n    this._stream = stream;\n    this._reader = null;\n    this._loaded = 0;\n    const source = stream.source;\n    this._withCredentials = source.withCredentials || false;\n    this._readCapability = new PromiseCapability();\n    this._isStreamingSupported = !source.disableStream;\n\n    this._abortController = new AbortController();\n    this._headers = createHeaders(this._stream.httpHeaders);\n    this._headers.append(\"Range\", `bytes=${begin}-${end - 1}`);\n\n    const url = source.url;\n    fetch(\n      url,\n      createFetchOptions(\n        this._headers,\n        this._withCredentials,\n        this._abortController\n      )\n    )\n      .then(response => {\n        if (!validateResponseStatus(response.status)) {\n          throw createResponseStatusError(response.status, url);\n        }\n        this._readCapability.resolve();\n        this._reader = response.body.getReader();\n      })\n      .catch(this._readCapability.reject);\n\n    this.onProgress = null;\n  }\n\n  get isStreamingSupported() {\n    return this._isStreamingSupported;\n  }\n\n  async read() {\n    await this._readCapability.promise;\n    const { value, done } = await this._reader.read();\n    if (done) {\n      return { value, done };\n    }\n    this._loaded += value.byteLength;\n    this.onProgress?.({ loaded: this._loaded });\n\n    return { value: getArrayBuffer(value), done: false };\n  }\n\n  cancel(reason) {\n    this._reader?.cancel(reason);\n    this._abortController.abort();\n  }\n}\n\nexport { PDFFetchStream };\n", "/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  assert,\n  bytesToString,\n  FeatureTest,\n  isNodeJS,\n  shadow,\n  string32,\n  unreachable,\n  warn,\n} from \"../shared/util.js\";\n\nclass FontLoader {\n  #systemFonts = new Set();\n\n  constructor({\n    ownerDocument = globalThis.document,\n    styleElement = null, // For testing only.\n  }) {\n    this._document = ownerDocument;\n\n    this.nativeFontFaces = new Set();\n    this.styleElement =\n      typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")\n        ? styleElement\n        : null;\n\n    if (typeof PDFJSDev === \"undefined\" || !PDFJSDev.test(\"MOZCENTRAL\")) {\n      this.loadingRequests = [];\n      this.loadTestFontId = 0;\n    }\n  }\n\n  addNativeFontFace(nativeFontFace) {\n    this.nativeFontFaces.add(nativeFontFace);\n    this._document.fonts.add(nativeFontFace);\n  }\n\n  removeNativeFontFace(nativeFontFace) {\n    this.nativeFontFaces.delete(nativeFontFace);\n    this._document.fonts.delete(nativeFontFace);\n  }\n\n  insertRule(rule) {\n    if (!this.styleElement) {\n      this.styleElement = this._document.createElement(\"style\");\n      this._document.documentElement\n        .getElementsByTagName(\"head\")[0]\n        .append(this.styleElement);\n    }\n    const styleSheet = this.styleElement.sheet;\n    styleSheet.insertRule(rule, styleSheet.cssRules.length);\n  }\n\n  clear() {\n    for (const nativeFontFace of this.nativeFontFaces) {\n      this._document.fonts.delete(nativeFontFace);\n    }\n    this.nativeFontFaces.clear();\n    this.#systemFonts.clear();\n\n    if (this.styleElement) {\n      // Note: ChildNode.remove doesn't throw if the parentNode is undefined.\n      this.styleElement.remove();\n      this.styleElement = null;\n    }\n  }\n\n  async loadSystemFont({ systemFontInfo: info, _inspectFont }) {\n    if (!info || this.#systemFonts.has(info.loadedName)) {\n      return;\n    }\n    assert(\n      !this.disableFontFace,\n      \"loadSystemFont shouldn't be called when `disableFontFace` is set.\"\n    );\n\n    if (this.isFontLoadingAPISupported) {\n      const { loadedName, src, style } = info;\n      const fontFace = new FontFace(loadedName, src, style);\n      this.addNativeFontFace(fontFace);\n      try {\n        await fontFace.load();\n        this.#systemFonts.add(loadedName);\n        _inspectFont?.(info);\n      } catch {\n        warn(\n          `Cannot load system font: ${info.baseFontName}, installing it could help to improve PDF rendering.`\n        );\n\n        this.removeNativeFontFace(fontFace);\n      }\n      return;\n    }\n\n    unreachable(\n      \"Not implemented: loadSystemFont without the Font Loading API.\"\n    );\n  }\n\n  async bind(font) {\n    // Add the font to the DOM only once; skip if the font is already loaded.\n    if (font.attached || (font.missingFile && !font.systemFontInfo)) {\n      return;\n    }\n    font.attached = true;\n\n    if (font.systemFontInfo) {\n      await this.loadSystemFont(font);\n      return;\n    }\n\n    if (this.isFontLoadingAPISupported) {\n      const nativeFontFace = font.createNativeFontFace();\n      if (nativeFontFace) {\n        this.addNativeFontFace(nativeFontFace);\n        try {\n          await nativeFontFace.loaded;\n        } catch (ex) {\n          warn(`Failed to load font '${nativeFontFace.family}': '${ex}'.`);\n\n          // When font loading failed, fall back to the built-in font renderer.\n          font.disableFontFace = true;\n          throw ex;\n        }\n      }\n      return; // The font was, asynchronously, loaded.\n    }\n\n    // !this.isFontLoadingAPISupported\n    const rule = font.createFontFaceRule();\n    if (rule) {\n      this.insertRule(rule);\n\n      if (this.isSyncFontLoadingSupported) {\n        return; // The font was, synchronously, loaded.\n      }\n      if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n        throw new Error(\"Not implemented: async font loading\");\n      }\n      await new Promise(resolve => {\n        const request = this._queueLoadingCallback(resolve);\n        this._prepareFontLoadEvent(font, request);\n      });\n      // The font was, asynchronously, loaded.\n    }\n  }\n\n  get isFontLoadingAPISupported() {\n    const hasFonts = !!this._document?.fonts;\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      return shadow(\n        this,\n        \"isFontLoadingAPISupported\",\n        hasFonts && !this.styleElement\n      );\n    }\n    return shadow(this, \"isFontLoadingAPISupported\", hasFonts);\n  }\n\n  get isSyncFontLoadingSupported() {\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n      return shadow(this, \"isSyncFontLoadingSupported\", true);\n    }\n\n    let supported = false;\n    if (typeof PDFJSDev === \"undefined\" || !PDFJSDev.test(\"CHROME\")) {\n      if (isNodeJS) {\n        // Node.js - we can pretend that sync font loading is supported.\n        supported = true;\n      } else if (\n        typeof navigator !== \"undefined\" &&\n        typeof navigator?.userAgent === \"string\" &&\n        // User agent string sniffing is bad, but there is no reliable way to\n        // tell if the font is fully loaded and ready to be used with canvas.\n        /Mozilla\\/5.0.*?rv:\\d+.*? Gecko/.test(navigator.userAgent)\n      ) {\n        // Firefox, from version 14, supports synchronous font loading.\n        supported = true;\n      }\n    }\n    return shadow(this, \"isSyncFontLoadingSupported\", supported);\n  }\n\n  _queueLoadingCallback(callback) {\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n      throw new Error(\"Not implemented: _queueLoadingCallback\");\n    }\n\n    function completeRequest() {\n      assert(!request.done, \"completeRequest() cannot be called twice.\");\n      request.done = true;\n\n      // Sending all completed requests in order of how they were queued.\n      while (loadingRequests.length > 0 && loadingRequests[0].done) {\n        const otherRequest = loadingRequests.shift();\n        setTimeout(otherRequest.callback, 0);\n      }\n    }\n\n    const { loadingRequests } = this;\n    const request = {\n      done: false,\n      complete: completeRequest,\n      callback,\n    };\n    loadingRequests.push(request);\n    return request;\n  }\n\n  get _loadTestFont() {\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n      throw new Error(\"Not implemented: _loadTestFont\");\n    }\n\n    // This is a CFF font with 1 glyph for '.' that fills its entire width\n    // and height.\n    const testFont = atob(\n      \"T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQA\" +\n        \"FQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAA\" +\n        \"ALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgA\" +\n        \"AAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1\" +\n        \"AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD\" +\n        \"6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACM\" +\n        \"AooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4D\" +\n        \"IP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAA\" +\n        \"AAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUA\" +\n        \"AQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgAB\" +\n        \"AAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABY\" +\n        \"AAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAA\" +\n        \"AC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\" +\n        \"AAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\" +\n        \"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\" +\n        \"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\" +\n        \"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\" +\n        \"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAA\" +\n        \"AAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQAC\" +\n        \"AQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3\" +\n        \"Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTj\" +\n        \"FQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==\"\n    );\n    return shadow(this, \"_loadTestFont\", testFont);\n  }\n\n  _prepareFontLoadEvent(font, request) {\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n      throw new Error(\"Not implemented: _prepareFontLoadEvent\");\n    }\n\n    /** Hack begin */\n    // There's currently no event when a font has finished downloading so the\n    // following code is a dirty hack to 'guess' when a font is ready.\n    // It's assumed fonts are loaded in order, so add a known test font after\n    // the desired fonts and then test for the loading of that test font.\n\n    function int32(data, offset) {\n      return (\n        (data.charCodeAt(offset) << 24) |\n        (data.charCodeAt(offset + 1) << 16) |\n        (data.charCodeAt(offset + 2) << 8) |\n        (data.charCodeAt(offset + 3) & 0xff)\n      );\n    }\n    function spliceString(s, offset, remove, insert) {\n      const chunk1 = s.substring(0, offset);\n      const chunk2 = s.substring(offset + remove);\n      return chunk1 + insert + chunk2;\n    }\n    let i, ii;\n\n    // The temporary canvas is used to determine if fonts are loaded.\n    const canvas = this._document.createElement(\"canvas\");\n    canvas.width = 1;\n    canvas.height = 1;\n    const ctx = canvas.getContext(\"2d\");\n\n    let called = 0;\n    function isFontReady(name, callback) {\n      // With setTimeout clamping this gives the font ~100ms to load.\n      if (++called > 30) {\n        warn(\"Load test font never loaded.\");\n        callback();\n        return;\n      }\n      ctx.font = \"30px \" + name;\n      ctx.fillText(\".\", 0, 20);\n      const imageData = ctx.getImageData(0, 0, 1, 1);\n      if (imageData.data[3] > 0) {\n        callback();\n        return;\n      }\n      setTimeout(isFontReady.bind(null, name, callback));\n    }\n\n    const loadTestFontId = `lt${Date.now()}${this.loadTestFontId++}`;\n    // Chromium seems to cache fonts based on a hash of the actual font data,\n    // so the font must be modified for each load test else it will appear to\n    // be loaded already.\n    // TODO: This could maybe be made faster by avoiding the btoa of the full\n    // font by splitting it in chunks before hand and padding the font id.\n    let data = this._loadTestFont;\n    const COMMENT_OFFSET = 976; // has to be on 4 byte boundary (for checksum)\n    data = spliceString(\n      data,\n      COMMENT_OFFSET,\n      loadTestFontId.length,\n      loadTestFontId\n    );\n    // CFF checksum is important for IE, adjusting it\n    const CFF_CHECKSUM_OFFSET = 16;\n    const XXXX_VALUE = 0x58585858; // the \"comment\" filled with 'X'\n    let checksum = int32(data, CFF_CHECKSUM_OFFSET);\n    for (i = 0, ii = loadTestFontId.length - 3; i < ii; i += 4) {\n      checksum = (checksum - XXXX_VALUE + int32(loadTestFontId, i)) | 0;\n    }\n    if (i < loadTestFontId.length) {\n      // align to 4 bytes boundary\n      checksum = (checksum - XXXX_VALUE + int32(loadTestFontId + \"XXX\", i)) | 0;\n    }\n    data = spliceString(data, CFF_CHECKSUM_OFFSET, 4, string32(checksum));\n\n    const url = `url(data:font/opentype;base64,${btoa(data)});`;\n    const rule = `@font-face {font-family:\"${loadTestFontId}\";src:${url}}`;\n    this.insertRule(rule);\n\n    const div = this._document.createElement(\"div\");\n    div.style.visibility = \"hidden\";\n    div.style.width = div.style.height = \"10px\";\n    div.style.position = \"absolute\";\n    div.style.top = div.style.left = \"0px\";\n\n    for (const name of [font.loadedName, loadTestFontId]) {\n      const span = this._document.createElement(\"span\");\n      span.textContent = \"Hi\";\n      span.style.fontFamily = name;\n      div.append(span);\n    }\n    this._document.body.append(div);\n\n    isFontReady(loadTestFontId, () => {\n      div.remove();\n      request.complete();\n    });\n    /** Hack end */\n  }\n}\n\nclass FontFaceObject {\n  constructor(\n    translatedData,\n    {\n      isEvalSupported = true,\n      disableFontFace = false,\n      ignoreErrors = false,\n      inspectFont = null,\n    }\n  ) {\n    this.compiledGlyphs = Object.create(null);\n    // importing translated data\n    for (const i in translatedData) {\n      this[i] = translatedData[i];\n    }\n    this.isEvalSupported = isEvalSupported !== false;\n    this.disableFontFace = disableFontFace === true;\n    this.ignoreErrors = ignoreErrors === true;\n    this._inspectFont = inspectFont;\n  }\n\n  createNativeFontFace() {\n    if (!this.data || this.disableFontFace) {\n      return null;\n    }\n    let nativeFontFace;\n    if (!this.cssFontInfo) {\n      nativeFontFace = new FontFace(this.loadedName, this.data, {});\n    } else {\n      const css = {\n        weight: this.cssFontInfo.fontWeight,\n      };\n      if (this.cssFontInfo.italicAngle) {\n        css.style = `oblique ${this.cssFontInfo.italicAngle}deg`;\n      }\n      nativeFontFace = new FontFace(\n        this.cssFontInfo.fontFamily,\n        this.data,\n        css\n      );\n    }\n\n    this._inspectFont?.(this);\n    return nativeFontFace;\n  }\n\n  createFontFaceRule() {\n    if (!this.data || this.disableFontFace) {\n      return null;\n    }\n    const data = bytesToString(this.data);\n    // Add the @font-face rule to the document.\n    const url = `url(data:${this.mimetype};base64,${btoa(data)});`;\n    let rule;\n    if (!this.cssFontInfo) {\n      rule = `@font-face {font-family:\"${this.loadedName}\";src:${url}}`;\n    } else {\n      let css = `font-weight: ${this.cssFontInfo.fontWeight};`;\n      if (this.cssFontInfo.italicAngle) {\n        css += `font-style: oblique ${this.cssFontInfo.italicAngle}deg;`;\n      }\n      rule = `@font-face {font-family:\"${this.cssFontInfo.fontFamily}\";${css}src:${url}}`;\n    }\n\n    this._inspectFont?.(this, url);\n    return rule;\n  }\n\n  getPathGenerator(objs, character) {\n    if (this.compiledGlyphs[character] !== undefined) {\n      return this.compiledGlyphs[character];\n    }\n\n    let cmds;\n    try {\n      cmds = objs.get(this.loadedName + \"_path_\" + character);\n    } catch (ex) {\n      if (!this.ignoreErrors) {\n        throw ex;\n      }\n      warn(`getPathGenerator - ignoring character: \"${ex}\".`);\n\n      return (this.compiledGlyphs[character] = function (c, size) {\n        // No-op function, to allow rendering to continue.\n      });\n    }\n\n    // If we can, compile cmds into JS for MAXIMUM SPEED...\n    if (this.isEvalSupported && FeatureTest.isEvalSupported) {\n      const jsBuf = [];\n      for (const current of cmds) {\n        const args = current.args !== undefined ? current.args.join(\",\") : \"\";\n        jsBuf.push(\"c.\", current.cmd, \"(\", args, \");\\n\");\n      }\n      // eslint-disable-next-line no-new-func\n      return (this.compiledGlyphs[character] = new Function(\n        \"c\",\n        \"size\",\n        jsBuf.join(\"\")\n      ));\n    }\n    // ... but fall back on using Function.prototype.apply() if we're\n    // blocked from using eval() for whatever reason (like CSP policies).\n    return (this.compiledGlyphs[character] = function (c, size) {\n      for (const current of cmds) {\n        if (current.cmd === \"scale\") {\n          current.args = [size, -size];\n        }\n        // eslint-disable-next-line prefer-spread\n        c[current.cmd].apply(c, current.args);\n      }\n    });\n  }\n}\n\nexport { FontFaceObject, FontLoader };\n", "/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { objectFromMap } from \"../shared/util.js\";\n\nclass Metadata {\n  #metadataMap;\n\n  #data;\n\n  constructor({ parsedData, rawData }) {\n    this.#metadataMap = parsedData;\n    this.#data = rawData;\n  }\n\n  getRaw() {\n    return this.#data;\n  }\n\n  get(name) {\n    return this.#metadataMap.get(name) ?? null;\n  }\n\n  getAll() {\n    return objectFromMap(this.#metadataMap);\n  }\n\n  has(name) {\n    return this.#metadataMap.has(name);\n  }\n}\n\nexport { Metadata };\n", "/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { assert, PromiseCapability, stringToBytes } from \"../shared/util.js\";\nimport {\n  createResponseStatusError,\n  extractFilenameFromHeader,\n  validateRangeRequestCapabilities,\n} from \"./network_utils.js\";\n\nif (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n  throw new Error(\n    'Module \"./network.js\" shall not be used with MOZCENTRAL builds.'\n  );\n}\n\nconst OK_RESPONSE = 200;\nconst PARTIAL_CONTENT_RESPONSE = 206;\n\nfunction getArrayBuffer(xhr) {\n  const data = xhr.response;\n  if (typeof data !== \"string\") {\n    return data;\n  }\n  return stringToBytes(data).buffer;\n}\n\nclass NetworkManager {\n  constructor(url, args = {}) {\n    this.url = url;\n    this.isHttp = /^https?:/i.test(url);\n    this.httpHeaders = (this.isHttp && args.httpHeaders) || Object.create(null);\n    this.withCredentials = args.withCredentials || false;\n\n    this.currXhrId = 0;\n    this.pendingRequests = Object.create(null);\n  }\n\n  requestRange(begin, end, listeners) {\n    const args = {\n      begin,\n      end,\n    };\n    for (const prop in listeners) {\n      args[prop] = listeners[prop];\n    }\n    return this.request(args);\n  }\n\n  requestFull(listeners) {\n    return this.request(listeners);\n  }\n\n  request(args) {\n    const xhr = new XMLHttpRequest();\n    const xhrId = this.currXhrId++;\n    const pendingRequest = (this.pendingRequests[xhrId] = { xhr });\n\n    xhr.open(\"GET\", this.url);\n    xhr.withCredentials = this.withCredentials;\n    for (const property in this.httpHeaders) {\n      const value = this.httpHeaders[property];\n      if (value === undefined) {\n        continue;\n      }\n      xhr.setRequestHeader(property, value);\n    }\n    if (this.isHttp && \"begin\" in args && \"end\" in args) {\n      xhr.setRequestHeader(\"Range\", `bytes=${args.begin}-${args.end - 1}`);\n      pendingRequest.expectedStatus = PARTIAL_CONTENT_RESPONSE;\n    } else {\n      pendingRequest.expectedStatus = OK_RESPONSE;\n    }\n    xhr.responseType = \"arraybuffer\";\n\n    if (args.onError) {\n      xhr.onerror = function (evt) {\n        args.onError(xhr.status);\n      };\n    }\n    xhr.onreadystatechange = this.onStateChange.bind(this, xhrId);\n    xhr.onprogress = this.onProgress.bind(this, xhrId);\n\n    pendingRequest.onHeadersReceived = args.onHeadersReceived;\n    pendingRequest.onDone = args.onDone;\n    pendingRequest.onError = args.onError;\n    pendingRequest.onProgress = args.onProgress;\n\n    xhr.send(null);\n\n    return xhrId;\n  }\n\n  onProgress(xhrId, evt) {\n    const pendingRequest = this.pendingRequests[xhrId];\n    if (!pendingRequest) {\n      return; // Maybe abortRequest was called...\n    }\n    pendingRequest.onProgress?.(evt);\n  }\n\n  onStateChange(xhrId, evt) {\n    const pendingRequest = this.pendingRequests[xhrId];\n    if (!pendingRequest) {\n      return; // Maybe abortRequest was called...\n    }\n\n    const xhr = pendingRequest.xhr;\n    if (xhr.readyState >= 2 && pendingRequest.onHeadersReceived) {\n      pendingRequest.onHeadersReceived();\n      delete pendingRequest.onHeadersReceived;\n    }\n\n    if (xhr.readyState !== 4) {\n      return;\n    }\n\n    if (!(xhrId in this.pendingRequests)) {\n      // The XHR request might have been aborted in onHeadersReceived()\n      // callback, in which case we should abort request.\n      return;\n    }\n\n    delete this.pendingRequests[xhrId];\n\n    // Success status == 0 can be on ftp, file and other protocols.\n    if (xhr.status === 0 && this.isHttp) {\n      pendingRequest.onError?.(xhr.status);\n      return;\n    }\n    const xhrStatus = xhr.status || OK_RESPONSE;\n\n    // From http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.35.2:\n    // \"A server MAY ignore the Range header\". This means it's possible to\n    // get a 200 rather than a 206 response from a range request.\n    const ok_response_on_range_request =\n      xhrStatus === OK_RESPONSE &&\n      pendingRequest.expectedStatus === PARTIAL_CONTENT_RESPONSE;\n\n    if (\n      !ok_response_on_range_request &&\n      xhrStatus !== pendingRequest.expectedStatus\n    ) {\n      pendingRequest.onError?.(xhr.status);\n      return;\n    }\n\n    const chunk = getArrayBuffer(xhr);\n    if (xhrStatus === PARTIAL_CONTENT_RESPONSE) {\n      const rangeHeader = xhr.getResponseHeader(\"Content-Range\");\n      const matches = /bytes (\\d+)-(\\d+)\\/(\\d+)/.exec(rangeHeader);\n      pendingRequest.onDone({\n        begin: parseInt(matches[1], 10),\n        chunk,\n      });\n    } else if (chunk) {\n      pendingRequest.onDone({\n        begin: 0,\n        chunk,\n      });\n    } else {\n      pendingRequest.onError?.(xhr.status);\n    }\n  }\n\n  getRequestXhr(xhrId) {\n    return this.pendingRequests[xhrId].xhr;\n  }\n\n  isPendingRequest(xhrId) {\n    return xhrId in this.pendingRequests;\n  }\n\n  abortRequest(xhrId) {\n    const xhr = this.pendingRequests[xhrId].xhr;\n    delete this.pendingRequests[xhrId];\n    xhr.abort();\n  }\n}\n\n/** @implements {IPDFStream} */\nclass PDFNetworkStream {\n  constructor(source) {\n    this._source = source;\n    this._manager = new NetworkManager(source.url, {\n      httpHeaders: source.httpHeaders,\n      withCredentials: source.withCredentials,\n    });\n    this._rangeChunkSize = source.rangeChunkSize;\n    this._fullRequestReader = null;\n    this._rangeRequestReaders = [];\n  }\n\n  _onRangeRequestReaderClosed(reader) {\n    const i = this._rangeRequestReaders.indexOf(reader);\n    if (i >= 0) {\n      this._rangeRequestReaders.splice(i, 1);\n    }\n  }\n\n  getFullReader() {\n    assert(\n      !this._fullRequestReader,\n      \"PDFNetworkStream.getFullReader can only be called once.\"\n    );\n    this._fullRequestReader = new PDFNetworkStreamFullRequestReader(\n      this._manager,\n      this._source\n    );\n    return this._fullRequestReader;\n  }\n\n  getRangeReader(begin, end) {\n    const reader = new PDFNetworkStreamRangeRequestReader(\n      this._manager,\n      begin,\n      end\n    );\n    reader.onClosed = this._onRangeRequestReaderClosed.bind(this);\n    this._rangeRequestReaders.push(reader);\n    return reader;\n  }\n\n  cancelAllRequests(reason) {\n    this._fullRequestReader?.cancel(reason);\n\n    for (const reader of this._rangeRequestReaders.slice(0)) {\n      reader.cancel(reason);\n    }\n  }\n}\n\n/** @implements {IPDFStreamReader} */\nclass PDFNetworkStreamFullRequestReader {\n  constructor(manager, source) {\n    this._manager = manager;\n\n    const args = {\n      onHeadersReceived: this._onHeadersReceived.bind(this),\n      onDone: this._onDone.bind(this),\n      onError: this._onError.bind(this),\n      onProgress: this._onProgress.bind(this),\n    };\n    this._url = source.url;\n    this._fullRequestId = manager.requestFull(args);\n    this._headersReceivedCapability = new PromiseCapability();\n    this._disableRange = source.disableRange || false;\n    this._contentLength = source.length; // Optional\n    this._rangeChunkSize = source.rangeChunkSize;\n    if (!this._rangeChunkSize && !this._disableRange) {\n      this._disableRange = true;\n    }\n\n    this._isStreamingSupported = false;\n    this._isRangeSupported = false;\n\n    this._cachedChunks = [];\n    this._requests = [];\n    this._done = false;\n    this._storedError = undefined;\n    this._filename = null;\n\n    this.onProgress = null;\n  }\n\n  _onHeadersReceived() {\n    const fullRequestXhrId = this._fullRequestId;\n    const fullRequestXhr = this._manager.getRequestXhr(fullRequestXhrId);\n\n    const getResponseHeader = name => {\n      return fullRequestXhr.getResponseHeader(name);\n    };\n    const { allowRangeRequests, suggestedLength } =\n      validateRangeRequestCapabilities({\n        getResponseHeader,\n        isHttp: this._manager.isHttp,\n        rangeChunkSize: this._rangeChunkSize,\n        disableRange: this._disableRange,\n      });\n\n    if (allowRangeRequests) {\n      this._isRangeSupported = true;\n    }\n    // Setting right content length.\n    this._contentLength = suggestedLength || this._contentLength;\n\n    this._filename = extractFilenameFromHeader(getResponseHeader);\n\n    if (this._isRangeSupported) {\n      // NOTE: by cancelling the full request, and then issuing range\n      // requests, there will be an issue for sites where you can only\n      // request the pdf once. However, if this is the case, then the\n      // server should not be returning that it can support range requests.\n      this._manager.abortRequest(fullRequestXhrId);\n    }\n\n    this._headersReceivedCapability.resolve();\n  }\n\n  _onDone(data) {\n    if (data) {\n      if (this._requests.length > 0) {\n        const requestCapability = this._requests.shift();\n        requestCapability.resolve({ value: data.chunk, done: false });\n      } else {\n        this._cachedChunks.push(data.chunk);\n      }\n    }\n    this._done = true;\n    if (this._cachedChunks.length > 0) {\n      return;\n    }\n    for (const requestCapability of this._requests) {\n      requestCapability.resolve({ value: undefined, done: true });\n    }\n    this._requests.length = 0;\n  }\n\n  _onError(status) {\n    this._storedError = createResponseStatusError(status, this._url);\n    this._headersReceivedCapability.reject(this._storedError);\n    for (const requestCapability of this._requests) {\n      requestCapability.reject(this._storedError);\n    }\n    this._requests.length = 0;\n    this._cachedChunks.length = 0;\n  }\n\n  _onProgress(evt) {\n    this.onProgress?.({\n      loaded: evt.loaded,\n      total: evt.lengthComputable ? evt.total : this._contentLength,\n    });\n  }\n\n  get filename() {\n    return this._filename;\n  }\n\n  get isRangeSupported() {\n    return this._isRangeSupported;\n  }\n\n  get isStreamingSupported() {\n    return this._isStreamingSupported;\n  }\n\n  get contentLength() {\n    return this._contentLength;\n  }\n\n  get headersReady() {\n    return this._headersReceivedCapability.promise;\n  }\n\n  async read() {\n    if (this._storedError) {\n      throw this._storedError;\n    }\n    if (this._cachedChunks.length > 0) {\n      const chunk = this._cachedChunks.shift();\n      return { value: chunk, done: false };\n    }\n    if (this._done) {\n      return { value: undefined, done: true };\n    }\n    const requestCapability = new PromiseCapability();\n    this._requests.push(requestCapability);\n    return requestCapability.promise;\n  }\n\n  cancel(reason) {\n    this._done = true;\n    this._headersReceivedCapability.reject(reason);\n    for (const requestCapability of this._requests) {\n      requestCapability.resolve({ value: undefined, done: true });\n    }\n    this._requests.length = 0;\n    if (this._manager.isPendingRequest(this._fullRequestId)) {\n      this._manager.abortRequest(this._fullRequestId);\n    }\n    this._fullRequestReader = null;\n  }\n}\n\n/** @implements {IPDFStreamRangeReader} */\nclass PDFNetworkStreamRangeRequestReader {\n  constructor(manager, begin, end) {\n    this._manager = manager;\n\n    const args = {\n      onDone: this._onDone.bind(this),\n      onError: this._onError.bind(this),\n      onProgress: this._onProgress.bind(this),\n    };\n    this._url = manager.url;\n    this._requestId = manager.requestRange(begin, end, args);\n    this._requests = [];\n    this._queuedChunk = null;\n    this._done = false;\n    this._storedError = undefined;\n\n    this.onProgress = null;\n    this.onClosed = null;\n  }\n\n  _close() {\n    this.onClosed?.(this);\n  }\n\n  _onDone(data) {\n    const chunk = data.chunk;\n    if (this._requests.length > 0) {\n      const requestCapability = this._requests.shift();\n      requestCapability.resolve({ value: chunk, done: false });\n    } else {\n      this._queuedChunk = chunk;\n    }\n    this._done = true;\n    for (const requestCapability of this._requests) {\n      requestCapability.resolve({ value: undefined, done: true });\n    }\n    this._requests.length = 0;\n    this._close();\n  }\n\n  _onError(status) {\n    this._storedError = createResponseStatusError(status, this._url);\n    for (const requestCapability of this._requests) {\n      requestCapability.reject(this._storedError);\n    }\n    this._requests.length = 0;\n    this._queuedChunk = null;\n  }\n\n  _onProgress(evt) {\n    if (!this.isStreamingSupported) {\n      this.onProgress?.({ loaded: evt.loaded });\n    }\n  }\n\n  get isStreamingSupported() {\n    return false;\n  }\n\n  async read() {\n    if (this._storedError) {\n      throw this._storedError;\n    }\n    if (this._queuedChunk !== null) {\n      const chunk = this._queuedChunk;\n      this._queuedChunk = null;\n      return { value: chunk, done: false };\n    }\n    if (this._done) {\n      return { value: undefined, done: true };\n    }\n    const requestCapability = new PromiseCapability();\n    this._requests.push(requestCapability);\n    return requestCapability.promise;\n  }\n\n  cancel(reason) {\n    this._done = true;\n    for (const requestCapability of this._requests) {\n      requestCapability.resolve({ value: undefined, done: true });\n    }\n    this._requests.length = 0;\n    if (this._manager.isPendingRequest(this._requestId)) {\n      this._manager.abortRequest(this._requestId);\n    }\n    this._close();\n  }\n}\n\nexport { PDFNetworkStream };\n", "/* Copyright 2017 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { stringToBytes } from \"../shared/util.js\";\n\n// This getFilenameFromContentDispositionHeader function is adapted from\n// https://github.com/Rob--W/open-in-browser/blob/7e2e35a38b8b4e981b11da7b2f01df0149049e92/extension/content-disposition.js\n// with the following changes:\n// - Modified to conform to PDF.js's coding style.\n// - Move return to the end of the function to prevent Babel from dropping the\n//   function declarations.\n\n/**\n * Extract file name from the Content-Disposition HTTP response header.\n *\n * @param {string} contentDisposition\n * @returns {string} Filename, if found in the Content-Disposition header.\n */\nfunction getFilenameFromContentDispositionHeader(contentDisposition) {\n  let needsEncodingFixup = true;\n\n  // filename*=ext-value (\"ext-value\" from RFC 5987, referenced by RFC 6266).\n  let tmp = toParamRegExp(\"filename\\\\*\", \"i\").exec(contentDisposition);\n  if (tmp) {\n    tmp = tmp[1];\n    let filename = rfc2616unquote(tmp);\n    filename = unescape(filename);\n    filename = rfc5987decode(filename);\n    filename = rfc2047decode(filename);\n    return fixupEncoding(filename);\n  }\n\n  // Continuations (RFC 2231 section 3, referenced by RFC 5987 section 3.1).\n  // filename*n*=part\n  // filename*n=part\n  tmp = rfc2231getparam(contentDisposition);\n  if (tmp) {\n    // RFC 2047, section\n    const filename = rfc2047decode(tmp);\n    return fixupEncoding(filename);\n  }\n\n  // filename=value (RFC 5987, section 4.1).\n  tmp = toParamRegExp(\"filename\", \"i\").exec(contentDisposition);\n  if (tmp) {\n    tmp = tmp[1];\n    let filename = rfc2616unquote(tmp);\n    filename = rfc2047decode(filename);\n    return fixupEncoding(filename);\n  }\n\n  // After this line there are only function declarations. We cannot put\n  // \"return\" here for readability because babel would then drop the function\n  // declarations...\n  function toParamRegExp(attributePattern, flags) {\n    return new RegExp(\n      \"(?:^|;)\\\\s*\" +\n        attributePattern +\n        \"\\\\s*=\\\\s*\" +\n        // Captures: value = token | quoted-string\n        // (RFC 2616, section 3.6 and referenced by RFC 6266 4.1)\n        \"(\" +\n        '[^\";\\\\s][^;\\\\s]*' +\n        \"|\" +\n        '\"(?:[^\"\\\\\\\\]|\\\\\\\\\"?)+\"?' +\n        \")\",\n      flags\n    );\n  }\n  function textdecode(encoding, value) {\n    if (encoding) {\n      if (!/^[\\x00-\\xFF]+$/.test(value)) {\n        return value;\n      }\n      try {\n        const decoder = new TextDecoder(encoding, { fatal: true });\n        const buffer = stringToBytes(value);\n        value = decoder.decode(buffer);\n        needsEncodingFixup = false;\n      } catch {\n        // TextDecoder constructor threw - unrecognized encoding.\n      }\n    }\n    return value;\n  }\n  function fixupEncoding(value) {\n    if (needsEncodingFixup && /[\\x80-\\xff]/.test(value)) {\n      // Maybe multi-byte UTF-8.\n      value = textdecode(\"utf-8\", value);\n      if (needsEncodingFixup) {\n        // Try iso-8859-1 encoding.\n        value = textdecode(\"iso-8859-1\", value);\n      }\n    }\n    return value;\n  }\n  function rfc2231getparam(contentDispositionStr) {\n    const matches = [];\n    let match;\n    // Iterate over all filename*n= and filename*n*= with n being an integer\n    // of at least zero. Any non-zero number must not start with '0'.\n    const iter = toParamRegExp(\"filename\\\\*((?!0\\\\d)\\\\d+)(\\\\*?)\", \"ig\");\n    while ((match = iter.exec(contentDispositionStr)) !== null) {\n      let [, n, quot, part] = match; // eslint-disable-line prefer-const\n      n = parseInt(n, 10);\n      if (n in matches) {\n        // Ignore anything after the invalid second filename*0.\n        if (n === 0) {\n          break;\n        }\n        continue;\n      }\n      matches[n] = [quot, part];\n    }\n    const parts = [];\n    for (let n = 0; n < matches.length; ++n) {\n      if (!(n in matches)) {\n        // Numbers must be consecutive. Truncate when there is a hole.\n        break;\n      }\n      let [quot, part] = matches[n]; // eslint-disable-line prefer-const\n      part = rfc2616unquote(part);\n      if (quot) {\n        part = unescape(part);\n        if (n === 0) {\n          part = rfc5987decode(part);\n        }\n      }\n      parts.push(part);\n    }\n    return parts.join(\"\");\n  }\n  function rfc2616unquote(value) {\n    if (value.startsWith('\"')) {\n      const parts = value.slice(1).split('\\\\\"');\n      // Find the first unescaped \" and terminate there.\n      for (let i = 0; i < parts.length; ++i) {\n        const quotindex = parts[i].indexOf('\"');\n        if (quotindex !== -1) {\n          parts[i] = parts[i].slice(0, quotindex);\n          parts.length = i + 1; // Truncates and stop the iteration.\n        }\n        parts[i] = parts[i].replaceAll(/\\\\(.)/g, \"$1\");\n      }\n      value = parts.join('\"');\n    }\n    return value;\n  }\n  function rfc5987decode(extvalue) {\n    // Decodes \"ext-value\" from RFC 5987.\n    const encodingend = extvalue.indexOf(\"'\");\n    if (encodingend === -1) {\n      // Some servers send \"filename*=\" without encoding 'language' prefix,\n      // e.g. in https://github.com/Rob--W/open-in-browser/issues/26\n      // Let's accept the value like Firefox (57) (Chrome 62 rejects it).\n      return extvalue;\n    }\n    const encoding = extvalue.slice(0, encodingend);\n    const langvalue = extvalue.slice(encodingend + 1);\n    // Ignore language (RFC 5987 section 3.2.1, and RFC 6266 section 4.1 ).\n    const value = langvalue.replace(/^[^']*'/, \"\");\n    return textdecode(encoding, value);\n  }\n  function rfc2047decode(value) {\n    // RFC 2047-decode the result. Firefox tried to drop support for it, but\n    // backed out because some servers use it - https://bugzil.la/875615\n    // Firefox's condition for decoding is here: https://searchfox.org/mozilla-central/rev/4a590a5a15e35d88a3b23dd6ac3c471cf85b04a8/netwerk/mime/nsMIMEHeaderParamImpl.cpp#742-748\n\n    // We are more strict and only recognize RFC 2047-encoding if the value\n    // starts with \"=?\", since then it is likely that the full value is\n    // RFC 2047-encoded.\n\n    // Firefox also decodes words even where RFC 2047 section 5 states:\n    // \"An 'encoded-word' MUST NOT appear within a 'quoted-string'.\"\n    if (!value.startsWith(\"=?\") || /[\\x00-\\x19\\x80-\\xff]/.test(value)) {\n      return value;\n    }\n    // RFC 2047, section 2.4\n    // encoded-word = \"=?\" charset \"?\" encoding \"?\" encoded-text \"?=\"\n    // charset = token (but let's restrict to characters that denote a\n    //       possibly valid encoding).\n    // encoding = q or b\n    // encoded-text = any printable ASCII character other than ? or space.\n    //        ... but Firefox permits ? and space.\n    return value.replaceAll(\n      /=\\?([\\w-]*)\\?([QqBb])\\?((?:[^?]|\\?(?!=))*)\\?=/g,\n      function (matches, charset, encoding, text) {\n        if (encoding === \"q\" || encoding === \"Q\") {\n          // RFC 2047 section 4.2.\n          text = text.replaceAll(\"_\", \" \");\n          text = text.replaceAll(/=([0-9a-fA-F]{2})/g, function (match, hex) {\n            return String.fromCharCode(parseInt(hex, 16));\n          });\n          return textdecode(charset, text);\n        } // else encoding is b or B - base64 (RFC 2047 section 4.1)\n        try {\n          text = atob(text);\n        } catch {}\n        return textdecode(charset, text);\n      }\n    );\n  }\n\n  return \"\";\n}\n\nexport { getFilenameFromContentDispositionHeader };\n", "/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  assert,\n  MissingPDFException,\n  UnexpectedResponseException,\n} from \"../shared/util.js\";\nimport { getFilenameFromContentDispositionHeader } from \"./content_disposition.js\";\nimport { isPdfFile } from \"./display_utils.js\";\n\nfunction validateRangeRequestCapabilities({\n  getResponseHeader,\n  isHttp,\n  rangeChunkSize,\n  disableRange,\n}) {\n  if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n    assert(\n      Number.isInteger(rangeChunkSize) && rangeChunkSize > 0,\n      \"rangeChunkSize must be an integer larger than zero.\"\n    );\n  }\n  const returnValues = {\n    allowRangeRequests: false,\n    suggestedLength: undefined,\n  };\n\n  const length = parseInt(getResponseHeader(\"Content-Length\"), 10);\n  if (!Number.isInteger(length)) {\n    return returnValues;\n  }\n\n  returnValues.suggestedLength = length;\n\n  if (length <= 2 * rangeChunkSize) {\n    // The file size is smaller than the size of two chunks, so it does not\n    // make any sense to abort the request and retry with a range request.\n    return returnValues;\n  }\n\n  if (disableRange || !isHttp) {\n    return returnValues;\n  }\n  if (getResponseHeader(\"Accept-Ranges\") !== \"bytes\") {\n    return returnValues;\n  }\n\n  const contentEncoding = getResponseHeader(\"Content-Encoding\") || \"identity\";\n  if (contentEncoding !== \"identity\") {\n    return returnValues;\n  }\n\n  returnValues.allowRangeRequests = true;\n  return returnValues;\n}\n\nfunction extractFilenameFromHeader(getResponseHeader) {\n  const contentDisposition = getResponseHeader(\"Content-Disposition\");\n  if (contentDisposition) {\n    let filename = getFilenameFromContentDispositionHeader(contentDisposition);\n    if (filename.includes(\"%\")) {\n      try {\n        filename = decodeURIComponent(filename);\n      } catch {}\n    }\n    if (isPdfFile(filename)) {\n      return filename;\n    }\n  }\n  return null;\n}\n\nfunction createResponseStatusError(status, url) {\n  if (status === 404 || (status === 0 && url.startsWith(\"file:\"))) {\n    return new MissingPDFException('Missing PDF \"' + url + '\".');\n  }\n  return new UnexpectedResponseException(\n    `Unexpected server response (${status}) while retrieving PDF \"${url}\".`,\n    status\n  );\n}\n\nfunction validateResponseStatus(status) {\n  return status === 200 || status === 206;\n}\n\nexport {\n  createResponseStatusError,\n  extractFilenameFromHeader,\n  validateRangeRequestCapabilities,\n  validateResponseStatus,\n};\n", "/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  AbortException,\n  assert,\n  isNodeJS,\n  MissingPDFException,\n  PromiseCapability,\n} from \"../shared/util.js\";\nimport {\n  extractFilenameFromHeader,\n  validateRangeRequestCapabilities,\n} from \"./network_utils.js\";\n\nif (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n  throw new Error(\n    'Module \"./node_stream.js\" shall not be used with MOZCENTRAL builds.'\n  );\n}\n\nlet fs, http, https, url;\nif (isNodeJS) {\n  // Native packages.\n  fs = await import(/* webpackIgnore: true */ \"fs\");\n  http = await import(/* webpackIgnore: true */ \"http\");\n  https = await import(/* webpackIgnore: true */ \"https\");\n  url = await import(/* webpackIgnore: true */ \"url\");\n}\n\nconst fileUriRegex = /^file:\\/\\/\\/[a-zA-Z]:\\//;\n\nfunction parseUrl(sourceUrl) {\n  const parsedUrl = url.parse(sourceUrl);\n  if (parsedUrl.protocol === \"file:\" || parsedUrl.host) {\n    return parsedUrl;\n  }\n  // Prepending 'file:///' to Windows absolute path.\n  if (/^[a-z]:[/\\\\]/i.test(sourceUrl)) {\n    return url.parse(`file:///${sourceUrl}`);\n  }\n  // Changes protocol to 'file:' if url refers to filesystem.\n  if (!parsedUrl.host) {\n    parsedUrl.protocol = \"file:\";\n  }\n  return parsedUrl;\n}\n\nclass PDFNodeStream {\n  constructor(source) {\n    this.source = source;\n    this.url = parseUrl(source.url);\n    this.isHttp =\n      this.url.protocol === \"http:\" || this.url.protocol === \"https:\";\n    // Check if url refers to filesystem.\n    this.isFsUrl = this.url.protocol === \"file:\";\n    this.httpHeaders = (this.isHttp && source.httpHeaders) || {};\n\n    this._fullRequestReader = null;\n    this._rangeRequestReaders = [];\n  }\n\n  get _progressiveDataLength() {\n    return this._fullRequestReader?._loaded ?? 0;\n  }\n\n  getFullReader() {\n    assert(\n      !this._fullRequestReader,\n      \"PDFNodeStream.getFullReader can only be called once.\"\n    );\n    this._fullRequestReader = this.isFsUrl\n      ? new PDFNodeStreamFsFullReader(this)\n      : new PDFNodeStreamFullReader(this);\n    return this._fullRequestReader;\n  }\n\n  getRangeReader(start, end) {\n    if (end <= this._progressiveDataLength) {\n      return null;\n    }\n    const rangeReader = this.isFsUrl\n      ? new PDFNodeStreamFsRangeReader(this, start, end)\n      : new PDFNodeStreamRangeReader(this, start, end);\n    this._rangeRequestReaders.push(rangeReader);\n    return rangeReader;\n  }\n\n  cancelAllRequests(reason) {\n    this._fullRequestReader?.cancel(reason);\n\n    for (const reader of this._rangeRequestReaders.slice(0)) {\n      reader.cancel(reason);\n    }\n  }\n}\n\nclass BaseFullReader {\n  constructor(stream) {\n    this._url = stream.url;\n    this._done = false;\n    this._storedError = null;\n    this.onProgress = null;\n    const source = stream.source;\n    this._contentLength = source.length; // optional\n    this._loaded = 0;\n    this._filename = null;\n\n    this._disableRange = source.disableRange || false;\n    this._rangeChunkSize = source.rangeChunkSize;\n    if (!this._rangeChunkSize && !this._disableRange) {\n      this._disableRange = true;\n    }\n\n    this._isStreamingSupported = !source.disableStream;\n    this._isRangeSupported = !source.disableRange;\n\n    this._readableStream = null;\n    this._readCapability = new PromiseCapability();\n    this._headersCapability = new PromiseCapability();\n  }\n\n  get headersReady() {\n    return this._headersCapability.promise;\n  }\n\n  get filename() {\n    return this._filename;\n  }\n\n  get contentLength() {\n    return this._contentLength;\n  }\n\n  get isRangeSupported() {\n    return this._isRangeSupported;\n  }\n\n  get isStreamingSupported() {\n    return this._isStreamingSupported;\n  }\n\n  async read() {\n    await this._readCapability.promise;\n    if (this._done) {\n      return { value: undefined, done: true };\n    }\n    if (this._storedError) {\n      throw this._storedError;\n    }\n\n    const chunk = this._readableStream.read();\n    if (chunk === null) {\n      this._readCapability = new PromiseCapability();\n      return this.read();\n    }\n    this._loaded += chunk.length;\n    this.onProgress?.({\n      loaded: this._loaded,\n      total: this._contentLength,\n    });\n\n    // Ensure that `read()` method returns ArrayBuffer.\n    const buffer = new Uint8Array(chunk).buffer;\n    return { value: buffer, done: false };\n  }\n\n  cancel(reason) {\n    // Call `this._error()` method when cancel is called\n    // before _readableStream is set.\n    if (!this._readableStream) {\n      this._error(reason);\n      return;\n    }\n    this._readableStream.destroy(reason);\n  }\n\n  _error(reason) {\n    this._storedError = reason;\n    this._readCapability.resolve();\n  }\n\n  _setReadableStream(readableStream) {\n    this._readableStream = readableStream;\n    readableStream.on(\"readable\", () => {\n      this._readCapability.resolve();\n    });\n\n    readableStream.on(\"end\", () => {\n      // Destroy readable to minimize resource usage.\n      readableStream.destroy();\n      this._done = true;\n      this._readCapability.resolve();\n    });\n\n    readableStream.on(\"error\", reason => {\n      this._error(reason);\n    });\n\n    // We need to stop reading when range is supported and streaming is\n    // disabled.\n    if (!this._isStreamingSupported && this._isRangeSupported) {\n      this._error(new AbortException(\"streaming is disabled\"));\n    }\n\n    // Destroy ReadableStream if already in errored state.\n    if (this._storedError) {\n      this._readableStream.destroy(this._storedError);\n    }\n  }\n}\n\nclass BaseRangeReader {\n  constructor(stream) {\n    this._url = stream.url;\n    this._done = false;\n    this._storedError = null;\n    this.onProgress = null;\n    this._loaded = 0;\n    this._readableStream = null;\n    this._readCapability = new PromiseCapability();\n    const source = stream.source;\n    this._isStreamingSupported = !source.disableStream;\n  }\n\n  get isStreamingSupported() {\n    return this._isStreamingSupported;\n  }\n\n  async read() {\n    await this._readCapability.promise;\n    if (this._done) {\n      return { value: undefined, done: true };\n    }\n    if (this._storedError) {\n      throw this._storedError;\n    }\n\n    const chunk = this._readableStream.read();\n    if (chunk === null) {\n      this._readCapability = new PromiseCapability();\n      return this.read();\n    }\n    this._loaded += chunk.length;\n    this.onProgress?.({ loaded: this._loaded });\n\n    // Ensure that `read()` method returns ArrayBuffer.\n    const buffer = new Uint8Array(chunk).buffer;\n    return { value: buffer, done: false };\n  }\n\n  cancel(reason) {\n    // Call `this._error()` method when cancel is called\n    // before _readableStream is set.\n    if (!this._readableStream) {\n      this._error(reason);\n      return;\n    }\n    this._readableStream.destroy(reason);\n  }\n\n  _error(reason) {\n    this._storedError = reason;\n    this._readCapability.resolve();\n  }\n\n  _setReadableStream(readableStream) {\n    this._readableStream = readableStream;\n    readableStream.on(\"readable\", () => {\n      this._readCapability.resolve();\n    });\n\n    readableStream.on(\"end\", () => {\n      // Destroy readableStream to minimize resource usage.\n      readableStream.destroy();\n      this._done = true;\n      this._readCapability.resolve();\n    });\n\n    readableStream.on(\"error\", reason => {\n      this._error(reason);\n    });\n\n    // Destroy readableStream if already in errored state.\n    if (this._storedError) {\n      this._readableStream.destroy(this._storedError);\n    }\n  }\n}\n\nfunction createRequestOptions(parsedUrl, headers) {\n  return {\n    protocol: parsedUrl.protocol,\n    auth: parsedUrl.auth,\n    host: parsedUrl.hostname,\n    port: parsedUrl.port,\n    path: parsedUrl.path,\n    method: \"GET\",\n    headers,\n  };\n}\n\nclass PDFNodeStreamFullReader extends BaseFullReader {\n  constructor(stream) {\n    super(stream);\n\n    const handleResponse = response => {\n      if (response.statusCode === 404) {\n        const error = new MissingPDFException(`Missing PDF \"${this._url}\".`);\n        this._storedError = error;\n        this._headersCapability.reject(error);\n        return;\n      }\n      this._headersCapability.resolve();\n      this._setReadableStream(response);\n\n      const getResponseHeader = name => {\n        // Make sure that headers name are in lower case, as mentioned\n        // here: https://nodejs.org/api/http.html#http_message_headers.\n        return this._readableStream.headers[name.toLowerCase()];\n      };\n      const { allowRangeRequests, suggestedLength } =\n        validateRangeRequestCapabilities({\n          getResponseHeader,\n          isHttp: stream.isHttp,\n          rangeChunkSize: this._rangeChunkSize,\n          disableRange: this._disableRange,\n        });\n\n      this._isRangeSupported = allowRangeRequests;\n      // Setting right content length.\n      this._contentLength = suggestedLength || this._contentLength;\n\n      this._filename = extractFilenameFromHeader(getResponseHeader);\n    };\n\n    this._request = null;\n    if (this._url.protocol === \"http:\") {\n      this._request = http.request(\n        createRequestOptions(this._url, stream.httpHeaders),\n        handleResponse\n      );\n    } else {\n      this._request = https.request(\n        createRequestOptions(this._url, stream.httpHeaders),\n        handleResponse\n      );\n    }\n\n    this._request.on(\"error\", reason => {\n      this._storedError = reason;\n      this._headersCapability.reject(reason);\n    });\n    // Note: `request.end(data)` is used to write `data` to request body\n    // and notify end of request. But one should always call `request.end()`\n    // even if there is no data to write -- (to notify the end of request).\n    this._request.end();\n  }\n}\n\nclass PDFNodeStreamRangeReader extends BaseRangeReader {\n  constructor(stream, start, end) {\n    super(stream);\n\n    this._httpHeaders = {};\n    for (const property in stream.httpHeaders) {\n      const value = stream.httpHeaders[property];\n      if (value === undefined) {\n        continue;\n      }\n      this._httpHeaders[property] = value;\n    }\n    this._httpHeaders.Range = `bytes=${start}-${end - 1}`;\n\n    const handleResponse = response => {\n      if (response.statusCode === 404) {\n        const error = new MissingPDFException(`Missing PDF \"${this._url}\".`);\n        this._storedError = error;\n        return;\n      }\n      this._setReadableStream(response);\n    };\n\n    this._request = null;\n    if (this._url.protocol === \"http:\") {\n      this._request = http.request(\n        createRequestOptions(this._url, this._httpHeaders),\n        handleResponse\n      );\n    } else {\n      this._request = https.request(\n        createRequestOptions(this._url, this._httpHeaders),\n        handleResponse\n      );\n    }\n\n    this._request.on(\"error\", reason => {\n      this._storedError = reason;\n    });\n    this._request.end();\n  }\n}\n\nclass PDFNodeStreamFsFullReader extends BaseFullReader {\n  constructor(stream) {\n    super(stream);\n\n    let path = decodeURIComponent(this._url.path);\n\n    // Remove the extra slash to get right path from url like `file:///C:/`\n    if (fileUriRegex.test(this._url.href)) {\n      path = path.replace(/^\\//, \"\");\n    }\n\n    fs.lstat(path, (error, stat) => {\n      if (error) {\n        if (error.code === \"ENOENT\") {\n          error = new MissingPDFException(`Missing PDF \"${path}\".`);\n        }\n        this._storedError = error;\n        this._headersCapability.reject(error);\n        return;\n      }\n      // Setting right content length.\n      this._contentLength = stat.size;\n\n      this._setReadableStream(fs.createReadStream(path));\n      this._headersCapability.resolve();\n    });\n  }\n}\n\nclass PDFNodeStreamFsRangeReader extends BaseRangeReader {\n  constructor(stream, start, end) {\n    super(stream);\n\n    let path = decodeURIComponent(this._url.path);\n\n    // Remove the extra slash to get right path from url like `file:///C:/`\n    if (fileUriRegex.test(this._url.href)) {\n      path = path.replace(/^\\//, \"\");\n    }\n\n    this._setReadableStream(fs.createReadStream(path, { start, end: end - 1 }));\n  }\n}\n\nexport { PDFNodeStream };\n", "/* Copyright 2020 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  BaseCanvasFactory,\n  BaseCMapReaderFactory,\n  BaseFilterFactory,\n  BaseStandardFontDataFactory,\n} from \"./base_factory.js\";\nimport { isNodeJS, warn } from \"../shared/util.js\";\n\nif (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n  throw new Error(\n    'Module \"./node_utils.js\" shall not be used with MOZCENTRAL builds.'\n  );\n}\n\nlet fs, canvas, path2d_polyfill;\nif (isNodeJS) {\n  // Native packages.\n  fs = await import(/* webpackIgnore: true */ \"fs\");\n  // Optional, third-party, packages.\n  try {\n    canvas = await import(/* webpackIgnore: true */ \"canvas\");\n  } catch {}\n  try {\n    path2d_polyfill = await import(/* webpackIgnore: true */ \"path2d-polyfill\");\n  } catch {}\n}\n\nif (typeof PDFJSDev !== \"undefined\" && !PDFJSDev.test(\"SKIP_BABEL\")) {\n  (function checkDOMMatrix() {\n    if (globalThis.DOMMatrix || !isNodeJS) {\n      return;\n    }\n    const DOMMatrix = canvas?.DOMMatrix;\n\n    if (DOMMatrix) {\n      globalThis.DOMMatrix = DOMMatrix;\n    } else {\n      warn(\"Cannot polyfill `DOMMatrix`, rendering may be broken.\");\n    }\n  })();\n\n  (function checkPath2D() {\n    if (globalThis.Path2D || !isNodeJS) {\n      return;\n    }\n    const CanvasRenderingContext2D = canvas?.CanvasRenderingContext2D;\n    const polyfillPath2D = path2d_polyfill?.polyfillPath2D;\n\n    if (CanvasRenderingContext2D && polyfillPath2D) {\n      globalThis.CanvasRenderingContext2D = CanvasRenderingContext2D;\n      polyfillPath2D(globalThis);\n    } else {\n      warn(\"Cannot polyfill `Path2D`, rendering may be broken.\");\n    }\n  })();\n}\n\nconst fetchData = function (url) {\n  return new Promise((resolve, reject) => {\n    fs.readFile(url, (error, data) => {\n      if (error || !data) {\n        reject(new Error(error));\n        return;\n      }\n      resolve(new Uint8Array(data));\n    });\n  });\n};\n\nclass NodeFilterFactory extends BaseFilterFactory {}\n\nclass NodeCanvasFactory extends BaseCanvasFactory {\n  /**\n   * @ignore\n   */\n  _createCanvas(width, height) {\n    return canvas.createCanvas(width, height);\n  }\n}\n\nclass NodeCMapReaderFactory extends BaseCMapReaderFactory {\n  /**\n   * @ignore\n   */\n  _fetchData(url, compressionType) {\n    return fetchData(url).then(data => {\n      return { cMapData: data, compressionType };\n    });\n  }\n}\n\nclass NodeStandardFontDataFactory extends BaseStandardFontDataFactory {\n  /**\n   * @ignore\n   */\n  _fetchData(url) {\n    return fetchData(url);\n  }\n}\n\nexport {\n  NodeCanvasFactory,\n  NodeCMapReaderFactory,\n  NodeFilterFactory,\n  NodeStandardFontDataFactory,\n};\n", "/* Copyright 2020 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { objectFromMap, unreachable, warn } from \"../shared/util.js\";\nimport { MurmurHash3_64 } from \"../shared/murmurhash3.js\";\n\nconst INTERNAL = Symbol(\"INTERNAL\");\n\nclass OptionalContentGroup {\n  #visible = true;\n\n  constructor(name, intent) {\n    this.name = name;\n    this.intent = intent;\n  }\n\n  /**\n   * @type {boolean}\n   */\n  get visible() {\n    return this.#visible;\n  }\n\n  /**\n   * @ignore\n   */\n  _setVisible(internal, visible) {\n    if (internal !== INTERNAL) {\n      unreachable(\"Internal method `_setVisible` called.\");\n    }\n    this.#visible = visible;\n  }\n}\n\nclass OptionalContentConfig {\n  #cachedGetHash = null;\n\n  #groups = new Map();\n\n  #initialHash = null;\n\n  #order = null;\n\n  constructor(data) {\n    this.name = null;\n    this.creator = null;\n\n    if (data === null) {\n      return;\n    }\n    this.name = data.name;\n    this.creator = data.creator;\n    this.#order = data.order;\n    for (const group of data.groups) {\n      this.#groups.set(\n        group.id,\n        new OptionalContentGroup(group.name, group.intent)\n      );\n    }\n\n    if (data.baseState === \"OFF\") {\n      for (const group of this.#groups.values()) {\n        group._setVisible(INTERNAL, false);\n      }\n    }\n\n    for (const on of data.on) {\n      this.#groups.get(on)._setVisible(INTERNAL, true);\n    }\n\n    for (const off of data.off) {\n      this.#groups.get(off)._setVisible(INTERNAL, false);\n    }\n\n    // The following code must always run *last* in the constructor.\n    this.#initialHash = this.getHash();\n  }\n\n  #evaluateVisibilityExpression(array) {\n    const length = array.length;\n    if (length < 2) {\n      return true;\n    }\n    const operator = array[0];\n    for (let i = 1; i < length; i++) {\n      const element = array[i];\n      let state;\n      if (Array.isArray(element)) {\n        state = this.#evaluateVisibilityExpression(element);\n      } else if (this.#groups.has(element)) {\n        state = this.#groups.get(element).visible;\n      } else {\n        warn(`Optional content group not found: ${element}`);\n        return true;\n      }\n      switch (operator) {\n        case \"And\":\n          if (!state) {\n            return false;\n          }\n          break;\n        case \"Or\":\n          if (state) {\n            return true;\n          }\n          break;\n        case \"Not\":\n          return !state;\n        default:\n          return true;\n      }\n    }\n    return operator === \"And\";\n  }\n\n  isVisible(group) {\n    if (this.#groups.size === 0) {\n      return true;\n    }\n    if (!group) {\n      warn(\"Optional content group not defined.\");\n      return true;\n    }\n    if (group.type === \"OCG\") {\n      if (!this.#groups.has(group.id)) {\n        warn(`Optional content group not found: ${group.id}`);\n        return true;\n      }\n      return this.#groups.get(group.id).visible;\n    } else if (group.type === \"OCMD\") {\n      // Per the spec, the expression should be preferred if available.\n      if (group.expression) {\n        return this.#evaluateVisibilityExpression(group.expression);\n      }\n      if (!group.policy || group.policy === \"AnyOn\") {\n        // Default\n        for (const id of group.ids) {\n          if (!this.#groups.has(id)) {\n            warn(`Optional content group not found: ${id}`);\n            return true;\n          }\n          if (this.#groups.get(id).visible) {\n            return true;\n          }\n        }\n        return false;\n      } else if (group.policy === \"AllOn\") {\n        for (const id of group.ids) {\n          if (!this.#groups.has(id)) {\n            warn(`Optional content group not found: ${id}`);\n            return true;\n          }\n          if (!this.#groups.get(id).visible) {\n            return false;\n          }\n        }\n        return true;\n      } else if (group.policy === \"AnyOff\") {\n        for (const id of group.ids) {\n          if (!this.#groups.has(id)) {\n            warn(`Optional content group not found: ${id}`);\n            return true;\n          }\n          if (!this.#groups.get(id).visible) {\n            return true;\n          }\n        }\n        return false;\n      } else if (group.policy === \"AllOff\") {\n        for (const id of group.ids) {\n          if (!this.#groups.has(id)) {\n            warn(`Optional content group not found: ${id}`);\n            return true;\n          }\n          if (this.#groups.get(id).visible) {\n            return false;\n          }\n        }\n        return true;\n      }\n      warn(`Unknown optional content policy ${group.policy}.`);\n      return true;\n    }\n    warn(`Unknown group type ${group.type}.`);\n    return true;\n  }\n\n  setVisibility(id, visible = true) {\n    if (!this.#groups.has(id)) {\n      warn(`Optional content group not found: ${id}`);\n      return;\n    }\n    this.#groups.get(id)._setVisible(INTERNAL, !!visible);\n\n    this.#cachedGetHash = null;\n  }\n\n  get hasInitialVisibility() {\n    return this.#initialHash === null || this.getHash() === this.#initialHash;\n  }\n\n  getOrder() {\n    if (!this.#groups.size) {\n      return null;\n    }\n    if (this.#order) {\n      return this.#order.slice();\n    }\n    return [...this.#groups.keys()];\n  }\n\n  getGroups() {\n    return this.#groups.size > 0 ? objectFromMap(this.#groups) : null;\n  }\n\n  getGroup(id) {\n    return this.#groups.get(id) || null;\n  }\n\n  getHash() {\n    if (this.#cachedGetHash !== null) {\n      return this.#cachedGetHash;\n    }\n    const hash = new MurmurHash3_64();\n\n    for (const [id, group] of this.#groups) {\n      hash.update(`${id}:${group.visible}`);\n    }\n    return (this.#cachedGetHash = hash.hexdigest());\n  }\n}\n\nexport { OptionalContentConfig };\n", "/* Copyright 2015 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"./display_utils\").PageViewport} PageViewport */\n/** @typedef {import(\"./api\").TextContent} TextContent */\n\nimport {\n  AbortException,\n  FeatureTest,\n  PromiseCapability,\n  Util,\n} from \"../shared/util.js\";\nimport { setLayerDimensions } from \"./display_utils.js\";\n\n/**\n * Text layer render parameters.\n *\n * @typedef {Object} TextLayerRenderParameters\n * @property {ReadableStream | TextContent} textContentSource - Text content to\n *   render, i.e. the value returned by the page's `streamTextContent` or\n *   `getTextContent` method.\n * @property {HTMLElement} container - The DOM node that will contain the text\n *   runs.\n * @property {PageViewport} viewport - The target viewport to properly layout\n *   the text runs.\n * @property {Array<HTMLElement>} [textDivs] - HTML elements that correspond to\n *   the text items of the textContent input.\n *   This is output and shall initially be set to an empty array.\n * @property {WeakMap<HTMLElement,Object>} [textDivProperties] - Some properties\n *   weakly mapped to the HTML elements used to render the text.\n * @property {Array<string>} [textContentItemsStr] - Strings that correspond to\n *   the `str` property of the text items of the textContent input.\n *   This is output and shall initially be set to an empty array.\n * @property {boolean} [isOffscreenCanvasSupported] true if we can use\n *   OffscreenCanvas to measure string widths.\n */\n\n/**\n * Text layer update parameters.\n *\n * @typedef {Object} TextLayerUpdateParameters\n * @property {HTMLElement} container - The DOM node that will contain the text\n *   runs.\n * @property {PageViewport} viewport - The target viewport to properly layout\n *   the text runs.\n * @property {Array<HTMLElement>} [textDivs] - HTML elements that correspond to\n *   the text items of the textContent input.\n *   This is output and shall initially be set to an empty array.\n * @property {WeakMap<HTMLElement,Object>} [textDivProperties] - Some properties\n *   weakly mapped to the HTML elements used to render the text.\n * @property {boolean} [isOffscreenCanvasSupported] true if we can use\n *   OffscreenCanvas to measure string widths.\n * @property {boolean} [mustRotate] true if the text layer must be rotated.\n * @property {boolean} [mustRescale] true if the text layer contents must be\n *   rescaled.\n */\n\nconst MAX_TEXT_DIVS_TO_RENDER = 100000;\nconst DEFAULT_FONT_SIZE = 30;\nconst DEFAULT_FONT_ASCENT = 0.8;\nconst ascentCache = new Map();\n\nfunction getCtx(size, isOffscreenCanvasSupported) {\n  let ctx;\n  if (isOffscreenCanvasSupported && FeatureTest.isOffscreenCanvasSupported) {\n    ctx = new OffscreenCanvas(size, size).getContext(\"2d\", { alpha: false });\n  } else {\n    const canvas = document.createElement(\"canvas\");\n    canvas.width = canvas.height = size;\n    ctx = canvas.getContext(\"2d\", { alpha: false });\n  }\n\n  return ctx;\n}\n\nfunction getAscent(fontFamily, isOffscreenCanvasSupported) {\n  const cachedAscent = ascentCache.get(fontFamily);\n  if (cachedAscent) {\n    return cachedAscent;\n  }\n\n  const ctx = getCtx(DEFAULT_FONT_SIZE, isOffscreenCanvasSupported);\n\n  ctx.font = `${DEFAULT_FONT_SIZE}px ${fontFamily}`;\n  const metrics = ctx.measureText(\"\");\n\n  // Both properties aren't available by default in Firefox.\n  let ascent = metrics.fontBoundingBoxAscent;\n  let descent = Math.abs(metrics.fontBoundingBoxDescent);\n  if (ascent) {\n    const ratio = ascent / (ascent + descent);\n    ascentCache.set(fontFamily, ratio);\n\n    ctx.canvas.width = ctx.canvas.height = 0;\n    return ratio;\n  }\n\n  // Try basic heuristic to guess ascent/descent.\n  // Draw a g with baseline at 0,0 and then get the line\n  // number where a pixel has non-null red component (starting\n  // from bottom).\n  ctx.strokeStyle = \"red\";\n  ctx.clearRect(0, 0, DEFAULT_FONT_SIZE, DEFAULT_FONT_SIZE);\n  ctx.strokeText(\"g\", 0, 0);\n  let pixels = ctx.getImageData(\n    0,\n    0,\n    DEFAULT_FONT_SIZE,\n    DEFAULT_FONT_SIZE\n  ).data;\n  descent = 0;\n  for (let i = pixels.length - 1 - 3; i >= 0; i -= 4) {\n    if (pixels[i] > 0) {\n      descent = Math.ceil(i / 4 / DEFAULT_FONT_SIZE);\n      break;\n    }\n  }\n\n  // Draw an A with baseline at 0,DEFAULT_FONT_SIZE and then get the line\n  // number where a pixel has non-null red component (starting\n  // from top).\n  ctx.clearRect(0, 0, DEFAULT_FONT_SIZE, DEFAULT_FONT_SIZE);\n  ctx.strokeText(\"A\", 0, DEFAULT_FONT_SIZE);\n  pixels = ctx.getImageData(0, 0, DEFAULT_FONT_SIZE, DEFAULT_FONT_SIZE).data;\n  ascent = 0;\n  for (let i = 0, ii = pixels.length; i < ii; i += 4) {\n    if (pixels[i] > 0) {\n      ascent = DEFAULT_FONT_SIZE - Math.floor(i / 4 / DEFAULT_FONT_SIZE);\n      break;\n    }\n  }\n\n  ctx.canvas.width = ctx.canvas.height = 0;\n\n  if (ascent) {\n    const ratio = ascent / (ascent + descent);\n    ascentCache.set(fontFamily, ratio);\n    return ratio;\n  }\n\n  ascentCache.set(fontFamily, DEFAULT_FONT_ASCENT);\n  return DEFAULT_FONT_ASCENT;\n}\n\nfunction appendText(task, geom, styles) {\n  // Initialize all used properties to keep the caches monomorphic.\n  const textDiv = document.createElement(\"span\");\n  const textDivProperties = {\n    angle: 0,\n    canvasWidth: 0,\n    hasText: geom.str !== \"\",\n    hasEOL: geom.hasEOL,\n    fontSize: 0,\n  };\n  task._textDivs.push(textDiv);\n\n  const tx = Util.transform(task._transform, geom.transform);\n  let angle = Math.atan2(tx[1], tx[0]);\n  const style = styles[geom.fontName];\n  if (style.vertical) {\n    angle += Math.PI / 2;\n  }\n\n  const fontFamily =\n    (task._fontInspectorEnabled && style.fontSubstitution) || style.fontFamily;\n  const fontHeight = Math.hypot(tx[2], tx[3]);\n  const fontAscent =\n    fontHeight * getAscent(fontFamily, task._isOffscreenCanvasSupported);\n\n  let left, top;\n  if (angle === 0) {\n    left = tx[4];\n    top = tx[5] - fontAscent;\n  } else {\n    left = tx[4] + fontAscent * Math.sin(angle);\n    top = tx[5] - fontAscent * Math.cos(angle);\n  }\n\n  const scaleFactorStr = \"calc(var(--scale-factor)*\";\n  const divStyle = textDiv.style;\n  // Setting the style properties individually, rather than all at once,\n  // should be OK since the `textDiv` isn't appended to the document yet.\n  if (task._container === task._rootContainer) {\n    divStyle.left = `${((100 * left) / task._pageWidth).toFixed(2)}%`;\n    divStyle.top = `${((100 * top) / task._pageHeight).toFixed(2)}%`;\n  } else {\n    // We're in a marked content span, hence we can't use percents.\n    divStyle.left = `${scaleFactorStr}${left.toFixed(2)}px)`;\n    divStyle.top = `${scaleFactorStr}${top.toFixed(2)}px)`;\n  }\n  divStyle.fontSize = `${scaleFactorStr}${fontHeight.toFixed(2)}px)`;\n  divStyle.fontFamily = fontFamily;\n\n  textDivProperties.fontSize = fontHeight;\n\n  // Keeps screen readers from pausing on every new text span.\n  textDiv.setAttribute(\"role\", \"presentation\");\n\n  textDiv.textContent = geom.str;\n  // geom.dir may be 'ttb' for vertical texts.\n  textDiv.dir = geom.dir;\n\n  // `fontName` is only used by the FontInspector, and we only use `dataset`\n  // here to make the font name available in the debugger.\n  if (task._fontInspectorEnabled) {\n    textDiv.dataset.fontName =\n      style.fontSubstitutionLoadedName || geom.fontName;\n  }\n  if (angle !== 0) {\n    textDivProperties.angle = angle * (180 / Math.PI);\n  }\n  // We don't bother scaling single-char text divs, because it has very\n  // little effect on text highlighting. This makes scrolling on docs with\n  // lots of such divs a lot faster.\n  let shouldScaleText = false;\n  if (geom.str.length > 1) {\n    shouldScaleText = true;\n  } else if (geom.str !== \" \" && geom.transform[0] !== geom.transform[3]) {\n    const absScaleX = Math.abs(geom.transform[0]),\n      absScaleY = Math.abs(geom.transform[3]);\n    // When the horizontal/vertical scaling differs significantly, also scale\n    // even single-char text to improve highlighting (fixes issue11713.pdf).\n    if (\n      absScaleX !== absScaleY &&\n      Math.max(absScaleX, absScaleY) / Math.min(absScaleX, absScaleY) > 1.5\n    ) {\n      shouldScaleText = true;\n    }\n  }\n  if (shouldScaleText) {\n    textDivProperties.canvasWidth = style.vertical ? geom.height : geom.width;\n  }\n  task._textDivProperties.set(textDiv, textDivProperties);\n  if (task._isReadableStream) {\n    task._layoutText(textDiv);\n  }\n}\n\nfunction layout(params) {\n  const { div, scale, properties, ctx, prevFontSize, prevFontFamily } = params;\n  const { style } = div;\n  let transform = \"\";\n  if (properties.canvasWidth !== 0 && properties.hasText) {\n    const { fontFamily } = style;\n    const { canvasWidth, fontSize } = properties;\n\n    if (prevFontSize !== fontSize || prevFontFamily !== fontFamily) {\n      ctx.font = `${fontSize * scale}px ${fontFamily}`;\n      params.prevFontSize = fontSize;\n      params.prevFontFamily = fontFamily;\n    }\n\n    // Only measure the width for multi-char text divs, see `appendText`.\n    const { width } = ctx.measureText(div.textContent);\n\n    if (width > 0) {\n      transform = `scaleX(${(canvasWidth * scale) / width})`;\n    }\n  }\n  if (properties.angle !== 0) {\n    transform = `rotate(${properties.angle}deg) ${transform}`;\n  }\n  if (transform.length > 0) {\n    style.transform = transform;\n  }\n}\n\nfunction render(task) {\n  if (task._canceled) {\n    return;\n  }\n  const textDivs = task._textDivs;\n  const capability = task._capability;\n  const textDivsLength = textDivs.length;\n\n  // No point in rendering many divs as it would make the browser\n  // unusable even after the divs are rendered.\n  if (textDivsLength > MAX_TEXT_DIVS_TO_RENDER) {\n    capability.resolve();\n    return;\n  }\n\n  if (!task._isReadableStream) {\n    for (const textDiv of textDivs) {\n      task._layoutText(textDiv);\n    }\n  }\n  capability.resolve();\n}\n\nclass TextLayerRenderTask {\n  constructor({\n    textContentSource,\n    container,\n    viewport,\n    textDivs,\n    textDivProperties,\n    textContentItemsStr,\n    isOffscreenCanvasSupported,\n  }) {\n    this._textContentSource = textContentSource;\n    this._isReadableStream = textContentSource instanceof ReadableStream;\n    this._container = this._rootContainer = container;\n    this._textDivs = textDivs || [];\n    this._textContentItemsStr = textContentItemsStr || [];\n    this._isOffscreenCanvasSupported = isOffscreenCanvasSupported;\n    this._fontInspectorEnabled = !!globalThis.FontInspector?.enabled;\n\n    this._reader = null;\n    this._textDivProperties = textDivProperties || new WeakMap();\n    this._canceled = false;\n    this._capability = new PromiseCapability();\n    this._layoutTextParams = {\n      prevFontSize: null,\n      prevFontFamily: null,\n      div: null,\n      scale: viewport.scale * (globalThis.devicePixelRatio || 1),\n      properties: null,\n      ctx: getCtx(0, isOffscreenCanvasSupported),\n    };\n    const { pageWidth, pageHeight, pageX, pageY } = viewport.rawDims;\n    this._transform = [1, 0, 0, -1, -pageX, pageY + pageHeight];\n    this._pageWidth = pageWidth;\n    this._pageHeight = pageHeight;\n\n    setLayerDimensions(container, viewport);\n\n    // Always clean-up the temporary canvas once rendering is no longer pending.\n    this._capability.promise\n      .finally(() => {\n        this._layoutTextParams = null;\n      })\n      .catch(() => {\n        // Avoid \"Uncaught promise\" messages in the console.\n      });\n  }\n\n  /**\n   * Promise for textLayer rendering task completion.\n   * @type {Promise<void>}\n   */\n  get promise() {\n    return this._capability.promise;\n  }\n\n  /**\n   * Cancel rendering of the textLayer.\n   */\n  cancel() {\n    this._canceled = true;\n    if (this._reader) {\n      this._reader\n        .cancel(new AbortException(\"TextLayer task cancelled.\"))\n        .catch(() => {\n          // Avoid \"Uncaught promise\" messages in the console.\n        });\n      this._reader = null;\n    }\n    this._capability.reject(new AbortException(\"TextLayer task cancelled.\"));\n  }\n\n  /**\n   * @private\n   */\n  _processItems(items, styleCache) {\n    for (const item of items) {\n      if (item.str === undefined) {\n        if (\n          item.type === \"beginMarkedContentProps\" ||\n          item.type === \"beginMarkedContent\"\n        ) {\n          const parent = this._container;\n          this._container = document.createElement(\"span\");\n          this._container.classList.add(\"markedContent\");\n          if (item.id !== null) {\n            this._container.setAttribute(\"id\", `${item.id}`);\n          }\n          parent.append(this._container);\n        } else if (item.type === \"endMarkedContent\") {\n          this._container = this._container.parentNode;\n        }\n        continue;\n      }\n      this._textContentItemsStr.push(item.str);\n      appendText(this, item, styleCache);\n    }\n  }\n\n  /**\n   * @private\n   */\n  _layoutText(textDiv) {\n    const textDivProperties = (this._layoutTextParams.properties =\n      this._textDivProperties.get(textDiv));\n    this._layoutTextParams.div = textDiv;\n    layout(this._layoutTextParams);\n\n    if (textDivProperties.hasText) {\n      this._container.append(textDiv);\n    }\n    if (textDivProperties.hasEOL) {\n      const br = document.createElement(\"br\");\n      br.setAttribute(\"role\", \"presentation\");\n      this._container.append(br);\n    }\n  }\n\n  /**\n   * @private\n   */\n  _render() {\n    const capability = new PromiseCapability();\n    let styleCache = Object.create(null);\n\n    if (this._isReadableStream) {\n      const pump = () => {\n        this._reader.read().then(({ value, done }) => {\n          if (done) {\n            capability.resolve();\n            return;\n          }\n\n          Object.assign(styleCache, value.styles);\n          this._processItems(value.items, styleCache);\n          pump();\n        }, capability.reject);\n      };\n\n      this._reader = this._textContentSource.getReader();\n      pump();\n    } else if (this._textContentSource) {\n      const { items, styles } = this._textContentSource;\n      this._processItems(items, styles);\n      capability.resolve();\n    } else {\n      throw new Error('No \"textContentSource\" parameter specified.');\n    }\n\n    capability.promise.then(() => {\n      styleCache = null;\n      render(this);\n    }, this._capability.reject);\n  }\n}\n\n/**\n * @param {TextLayerRenderParameters} params\n * @returns {TextLayerRenderTask}\n */\nfunction renderTextLayer(params) {\n  const task = new TextLayerRenderTask(params);\n  task._render();\n  return task;\n}\n\n/**\n * @param {TextLayerUpdateParameters} params\n * @returns {undefined}\n */\nfunction updateTextLayer({\n  container,\n  viewport,\n  textDivs,\n  textDivProperties,\n  isOffscreenCanvasSupported,\n  mustRotate = true,\n  mustRescale = true,\n}) {\n  if (mustRotate) {\n    setLayerDimensions(container, { rotation: viewport.rotation });\n  }\n\n  if (mustRescale) {\n    const ctx = getCtx(0, isOffscreenCanvasSupported);\n    const scale = viewport.scale * (globalThis.devicePixelRatio || 1);\n    const params = {\n      prevFontSize: null,\n      prevFontFamily: null,\n      div: null,\n      scale,\n      properties: null,\n      ctx,\n    };\n    for (const div of textDivs) {\n      params.properties = textDivProperties.get(div);\n      params.div = div;\n      layout(params);\n    }\n  }\n}\n\nexport { renderTextLayer, TextLayerRenderTask, updateTextLayer };\n", "/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"../interfaces\").IPDFStream} IPDFStream */\n/** @typedef {import(\"../interfaces\").IPDFStreamReader} IPDFStreamReader */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../interfaces\").IPDFStreamRangeReader} IPDFStreamRangeReader */\n\nimport { assert, PromiseCapability } from \"../shared/util.js\";\nimport { isPdfFile } from \"./display_utils.js\";\n\n/** @implements {IPDFStream} */\nclass PDFDataTransportStream {\n  constructor(\n    {\n      length,\n      initialData,\n      progressiveDone = false,\n      contentDispositionFilename = null,\n      disableRange = false,\n      disableStream = false,\n    },\n    pdfDataRangeTransport\n  ) {\n    assert(\n      pdfDataRangeTransport,\n      'PDFDataTransportStream - missing required \"pdfDataRangeTransport\" argument.'\n    );\n\n    this._queuedChunks = [];\n    this._progressiveDone = progressiveDone;\n    this._contentDispositionFilename = contentDispositionFilename;\n\n    if (initialData?.length > 0) {\n      // Prevent any possible issues by only transferring a Uint8Array that\n      // completely \"utilizes\" its underlying ArrayBuffer.\n      const buffer =\n        initialData instanceof Uint8Array &&\n        initialData.byteLength === initialData.buffer.byteLength\n          ? initialData.buffer\n          : new Uint8Array(initialData).buffer;\n      this._queuedChunks.push(buffer);\n    }\n\n    this._pdfDataRangeTransport = pdfDataRangeTransport;\n    this._isStreamingSupported = !disableStream;\n    this._isRangeSupported = !disableRange;\n    this._contentLength = length;\n\n    this._fullRequestReader = null;\n    this._rangeReaders = [];\n\n    this._pdfDataRangeTransport.addRangeListener((begin, chunk) => {\n      this._onReceiveData({ begin, chunk });\n    });\n\n    this._pdfDataRangeTransport.addProgressListener((loaded, total) => {\n      this._onProgress({ loaded, total });\n    });\n\n    this._pdfDataRangeTransport.addProgressiveReadListener(chunk => {\n      this._onReceiveData({ chunk });\n    });\n\n    this._pdfDataRangeTransport.addProgressiveDoneListener(() => {\n      this._onProgressiveDone();\n    });\n\n    this._pdfDataRangeTransport.transportReady();\n  }\n\n  _onReceiveData({ begin, chunk }) {\n    // Prevent any possible issues by only transferring a Uint8Array that\n    // completely \"utilizes\" its underlying ArrayBuffer.\n    const buffer =\n      chunk instanceof Uint8Array &&\n      chunk.byteLength === chunk.buffer.byteLength\n        ? chunk.buffer\n        : new Uint8Array(chunk).buffer;\n\n    if (begin === undefined) {\n      if (this._fullRequestReader) {\n        this._fullRequestReader._enqueue(buffer);\n      } else {\n        this._queuedChunks.push(buffer);\n      }\n    } else {\n      const found = this._rangeReaders.some(function (rangeReader) {\n        if (rangeReader._begin !== begin) {\n          return false;\n        }\n        rangeReader._enqueue(buffer);\n        return true;\n      });\n      assert(\n        found,\n        \"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.\"\n      );\n    }\n  }\n\n  get _progressiveDataLength() {\n    return this._fullRequestReader?._loaded ?? 0;\n  }\n\n  _onProgress(evt) {\n    if (evt.total === undefined) {\n      // Reporting to first range reader, if it exists.\n      this._rangeReaders[0]?.onProgress?.({ loaded: evt.loaded });\n    } else {\n      this._fullRequestReader?.onProgress?.({\n        loaded: evt.loaded,\n        total: evt.total,\n      });\n    }\n  }\n\n  _onProgressiveDone() {\n    this._fullRequestReader?.progressiveDone();\n    this._progressiveDone = true;\n  }\n\n  _removeRangeReader(reader) {\n    const i = this._rangeReaders.indexOf(reader);\n    if (i >= 0) {\n      this._rangeReaders.splice(i, 1);\n    }\n  }\n\n  getFullReader() {\n    assert(\n      !this._fullRequestReader,\n      \"PDFDataTransportStream.getFullReader can only be called once.\"\n    );\n    const queuedChunks = this._queuedChunks;\n    this._queuedChunks = null;\n    return new PDFDataTransportStreamReader(\n      this,\n      queuedChunks,\n      this._progressiveDone,\n      this._contentDispositionFilename\n    );\n  }\n\n  getRangeReader(begin, end) {\n    if (end <= this._progressiveDataLength) {\n      return null;\n    }\n    const reader = new PDFDataTransportStreamRangeReader(this, begin, end);\n    this._pdfDataRangeTransport.requestDataRange(begin, end);\n    this._rangeReaders.push(reader);\n    return reader;\n  }\n\n  cancelAllRequests(reason) {\n    this._fullRequestReader?.cancel(reason);\n\n    for (const reader of this._rangeReaders.slice(0)) {\n      reader.cancel(reason);\n    }\n    this._pdfDataRangeTransport.abort();\n  }\n}\n\n/** @implements {IPDFStreamReader} */\nclass PDFDataTransportStreamReader {\n  constructor(\n    stream,\n    queuedChunks,\n    progressiveDone = false,\n    contentDispositionFilename = null\n  ) {\n    this._stream = stream;\n    this._done = progressiveDone || false;\n    this._filename = isPdfFile(contentDispositionFilename)\n      ? contentDispositionFilename\n      : null;\n    this._queuedChunks = queuedChunks || [];\n    this._loaded = 0;\n    for (const chunk of this._queuedChunks) {\n      this._loaded += chunk.byteLength;\n    }\n    this._requests = [];\n    this._headersReady = Promise.resolve();\n    stream._fullRequestReader = this;\n\n    this.onProgress = null;\n  }\n\n  _enqueue(chunk) {\n    if (this._done) {\n      return; // Ignore new data.\n    }\n    if (this._requests.length > 0) {\n      const requestCapability = this._requests.shift();\n      requestCapability.resolve({ value: chunk, done: false });\n    } else {\n      this._queuedChunks.push(chunk);\n    }\n    this._loaded += chunk.byteLength;\n  }\n\n  get headersReady() {\n    return this._headersReady;\n  }\n\n  get filename() {\n    return this._filename;\n  }\n\n  get isRangeSupported() {\n    return this._stream._isRangeSupported;\n  }\n\n  get isStreamingSupported() {\n    return this._stream._isStreamingSupported;\n  }\n\n  get contentLength() {\n    return this._stream._contentLength;\n  }\n\n  async read() {\n    if (this._queuedChunks.length > 0) {\n      const chunk = this._queuedChunks.shift();\n      return { value: chunk, done: false };\n    }\n    if (this._done) {\n      return { value: undefined, done: true };\n    }\n    const requestCapability = new PromiseCapability();\n    this._requests.push(requestCapability);\n    return requestCapability.promise;\n  }\n\n  cancel(reason) {\n    this._done = true;\n    for (const requestCapability of this._requests) {\n      requestCapability.resolve({ value: undefined, done: true });\n    }\n    this._requests.length = 0;\n  }\n\n  progressiveDone() {\n    if (this._done) {\n      return;\n    }\n    this._done = true;\n  }\n}\n\n/** @implements {IPDFStreamRangeReader} */\nclass PDFDataTransportStreamRangeReader {\n  constructor(stream, begin, end) {\n    this._stream = stream;\n    this._begin = begin;\n    this._end = end;\n    this._queuedChunk = null;\n    this._requests = [];\n    this._done = false;\n\n    this.onProgress = null;\n  }\n\n  _enqueue(chunk) {\n    if (this._done) {\n      return; // ignore new data\n    }\n    if (this._requests.length === 0) {\n      this._queuedChunk = chunk;\n    } else {\n      const requestsCapability = this._requests.shift();\n      requestsCapability.resolve({ value: chunk, done: false });\n      for (const requestCapability of this._requests) {\n        requestCapability.resolve({ value: undefined, done: true });\n      }\n      this._requests.length = 0;\n    }\n    this._done = true;\n    this._stream._removeRangeReader(this);\n  }\n\n  get isStreamingSupported() {\n    return false;\n  }\n\n  async read() {\n    if (this._queuedChunk) {\n      const chunk = this._queuedChunk;\n      this._queuedChunk = null;\n      return { value: chunk, done: false };\n    }\n    if (this._done) {\n      return { value: undefined, done: true };\n    }\n    const requestCapability = new PromiseCapability();\n    this._requests.push(requestCapability);\n    return requestCapability.promise;\n  }\n\n  cancel(reason) {\n    this._done = true;\n    for (const requestCapability of this._requests) {\n      requestCapability.resolve({ value: undefined, done: true });\n    }\n    this._requests.length = 0;\n    this._stream._removeRangeReader(this);\n  }\n}\n\nexport { PDFDataTransportStream };\n", "/* Copyright 2018 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @typedef {Object} GlobalWorkerOptionsType\n * @property {Worker | null} workerPort - Defines global port for worker\n *   process. Overrides the `workerSrc` option.\n * @property {string} workerSrc - A string containing the path and filename\n *   of the worker file.\n *\n *   NOTE: The `workerSrc` option should always be set, in order to prevent any\n *         issues when using the PDF.js library.\n */\n\n/** @type {GlobalWorkerOptionsType} */\nconst GlobalWorkerOptions = Object.create(null);\n\nGlobalWorkerOptions.workerPort = null;\nGlobalWorkerOptions.workerSrc = \"\";\n\nexport { GlobalWorkerOptions };\n", "/* Copyright 2021 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// eslint-disable-next-line max-len\n/** @typedef {import(\"./annotation_storage\").AnnotationStorage} AnnotationStorage */\n/** @typedef {import(\"./display_utils\").PageViewport} PageViewport */\n/** @typedef {import(\"../../web/interfaces\").IPDFLinkService} IPDFLinkService */\n\nimport { XfaText } from \"./xfa_text.js\";\n\n/**\n * @typedef {Object} XfaLayerParameters\n * @property {PageViewport} viewport\n * @property {HTMLDivElement} div\n * @property {Object} xfaHtml\n * @property {AnnotationStorage} [annotationStorage]\n * @property {IPDFLinkService} linkService\n * @property {string} [intent] - (default value is 'display').\n */\n\nclass XfaLayer {\n  static setupStorage(html, id, element, storage, intent) {\n    const storedData = storage.getValue(id, { value: null });\n    switch (element.name) {\n      case \"textarea\":\n        if (storedData.value !== null) {\n          html.textContent = storedData.value;\n        }\n        if (intent === \"print\") {\n          break;\n        }\n        html.addEventListener(\"input\", event => {\n          storage.setValue(id, { value: event.target.value });\n        });\n        break;\n      case \"input\":\n        if (\n          element.attributes.type === \"radio\" ||\n          element.attributes.type === \"checkbox\"\n        ) {\n          if (storedData.value === element.attributes.xfaOn) {\n            html.setAttribute(\"checked\", true);\n          } else if (storedData.value === element.attributes.xfaOff) {\n            // The checked attribute may have been set when opening the file,\n            // unset through the UI and we're here because of printing.\n            html.removeAttribute(\"checked\");\n          }\n          if (intent === \"print\") {\n            break;\n          }\n          html.addEventListener(\"change\", event => {\n            storage.setValue(id, {\n              value: event.target.checked\n                ? event.target.getAttribute(\"xfaOn\")\n                : event.target.getAttribute(\"xfaOff\"),\n            });\n          });\n        } else {\n          if (storedData.value !== null) {\n            html.setAttribute(\"value\", storedData.value);\n          }\n          if (intent === \"print\") {\n            break;\n          }\n          html.addEventListener(\"input\", event => {\n            storage.setValue(id, { value: event.target.value });\n          });\n        }\n        break;\n      case \"select\":\n        if (storedData.value !== null) {\n          html.setAttribute(\"value\", storedData.value);\n          for (const option of element.children) {\n            if (option.attributes.value === storedData.value) {\n              option.attributes.selected = true;\n            } else if (option.attributes.hasOwnProperty(\"selected\")) {\n              delete option.attributes.selected;\n            }\n          }\n        }\n        html.addEventListener(\"input\", event => {\n          const options = event.target.options;\n          const value =\n            options.selectedIndex === -1\n              ? \"\"\n              : options[options.selectedIndex].value;\n          storage.setValue(id, { value });\n        });\n        break;\n    }\n  }\n\n  static setAttributes({ html, element, storage = null, intent, linkService }) {\n    const { attributes } = element;\n    const isHTMLAnchorElement = html instanceof HTMLAnchorElement;\n\n    if (attributes.type === \"radio\") {\n      // Avoid to have a radio group when printing with the same as one\n      // already displayed.\n      attributes.name = `${attributes.name}-${intent}`;\n    }\n    for (const [key, value] of Object.entries(attributes)) {\n      if (value === null || value === undefined) {\n        continue;\n      }\n\n      switch (key) {\n        case \"class\":\n          if (value.length) {\n            html.setAttribute(key, value.join(\" \"));\n          }\n          break;\n        case \"dataId\":\n          // We don't need to add dataId in the html object but it can\n          // be useful to know its value when writing printing tests:\n          // in this case, don't skip dataId to have its value.\n          break;\n        case \"id\":\n          html.setAttribute(\"data-element-id\", value);\n          break;\n        case \"style\":\n          Object.assign(html.style, value);\n          break;\n        case \"textContent\":\n          html.textContent = value;\n          break;\n        default:\n          if (!isHTMLAnchorElement || (key !== \"href\" && key !== \"newWindow\")) {\n            html.setAttribute(key, value);\n          }\n      }\n    }\n\n    if (isHTMLAnchorElement) {\n      linkService.addLinkAttributes(\n        html,\n        attributes.href,\n        attributes.newWindow\n      );\n    }\n\n    // Set the value after the others to be sure to overwrite any other values.\n    if (storage && attributes.dataId) {\n      this.setupStorage(html, attributes.dataId, element, storage);\n    }\n  }\n\n  /**\n   * Render the XFA layer.\n   *\n   * @param {XfaLayerParameters} parameters\n   */\n  static render(parameters) {\n    const storage = parameters.annotationStorage;\n    const linkService = parameters.linkService;\n    const root = parameters.xfaHtml;\n    const intent = parameters.intent || \"display\";\n    const rootHtml = document.createElement(root.name);\n    if (root.attributes) {\n      this.setAttributes({\n        html: rootHtml,\n        element: root,\n        intent,\n        linkService,\n      });\n    }\n\n    const isNotForRichText = intent !== \"richText\";\n    const rootDiv = parameters.div;\n    rootDiv.append(rootHtml);\n\n    if (parameters.viewport) {\n      const transform = `matrix(${parameters.viewport.transform.join(\",\")})`;\n      rootDiv.style.transform = transform;\n    }\n\n    // Set defaults.\n    if (isNotForRichText) {\n      rootDiv.setAttribute(\"class\", \"xfaLayer xfaFont\");\n    }\n\n    // Text nodes used for the text highlighter.\n    const textDivs = [];\n\n    // In the rich text context, it's possible to just have a text node without\n    // a root element, so we handle this case here (see issue 17215).\n    if (root.children.length === 0) {\n      if (root.value) {\n        const node = document.createTextNode(root.value);\n        rootHtml.append(node);\n        if (isNotForRichText && XfaText.shouldBuildText(root.name)) {\n          textDivs.push(node);\n        }\n      }\n      return { textDivs };\n    }\n\n    const stack = [[root, -1, rootHtml]];\n\n    while (stack.length > 0) {\n      const [parent, i, html] = stack.at(-1);\n      if (i + 1 === parent.children.length) {\n        stack.pop();\n        continue;\n      }\n\n      const child = parent.children[++stack.at(-1)[1]];\n      if (child === null) {\n        continue;\n      }\n\n      const { name } = child;\n      if (name === \"#text\") {\n        const node = document.createTextNode(child.value);\n        textDivs.push(node);\n        html.append(node);\n        continue;\n      }\n\n      const childHtml = child?.attributes?.xmlns\n        ? document.createElementNS(child.attributes.xmlns, name)\n        : document.createElement(name);\n\n      html.append(childHtml);\n      if (child.attributes) {\n        this.setAttributes({\n          html: childHtml,\n          element: child,\n          storage,\n          intent,\n          linkService,\n        });\n      }\n\n      if (child.children?.length > 0) {\n        stack.push([child, -1, childHtml]);\n      } else if (child.value) {\n        const node = document.createTextNode(child.value);\n        if (isNotForRichText && XfaText.shouldBuildText(name)) {\n          textDivs.push(node);\n        }\n        childHtml.append(node);\n      }\n    }\n\n    /**\n     * TODO: re-enable that stuff once we've JS implementation.\n     * See https://bugzilla.mozilla.org/show_bug.cgi?id=1719465.\n     *\n     * for (const el of rootDiv.querySelectorAll(\n     * \".xfaDisabled input, .xfaDisabled textarea\"\n     * )) {\n     * el.setAttribute(\"disabled\", true);\n     * }\n     * for (const el of rootDiv.querySelectorAll(\n     * \".xfaReadOnly input, .xfaReadOnly textarea\"\n     * )) {\n     * el.setAttribute(\"readOnly\", true);\n     * }\n     */\n\n    for (const el of rootDiv.querySelectorAll(\n      \".xfaNonInteractive input, .xfaNonInteractive textarea\"\n    )) {\n      el.setAttribute(\"readOnly\", true);\n    }\n\n    return {\n      textDivs,\n    };\n  }\n\n  /**\n   * Update the XFA layer.\n   *\n   * @param {XfaLayerParameters} parameters\n   */\n  static update(parameters) {\n    const transform = `matrix(${parameters.viewport.transform.join(\",\")})`;\n    parameters.div.style.transform = transform;\n    parameters.div.hidden = false;\n  }\n}\n\nexport { XfaLayer };\n", "/* Copyright 2021 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"./api\").TextContent} TextContent */\n\nclass XfaText {\n  /**\n   * Walk an XFA tree and create an array of text nodes that is compatible\n   * with a regular PDFs TextContent. Currently, only TextItem.str is supported,\n   * all other fields and styles haven't been implemented.\n   *\n   * @param {Object} xfa - An XFA fake DOM object.\n   *\n   * @returns {TextContent}\n   */\n  static textContent(xfa) {\n    const items = [];\n    const output = {\n      items,\n      styles: Object.create(null),\n    };\n    function walk(node) {\n      if (!node) {\n        return;\n      }\n      let str = null;\n      const name = node.name;\n      if (name === \"#text\") {\n        str = node.value;\n      } else if (!XfaText.shouldBuildText(name)) {\n        return;\n      } else if (node?.attributes?.textContent) {\n        str = node.attributes.textContent;\n      } else if (node.value) {\n        str = node.value;\n      }\n      if (str !== null) {\n        items.push({\n          str,\n        });\n      }\n      if (!node.children) {\n        return;\n      }\n      for (const child of node.children) {\n        walk(child);\n      }\n    }\n    walk(xfa);\n    return output;\n  }\n\n  /**\n   * @param {string} name - DOM node name. (lower case)\n   *\n   * @returns {boolean} true if the DOM node should have a corresponding text\n   * node.\n   */\n  static shouldBuildText(name) {\n    return !(\n      name === \"textarea\" ||\n      name === \"input\" ||\n      name === \"option\" ||\n      name === \"select\"\n    );\n  }\n}\n\nexport { XfaText };\n", "/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// eslint-disable-next-line max-len\n/** @typedef {import(\"./display/api\").OnProgressParameters} OnProgressParameters */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"./display/api\").PDFDocumentLoadingTask} PDFDocumentLoadingTask */\n/** @typedef {import(\"./display/api\").PDFDocumentProxy} PDFDocumentProxy */\n/** @typedef {import(\"./display/api\").PDFPageProxy} PDFPageProxy */\n/** @typedef {import(\"./display/api\").RenderTask} RenderTask */\n/** @typedef {import(\"./display/display_utils\").PageViewport} PageViewport */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"./display/text_layer\").TextLayerRenderTask} TextLayerRenderTask */\n\nimport {\n  AbortException,\n  AnnotationEditorParamsType,\n  AnnotationEditorType,\n  AnnotationMode,\n  CMapCompressionType,\n  createValidAbsoluteUrl,\n  FeatureTest,\n  ImageKind,\n  InvalidPDFException,\n  MissingPDFException,\n  normalizeUnicode,\n  OPS,\n  PasswordResponses,\n  PermissionFlag,\n  PromiseCapability,\n  shadow,\n  UnexpectedResponseException,\n  Util,\n  VerbosityLevel,\n} from \"./shared/util.js\";\nimport {\n  build,\n  getDocument,\n  PDFDataRangeTransport,\n  PDFWorker,\n  version,\n} from \"./display/api.js\";\nimport {\n  DOMSVGFactory,\n  fetchData,\n  getFilenameFromUrl,\n  getPdfFilenameFromUrl,\n  getXfaPageViewport,\n  isDataScheme,\n  isPdfFile,\n  noContextMenu,\n  PDFDateString,\n  PixelsPerInch,\n  RenderingCancelledException,\n  setLayerDimensions,\n} from \"./display/display_utils.js\";\nimport { renderTextLayer, updateTextLayer } from \"./display/text_layer.js\";\nimport { AnnotationEditorLayer } from \"./display/editor/annotation_editor_layer.js\";\nimport { AnnotationEditorUIManager } from \"./display/editor/tools.js\";\nimport { AnnotationLayer } from \"./display/annotation_layer.js\";\nimport { ColorPicker } from \"./display/editor/color_picker.js\";\nimport { DrawLayer } from \"./display/draw_layer.js\";\nimport { GlobalWorkerOptions } from \"./display/worker_options.js\";\nimport { Outliner } from \"./display/editor/outliner.js\";\nimport { XfaLayer } from \"./display/xfa_layer.js\";\n\n/* eslint-disable-next-line no-unused-vars */\nconst pdfjsVersion =\n  typeof PDFJSDev !== \"undefined\" ? PDFJSDev.eval(\"BUNDLE_VERSION\") : void 0;\n/* eslint-disable-next-line no-unused-vars */\nconst pdfjsBuild =\n  typeof PDFJSDev !== \"undefined\" ? PDFJSDev.eval(\"BUNDLE_BUILD\") : void 0;\n\nexport {\n  AbortException,\n  AnnotationEditorLayer,\n  AnnotationEditorParamsType,\n  AnnotationEditorType,\n  AnnotationEditorUIManager,\n  AnnotationLayer,\n  AnnotationMode,\n  build,\n  CMapCompressionType,\n  ColorPicker,\n  createValidAbsoluteUrl,\n  DOMSVGFactory,\n  DrawLayer,\n  FeatureTest,\n  fetchData,\n  getDocument,\n  getFilenameFromUrl,\n  getPdfFilenameFromUrl,\n  getXfaPageViewport,\n  GlobalWorkerOptions,\n  ImageKind,\n  InvalidPDFException,\n  isDataScheme,\n  isPdfFile,\n  MissingPDFException,\n  noContextMenu,\n  normalizeUnicode,\n  OPS,\n  Outliner,\n  PasswordResponses,\n  PDFDataRangeTransport,\n  PDFDateString,\n  PDFWorker,\n  PermissionFlag,\n  PixelsPerInch,\n  PromiseCapability,\n  RenderingCancelledException,\n  renderTextLayer,\n  setLayerDimensions,\n  shadow,\n  UnexpectedResponseException,\n  updateTextLayer,\n  Util,\n  VerbosityLevel,\n  version,\n  XfaLayer,\n};\n", "/* Copyright 2018 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  AbortException,\n  assert,\n  MissingPDFException,\n  PasswordException,\n  PromiseCapability,\n  UnexpectedResponseException,\n  UnknownErrorException,\n  unreachable,\n} from \"./util.js\";\n\nconst CallbackKind = {\n  UNKNOWN: 0,\n  DATA: 1,\n  ERROR: 2,\n};\n\nconst StreamKind = {\n  UNKNOWN: 0,\n  CANCEL: 1,\n  CANCEL_COMPLETE: 2,\n  CLOSE: 3,\n  ENQUEUE: 4,\n  ERROR: 5,\n  PULL: 6,\n  PULL_COMPLETE: 7,\n  START_COMPLETE: 8,\n};\n\nfunction wrapReason(reason) {\n  if (\n    !(\n      reason instanceof Error ||\n      (typeof reason === \"object\" && reason !== null)\n    )\n  ) {\n    unreachable(\n      'wrapReason: Expected \"reason\" to be a (possibly cloned) Error.'\n    );\n  }\n  switch (reason.name) {\n    case \"AbortException\":\n      return new AbortException(reason.message);\n    case \"MissingPDFException\":\n      return new MissingPDFException(reason.message);\n    case \"PasswordException\":\n      return new PasswordException(reason.message, reason.code);\n    case \"UnexpectedResponseException\":\n      return new UnexpectedResponseException(reason.message, reason.status);\n    case \"UnknownErrorException\":\n      return new UnknownErrorException(reason.message, reason.details);\n    default:\n      return new UnknownErrorException(reason.message, reason.toString());\n  }\n}\n\nclass MessageHandler {\n  constructor(sourceName, targetName, comObj) {\n    this.sourceName = sourceName;\n    this.targetName = targetName;\n    this.comObj = comObj;\n    this.callbackId = 1;\n    this.streamId = 1;\n    this.streamSinks = Object.create(null);\n    this.streamControllers = Object.create(null);\n    this.callbackCapabilities = Object.create(null);\n    this.actionHandler = Object.create(null);\n\n    this._onComObjOnMessage = event => {\n      const data = event.data;\n      if (data.targetName !== this.sourceName) {\n        return;\n      }\n      if (data.stream) {\n        this.#processStreamMessage(data);\n        return;\n      }\n      if (data.callback) {\n        const callbackId = data.callbackId;\n        const capability = this.callbackCapabilities[callbackId];\n        if (!capability) {\n          throw new Error(`Cannot resolve callback ${callbackId}`);\n        }\n        delete this.callbackCapabilities[callbackId];\n\n        if (data.callback === CallbackKind.DATA) {\n          capability.resolve(data.data);\n        } else if (data.callback === CallbackKind.ERROR) {\n          capability.reject(wrapReason(data.reason));\n        } else {\n          throw new Error(\"Unexpected callback case\");\n        }\n        return;\n      }\n      const action = this.actionHandler[data.action];\n      if (!action) {\n        throw new Error(`Unknown action from worker: ${data.action}`);\n      }\n      if (data.callbackId) {\n        const cbSourceName = this.sourceName;\n        const cbTargetName = data.sourceName;\n\n        new Promise(function (resolve) {\n          resolve(action(data.data));\n        }).then(\n          function (result) {\n            comObj.postMessage({\n              sourceName: cbSourceName,\n              targetName: cbTargetName,\n              callback: CallbackKind.DATA,\n              callbackId: data.callbackId,\n              data: result,\n            });\n          },\n          function (reason) {\n            comObj.postMessage({\n              sourceName: cbSourceName,\n              targetName: cbTargetName,\n              callback: CallbackKind.ERROR,\n              callbackId: data.callbackId,\n              reason: wrapReason(reason),\n            });\n          }\n        );\n        return;\n      }\n      if (data.streamId) {\n        this.#createStreamSink(data);\n        return;\n      }\n      action(data.data);\n    };\n    comObj.addEventListener(\"message\", this._onComObjOnMessage);\n  }\n\n  on(actionName, handler) {\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      assert(\n        typeof handler === \"function\",\n        'MessageHandler.on: Expected \"handler\" to be a function.'\n      );\n    }\n    const ah = this.actionHandler;\n    if (ah[actionName]) {\n      throw new Error(`There is already an actionName called \"${actionName}\"`);\n    }\n    ah[actionName] = handler;\n  }\n\n  /**\n   * Sends a message to the comObj to invoke the action with the supplied data.\n   * @param {string} actionName - Action to call.\n   * @param {JSON} data - JSON data to send.\n   * @param {Array} [transfers] - List of transfers/ArrayBuffers.\n   */\n  send(actionName, data, transfers) {\n    this.comObj.postMessage(\n      {\n        sourceName: this.sourceName,\n        targetName: this.targetName,\n        action: actionName,\n        data,\n      },\n      transfers\n    );\n  }\n\n  /**\n   * Sends a message to the comObj to invoke the action with the supplied data.\n   * Expects that the other side will callback with the response.\n   * @param {string} actionName - Action to call.\n   * @param {JSON} data - JSON data to send.\n   * @param {Array} [transfers] - List of transfers/ArrayBuffers.\n   * @returns {Promise} Promise to be resolved with response data.\n   */\n  sendWithPromise(actionName, data, transfers) {\n    const callbackId = this.callbackId++;\n    const capability = new PromiseCapability();\n    this.callbackCapabilities[callbackId] = capability;\n    try {\n      this.comObj.postMessage(\n        {\n          sourceName: this.sourceName,\n          targetName: this.targetName,\n          action: actionName,\n          callbackId,\n          data,\n        },\n        transfers\n      );\n    } catch (ex) {\n      capability.reject(ex);\n    }\n    return capability.promise;\n  }\n\n  /**\n   * Sends a message to the comObj to invoke the action with the supplied data.\n   * Expect that the other side will callback to signal 'start_complete'.\n   * @param {string} actionName - Action to call.\n   * @param {JSON} data - JSON data to send.\n   * @param {Object} queueingStrategy - Strategy to signal backpressure based on\n   *                 internal queue.\n   * @param {Array} [transfers] - List of transfers/ArrayBuffers.\n   * @returns {ReadableStream} ReadableStream to read data in chunks.\n   */\n  sendWithStream(actionName, data, queueingStrategy, transfers) {\n    const streamId = this.streamId++,\n      sourceName = this.sourceName,\n      targetName = this.targetName,\n      comObj = this.comObj;\n\n    return new ReadableStream(\n      {\n        start: controller => {\n          const startCapability = new PromiseCapability();\n          this.streamControllers[streamId] = {\n            controller,\n            startCall: startCapability,\n            pullCall: null,\n            cancelCall: null,\n            isClosed: false,\n          };\n          comObj.postMessage(\n            {\n              sourceName,\n              targetName,\n              action: actionName,\n              streamId,\n              data,\n              desiredSize: controller.desiredSize,\n            },\n            transfers\n          );\n          // Return Promise for Async process, to signal success/failure.\n          return startCapability.promise;\n        },\n\n        pull: controller => {\n          const pullCapability = new PromiseCapability();\n          this.streamControllers[streamId].pullCall = pullCapability;\n          comObj.postMessage({\n            sourceName,\n            targetName,\n            stream: StreamKind.PULL,\n            streamId,\n            desiredSize: controller.desiredSize,\n          });\n          // Returning Promise will not call \"pull\"\n          // again until current pull is resolved.\n          return pullCapability.promise;\n        },\n\n        cancel: reason => {\n          assert(reason instanceof Error, \"cancel must have a valid reason\");\n          const cancelCapability = new PromiseCapability();\n          this.streamControllers[streamId].cancelCall = cancelCapability;\n          this.streamControllers[streamId].isClosed = true;\n          comObj.postMessage({\n            sourceName,\n            targetName,\n            stream: StreamKind.CANCEL,\n            streamId,\n            reason: wrapReason(reason),\n          });\n          // Return Promise to signal success or failure.\n          return cancelCapability.promise;\n        },\n      },\n      queueingStrategy\n    );\n  }\n\n  #createStreamSink(data) {\n    const streamId = data.streamId,\n      sourceName = this.sourceName,\n      targetName = data.sourceName,\n      comObj = this.comObj;\n    const self = this,\n      action = this.actionHandler[data.action];\n\n    const streamSink = {\n      enqueue(chunk, size = 1, transfers) {\n        if (this.isCancelled) {\n          return;\n        }\n        const lastDesiredSize = this.desiredSize;\n        this.desiredSize -= size;\n        // Enqueue decreases the desiredSize property of sink,\n        // so when it changes from positive to negative,\n        // set ready as unresolved promise.\n        if (lastDesiredSize > 0 && this.desiredSize <= 0) {\n          this.sinkCapability = new PromiseCapability();\n          this.ready = this.sinkCapability.promise;\n        }\n        comObj.postMessage(\n          {\n            sourceName,\n            targetName,\n            stream: StreamKind.ENQUEUE,\n            streamId,\n            chunk,\n          },\n          transfers\n        );\n      },\n\n      close() {\n        if (this.isCancelled) {\n          return;\n        }\n        this.isCancelled = true;\n        comObj.postMessage({\n          sourceName,\n          targetName,\n          stream: StreamKind.CLOSE,\n          streamId,\n        });\n        delete self.streamSinks[streamId];\n      },\n\n      error(reason) {\n        assert(reason instanceof Error, \"error must have a valid reason\");\n        if (this.isCancelled) {\n          return;\n        }\n        this.isCancelled = true;\n        comObj.postMessage({\n          sourceName,\n          targetName,\n          stream: StreamKind.ERROR,\n          streamId,\n          reason: wrapReason(reason),\n        });\n      },\n\n      sinkCapability: new PromiseCapability(),\n      onPull: null,\n      onCancel: null,\n      isCancelled: false,\n      desiredSize: data.desiredSize,\n      ready: null,\n    };\n\n    streamSink.sinkCapability.resolve();\n    streamSink.ready = streamSink.sinkCapability.promise;\n    this.streamSinks[streamId] = streamSink;\n\n    new Promise(function (resolve) {\n      resolve(action(data.data, streamSink));\n    }).then(\n      function () {\n        comObj.postMessage({\n          sourceName,\n          targetName,\n          stream: StreamKind.START_COMPLETE,\n          streamId,\n          success: true,\n        });\n      },\n      function (reason) {\n        comObj.postMessage({\n          sourceName,\n          targetName,\n          stream: StreamKind.START_COMPLETE,\n          streamId,\n          reason: wrapReason(reason),\n        });\n      }\n    );\n  }\n\n  #processStreamMessage(data) {\n    const streamId = data.streamId,\n      sourceName = this.sourceName,\n      targetName = data.sourceName,\n      comObj = this.comObj;\n    const streamController = this.streamControllers[streamId],\n      streamSink = this.streamSinks[streamId];\n\n    switch (data.stream) {\n      case StreamKind.START_COMPLETE:\n        if (data.success) {\n          streamController.startCall.resolve();\n        } else {\n          streamController.startCall.reject(wrapReason(data.reason));\n        }\n        break;\n      case StreamKind.PULL_COMPLETE:\n        if (data.success) {\n          streamController.pullCall.resolve();\n        } else {\n          streamController.pullCall.reject(wrapReason(data.reason));\n        }\n        break;\n      case StreamKind.PULL:\n        // Ignore any pull after close is called.\n        if (!streamSink) {\n          comObj.postMessage({\n            sourceName,\n            targetName,\n            stream: StreamKind.PULL_COMPLETE,\n            streamId,\n            success: true,\n          });\n          break;\n        }\n        // Pull increases the desiredSize property of sink, so when it changes\n        // from negative to positive, set ready property as resolved promise.\n        if (streamSink.desiredSize <= 0 && data.desiredSize > 0) {\n          streamSink.sinkCapability.resolve();\n        }\n        // Reset desiredSize property of sink on every pull.\n        streamSink.desiredSize = data.desiredSize;\n\n        new Promise(function (resolve) {\n          resolve(streamSink.onPull?.());\n        }).then(\n          function () {\n            comObj.postMessage({\n              sourceName,\n              targetName,\n              stream: StreamKind.PULL_COMPLETE,\n              streamId,\n              success: true,\n            });\n          },\n          function (reason) {\n            comObj.postMessage({\n              sourceName,\n              targetName,\n              stream: StreamKind.PULL_COMPLETE,\n              streamId,\n              reason: wrapReason(reason),\n            });\n          }\n        );\n        break;\n      case StreamKind.ENQUEUE:\n        assert(streamController, \"enqueue should have stream controller\");\n        if (streamController.isClosed) {\n          break;\n        }\n        streamController.controller.enqueue(data.chunk);\n        break;\n      case StreamKind.CLOSE:\n        assert(streamController, \"close should have stream controller\");\n        if (streamController.isClosed) {\n          break;\n        }\n        streamController.isClosed = true;\n        streamController.controller.close();\n        this.#deleteStreamController(streamController, streamId);\n        break;\n      case StreamKind.ERROR:\n        assert(streamController, \"error should have stream controller\");\n        streamController.controller.error(wrapReason(data.reason));\n        this.#deleteStreamController(streamController, streamId);\n        break;\n      case StreamKind.CANCEL_COMPLETE:\n        if (data.success) {\n          streamController.cancelCall.resolve();\n        } else {\n          streamController.cancelCall.reject(wrapReason(data.reason));\n        }\n        this.#deleteStreamController(streamController, streamId);\n        break;\n      case StreamKind.CANCEL:\n        if (!streamSink) {\n          break;\n        }\n\n        new Promise(function (resolve) {\n          resolve(streamSink.onCancel?.(wrapReason(data.reason)));\n        }).then(\n          function () {\n            comObj.postMessage({\n              sourceName,\n              targetName,\n              stream: StreamKind.CANCEL_COMPLETE,\n              streamId,\n              success: true,\n            });\n          },\n          function (reason) {\n            comObj.postMessage({\n              sourceName,\n              targetName,\n              stream: StreamKind.CANCEL_COMPLETE,\n              streamId,\n              reason: wrapReason(reason),\n            });\n          }\n        );\n        streamSink.sinkCapability.reject(wrapReason(data.reason));\n        streamSink.isCancelled = true;\n        delete this.streamSinks[streamId];\n        break;\n      default:\n        throw new Error(\"Unexpected stream case\");\n    }\n  }\n\n  async #deleteStreamController(streamController, streamId) {\n    // Delete the `streamController` only when the start, pull, and cancel\n    // capabilities have settled, to prevent `TypeError`s.\n    await Promise.allSettled([\n      streamController.startCall?.promise,\n      streamController.pullCall?.promise,\n      streamController.cancelCall?.promise,\n    ]);\n    delete this.streamControllers[streamId];\n  }\n\n  destroy() {\n    this.comObj.removeEventListener(\"message\", this._onComObjOnMessage);\n  }\n}\n\nexport { MessageHandler };\n", "/* Copyright 2014 Opera Software ASA\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n *\n * Based on https://code.google.com/p/smhasher/wiki/MurmurHash3.\n * Hashes roughly 100 KB per millisecond on i7 3.4 GHz.\n */\n\nimport { isArrayBuffer } from \"./util.js\";\n\nconst SEED = 0xc3d2e1f0;\n// Workaround for missing math precision in JS.\nconst MASK_HIGH = 0xffff0000;\nconst MASK_LOW = 0xffff;\n\nclass MurmurHash3_64 {\n  constructor(seed) {\n    this.h1 = seed ? seed & 0xffffffff : SEED;\n    this.h2 = seed ? seed & 0xffffffff : SEED;\n  }\n\n  update(input) {\n    let data, length;\n    if (typeof input === \"string\") {\n      data = new Uint8Array(input.length * 2);\n      length = 0;\n      for (let i = 0, ii = input.length; i < ii; i++) {\n        const code = input.charCodeAt(i);\n        if (code <= 0xff) {\n          data[length++] = code;\n        } else {\n          data[length++] = code >>> 8;\n          data[length++] = code & 0xff;\n        }\n      }\n    } else if (isArrayBuffer(input)) {\n      data = input.slice();\n      length = data.byteLength;\n    } else {\n      throw new Error(\n        \"Wrong data format in MurmurHash3_64_update. \" +\n          \"Input must be a string or array.\"\n      );\n    }\n\n    const blockCounts = length >> 2;\n    const tailLength = length - blockCounts * 4;\n    // We don't care about endianness here.\n    const dataUint32 = new Uint32Array(data.buffer, 0, blockCounts);\n    let k1 = 0,\n      k2 = 0;\n    let h1 = this.h1,\n      h2 = this.h2;\n    const C1 = 0xcc9e2d51,\n      C2 = 0x1b873593;\n    const C1_LOW = C1 & MASK_LOW,\n      C2_LOW = C2 & MASK_LOW;\n\n    for (let i = 0; i < blockCounts; i++) {\n      if (i & 1) {\n        k1 = dataUint32[i];\n        k1 = ((k1 * C1) & MASK_HIGH) | ((k1 * C1_LOW) & MASK_LOW);\n        k1 = (k1 << 15) | (k1 >>> 17);\n        k1 = ((k1 * C2) & MASK_HIGH) | ((k1 * C2_LOW) & MASK_LOW);\n        h1 ^= k1;\n        h1 = (h1 << 13) | (h1 >>> 19);\n        h1 = h1 * 5 + 0xe6546b64;\n      } else {\n        k2 = dataUint32[i];\n        k2 = ((k2 * C1) & MASK_HIGH) | ((k2 * C1_LOW) & MASK_LOW);\n        k2 = (k2 << 15) | (k2 >>> 17);\n        k2 = ((k2 * C2) & MASK_HIGH) | ((k2 * C2_LOW) & MASK_LOW);\n        h2 ^= k2;\n        h2 = (h2 << 13) | (h2 >>> 19);\n        h2 = h2 * 5 + 0xe6546b64;\n      }\n    }\n\n    k1 = 0;\n\n    switch (tailLength) {\n      case 3:\n        k1 ^= data[blockCounts * 4 + 2] << 16;\n      /* falls through */\n      case 2:\n        k1 ^= data[blockCounts * 4 + 1] << 8;\n      /* falls through */\n      case 1:\n        k1 ^= data[blockCounts * 4];\n        /* falls through */\n\n        k1 = ((k1 * C1) & MASK_HIGH) | ((k1 * C1_LOW) & MASK_LOW);\n        k1 = (k1 << 15) | (k1 >>> 17);\n        k1 = ((k1 * C2) & MASK_HIGH) | ((k1 * C2_LOW) & MASK_LOW);\n        if (blockCounts & 1) {\n          h1 ^= k1;\n        } else {\n          h2 ^= k1;\n        }\n    }\n\n    this.h1 = h1;\n    this.h2 = h2;\n  }\n\n  hexdigest() {\n    let h1 = this.h1,\n      h2 = this.h2;\n\n    h1 ^= h2 >>> 1;\n    h1 = ((h1 * 0xed558ccd) & MASK_HIGH) | ((h1 * 0x8ccd) & MASK_LOW);\n    h2 =\n      ((h2 * 0xff51afd7) & MASK_HIGH) |\n      (((((h2 << 16) | (h1 >>> 16)) * 0xafd7ed55) & MASK_HIGH) >>> 16);\n    h1 ^= h2 >>> 1;\n    h1 = ((h1 * 0x1a85ec53) & MASK_HIGH) | ((h1 * 0xec53) & MASK_LOW);\n    h2 =\n      ((h2 * 0xc4ceb9fe) & MASK_HIGH) |\n      (((((h2 << 16) | (h1 >>> 16)) * 0xb9fe1a85) & MASK_HIGH) >>> 16);\n    h1 ^= h2 >>> 1;\n\n    return (\n      (h1 >>> 0).toString(16).padStart(8, \"0\") +\n      (h2 >>> 0).toString(16).padStart(8, \"0\")\n    );\n  }\n}\n\nexport { MurmurHash3_64 };\n", "/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/* globals process */\n\n// NW.js / Electron is a browser context, but copies some Node.js objects; see\n// http://docs.nwjs.io/en/latest/For%20Users/Advanced/JavaScript%20Contexts%20in%20NW.js/#access-nodejs-and-nwjs-api-in-browser-context\n// https://www.electronjs.org/docs/api/process#processversionselectron-readonly\n// https://www.electronjs.org/docs/api/process#processtype-readonly\nconst isNodeJS =\n  (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) &&\n  typeof process === \"object\" &&\n  process + \"\" === \"[object process]\" &&\n  !process.versions.nw &&\n  !(process.versions.electron && process.type && process.type !== \"browser\");\n\nconst IDENTITY_MATRIX = [1, 0, 0, 1, 0, 0];\nconst FONT_IDENTITY_MATRIX = [0.001, 0, 0, 0.001, 0, 0];\n\nconst MAX_IMAGE_SIZE_TO_CACHE = 10e6; // Ten megabytes.\n\n// Represent the percentage of the height of a single-line field over\n// the font size. Acrobat seems to use this value.\nconst LINE_FACTOR = 1.35;\nconst LINE_DESCENT_FACTOR = 0.35;\nconst BASELINE_FACTOR = LINE_DESCENT_FACTOR / LINE_FACTOR;\n\n/**\n * Refer to the `WorkerTransport.getRenderingIntent`-method in the API, to see\n * how these flags are being used:\n *  - ANY, DISPLAY, and PRINT are the normal rendering intents, note the\n *    `PDFPageProxy.{render, getOperatorList, getAnnotations}`-methods.\n *  - ANNOTATIONS_FORMS, ANNOTATIONS_STORAGE, ANNOTATIONS_DISABLE control which\n *    annotations are rendered onto the canvas (i.e. by being included in the\n *    operatorList), note the `PDFPageProxy.{render, getOperatorList}`-methods\n *    and their `annotationMode`-option.\n *  - OPLIST is used with the `PDFPageProxy.getOperatorList`-method, note the\n *    `OperatorList`-constructor (on the worker-thread).\n */\nconst RenderingIntentFlag = {\n  ANY: 0x01,\n  DISPLAY: 0x02,\n  PRINT: 0x04,\n  SAVE: 0x08,\n  ANNOTATIONS_FORMS: 0x10,\n  ANNOTATIONS_STORAGE: 0x20,\n  ANNOTATIONS_DISABLE: 0x40,\n  OPLIST: 0x100,\n};\n\nconst AnnotationMode = {\n  DISABLE: 0,\n  ENABLE: 1,\n  ENABLE_FORMS: 2,\n  ENABLE_STORAGE: 3,\n};\n\nconst AnnotationEditorPrefix = \"pdfjs_internal_editor_\";\n\nconst AnnotationEditorType = {\n  DISABLE: -1,\n  NONE: 0,\n  FREETEXT: 3,\n  HIGHLIGHT: 9,\n  STAMP: 13,\n  INK: 15,\n};\n\nconst AnnotationEditorParamsType = {\n  RESIZE: 1,\n  CREATE: 2,\n  FREETEXT_SIZE: 11,\n  FREETEXT_COLOR: 12,\n  FREETEXT_OPACITY: 13,\n  INK_COLOR: 21,\n  INK_THICKNESS: 22,\n  INK_OPACITY: 23,\n  HIGHLIGHT_COLOR: 31,\n  HIGHLIGHT_DEFAULT_COLOR: 32,\n};\n\n// Permission flags from Table 22, Section 7.6.3.2 of the PDF specification.\nconst PermissionFlag = {\n  PRINT: 0x04,\n  MODIFY_CONTENTS: 0x08,\n  COPY: 0x10,\n  MODIFY_ANNOTATIONS: 0x20,\n  FILL_INTERACTIVE_FORMS: 0x100,\n  COPY_FOR_ACCESSIBILITY: 0x200,\n  ASSEMBLE: 0x400,\n  PRINT_HIGH_QUALITY: 0x800,\n};\n\nconst TextRenderingMode = {\n  FILL: 0,\n  STROKE: 1,\n  FILL_STROKE: 2,\n  INVISIBLE: 3,\n  FILL_ADD_TO_PATH: 4,\n  STROKE_ADD_TO_PATH: 5,\n  FILL_STROKE_ADD_TO_PATH: 6,\n  ADD_TO_PATH: 7,\n  FILL_STROKE_MASK: 3,\n  ADD_TO_PATH_FLAG: 4,\n};\n\nconst ImageKind = {\n  GRAYSCALE_1BPP: 1,\n  RGB_24BPP: 2,\n  RGBA_32BPP: 3,\n};\n\nconst AnnotationType = {\n  TEXT: 1,\n  LINK: 2,\n  FREETEXT: 3,\n  LINE: 4,\n  SQUARE: 5,\n  CIRCLE: 6,\n  POLYGON: 7,\n  POLYLINE: 8,\n  HIGHLIGHT: 9,\n  UNDERLINE: 10,\n  SQUIGGLY: 11,\n  STRIKEOUT: 12,\n  STAMP: 13,\n  CARET: 14,\n  INK: 15,\n  POPUP: 16,\n  FILEATTACHMENT: 17,\n  SOUND: 18,\n  MOVIE: 19,\n  WIDGET: 20,\n  SCREEN: 21,\n  PRINTERMARK: 22,\n  TRAPNET: 23,\n  WATERMARK: 24,\n  THREED: 25,\n  REDACT: 26,\n};\n\nconst AnnotationReplyType = {\n  GROUP: \"Group\",\n  REPLY: \"R\",\n};\n\nconst AnnotationFlag = {\n  INVISIBLE: 0x01,\n  HIDDEN: 0x02,\n  PRINT: 0x04,\n  NOZOOM: 0x08,\n  NOROTATE: 0x10,\n  NOVIEW: 0x20,\n  READONLY: 0x40,\n  LOCKED: 0x80,\n  TOGGLENOVIEW: 0x100,\n  LOCKEDCONTENTS: 0x200,\n};\n\nconst AnnotationFieldFlag = {\n  READONLY: 0x0000001,\n  REQUIRED: 0x0000002,\n  NOEXPORT: 0x0000004,\n  MULTILINE: 0x0001000,\n  PASSWORD: 0x0002000,\n  NOTOGGLETOOFF: 0x0004000,\n  RADIO: 0x0008000,\n  PUSHBUTTON: 0x0010000,\n  COMBO: 0x0020000,\n  EDIT: 0x0040000,\n  SORT: 0x0080000,\n  FILESELECT: 0x0100000,\n  MULTISELECT: 0x0200000,\n  DONOTSPELLCHECK: 0x0400000,\n  DONOTSCROLL: 0x0800000,\n  COMB: 0x1000000,\n  RICHTEXT: 0x2000000,\n  RADIOSINUNISON: 0x2000000,\n  COMMITONSELCHANGE: 0x4000000,\n};\n\nconst AnnotationBorderStyleType = {\n  SOLID: 1,\n  DASHED: 2,\n  BEVELED: 3,\n  INSET: 4,\n  UNDERLINE: 5,\n};\n\nconst AnnotationActionEventType = {\n  E: \"Mouse Enter\",\n  X: \"Mouse Exit\",\n  D: \"Mouse Down\",\n  U: \"Mouse Up\",\n  Fo: \"Focus\",\n  Bl: \"Blur\",\n  PO: \"PageOpen\",\n  PC: \"PageClose\",\n  PV: \"PageVisible\",\n  PI: \"PageInvisible\",\n  K: \"Keystroke\",\n  F: \"Format\",\n  V: \"Validate\",\n  C: \"Calculate\",\n};\n\nconst DocumentActionEventType = {\n  WC: \"WillClose\",\n  WS: \"WillSave\",\n  DS: \"DidSave\",\n  WP: \"WillPrint\",\n  DP: \"DidPrint\",\n};\n\nconst PageActionEventType = {\n  O: \"PageOpen\",\n  C: \"PageClose\",\n};\n\nconst VerbosityLevel = {\n  ERRORS: 0,\n  WARNINGS: 1,\n  INFOS: 5,\n};\n\nconst CMapCompressionType = {\n  NONE: 0,\n  BINARY: 1,\n};\n\n// All the possible operations for an operator list.\nconst OPS = {\n  // Intentionally start from 1 so it is easy to spot bad operators that will be\n  // 0's.\n  // PLEASE NOTE: We purposely keep any removed operators commented out, since\n  //              re-numbering the list would risk breaking third-party users.\n  dependency: 1,\n  setLineWidth: 2,\n  setLineCap: 3,\n  setLineJoin: 4,\n  setMiterLimit: 5,\n  setDash: 6,\n  setRenderingIntent: 7,\n  setFlatness: 8,\n  setGState: 9,\n  save: 10,\n  restore: 11,\n  transform: 12,\n  moveTo: 13,\n  lineTo: 14,\n  curveTo: 15,\n  curveTo2: 16,\n  curveTo3: 17,\n  closePath: 18,\n  rectangle: 19,\n  stroke: 20,\n  closeStroke: 21,\n  fill: 22,\n  eoFill: 23,\n  fillStroke: 24,\n  eoFillStroke: 25,\n  closeFillStroke: 26,\n  closeEOFillStroke: 27,\n  endPath: 28,\n  clip: 29,\n  eoClip: 30,\n  beginText: 31,\n  endText: 32,\n  setCharSpacing: 33,\n  setWordSpacing: 34,\n  setHScale: 35,\n  setLeading: 36,\n  setFont: 37,\n  setTextRenderingMode: 38,\n  setTextRise: 39,\n  moveText: 40,\n  setLeadingMoveText: 41,\n  setTextMatrix: 42,\n  nextLine: 43,\n  showText: 44,\n  showSpacedText: 45,\n  nextLineShowText: 46,\n  nextLineSetSpacingShowText: 47,\n  setCharWidth: 48,\n  setCharWidthAndBounds: 49,\n  setStrokeColorSpace: 50,\n  setFillColorSpace: 51,\n  setStrokeColor: 52,\n  setStrokeColorN: 53,\n  setFillColor: 54,\n  setFillColorN: 55,\n  setStrokeGray: 56,\n  setFillGray: 57,\n  setStrokeRGBColor: 58,\n  setFillRGBColor: 59,\n  setStrokeCMYKColor: 60,\n  setFillCMYKColor: 61,\n  shadingFill: 62,\n  beginInlineImage: 63,\n  beginImageData: 64,\n  endInlineImage: 65,\n  paintXObject: 66,\n  markPoint: 67,\n  markPointProps: 68,\n  beginMarkedContent: 69,\n  beginMarkedContentProps: 70,\n  endMarkedContent: 71,\n  beginCompat: 72,\n  endCompat: 73,\n  paintFormXObjectBegin: 74,\n  paintFormXObjectEnd: 75,\n  beginGroup: 76,\n  endGroup: 77,\n  // beginAnnotations: 78,\n  // endAnnotations: 79,\n  beginAnnotation: 80,\n  endAnnotation: 81,\n  // paintJpegXObject: 82,\n  paintImageMaskXObject: 83,\n  paintImageMaskXObjectGroup: 84,\n  paintImageXObject: 85,\n  paintInlineImageXObject: 86,\n  paintInlineImageXObjectGroup: 87,\n  paintImageXObjectRepeat: 88,\n  paintImageMaskXObjectRepeat: 89,\n  paintSolidColorImageMask: 90,\n  constructPath: 91,\n};\n\nconst PasswordResponses = {\n  NEED_PASSWORD: 1,\n  INCORRECT_PASSWORD: 2,\n};\n\nlet verbosity = VerbosityLevel.WARNINGS;\n\nfunction setVerbosityLevel(level) {\n  if (Number.isInteger(level)) {\n    verbosity = level;\n  }\n}\n\nfunction getVerbosityLevel() {\n  return verbosity;\n}\n\n// A notice for devs. These are good for things that are helpful to devs, such\n// as warning that Workers were disabled, which is important to devs but not\n// end users.\nfunction info(msg) {\n  if (verbosity >= VerbosityLevel.INFOS) {\n    console.log(`Info: ${msg}`);\n  }\n}\n\n// Non-fatal warnings.\nfunction warn(msg) {\n  if (verbosity >= VerbosityLevel.WARNINGS) {\n    console.log(`Warning: ${msg}`);\n  }\n}\n\nfunction unreachable(msg) {\n  throw new Error(msg);\n}\n\nfunction assert(cond, msg) {\n  if (!cond) {\n    unreachable(msg);\n  }\n}\n\n// Checks if URLs use one of the allowed protocols, e.g. to avoid XSS.\nfunction _isValidProtocol(url) {\n  switch (url?.protocol) {\n    case \"http:\":\n    case \"https:\":\n    case \"ftp:\":\n    case \"mailto:\":\n    case \"tel:\":\n      return true;\n    default:\n      return false;\n  }\n}\n\n/**\n * Attempts to create a valid absolute URL.\n *\n * @param {URL|string} url - An absolute, or relative, URL.\n * @param {URL|string} [baseUrl] - An absolute URL.\n * @param {Object} [options]\n * @returns Either a valid {URL}, or `null` otherwise.\n */\nfunction createValidAbsoluteUrl(url, baseUrl = null, options = null) {\n  if (!url) {\n    return null;\n  }\n  try {\n    if (options && typeof url === \"string\") {\n      // Let URLs beginning with \"www.\" default to using the \"http://\" protocol.\n      if (options.addDefaultProtocol && url.startsWith(\"www.\")) {\n        const dots = url.match(/\\./g);\n        // Avoid accidentally matching a *relative* URL pointing to a file named\n        // e.g. \"www.pdf\" or similar.\n        if (dots?.length >= 2) {\n          url = `http://${url}`;\n        }\n      }\n\n      // According to ISO 32000-1:2008, section 12.6.4.7, URIs should be encoded\n      // in 7-bit ASCII. Some bad PDFs use UTF-8 encoding; see bug 1122280.\n      if (options.tryConvertEncoding) {\n        try {\n          url = stringToUTF8String(url);\n        } catch {}\n      }\n    }\n\n    const absoluteUrl = baseUrl ? new URL(url, baseUrl) : new URL(url);\n    if (_isValidProtocol(absoluteUrl)) {\n      return absoluteUrl;\n    }\n  } catch {\n    /* `new URL()` will throw on incorrect data. */\n  }\n  return null;\n}\n\nfunction shadow(obj, prop, value, nonSerializable = false) {\n  if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n    assert(\n      prop in obj,\n      `shadow: Property \"${prop && prop.toString()}\" not found in object.`\n    );\n  }\n  Object.defineProperty(obj, prop, {\n    value,\n    enumerable: !nonSerializable,\n    configurable: true,\n    writable: false,\n  });\n  return value;\n}\n\n/**\n * @type {any}\n */\nconst BaseException = (function BaseExceptionClosure() {\n  // eslint-disable-next-line no-shadow\n  function BaseException(message, name) {\n    if (this.constructor === BaseException) {\n      unreachable(\"Cannot initialize BaseException.\");\n    }\n    this.message = message;\n    this.name = name;\n  }\n  BaseException.prototype = new Error();\n  BaseException.constructor = BaseException;\n\n  return BaseException;\n})();\n\nclass PasswordException extends BaseException {\n  constructor(msg, code) {\n    super(msg, \"PasswordException\");\n    this.code = code;\n  }\n}\n\nclass UnknownErrorException extends BaseException {\n  constructor(msg, details) {\n    super(msg, \"UnknownErrorException\");\n    this.details = details;\n  }\n}\n\nclass InvalidPDFException extends BaseException {\n  constructor(msg) {\n    super(msg, \"InvalidPDFException\");\n  }\n}\n\nclass MissingPDFException extends BaseException {\n  constructor(msg) {\n    super(msg, \"MissingPDFException\");\n  }\n}\n\nclass UnexpectedResponseException extends BaseException {\n  constructor(msg, status) {\n    super(msg, \"UnexpectedResponseException\");\n    this.status = status;\n  }\n}\n\n/**\n * Error caused during parsing PDF data.\n */\nclass FormatError extends BaseException {\n  constructor(msg) {\n    super(msg, \"FormatError\");\n  }\n}\n\n/**\n * Error used to indicate task cancellation.\n */\nclass AbortException extends BaseException {\n  constructor(msg) {\n    super(msg, \"AbortException\");\n  }\n}\n\nfunction bytesToString(bytes) {\n  if (typeof bytes !== \"object\" || bytes?.length === undefined) {\n    unreachable(\"Invalid argument for bytesToString\");\n  }\n  const length = bytes.length;\n  const MAX_ARGUMENT_COUNT = 8192;\n  if (length < MAX_ARGUMENT_COUNT) {\n    return String.fromCharCode.apply(null, bytes);\n  }\n  const strBuf = [];\n  for (let i = 0; i < length; i += MAX_ARGUMENT_COUNT) {\n    const chunkEnd = Math.min(i + MAX_ARGUMENT_COUNT, length);\n    const chunk = bytes.subarray(i, chunkEnd);\n    strBuf.push(String.fromCharCode.apply(null, chunk));\n  }\n  return strBuf.join(\"\");\n}\n\nfunction stringToBytes(str) {\n  if (typeof str !== \"string\") {\n    unreachable(\"Invalid argument for stringToBytes\");\n  }\n  const length = str.length;\n  const bytes = new Uint8Array(length);\n  for (let i = 0; i < length; ++i) {\n    bytes[i] = str.charCodeAt(i) & 0xff;\n  }\n  return bytes;\n}\n\nfunction string32(value) {\n  if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n    assert(\n      typeof value === \"number\" && Math.abs(value) < 2 ** 32,\n      `string32: Unexpected input \"${value}\".`\n    );\n  }\n  return String.fromCharCode(\n    (value >> 24) & 0xff,\n    (value >> 16) & 0xff,\n    (value >> 8) & 0xff,\n    value & 0xff\n  );\n}\n\nfunction objectSize(obj) {\n  return Object.keys(obj).length;\n}\n\n// Ensure that the returned Object has a `null` prototype; hence why\n// `Object.fromEntries(...)` is not used.\nfunction objectFromMap(map) {\n  const obj = Object.create(null);\n  for (const [key, value] of map) {\n    obj[key] = value;\n  }\n  return obj;\n}\n\n// Checks the endianness of the platform.\nfunction isLittleEndian() {\n  const buffer8 = new Uint8Array(4);\n  buffer8[0] = 1;\n  const view32 = new Uint32Array(buffer8.buffer, 0, 1);\n  return view32[0] === 1;\n}\n\n// Checks if it's possible to eval JS expressions.\nfunction isEvalSupported() {\n  try {\n    new Function(\"\"); // eslint-disable-line no-new, no-new-func\n    return true;\n  } catch {\n    return false;\n  }\n}\n\nclass FeatureTest {\n  static get isLittleEndian() {\n    return shadow(this, \"isLittleEndian\", isLittleEndian());\n  }\n\n  static get isEvalSupported() {\n    return shadow(this, \"isEvalSupported\", isEvalSupported());\n  }\n\n  static get isOffscreenCanvasSupported() {\n    return shadow(\n      this,\n      \"isOffscreenCanvasSupported\",\n      typeof OffscreenCanvas !== \"undefined\"\n    );\n  }\n\n  static get platform() {\n    if (\n      (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) ||\n      (typeof navigator !== \"undefined\" &&\n        typeof navigator?.platform === \"string\")\n    ) {\n      return shadow(this, \"platform\", {\n        isMac: navigator.platform.includes(\"Mac\"),\n      });\n    }\n    return shadow(this, \"platform\", { isMac: false });\n  }\n\n  static get isCSSRoundSupported() {\n    return shadow(\n      this,\n      \"isCSSRoundSupported\",\n      globalThis.CSS?.supports?.(\"width: round(1.5px, 1px)\")\n    );\n  }\n}\n\nconst hexNumbers = [...Array(256).keys()].map(n =>\n  n.toString(16).padStart(2, \"0\")\n);\n\nclass Util {\n  static makeHexColor(r, g, b) {\n    return `#${hexNumbers[r]}${hexNumbers[g]}${hexNumbers[b]}`;\n  }\n\n  // Apply a scaling matrix to some min/max values.\n  // If a scaling factor is negative then min and max must be\n  // swaped.\n  static scaleMinMax(transform, minMax) {\n    let temp;\n    if (transform[0]) {\n      if (transform[0] < 0) {\n        temp = minMax[0];\n        minMax[0] = minMax[1];\n        minMax[1] = temp;\n      }\n      minMax[0] *= transform[0];\n      minMax[1] *= transform[0];\n\n      if (transform[3] < 0) {\n        temp = minMax[2];\n        minMax[2] = minMax[3];\n        minMax[3] = temp;\n      }\n      minMax[2] *= transform[3];\n      minMax[3] *= transform[3];\n    } else {\n      temp = minMax[0];\n      minMax[0] = minMax[2];\n      minMax[2] = temp;\n      temp = minMax[1];\n      minMax[1] = minMax[3];\n      minMax[3] = temp;\n\n      if (transform[1] < 0) {\n        temp = minMax[2];\n        minMax[2] = minMax[3];\n        minMax[3] = temp;\n      }\n      minMax[2] *= transform[1];\n      minMax[3] *= transform[1];\n\n      if (transform[2] < 0) {\n        temp = minMax[0];\n        minMax[0] = minMax[1];\n        minMax[1] = temp;\n      }\n      minMax[0] *= transform[2];\n      minMax[1] *= transform[2];\n    }\n    minMax[0] += transform[4];\n    minMax[1] += transform[4];\n    minMax[2] += transform[5];\n    minMax[3] += transform[5];\n  }\n\n  // Concatenates two transformation matrices together and returns the result.\n  static transform(m1, m2) {\n    return [\n      m1[0] * m2[0] + m1[2] * m2[1],\n      m1[1] * m2[0] + m1[3] * m2[1],\n      m1[0] * m2[2] + m1[2] * m2[3],\n      m1[1] * m2[2] + m1[3] * m2[3],\n      m1[0] * m2[4] + m1[2] * m2[5] + m1[4],\n      m1[1] * m2[4] + m1[3] * m2[5] + m1[5],\n    ];\n  }\n\n  // For 2d affine transforms\n  static applyTransform(p, m) {\n    const xt = p[0] * m[0] + p[1] * m[2] + m[4];\n    const yt = p[0] * m[1] + p[1] * m[3] + m[5];\n    return [xt, yt];\n  }\n\n  static applyInverseTransform(p, m) {\n    const d = m[0] * m[3] - m[1] * m[2];\n    const xt = (p[0] * m[3] - p[1] * m[2] + m[2] * m[5] - m[4] * m[3]) / d;\n    const yt = (-p[0] * m[1] + p[1] * m[0] + m[4] * m[1] - m[5] * m[0]) / d;\n    return [xt, yt];\n  }\n\n  // Applies the transform to the rectangle and finds the minimum axially\n  // aligned bounding box.\n  static getAxialAlignedBoundingBox(r, m) {\n    const p1 = this.applyTransform(r, m);\n    const p2 = this.applyTransform(r.slice(2, 4), m);\n    const p3 = this.applyTransform([r[0], r[3]], m);\n    const p4 = this.applyTransform([r[2], r[1]], m);\n    return [\n      Math.min(p1[0], p2[0], p3[0], p4[0]),\n      Math.min(p1[1], p2[1], p3[1], p4[1]),\n      Math.max(p1[0], p2[0], p3[0], p4[0]),\n      Math.max(p1[1], p2[1], p3[1], p4[1]),\n    ];\n  }\n\n  static inverseTransform(m) {\n    const d = m[0] * m[3] - m[1] * m[2];\n    return [\n      m[3] / d,\n      -m[1] / d,\n      -m[2] / d,\n      m[0] / d,\n      (m[2] * m[5] - m[4] * m[3]) / d,\n      (m[4] * m[1] - m[5] * m[0]) / d,\n    ];\n  }\n\n  // This calculation uses Singular Value Decomposition.\n  // The SVD can be represented with formula A = USV. We are interested in the\n  // matrix S here because it represents the scale values.\n  static singularValueDecompose2dScale(m) {\n    const transpose = [m[0], m[2], m[1], m[3]];\n\n    // Multiply matrix m with its transpose.\n    const a = m[0] * transpose[0] + m[1] * transpose[2];\n    const b = m[0] * transpose[1] + m[1] * transpose[3];\n    const c = m[2] * transpose[0] + m[3] * transpose[2];\n    const d = m[2] * transpose[1] + m[3] * transpose[3];\n\n    // Solve the second degree polynomial to get roots.\n    const first = (a + d) / 2;\n    const second = Math.sqrt((a + d) ** 2 - 4 * (a * d - c * b)) / 2;\n    const sx = first + second || 1;\n    const sy = first - second || 1;\n\n    // Scale values are the square roots of the eigenvalues.\n    return [Math.sqrt(sx), Math.sqrt(sy)];\n  }\n\n  // Normalize rectangle rect=[x1, y1, x2, y2] so that (x1,y1) < (x2,y2)\n  // For coordinate systems whose origin lies in the bottom-left, this\n  // means normalization to (BL,TR) ordering. For systems with origin in the\n  // top-left, this means (TL,BR) ordering.\n  static normalizeRect(rect) {\n    const r = rect.slice(0); // clone rect\n    if (rect[0] > rect[2]) {\n      r[0] = rect[2];\n      r[2] = rect[0];\n    }\n    if (rect[1] > rect[3]) {\n      r[1] = rect[3];\n      r[3] = rect[1];\n    }\n    return r;\n  }\n\n  // Returns a rectangle [x1, y1, x2, y2] corresponding to the\n  // intersection of rect1 and rect2. If no intersection, returns 'null'\n  // The rectangle coordinates of rect1, rect2 should be [x1, y1, x2, y2]\n  static intersect(rect1, rect2) {\n    const xLow = Math.max(\n      Math.min(rect1[0], rect1[2]),\n      Math.min(rect2[0], rect2[2])\n    );\n    const xHigh = Math.min(\n      Math.max(rect1[0], rect1[2]),\n      Math.max(rect2[0], rect2[2])\n    );\n    if (xLow > xHigh) {\n      return null;\n    }\n    const yLow = Math.max(\n      Math.min(rect1[1], rect1[3]),\n      Math.min(rect2[1], rect2[3])\n    );\n    const yHigh = Math.min(\n      Math.max(rect1[1], rect1[3]),\n      Math.max(rect2[1], rect2[3])\n    );\n    if (yLow > yHigh) {\n      return null;\n    }\n\n    return [xLow, yLow, xHigh, yHigh];\n  }\n\n  // From https://github.com/adobe-webplatform/Snap.svg/blob/b365287722a72526000ac4bfcf0ce4cac2faa015/src/path.js#L852\n  static bezierBoundingBox(x0, y0, x1, y1, x2, y2, x3, y3) {\n    const tvalues = [],\n      bounds = [[], []];\n    let a, b, c, t, t1, t2, b2ac, sqrtb2ac;\n    for (let i = 0; i < 2; ++i) {\n      if (i === 0) {\n        b = 6 * x0 - 12 * x1 + 6 * x2;\n        a = -3 * x0 + 9 * x1 - 9 * x2 + 3 * x3;\n        c = 3 * x1 - 3 * x0;\n      } else {\n        b = 6 * y0 - 12 * y1 + 6 * y2;\n        a = -3 * y0 + 9 * y1 - 9 * y2 + 3 * y3;\n        c = 3 * y1 - 3 * y0;\n      }\n      if (Math.abs(a) < 1e-12) {\n        if (Math.abs(b) < 1e-12) {\n          continue;\n        }\n        t = -c / b;\n        if (0 < t && t < 1) {\n          tvalues.push(t);\n        }\n        continue;\n      }\n      b2ac = b * b - 4 * c * a;\n      sqrtb2ac = Math.sqrt(b2ac);\n      if (b2ac < 0) {\n        continue;\n      }\n      t1 = (-b + sqrtb2ac) / (2 * a);\n      if (0 < t1 && t1 < 1) {\n        tvalues.push(t1);\n      }\n      t2 = (-b - sqrtb2ac) / (2 * a);\n      if (0 < t2 && t2 < 1) {\n        tvalues.push(t2);\n      }\n    }\n\n    let j = tvalues.length,\n      mt;\n    const jlen = j;\n    while (j--) {\n      t = tvalues[j];\n      mt = 1 - t;\n      bounds[0][j] =\n        mt * mt * mt * x0 +\n        3 * mt * mt * t * x1 +\n        3 * mt * t * t * x2 +\n        t * t * t * x3;\n      bounds[1][j] =\n        mt * mt * mt * y0 +\n        3 * mt * mt * t * y1 +\n        3 * mt * t * t * y2 +\n        t * t * t * y3;\n    }\n\n    bounds[0][jlen] = x0;\n    bounds[1][jlen] = y0;\n    bounds[0][jlen + 1] = x3;\n    bounds[1][jlen + 1] = y3;\n    bounds[0].length = bounds[1].length = jlen + 2;\n\n    return [\n      Math.min(...bounds[0]),\n      Math.min(...bounds[1]),\n      Math.max(...bounds[0]),\n      Math.max(...bounds[1]),\n    ];\n  }\n}\n\nconst PDFStringTranslateTable = [\n  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0x2d8,\n  0x2c7, 0x2c6, 0x2d9, 0x2dd, 0x2db, 0x2da, 0x2dc, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n  0, 0, 0, 0, 0, 0, 0, 0, 0x2022, 0x2020, 0x2021, 0x2026, 0x2014, 0x2013, 0x192,\n  0x2044, 0x2039, 0x203a, 0x2212, 0x2030, 0x201e, 0x201c, 0x201d, 0x2018,\n  0x2019, 0x201a, 0x2122, 0xfb01, 0xfb02, 0x141, 0x152, 0x160, 0x178, 0x17d,\n  0x131, 0x142, 0x153, 0x161, 0x17e, 0, 0x20ac,\n];\n\nfunction stringToPDFString(str) {\n  // See section 7.9.2.2 Text String Type.\n  // The string can contain some language codes bracketed with 0x0b,\n  // so we must remove them.\n  if (str[0] >= \"\\xEF\") {\n    let encoding;\n    if (str[0] === \"\\xFE\" && str[1] === \"\\xFF\") {\n      encoding = \"utf-16be\";\n      if (str.length % 2 === 1) {\n        str = str.slice(0, -1);\n      }\n    } else if (str[0] === \"\\xFF\" && str[1] === \"\\xFE\") {\n      encoding = \"utf-16le\";\n      if (str.length % 2 === 1) {\n        str = str.slice(0, -1);\n      }\n    } else if (str[0] === \"\\xEF\" && str[1] === \"\\xBB\" && str[2] === \"\\xBF\") {\n      encoding = \"utf-8\";\n    }\n\n    if (encoding) {\n      try {\n        const decoder = new TextDecoder(encoding, { fatal: true });\n        const buffer = stringToBytes(str);\n        const decoded = decoder.decode(buffer);\n        if (!decoded.includes(\"\\x1b\")) {\n          return decoded;\n        }\n        return decoded.replaceAll(/\\x1b[^\\x1b]*(?:\\x1b|$)/g, \"\");\n      } catch (ex) {\n        warn(`stringToPDFString: \"${ex}\".`);\n      }\n    }\n  }\n  // ISO Latin 1\n  const strBuf = [];\n  for (let i = 0, ii = str.length; i < ii; i++) {\n    const charCode = str.charCodeAt(i);\n    if (charCode === 0x1b) {\n      // eslint-disable-next-line no-empty\n      while (++i < ii && str.charCodeAt(i) !== 0x1b) {}\n      continue;\n    }\n    const code = PDFStringTranslateTable[charCode];\n    strBuf.push(code ? String.fromCharCode(code) : str.charAt(i));\n  }\n  return strBuf.join(\"\");\n}\n\nfunction stringToUTF8String(str) {\n  return decodeURIComponent(escape(str));\n}\n\nfunction utf8StringToString(str) {\n  return unescape(encodeURIComponent(str));\n}\n\nfunction isArrayBuffer(v) {\n  return typeof v === \"object\" && v?.byteLength !== undefined;\n}\n\nfunction isArrayEqual(arr1, arr2) {\n  if (arr1.length !== arr2.length) {\n    return false;\n  }\n  for (let i = 0, ii = arr1.length; i < ii; i++) {\n    if (arr1[i] !== arr2[i]) {\n      return false;\n    }\n  }\n  return true;\n}\n\nfunction getModificationDate(date = new Date()) {\n  const buffer = [\n    date.getUTCFullYear().toString(),\n    (date.getUTCMonth() + 1).toString().padStart(2, \"0\"),\n    date.getUTCDate().toString().padStart(2, \"0\"),\n    date.getUTCHours().toString().padStart(2, \"0\"),\n    date.getUTCMinutes().toString().padStart(2, \"0\"),\n    date.getUTCSeconds().toString().padStart(2, \"0\"),\n  ];\n\n  return buffer.join(\"\");\n}\n\nclass PromiseCapability {\n  #settled = false;\n\n  constructor() {\n    /**\n     * @type {Promise<any>} The Promise object.\n     */\n    this.promise = new Promise((resolve, reject) => {\n      /**\n       * @type {function} Fulfills the Promise.\n       */\n      this.resolve = data => {\n        this.#settled = true;\n        resolve(data);\n      };\n\n      /**\n       * @type {function} Rejects the Promise.\n       */\n      this.reject = reason => {\n        if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n          assert(reason instanceof Error, 'Expected valid \"reason\" argument.');\n        }\n        this.#settled = true;\n        reject(reason);\n      };\n    });\n  }\n\n  /**\n   * @type {boolean} If the Promise has been fulfilled/rejected.\n   */\n  get settled() {\n    return this.#settled;\n  }\n}\n\nlet NormalizeRegex = null;\nlet NormalizationMap = null;\nfunction normalizeUnicode(str) {\n  if (!NormalizeRegex) {\n    // In order to generate the following regex:\n    //  - create a PDF containing all the chars in the range 0000-FFFF with\n    //    a NFKC which is different of the char.\n    //  - copy and paste all those chars and get the ones where NFKC is\n    //    required.\n    // It appears that most the chars here contain some ligatures.\n    NormalizeRegex =\n      /([\\u00a0\\u00b5\\u037e\\u0eb3\\u2000-\\u200a\\u202f\\u2126\\ufb00-\\ufb04\\ufb06\\ufb20-\\ufb36\\ufb38-\\ufb3c\\ufb3e\\ufb40-\\ufb41\\ufb43-\\ufb44\\ufb46-\\ufba1\\ufba4-\\ufba9\\ufbae-\\ufbb1\\ufbd3-\\ufbdc\\ufbde-\\ufbe7\\ufbea-\\ufbf8\\ufbfc-\\ufbfd\\ufc00-\\ufc5d\\ufc64-\\ufcf1\\ufcf5-\\ufd3d\\ufd88\\ufdf4\\ufdfa-\\ufdfb\\ufe71\\ufe77\\ufe79\\ufe7b\\ufe7d]+)|(\\ufb05+)/gu;\n    NormalizationMap = new Map([[\"\", \"t\"]]);\n  }\n  return str.replaceAll(NormalizeRegex, (_, p1, p2) => {\n    return p1 ? p1.normalize(\"NFKC\") : NormalizationMap.get(p2);\n  });\n}\n\nfunction getUuid() {\n  if (\n    (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) ||\n    (typeof crypto !== \"undefined\" && typeof crypto?.randomUUID === \"function\")\n  ) {\n    return crypto.randomUUID();\n  }\n  const buf = new Uint8Array(32);\n  if (\n    typeof crypto !== \"undefined\" &&\n    typeof crypto?.getRandomValues === \"function\"\n  ) {\n    crypto.getRandomValues(buf);\n  } else {\n    for (let i = 0; i < 32; i++) {\n      buf[i] = Math.floor(Math.random() * 255);\n    }\n  }\n  return bytesToString(buf);\n}\n\nconst AnnotationPrefix = \"pdfjs_internal_id_\";\n\nexport {\n  AbortException,\n  AnnotationActionEventType,\n  AnnotationBorderStyleType,\n  AnnotationEditorParamsType,\n  AnnotationEditorPrefix,\n  AnnotationEditorType,\n  AnnotationFieldFlag,\n  AnnotationFlag,\n  AnnotationMode,\n  AnnotationPrefix,\n  AnnotationReplyType,\n  AnnotationType,\n  assert,\n  BaseException,\n  BASELINE_FACTOR,\n  bytesToString,\n  CMapCompressionType,\n  createValidAbsoluteUrl,\n  DocumentActionEventType,\n  FeatureTest,\n  FONT_IDENTITY_MATRIX,\n  FormatError,\n  getModificationDate,\n  getUuid,\n  getVerbosityLevel,\n  IDENTITY_MATRIX,\n  ImageKind,\n  info,\n  InvalidPDFException,\n  isArrayBuffer,\n  isArrayEqual,\n  isNodeJS,\n  LINE_DESCENT_FACTOR,\n  LINE_FACTOR,\n  MAX_IMAGE_SIZE_TO_CACHE,\n  MissingPDFException,\n  normalizeUnicode,\n  objectFromMap,\n  objectSize,\n  OPS,\n  PageActionEventType,\n  PasswordException,\n  PasswordResponses,\n  PermissionFlag,\n  PromiseCapability,\n  RenderingIntentFlag,\n  setVerbosityLevel,\n  shadow,\n  string32,\n  stringToBytes,\n  stringToPDFString,\n  stringToUTF8String,\n  TextRenderingMode,\n  UnexpectedResponseException,\n  UnknownErrorException,\n  unreachable,\n  utf8StringToString,\n  Util,\n  VerbosityLevel,\n  warn,\n};\n", "// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n", "var webpackQueues = typeof Symbol === \"function\" ? Symbol(\"webpack queues\") : \"__webpack_queues__\";\nvar webpackExports = typeof Symbol === \"function\" ? Symbol(\"webpack exports\") : \"__webpack_exports__\";\nvar webpackError = typeof Symbol === \"function\" ? Symbol(\"webpack error\") : \"__webpack_error__\";\nvar resolveQueue = (queue) => {\n\tif(queue && queue.d < 1) {\n\t\tqueue.d = 1;\n\t\tqueue.forEach((fn) => (fn.r--));\n\t\tqueue.forEach((fn) => (fn.r-- ? fn.r++ : fn()));\n\t}\n}\nvar wrapDeps = (deps) => (deps.map((dep) => {\n\tif(dep !== null && typeof dep === \"object\") {\n\t\tif(dep[webpackQueues]) return dep;\n\t\tif(dep.then) {\n\t\t\tvar queue = [];\n\t\t\tqueue.d = 0;\n\t\t\tdep.then((r) => {\n\t\t\t\tobj[webpackExports] = r;\n\t\t\t\tresolveQueue(queue);\n\t\t\t}, (e) => {\n\t\t\t\tobj[webpackError] = e;\n\t\t\t\tresolveQueue(queue);\n\t\t\t});\n\t\t\tvar obj = {};\n\t\t\tobj[webpackQueues] = (fn) => (fn(queue));\n\t\t\treturn obj;\n\t\t}\n\t}\n\tvar ret = {};\n\tret[webpackQueues] = x => {};\n\tret[webpackExports] = dep;\n\treturn ret;\n}));\n__webpack_require__.a = (module, body, hasAwait) => {\n\tvar queue;\n\thasAwait && ((queue = []).d = -1);\n\tvar depQueues = new Set();\n\tvar exports = module.exports;\n\tvar currentDeps;\n\tvar outerResolve;\n\tvar reject;\n\tvar promise = new Promise((resolve, rej) => {\n\t\treject = rej;\n\t\touterResolve = resolve;\n\t});\n\tpromise[webpackExports] = exports;\n\tpromise[webpackQueues] = (fn) => (queue && fn(queue), depQueues.forEach(fn), promise[\"catch\"](x => {}));\n\tmodule.exports = promise;\n\tbody((deps) => {\n\t\tcurrentDeps = wrapDeps(deps);\n\t\tvar fn;\n\t\tvar getResult = () => (currentDeps.map((d) => {\n\t\t\tif(d[webpackError]) throw d[webpackError];\n\t\t\treturn d[webpackExports];\n\t\t}))\n\t\tvar promise = new Promise((resolve) => {\n\t\t\tfn = () => (resolve(getResult));\n\t\t\tfn.r = 0;\n\t\t\tvar fnQueue = (q) => (q !== queue && !depQueues.has(q) && (depQueues.add(q), q && !q.d && (fn.r++, q.push(fn))));\n\t\t\tcurrentDeps.map((dep) => (dep[webpackQueues](fnQueue)));\n\t\t});\n\t\treturn fn.r ? promise : getResult();\n\t}, (err) => ((err ? reject(promise[webpackError] = err) : outerResolve(exports)), resolveQueue(queue)));\n\tqueue && queue.d < 0 && (queue.d = 0);\n};", "// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};", "__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))", "", "// startup\n// Load entry module and return exports\n// This entry module used 'module' so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(907);\n", ""],
  "mappings": "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",
  "names": ["makeColorComp", "n", "Math", "floor", "max", "min", "toString", "padStart", "scaleAndClamp", "x", "ColorConverters", "CMYK_G", "c", "y", "m", "k", "G_CMYK", "g", "G_RGB", "G_rgb", "G_HTML", "G", "RGB_G", "r", "b", "RGB_rgb", "color", "map", "RGB_HTML", "join", "T_HTML", "T_rgb", "CMYK_RGB", "CMYK_rgb", "CMYK_HTML", "components", "rgb", "slice", "RGB_CMYK", "DEFAULT_TAB_INDEX", "DEFAULT_FONT_SIZE", "GetElementsByNameSet", "WeakSet", "getRectDims", "rect", "width", "height", "AnnotationElementFactory", "create", "parameters", "subtype", "data", "annotationType", "AnnotationType", "LINK", "LinkAnnotationElement", "TEXT", "TextAnnotationElement", "WIDGET", "fieldType", "TextWidgetAnnotationElement", "radioButton", "RadioButtonWidgetAnnotationElement", "checkBox", "CheckboxWidgetAnnotationElement", "PushButtonWidgetAnnotationElement", "ChoiceWidgetAnnotationElement", "SignatureWidgetAnnotationElement", "WidgetAnnotationElement", "POPUP", "PopupAnnotationElement", "FREETEXT", "FreeTextAnnotationElement", "LINE", "LineAnnotationElement", "SQUARE", "SquareAnnotationElement", "CIRCLE", "CircleAnnotationElement", "POLYLINE", "PolylineAnnotationElement", "CARET", "CaretAnnotationElement", "INK", "InkAnnotationElement", "POLYGON", "PolygonAnnotationElement", "HIGHLIGHT", "HighlightAnnotationElement", "UNDERLINE", "UnderlineAnnotationElement", "SQUIGGLY", "SquigglyAnnotationElement", "STRIKEOUT", "StrikeOutAnnotationElement", "STAMP", "StampAnnotationElement", "FILEATTACHMENT", "FileAttachmentAnnotationElement", "AnnotationElement", "constructor", "isRenderable", "ignoreBorder", "createQuadrilaterals", "layer", "linkService", "downloadManager", "imageResourcesPath", "renderForms", "svgFactory", "annotationStorage", "enableScripting", "hasJSActions", "_fieldObjects", "fieldObjects", "parent", "container", "_createContainer", "_createQuadrilaterals", "_hasPopupData", "titleObj", "contentsObj", "richText", "str", "hasPopupData", "page", "viewport", "document", "createElement", "setAttribute", "id", "tabIndex", "style", "zIndex", "popupRef", "noRotate", "classList", "add", "pageWidth", "pageHeight", "pageX", "pageY", "rawDims", "rotation", "hasOwnCanvas", "setRotation", "Util", "normalizeRect", "view", "borderStyle", "borderWidth", "horizontalRadius", "horizontalCornerRadius", "verticalRadius", "verticalCornerRadius", "radius", "borderRadius", "AnnotationBorderStyleType", "SOLID", "DASHED", "BEVELED", "warn", "INSET", "borderBottomStyle", "borderColor", "makeHexColor", "left", "top", "angle", "elementWidth", "elementHeight", "_commonActions", "setColor", "jsName", "styleName", "event", "detail", "colorType", "colorArray", "target", "setValue", "shadow", "display", "hidden", "visibility", "noView", "noPrint", "print", "focus", "setTimeout", "preventScroll", "userName", "title", "readonly", "disabled", "required", "_setRequired", "bgColor", "fillColor", "fgColor", "textColor", "strokeColor", "_dispatchEventFromSandbox", "actions", "jsEvent", "commonActions", "name", "Object", "keys", "action", "_setDefaultPropertiesFromJS", "element", "storedData", "getRawValue", "actionName", "entries", "eventProxy", "quadPoints", "rectBlX", "rectBlY", "rectTrX", "rectTrY", "length", "trX", "trY", "blX", "blY", "svgBuffer", "svg", "defs", "append", "clipPath", "rectWidth", "rectHeight", "push", "backgroundImage", "_createPopup", "popup", "modificationDate", "parentRect", "elements", "div", "render", "unreachable", "_getElementsByName", "skipId", "fields", "fieldObj", "exportValues", "exportValue", "domElement", "querySelector", "has", "getElementsByName", "getAttribute", "show", "maybeShow", "hide", "forceHide", "getElementsToTriggerPopup", "addHighlightArea", "triggers", "Array", "isArray", "_isEditable", "_editOnDoubleClick", "annotationEditorType", "mode", "editId", "addEventListener", "eventBus", "dispatch", "source", "options", "isTooltipOnly", "link", "isBound", "url", "addLinkAttributes", "newWindow", "_bindNamedAction", "attachment", "attachmentDest", "setOCGState", "dest", "_bindLink", "Action", "_bindJSAction", "resetForm", "_bindResetFormAction", "destination", "href", "getDestinationHash", "onclick", "goToDestination", "getAnchorUrl", "executeNamedAction", "openOrDownloadData", "content", "filename", "executeSetOCGState", "Map", "get", "otherClickAction", "resetFormFields", "refs", "resetFormRefs", "include", "allFields", "fieldIds", "Set", "fieldName", "values", "field", "storage", "allIds", "type", "value", "defaultValue", "dispatchEvent", "Event", "ids", "image", "src", "toLowerCase", "JSON", "stringify", "alternativeText", "showElementAndHideCanvas", "previousSibling", "nodeName", "_getKeyModifier", "FeatureTest", "platform", "isMac", "metaKey", "ctrlKey", "_setEventListener", "elementData", "baseName", "eventName", "valueGetter", "includes", "shift", "shiftKey", "modifier", "focused", "relatedTarget", "_setEventListeners", "names", "getter", "Blur", "Focus", "_setBackgroundColor", "backgroundColor", "_setTextStyle", "TEXT_ALIGNMENT", "fontColor", "defaultAppearanceData", "fontSize", "computedFontSize", "BORDER_SIZE", "roundToOneDecimal", "round", "multiLine", "abs", "numberOfLines", "LINE_FACTOR", "lineHeight", "textAlignment", "textAlign", "isRequired", "removeAttribute", "hasAppearance", "fieldValue", "setPropertyOnSiblings", "base", "key", "keyInStorage", "getValue", "textContent", "maxLen", "charLimit", "fieldFormattedValues", "formattedValue", "comb", "replaceAll", "userValue", "lastCommittedValue", "commitKey", "doNotScroll", "overflowY", "overflowX", "readOnly", "maxLength", "defaultFieldValue", "blurListener", "undefined", "scrollLeft", "activeElement", "selRange", "setSelectionRange", "willCommit", "selStart", "selectionStart", "selEnd", "selectionEnd", "_blurListener", "Keystroke", "inputType", "match", "substring", "preventDefault", "change", "fieldWidth", "combWidth", "letterSpacing", "verticalAlign", "checked", "checkbox", "curChecked", "buttonValue", "radio", "pdfButtonValue", "linkElement", "lastChild", "selectElement", "addAnEmptyEntry", "combo", "size", "multiSelect", "multiple", "option", "selected", "optionElement", "displayValue", "removeEmptyEntry", "noneOptionElement", "prepend", "remove", "removeEventListener", "isExport", "selectedIndex", "prototype", "filter", "call", "selectedValues", "getItems", "multipleSelection", "index", "i", "findIndex", "items", "clear", "insert", "selectChild", "children", "before", "item", "indices", "editable", "changeEx", "keyDown", "PopupElement", "open", "elementIds", "AnnotationPrefix", "bind", "PDFDateString", "toDateObject", "trigger", "flatMap", "e", "className", "baseColor", "outlineColor", "CSS", "supports", "BACKGROUND_ENLIGHT", "header", "dir", "date", "toLocaleDateString", "time", "toLocaleTimeString", "XfaLayer", "xfaHtml", "html", "intent", "contents", "_formatContents", "useParentRect", "intersect", "normalizedRect", "HORIZONTAL_SPACE_AFTER_ANNOTATION", "parentWidth", "popupLeft", "popupTop", "p", "lines", "split", "ii", "line", "createTextNode", "altKey", "isVisible", "parseInt", "textPosition", "AnnotationEditorType", "lineSpan", "lineCoordinates", "square", "circle", "containerClassName", "svgElementName", "points", "coordinate", "vertices", "polyline", "inkList", "inkLists", "file", "getFilenameFromUrl", "fillAlpha", "test", "evt", "AnnotationLayer", "accessibilityManager", "annotationCanvasMap", "contentElement", "firstChild", "moveElementInDOM", "params", "annotations", "setLayerDimensions", "popupToElements", "elementParams", "DOMSVGFactory", "AnnotationStorage", "noHTML", "isPopupAnnotation", "set", "rendered", "update", "canvas", "replaceWith", "getEditableAnnotations", "from", "getEditableAnnotation", "SerializableEmpty", "freeze", "hash", "transfer", "onSetModified", "onResetModified", "onAnnotationEditor", "assign", "delete", "resetModified", "AnnotationEditor", "obj", "modified", "entry", "val", "_type", "getAll", "objectFromMap", "setAll", "PrintAnnotationStorage", "serializable", "MurmurHash3_64", "context", "hasBitmap", "serialized", "serialize", "bitmap", "hexdigest", "clone", "structuredClone", "getDocument", "URL", "isArrayBuffer", "Error", "range", "task", "PDFDocumentLoadingTask", "docId", "getUrlProp", "getDataProp", "httpHeaders", "withCredentials", "password", "rangeTransport", "PDFDataRangeTransport", "rangeChunkSize", "Number", "isInteger", "DEFAULT_RANGE_CHUNK_SIZE", "worker", "PDFWorker", "verbosity", "docBaseUrl", "isDataScheme", "cMapUrl", "cMapPacked", "CMapReaderFactory", "DefaultCMapReaderFactory", "standardFontDataUrl", "StandardFontDataFactory", "DefaultStandardFontDataFactory", "ignoreErrors", "stopAtErrors", "maxImageSize", "isEvalSupported", "isOffscreenCanvasSupported", "isNodeJS", "canvasMaxAreaInBytes", "disableFontFace", "fontExtraProperties", "enableXfa", "ownerDocument", "globalThis", "disableRange", "disableStream", "disableAutoFetch", "pdfBug", "NaN", "useSystemFonts", "useWorkerFetch", "DOMCMapReaderFactory", "DOMStandardFontDataFactory", "isValidFetchUrl", "baseURI", "canvasFactory", "DefaultCanvasFactory", "filterFactory", "DefaultFilterFactory", "styleElement", "setVerbosityLevel", "transportFactory", "cMapReaderFactory", "baseUrl", "isCompressed", "standardFontDataFactory", "workerParams", "port", "GlobalWorkerOptions", "workerPort", "fromPort", "_worker", "fetchDocParams", "apiVersion", "evaluatorOptions", "transportParams", "promise", "then", "destroyed", "workerIdPromise", "_fetchDocument", "networkStreamPromise", "Promise", "resolve", "networkStream", "PDFDataTransportStream", "initialData", "progressiveDone", "contentDispositionFilename", "createPDFNetworkStream", "PDFNodeStream", "PDFFetchStream", "PDFNetworkStream", "all", "workerId", "messageHandler", "MessageHandler", "transport", "WorkerTransport", "_transport", "send", "catch", "_capability", "reject", "window", "location", "Buffer", "Uint8Array", "byteLength", "buffer", "stringToBytes", "isNaN", "RENDERING_CANCELLED_TIMEOUT", "DELAYED_CLEANUP_TIMEOUT", "NodeCanvasFactory", "DOMCanvasFactory", "NodeCMapReaderFactory", "NodeFilterFactory", "DOMFilterFactory", "NodeStandardFontDataFactory", "sendWithPromise", "PromiseCapability", "onPassword", "onProgress", "destroy", "_pendingDestroy", "ex", "_rangeListeners", "_progressListeners", "_progressiveReadListeners", "_progressiveDoneListeners", "_readyCapability", "addRangeListener", "listener", "addProgressListener", "addProgressiveReadListener", "addProgressiveDoneListener", "onDataRange", "begin", "chunk", "onDataProgress", "loaded", "total", "onDataProgressiveRead", "onDataProgressiveDone", "transportReady", "requestDataRange", "end", "abort", "PDFDocumentProxy", "pdfInfo", "_pdfInfo", "numPages", "fingerprints", "isPureXfa", "_htmlForXfa", "allXfaHtml", "getPage", "pageNumber", "getPageIndex", "ref", "getDestinations", "getDestination", "getPageLabels", "getPageLayout", "getPageMode", "getViewerPreferences", "getOpenAction", "getAttachments", "getJSActions", "getDocJSActions", "getOutline", "getOptionalContentConfig", "getPermissions", "getMetadata", "getMarkInfo", "getData", "saveDocument", "getDownloadInfo", "downloadInfoCapability", "cleanup", "keepLoadedFonts", "startCleanup", "loadingTask", "loadingParams", "getFieldObjects", "getCalculationOrderIds", "PDFPageProxy", "pageIndex", "pageInfo", "_pageIndex", "_pageInfo", "_stats", "StatTimer", "_pdfBug", "commonObjs", "objs", "PDFObjects", "_maybeCleanupAfterRender", "_intentStates", "rotate", "userUnit", "getViewport", "scale", "offsetX", "offsetY", "dontFlip", "PageViewport", "viewBox", "getAnnotations", "intentArgs", "getRenderingIntent", "renderingIntent", "getPageJSActions", "getXfa", "canvasContext", "annotationMode", "AnnotationMode", "ENABLE", "transform", "background", "optionalContentConfigPromise", "pageColors", "printAnnotationStorage", "intentState", "cacheKey", "streamReaderCancelTimeout", "clearTimeout", "intentPrint", "RenderingIntentFlag", "PRINT", "displayReadyCapability", "operatorList", "fnArray", "argsArray", "lastChunk", "separateAnnots", "_pumpOperatorList", "complete", "error", "renderTasks", "internalRenderTask", "capability", "_abortOperatorList", "reason", "timeEnd", "InternalRenderTask", "callback", "useRequestAnimationFrame", "renderTask", "transparency", "optionalContentConfig", "initializeGraphics", "operatorListChanged", "getOperatorList", "opListReadCapability", "opListTask", "streamTextContent", "includeMarkedContent", "disableNormalization", "TEXT_CONTENT_CHUNK_SIZE", "sendWithStream", "highWaterMark", "getTextContent", "xfa", "XfaText", "readableStream", "pump", "reader", "read", "done", "styles", "getReader", "getStructTree", "_destroy", "waitOn", "force", "completed", "cancel", "resetStats", "success", "delayed", "_startRenderPage", "_renderPageChunk", "operatorListChunk", "annotationStorageSerializable", "streamReader", "RenderingCancelledException", "delay", "extraDelay", "AbortException", "message", "curCacheKey", "curIntentState", "stats", "LoopbackPort", "postMessage", "terminate", "PDFWorkerUtil", "isWorkerDisabled", "fakeWorkerId", "workerSrc", "isSameOrigin", "otherUrl", "origin", "other", "createCDNWrapper", "wrapper", "createObjectURL", "Blob", "getVerbosityLevel", "_port", "_webWorker", "_messageHandler", "WeakMap", "_initializeFromPort", "_initialize", "on", "Worker", "terminateEarly", "onWorkerError", "_setupFakeWorker", "sendTest", "testObj", "info", "_setupFakeWorkerGlobal", "WorkerMessageHandler", "workerHandler", "setup", "cachedPort", "pdfjsWorker", "loader", "__non_webpack_import__", "factory", "fontLoader", "FontLoader", "_params", "destroyCapability", "_networkStream", "_fullReader", "_lastProgress", "setupMessageHandler", "cachedPromise", "isOpList", "DISPLAY", "ANY", "DISABLE", "ANNOTATIONS_DISABLE", "ENABLE_FORMS", "ANNOTATIONS_FORMS", "ENABLE_STORAGE", "ANNOTATIONS_STORAGE", "OPLIST", "hasOwnProperty", "terminated", "cancelAllRequests", "sink", "assert", "getFullReader", "onPull", "close", "ArrayBuffer", "enqueue", "onCancel", "ready", "readyReason", "headersCapability", "fullReader", "headersReady", "isStreamingSupported", "isRangeSupported", "contentLength", "rangeReader", "getRangeReader", "_numPages", "htmlForXfa", "PasswordException", "code", "InvalidPDFException", "MissingPDFException", "UnexpectedResponseException", "status", "UnknownErrorException", "details", "exception", "updatePassword", "exportedData", "exportedError", "inspectFont", "FontInspector", "enabled", "font", "fontAdded", "FontFaceObject", "finally", "imageRef", "pageProxy", "dataLen", "imageData", "MAX_IMAGE_SIZE_TO_CACHE", "fetch", "num", "gen", "results", "OptionalContentConfig", "metadata", "Metadata", "cleanupSuccessful", "objId", "settled", "Symbol", "iterator", "RenderTask", "onContinue", "form", "operatorListIdx", "running", "graphicsReadyCallback", "graphicsReady", "_useRequestAnimationFrame", "cancelled", "_cancelBound", "_continueBound", "_continue", "_scheduleNextBound", "_scheduleNext", "_nextBound", "_next", "_canvas", "StepperManager", "stepper", "init", "nextBreakPoint", "getNextBreakPoint", "gfx", "CanvasGraphics", "beginDrawing", "endDrawing", "updateOperatorList", "requestAnimationFrame", "executeOperatorList", "version", "build", "BaseFilterFactory", "addFilter", "maps", "addHCMFilter", "addHighlightHCMFilter", "newFgColor", "newBgColor", "keepHCM", "BaseCanvasFactory", "_createCanvas", "getContext", "reset", "canvasAndContext", "BaseCMapReaderFactory", "compressionType", "CMapCompressionType", "BINARY", "NONE", "_fetchData", "BaseStandardFontDataFactory", "BaseSVGFactory", "skipDimensions", "_createSVG", "PathType", "FILL", "STROKE", "SHADING", "applyBoundingBox", "ctx", "bbox", "region", "Path2D", "clip", "BaseShadingPattern", "getPattern", "RadialAxialShadingPattern", "IR", "_bbox", "_colorStops", "_p0", "_p1", "_r0", "_r1", "matrix", "_createGradient", "grad", "createLinearGradient", "createRadialGradient", "colorStop", "addColorStop", "owner", "inverse", "pathType", "pattern", "ownerBBox", "current", "getClippedPathBoundingBox", "getCurrentTransform", "ceil", "tmpCanvas", "cachedCanvases", "getCanvas", "tmpCtx", "clearRect", "beginPath", "translate", "baseTransform", "fillStyle", "fill", "createPattern", "domMatrix", "DOMMatrix", "setTransform", "drawTriangle", "p1", "p2", "p3", "c1", "c2", "c3", "coords", "colors", "bytes", "rowSize", "tmp", "x1", "scaleX", "y1", "scaleY", "x2", "y2", "x3", "y3", "c1r", "c1g", "c1b", "c2r", "c2g", "c2b", "c3r", "c3g", "c3b", "minY", "maxY", "xa", "car", "cag", "cab", "xb", "cbr", "cbg", "cbb", "x1_", "x2_", "j", "drawFigure", "figure", "ps", "cs", "verticesPerRow", "rows", "cols", "q", "MeshShadingPattern", "_coords", "_colors", "_figures", "_bounds", "_background", "_createMeshCanvas", "combinedScale", "EXPECTED_SCALE", "MAX_PATTERN_SIZE", "boundsWidth", "boundsHeight", "paddedWidth", "paddedHeight", "createImageData", "putImageData", "singularValueDecompose2dScale", "matrixScale", "temporaryPatternCanvas", "DummyShadingPattern", "getShadingPattern", "PaintType", "COLORED", "UNCOLORED", "TilingPattern", "canvasGraphicsFactory", "xstep", "ystep", "paintType", "tilingType", "createPatternCanvas", "x0", "y0", "curMatrixScale", "dimx", "getSizeAndScale", "dimy", "graphics", "createCanvasGraphics", "groupLevel", "setFillAndStrokeStyleToContext", "adjustedX0", "adjustedY0", "adjustedX1", "adjustedY1", "save", "clipBbox", "step", "realOutputSize", "maxSize", "bboxWidth", "bboxHeight", "updateRectMinMax", "endPath", "strokeStyle", "cssColor", "FormatError", "convertToRGBA", "kind", "ImageKind", "GRAYSCALE_1BPP", "convertBlackAndWhiteToRGBA", "RGB_24BPP", "convertRGBToRGBA", "srcPos", "nonBlackColor", "inverseDecode", "black", "isLittleEndian", "zeroMapping", "oneMapping", "widthInSource", "widthRemainder", "srcLength", "Uint32Array", "destPos", "elem", "len32", "src32", "s1", "s2", "s3", "jj", "grayToRGBA", "MIN_FONT_SIZE", "MAX_FONT_SIZE", "MAX_GROUP_SIZE", "EXECUTION_TIME", "EXECUTION_STEPS", "MAX_SIZE_TO_COMPILE", "FULL_CHUNK_HEIGHT", "mirrorContextOperations", "destCtx", "_removeMirroring", "__originalSave", "__originalRestore", "restore", "__originalRotate", "__originalScale", "__originalTranslate", "__originalTransform", "__originalSetTransform", "__originalResetTransform", "resetTransform", "__originalClip", "__originalMoveTo", "moveTo", "__originalLineTo", "lineTo", "__originalBezierCurveTo", "bezierCurveTo", "__originalRect", "__originalClosePath", "closePath", "__originalBeginPath", "ctxSave", "ctxRestore", "ctxTranslate", "ctxScale", "ctxTransform", "a", "d", "f", "ctxSetTransform", "ctxResetTransform", "ctxRotate", "rule", "cp1x", "cp1y", "cp2x", "cp2y", "CachedCanvases", "cache", "canvasEntry", "drawImageAtIntegerCoords", "srcImg", "srcX", "srcY", "srcW", "srcH", "destX", "destY", "destW", "destH", "tx", "ty", "tlX", "rTlX", "tlY", "rTlY", "brX", "rWidth", "brY", "rHeight", "sign", "drawImage", "hypot", "compileType3Glyph", "imgData", "POINT_TO_PROCESS_LIMIT", "POINT_TYPES", "width1", "j0", "lineSize", "pos", "mask", "count", "sum", "steps", "Int32Array", "path", "p0", "pp", "drawOutline", "CanvasExtraState", "alphaIsShape", "fontSizeScale", "textMatrix", "IDENTITY_MATRIX", "textMatrixScale", "fontMatrix", "FONT_IDENTITY_MATRIX", "leading", "lineX", "lineY", "charSpacing", "wordSpacing", "textHScale", "textRenderingMode", "TextRenderingMode", "textRise", "patternFill", "strokeAlpha", "lineWidth", "activeSMask", "transferMaps", "startNewPathAndClipBox", "clipBox", "setCurrentPoint", "updatePathMinMax", "applyTransform", "minX", "maxX", "p4", "updateScalingPathMinMax", "minMax", "scaleMinMax", "updateCurvePathMinMax", "box", "bezierBoundingBox", "getPathBoundingBox", "xStrokePad", "yStrokePad", "updateClipFromPath", "isEmptyClip", "Infinity", "putBinaryImageData", "ImageData", "partialChunkHeight", "fullChunks", "totalChunks", "chunkImgData", "thisChunkHeight", "elemsInThisChunk", "dest32", "dest32DataLength", "fullSrcDiff", "white", "srcDiff", "kEnd", "kEndUnrolled", "srcByte", "RGBA_32BPP", "subarray", "putBinaryImageMask", "copyCtxState", "sourceCtx", "properties", "property", "setLineDash", "getLineDash", "lineDashOffset", "resetCtxToDefault", "fillRule", "globalAlpha", "lineCap", "lineJoin", "miterLimit", "globalCompositeOperation", "composeSMaskBackdrop", "r0", "g0", "b0", "alpha", "alpha_", "composeSMaskAlpha", "maskData", "layerData", "transferMap", "composeSMaskLuminosity", "genericComposeSMask", "maskCtx", "layerCtx", "backdrop", "layerOffsetX", "layerOffsetY", "maskOffsetX", "maskOffsetY", "hasBackdrop", "composeFn", "PIXELS_TO_PROCESS", "chunkSize", "row", "chunkHeight", "getImageData", "composeSMask", "smask", "layerBox", "layerWidth", "layerHeight", "getImageSmoothingEnabled", "interpolate", "fround", "actualScale", "devicePixelRatio", "PixelsPerInch", "PDF_TO_CSS_UNITS", "LINE_CAP_STYLES", "LINE_JOIN_STYLES", "NORMAL_CLIP", "EO_CLIP", "canvasCtx", "markedContentStack", "stateStack", "pendingClip", "pendingEOFill", "res", "xobjs", "groupStack", "processingType3", "baseTransformStack", "smaskStack", "smaskCounter", "tempSMask", "suspendedCtx", "contentVisible", "cachedPatterns", "viewportScale", "outputScaleX", "outputScaleY", "_cachedScaleForStroking", "_cachedGetSinglePixelWidth", "_cachedBitmapsMap", "getObject", "fallback", "startsWith", "savedFillStyle", "fillRect", "transparentCanvas", "compositeCtx", "executionStartIdx", "continueCallback", "argsArrayLen", "chunkOperations", "endTime", "Date", "now", "fnId", "breakIt", "OPS", "dependency", "apply", "depObjId", "objsPool", "inSMaskMode", "HTMLCanvasElement", "hcmFilterId", "foreground", "savedFilter", "_scaleImage", "img", "inverseTransform", "widthScale", "heightScale", "paintWidth", "paintHeight", "tmpCanvasId", "newWidth", "newHeight", "_createMaskCanvas", "isPatternFill", "currentTransform", "scaled", "maskCanvas", "mainKey", "cachedImage", "maskToCanvas", "getAxialAlignedBoundingBox", "drawnWidth", "drawnHeight", "fillCanvas", "fillCtx", "getCurrentTransformInverse", "imageSmoothingEnabled", "setLineWidth", "setLineCap", "setLineJoin", "setMiterLimit", "limit", "setDash", "dashArray", "dashPhase", "setRenderingIntent", "setFlatness", "flatness", "setGState", "states", "setFont", "checkSMaskState", "beginSMaskMode", "endSMaskMode", "cacheId", "scratchCanvas", "compose", "dirtyBox", "old", "pop", "constructPath", "ops", "args", "startX", "startY", "isScalingMatrix", "minMaxForBezier", "rectangle", "xw", "yh", "curveTo", "curveTo2", "curveTo3", "stroke", "consumePath", "rescaleAndStroke", "closeStroke", "needRestore", "eoFill", "fillStroke", "eoFillStroke", "closeFillStroke", "closeEOFillStroke", "eoClip", "beginText", "endText", "paths", "pendingTextPaths", "addToPath", "setCharSpacing", "spacing", "setWordSpacing", "setHScale", "setLeading", "fontRefName", "fontObj", "fontDirection", "isType3Font", "loadedName", "typeface", "systemFontInfo", "css", "fallbackName", "bold", "italic", "browserFontSize", "setTextRenderingMode", "setTextRise", "rise", "moveText", "setLeadingMoveText", "setTextMatrix", "nextLine", "paintChar", "character", "patternTransform", "fillStrokeMode", "FILL_STROKE_MASK", "isAddToPathSet", "ADD_TO_PATH_FLAG", "missingFile", "getPathGenerator", "FILL_STROKE", "fillText", "strokeText", "isFontSubpixelAAEnabled", "showText", "glyphs", "showType3Text", "glyphsLength", "vertical", "spacingDir", "defaultVMetrics", "widthAdvanceScale", "simpleFillText", "getSinglePixelWidth", "isInvalidPDFjsFont", "chars", "glyph", "unicode", "restoreNeeded", "isSpace", "fontChar", "accent", "scaledX", "scaledY", "vmetric", "vx", "vy", "remeasure", "measuredWidth", "measureText", "characterScaleX", "isInFont", "scaledAccentX", "offset", "scaledAccentY", "charWidth", "isTextInvisible", "INVISIBLE", "spacingLength", "charProcOperatorList", "operatorListId", "transformed", "setCharWidth", "xWidth", "yWidth", "setCharWidthAndBounds", "llx", "lly", "urx", "ury", "getColorN_Pattern", "_getPattern", "setStrokeColorN", "arguments", "setFillColorN", "setStrokeRGBColor", "setFillRGBColor", "shadingFill", "inv", "beginInlineImage", "beginImageData", "paintFormXObjectBegin", "paintFormXObjectEnd", "beginGroup", "group", "currentCtx", "isolated", "knockout", "bounds", "canvasBounds", "groupCtx", "startTransformInverse", "endGroup", "currentMtx", "beginAnnotation", "canvasWidth", "canvasHeight", "annotationCanvas", "savedCtx", "endAnnotation", "paintImageMaskXObject", "compiled", "paintImageMaskXObjectRepeat", "skewX", "skewY", "positions", "trans", "paintImageMaskXObjectGroup", "images", "paintImageXObject", "paintInlineImageXObject", "paintImageXObjectRepeat", "w", "h", "paintInlineImageXObjectGroup", "applyTransferMapsToCanvas", "applyTransferMapsToBitmap", "imgToPaint", "HTMLElement", "paintSolidColorImageMask", "markPoint", "tag", "markPointProps", "beginMarkedContent", "visible", "beginMarkedContentProps", "isContentVisible", "endMarkedContent", "beginCompat", "endCompat", "isEmpty", "absDet", "normX", "normY", "getScaleForStroking", "getTransform", "scaledLineWidth", "scaledXLineWidth", "scaledYLineWidth", "baseArea", "saveRestore", "dashes", "op", "SVG_NS", "PDF", "contain", "position", "createElementNS", "body", "tableR", "tableG", "tableB", "mapR", "mapG", "mapB", "bufferR", "bufferG", "bufferB", "fgRGB", "bgRGB", "table", "getSteps", "start", "arr", "fgGray", "bgGray", "newFgRGB", "newBgRGB", "fg", "bg", "newStart", "newStep", "prev", "parentNode", "feColorMatrix", "feComponentTransfer", "func", "feFunc", "rTable", "gTable", "bTable", "getRGB", "getComputedStyle", "getPropertyValue", "_document", "fetchData", "response", "ok", "statusText", "arrayBuffer", "blob", "json", "text", "request", "XMLHttpRequest", "responseType", "onreadystatechange", "readyState", "DONE", "responseText", "cMapData", "centerX", "centerY", "rotateA", "rotateB", "rotateC", "rotateD", "offsetCanvasX", "offsetCanvasY", "convertToViewportPoint", "convertToViewportRectangle", "topLeft", "bottomRight", "convertToPdfPoint", "applyInverseTransform", "BaseException", "msg", "trim", "isPdfFile", "onlyStripPath", "lastIndexOf", "getPdfFilenameFromUrl", "defaultFilename", "reURI", "reFilename", "splitURI", "exec", "suggestedFilename", "decodeURIComponent", "started", "times", "outBuf", "longest", "padEnd", "protocol", "noContextMenu", "deprecated", "console", "log", "pdfDateStringRegex", "input", "RegExp", "matches", "year", "month", "day", "hour", "minute", "second", "universalTimeRelation", "offsetHour", "offsetMinute", "UTC", "getXfaPageViewport", "xfaPage", "attributes", "colorRGB", "getColorValues", "span", "computedColor", "invertSelf", "mustFlip", "mustRotate", "useRound", "isCSSRoundSupported", "widthStr", "heightStr", "DrawLayer", "setParent", "root", "_svgFactory", "highlight", "outlines", "opacity", "pathId", "clipPathId", "clipPathUse", "use", "highlightOutline", "use1", "use2", "cloneNode", "polygons", "polygon", "prevX", "prevY", "updateBox", "changeColor", "changeOpacity", "addClass", "removeClass", "FreeTextEditor", "editorDivBlur", "editorDivFocus", "editorDivInput", "editorDivKeydown", "_freeTextDefaultContent", "_internalPadding", "_defaultColor", "_defaultFontSize", "_keyboardManager", "proto", "arrowChecker", "self", "small", "AnnotationEditorUIManager", "TRANSLATE_SMALL", "big", "TRANSLATE_BIG", "KeyboardManager", "commitOrRemove", "bubbles", "_translateEmpty", "checker", "_editorType", "_defaultLineColor", "initialize", "l10n", "strings", "documentElement", "parseFloat", "updateDefaultParams", "AnnotationEditorParamsType", "FREETEXT_SIZE", "FREETEXT_COLOR", "updateParams", "defaultPropertiesToUpdate", "propertiesToUpdate", "setFontsize", "editorDiv", "parentScale", "savedFontsize", "addCommands", "cmd", "undo", "mustExec", "overwriteIfSameType", "keepUndo", "savedColor", "_uiManager", "translateSelectedEditors", "getInitialTranslation", "rebuild", "isAttachedToDOM", "enableEditMode", "isInEditMode", "setEditingState", "updateToolbar", "overlayDiv", "contentEditable", "_isDraggable", "disableEditMode", "isEditing", "focusin", "_focusEventsAllowed", "onceAdded", "_initialOptions", "isCentered", "center", "innerText", "divs", "getElementsByTagName", "replace", "parentHeight", "parentDimensions", "getBoundingClientRect", "currentLayer", "savedDisplay", "parentRotation", "fixAndSetPosition", "commit", "savedText", "newText", "trimEnd", "setText", "shouldGetKeyboardEvents", "enterInEditMode", "dblclick", "keydown", "toggle", "disableEditing", "enableEditing", "baseX", "baseY", "_l10nPromise", "bindEvents", "annotationElementId", "pageTranslationToScreen", "pageDimensions", "pageTranslation", "posX", "posY", "setAt", "replaceChildren", "contentDiv", "deserialize", "uiManager", "deleted", "editor", "isForCopying", "padding", "getRect", "_colorManager", "convert", "structTreeParentId", "_structTreeParentId", "some", "HighlightEditor", "_defaultOpacity", "highlightColors", "next", "boxes", "outliner", "Outliner", "getOutlines", "outlinerForOutline", "direction", "lastPoint", "HIGHLIGHT_DEFAULT_COLOR", "toolbarPosition", "HIGHLIGHT_COLOR", "drawLayer", "updateColor", "addEditToolbar", "toolbar", "ColorPicker", "addColorPicker", "addUndoableEditor", "mustBeSelected", "contains", "select", "highlightDiv", "setDims", "pointerover", "pointerleave", "unselect", "sx", "sy", "outline", "canCreateNewEmptyEditor", "InkEditor", "canvasPointermove", "canvasPointerleave", "canvasPointerup", "canvasPointerdown", "_defaultThickness", "thickness", "bezierPath2D", "allRawPaths", "currentPath", "scaleFactor", "translationX", "translationY", "_willKeepAspectRatio", "INK_THICKNESS", "INK_COLOR", "INK_OPACITY", "savedThickness", "savedOpacity", "disconnect", "removeShouldRescale", "addShouldRescale", "onScaleChanging", "setDimensions", "opacityToHex", "lastX", "lastY", "at", "path2D", "bezier", "xy", "lastPoints", "xMin", "xMax", "yMin", "yMax", "bezierPoints", "control1", "control2", "setInForeground", "addInkEditorIfNeeded", "moveInDOM", "button", "addToAnnotationStorage", "setInBackground", "ResizeObserver", "contentRect", "observe", "isResizable", "setAspectRatio", "roundedWidth", "roundedHeight", "fixDims", "scaleFactorW", "scaleFactorH", "first", "s", "shiftX", "shiftY", "p10", "p11", "p20", "p21", "p30", "p31", "p40", "p41", "firstTime", "MIN_SIZE", "prevTranslationX", "prevTranslationY", "unscaledPadding", "StampEditor", "bitmapUrl", "bitmapFile", "supportedTypes", "types", "supportedTypesStr", "isHandlingMimeForPasting", "mime", "paste", "pasteEditor", "getAsFile", "fromId", "isSvg", "enableWaiting", "imageManager", "getFromId", "getFromUrl", "getFromFile", "accept", "files", "click", "deleteId", "MAX_RATIO", "factor", "_eventBus", "editorType", "addAltTextButton", "TIME_TO_WAIT", "bitmapWidth", "bitmapHeight", "prevWidth", "prevHeight", "offscreen", "OffscreenCanvas", "transferToImageBitmap", "hcmFilter", "getImageForAltText", "toUrl", "getSvgUrl", "toDataURL", "bitmapId", "accessibilityData", "isValidId", "altTextData", "decorative", "altText", "alt", "stamps", "area", "prevData", "AnnotationEditorLayer", "pointerup", "pointerUpAfterSelection", "pointerdown", "_initialized", "annotationLayer", "textLayer", "editorTypes", "registerEditorTypes", "addLayer", "updateMode", "getMode", "disableTextSelection", "togglePointerEvents", "disableClick", "enableTextSelection", "enableClick", "isCommitting", "enable", "annotationElementIds", "editables", "isDeletedAnnotationElement", "addOrRebuild", "disable", "hiddenAnnotationIds", "setActiveEditor", "currentActive", "getActive", "attach", "removeDeletedAnnotationElement", "detach", "removePointerInTextLayer", "addDeletedAnnotationElement", "removeEditor", "changeParent", "deleteAnnotationElement", "addEditor", "moveEditorInDOM", "once", "needsToBeRebuilt", "getNextId", "getId", "innerWidth", "innerHeight", "addNewEditor", "setSelected", "toggleSelected", "isSelected", "_event", "selection", "getSelection", "rangeCount", "getRangeAt", "collapsed", "commonAncestorContainer", "layerX", "layerY", "bboxes", "getClientRects", "rotator", "empty", "unselectAll", "findNewParent", "findParent", "removeLayer", "getEditors", "oldRotation", "_hideDropdownFromKeyboard", "_colorSelectFromKeyboard", "_moveToNext", "_moveToPrevious", "_moveToBeginning", "_moveToEnd", "renderButton", "swatch", "renderMainDropdown", "dropdown", "paramType", "role", "stopPropagation", "nextSibling", "hideDropdown", "focusVisible", "child", "AltText", "l10nPromise", "onClick", "editAltText", "capture", "finish", "tooltip", "DELAY_TO_SHOW_TOOLTIP", "EditorToolbar", "editToolbar", "buttons", "insetInlineEnd", "divider", "colorPicker", "focusout", "_zIndex", "_borderLineWidth", "ColorManager", "_resizerKeyboardManager", "resize", "_resizeWithKeyboard", "_stopResizingWithKeyboard", "pageRotation", "viewParameters", "getPrototypeOf", "getHexCode", "fakeEditor", "FakeEditor", "_value", "isEnterHandled", "closest", "isMultipleSelection", "screenToPageTranslation", "translateInPage", "scrollIntoView", "block", "drag", "bx", "by", "toFixed", "realScale", "scaledWidth", "scaledHeight", "widthPercent", "endsWith", "heightPercent", "classes", "boundResizerPointermove", "savedDraggable", "pointerMoveOptions", "passive", "savedX", "savedY", "savedWidth", "savedHeight", "savedParentCursor", "cursor", "savedCursor", "pointerUpCallback", "newX", "newY", "minWidth", "minHeight", "rotationMatrix", "transf", "invRotationMatrix", "invTransf", "getPoint", "getOpposite", "isDiagonal", "isHorizontal", "point", "oppositePoint", "transfOppositePoint", "oppositeX", "oppositeY", "ratioX", "ratioY", "deltaX", "deltaY", "movementX", "movementY", "oldDiag", "altTextFinish", "removeEditToolbar", "getClientDimensions", "maxWidth", "maxHeight", "setUpDragSession", "pointerMoveCallback", "dragSelectedEditors", "endDragSession", "_setParentAndPosition", "getRectInCurrentCoords", "_angle", "makeResizable", "boundResizerKeydown", "boundResizerBlur", "firstPosition", "nextFirstPosition", "stopImmediatePropagation", "aspectRatio", "innerMargin", "isLTR", "NUMBER_OF_DIGITS", "EPSILON", "right", "shiftedMinX", "shiftedMinY", "lastEdge", "edge", "sort", "outlineVerticalEdges", "edges", "allEdges", "edge1", "edge2", "lastPointX", "lastPointY", "array", "middle", "splice", "y4", "IdManager", "AnnotationEditorPrefix", "ImageManager", "getUuid", "_isSVGFittingCanvas", "Image", "decode", "rawData", "refCounter", "mustRemoveAspectRatioPromise", "fileReader", "FileReader", "imageElement", "imagePromise", "onload", "svgUrl", "result", "onerror", "readAsDataURL", "createImageBitmap", "lastModified", "CommandManager", "redo", "hasSomethingToUndo", "hasSomethingToRedo", "callbacks", "allKeys", "isMacKey", "_colorsMapping", "matchMedia", "RGB", "every", "blur", "copy", "cut", "onEditingAction", "onPageChanging", "onRotationChanging", "hasSelectedEditor", "tagName", "hasSomethingToControl", "textInputChecker", "_self", "el", "HTMLInputElement", "selectAll", "addNewEditorFromKeyboard", "HTMLButtonElement", "viewer", "altTextManager", "pdfDocument", "_on", "_off", "pair", "setMainHighlightColorPicker", "focusMainContainer", "disableUserSelect", "pagesRotation", "hasSelection", "lastEditor", "lastActiveElement", "addEditListeners", "removeEditListeners", "editors", "clipboardData", "setData", "parse", "newEditors", "deserializedEditor", "isEditorHandlingKeyboard", "hasChanged", "getLayer", "currentPageIndex", "isFromKeyboard", "CREATE", "mustWait", "getEditor", "ed", "firstSelectedEditor", "noCommit", "totalX", "totalY", "savedPageIndex", "newPageIndex", "mustBeAddedInUndoStack", "move", "isActive", "createFetchOptions", "headers", "abortController", "method", "signal", "credentials", "redirect", "createHeaders", "Headers", "getArrayBuffer", "isHttp", "_fullRequestReader", "_rangeRequestReaders", "_progressiveDataLength", "_loaded", "PDFFetchStreamReader", "PDFFetchStreamRangeReader", "stream", "_stream", "_reader", "_filename", "_withCredentials", "_contentLength", "_headersCapability", "_disableRange", "_rangeChunkSize", "_abortController", "AbortController", "_isStreamingSupported", "_isRangeSupported", "_headers", "validateResponseStatus", "createResponseStatusError", "getResponseHeader", "allowRangeRequests", "suggestedLength", "validateRangeRequestCapabilities", "extractFilenameFromHeader", "_readCapability", "nativeFontFaces", "loadingRequests", "loadTestFontId", "addNativeFontFace", "nativeFontFace", "fonts", "removeNativeFontFace", "insertRule", "styleSheet", "sheet", "cssRules", "loadSystemFont", "_inspectFont", "isFontLoadingAPISupported", "fontFace", "FontFace", "load", "baseFontName", "attached", "createNativeFontFace", "family", "createFontFaceRule", "isSyncFontLoadingSupported", "_queueLoadingCallback", "_prepareFontLoadEvent", "hasFonts", "supported", "navigator", "userAgent", "completeRequest", "otherRequest", "_loadTestFont", "testFont", "atob", "int32", "charCodeAt", "spliceString", "chunk1", "chunk2", "called", "isFontReady", "COMMENT_OFFSET", "CFF_CHECKSUM_OFFSET", "XXXX_VALUE", "checksum", "string32", "btoa", "fontFamily", "translatedData", "compiledGlyphs", "cssFontInfo", "weight", "fontWeight", "italicAngle", "bytesToString", "mimetype", "cmds", "jsBuf", "Function", "parsedData", "getRaw", "OK_RESPONSE", "PARTIAL_CONTENT_RESPONSE", "xhr", "NetworkManager", "currXhrId", "pendingRequests", "requestRange", "listeners", "prop", "requestFull", "xhrId", "pendingRequest", "setRequestHeader", "expectedStatus", "onError", "onStateChange", "onprogress", "onHeadersReceived", "onDone", "xhrStatus", "ok_response_on_range_request", "rangeHeader", "getRequestXhr", "isPendingRequest", "abortRequest", "_source", "_manager", "_onRangeRequestReaderClosed", "indexOf", "PDFNetworkStreamFullRequestReader", "PDFNetworkStreamRangeRequestReader", "onClosed", "manager", "_onHeadersReceived", "_onDone", "_onError", "_onProgress", "_url", "_fullRequestId", "_headersReceivedCapability", "_cachedChunks", "_requests", "_done", "_storedError", "fullRequestXhrId", "fullRequestXhr", "requestCapability", "lengthComputable", "_requestId", "_queuedChunk", "_close", "getFilenameFromContentDispositionHeader", "contentDisposition", "needsEncodingFixup", "toParamRegExp", "rfc2616unquote", "unescape", "rfc5987decode", "rfc2047decode", "fixupEncoding", "rfc2231getparam", "attributePattern", "flags", "textdecode", "encoding", "decoder", "TextDecoder", "fatal", "contentDispositionStr", "iter", "quot", "part", "parts", "quotindex", "extvalue", "encodingend", "langvalue", "charset", "hex", "String", "fromCharCode", "returnValues", "contentEncoding", "parseUrl", "sourceUrl", "parsedUrl", "host", "createRequestOptions", "auth", "hostname", "fs", "http", "https", "fileUriRegex", "isFsUrl", "PDFNodeStreamFsFullReader", "PDFNodeStreamFullReader", "PDFNodeStreamFsRangeReader", "PDFNodeStreamRangeReader", "BaseFullReader", "_readableStream", "_error", "_setReadableStream", "BaseRangeReader", "handleResponse", "statusCode", "_request", "_httpHeaders", "Range", "lstat", "stat", "createReadStream", "path2d_polyfill", "readFile", "createCanvas", "INTERNAL", "OptionalContentGroup", "_setVisible", "internal", "creator", "order", "groups", "baseState", "off", "getHash", "operator", "state", "expression", "policy", "setVisibility", "hasInitialVisibility", "getOrder", "getGroups", "getGroup", "MAX_TEXT_DIVS_TO_RENDER", "DEFAULT_FONT_ASCENT", "ascentCache", "getCtx", "getAscent", "cachedAscent", "metrics", "ascent", "fontBoundingBoxAscent", "descent", "fontBoundingBoxDescent", "ratio", "pixels", "appendText", "geom", "textDiv", "textDivProperties", "hasText", "hasEOL", "_textDivs", "_transform", "atan2", "fontName", "PI", "_fontInspectorEnabled", "fontSubstitution", "fontHeight", "fontAscent", "_isOffscreenCanvasSupported", "sin", "cos", "scaleFactorStr", "divStyle", "_container", "_rootContainer", "_pageWidth", "_pageHeight", "dataset", "fontSubstitutionLoadedName", "shouldScaleText", "absScaleX", "absScaleY", "_textDivProperties", "_isReadableStream", "_layoutText", "layout", "prevFontSize", "prevFontFamily", "_canceled", "textDivs", "textDivsLength", "TextLayerRenderTask", "textContentSource", "textContentItemsStr", "_textContentSource", "ReadableStream", "_textContentItemsStr", "_layoutTextParams", "_processItems", "styleCache", "br", "_render", "renderTextLayer", "updateTextLayer", "mustRescale", "pdfDataRangeTransport", "_queuedChunks", "_progressiveDone", "_contentDispositionFilename", "_pdfDataRangeTransport", "_rangeReaders", "_onReceiveData", "_onProgressiveDone", "_enqueue", "found", "_begin", "_removeRangeReader", "queuedChunks", "PDFDataTransportStreamReader", "PDFDataTransportStreamRangeReader", "_headersReady", "_end", "requestsCapability", "setupStorage", "xfaOn", "xfaOff", "setAttributes", "isHTMLAnchorElement", "HTMLAnchorElement", "dataId", "rootHtml", "isNotForRichText", "rootDiv", "node", "shouldBuildText", "stack", "childHtml", "xmlns", "querySelectorAll", "output", "walk", "pdfjsVersion", "pdfjsBuild", "CallbackKind", "UNKNOWN", "DATA", "ERROR", "StreamKind", "CANCEL", "CANCEL_COMPLETE", "CLOSE", "ENQUEUE", "PULL", "PULL_COMPLETE", "START_COMPLETE", "wrapReason", "sourceName", "targetName", "comObj", "callbackId", "streamId", "streamSinks", "streamControllers", "callbackCapabilities", "actionHandler", "_onComObjOnMessage", "cbSourceName", "cbTargetName", "handler", "ah", "transfers", "queueingStrategy", "controller", "startCapability", "startCall", "pullCall", "cancelCall", "isClosed", "desiredSize", "pull", "pullCapability", "cancelCapability", "streamSink", "isCancelled", "lastDesiredSize", "sinkCapability", "streamController", "allSettled", "SEED", "MASK_HIGH", "MASK_LOW", "seed", "h1", "h2", "blockCounts", "tailLength", "dataUint32", "k1", "k2", "C1", "C2", "C1_LOW", "C2_LOW", "process", "versions", "nw", "electron", "LINE_DESCENT_FACTOR", "BASELINE_FACTOR", "SAVE", "RESIZE", "FREETEXT_OPACITY", "PermissionFlag", "MODIFY_CONTENTS", "COPY", "MODIFY_ANNOTATIONS", "FILL_INTERACTIVE_FORMS", "COPY_FOR_ACCESSIBILITY", "ASSEMBLE", "PRINT_HIGH_QUALITY", "FILL_ADD_TO_PATH", "STROKE_ADD_TO_PATH", "FILL_STROKE_ADD_TO_PATH", "ADD_TO_PATH", "SOUND", "MOVIE", "SCREEN", "PRINTERMARK", "TRAPNET", "WATERMARK", "THREED", "REDACT", "AnnotationReplyType", "GROUP", "REPLY", "AnnotationFlag", "HIDDEN", "NOZOOM", "NOROTATE", "NOVIEW", "READONLY", "LOCKED", "TOGGLENOVIEW", "LOCKEDCONTENTS", "AnnotationFieldFlag", "REQUIRED", "NOEXPORT", "MULTILINE", "PASSWORD", "NOTOGGLETOOFF", "RADIO", "PUSHBUTTON", "COMBO", "EDIT", "SORT", "FILESELECT", "MULTISELECT", "DONOTSPELLCHECK", "DONOTSCROLL", "COMB", "RICHTEXT", "RADIOSINUNISON", "COMMITONSELCHANGE", "AnnotationActionEventType", "E", "X", "D", "U", "Fo", "Bl", "PO", "PC", "PV", "K", "F", "V", "C", "DocumentActionEventType", "WC", "WS", "DS", "WP", "DP", "PageActionEventType", "O", "VerbosityLevel", "ERRORS", "WARNINGS", "INFOS", "showSpacedText", "nextLineShowText", "nextLineSetSpacingShowText", "setStrokeColorSpace", "setFillColorSpace", "setStrokeColor", "setFillColor", "setStrokeGray", "setFillGray", "setStrokeCMYKColor", "setFillCMYKColor", "endInlineImage", "paintXObject", "PasswordResponses", "NEED_PASSWORD", "INCORRECT_PASSWORD", "level", "cond", "_isValidProtocol", "createValidAbsoluteUrl", "addDefaultProtocol", "dots", "tryConvertEncoding", "stringToUTF8String", "absoluteUrl", "nonSerializable", "defineProperty", "enumerable", "configurable", "writable", "BaseExceptionClosure", "MAX_ARGUMENT_COUNT", "strBuf", "chunkEnd", "objectSize", "buffer8", "view32", "hexNumbers", "temp", "m1", "m2", "xt", "yt", "transpose", "sqrt", "rect1", "rect2", "xLow", "xHigh", "yLow", "yHigh", "tvalues", "t", "t1", "t2", "b2ac", "sqrtb2ac", "mt", "jlen", "PDFStringTranslateTable", "stringToPDFString", "decoded", "charCode", "charAt", "escape", "utf8StringToString", "encodeURIComponent", "v", "isArrayEqual", "arr1", "arr2", "getModificationDate", "getUTCFullYear", "getUTCMonth", "getUTCDate", "getUTCHours", "getUTCMinutes", "getUTCSeconds", "NormalizeRegex", "NormalizationMap", "normalizeUnicode", "_", "normalize", "crypto", "randomUUID", "buf", "getRandomValues", "random"]
}
